montageDefine("f57d345","lib/_stream_writable",{dependencies:["buffer","core-util-is","inherits","stream","./_stream_duplex"],factory:function(e,i,t){function s(e,i,t){this.chunk=e,this.encoding=i,this.callback=t}function a(e,i){e=e||{};var t=e.highWaterMark;this.highWaterMark=t||0===t?t:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=e.decodeStrings===!1;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){p(i,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function u(i){var t=e("./_stream_duplex");return this instanceof u||this instanceof t?(this._writableState=new a(i,this),this.writable=!0,P.call(this),void 0):new u(i)}function n(e,i,t){var s=Error("write after end");e.emit("error",s),process.nextTick(function(){t(s)})}function r(e,i,t,s){var a=!0;if(!S.isBuffer(t)&&"string"!=typeof t&&null!==t&&void 0!==t&&!i.objectMode){var u=new TypeError("Invalid non-string/buffer chunk");e.emit("error",u),process.nextTick(function(){s(u)}),a=!1}return a}function l(e,i,t){return e.objectMode||e.decodeStrings===!1||"string"!=typeof i||(i=new S(i,t)),i}function o(e,i,t,a,u){t=l(i,t,a),S.isBuffer(t)&&(a="buffer");var n=i.objectMode?1:t.length;i.length+=n;var r=i.length<i.highWaterMark;return r||(i.needDrain=!0),i.writing?i.buffer.push(new s(t,a,u)):c(e,i,n,t,a,u),r}function c(e,i,t,s,a,u){i.writelen=t,i.writecb=u,i.writing=!0,i.sync=!0,e._write(s,a,i.onwrite),i.sync=!1}function m(e,i,t,s,a){t?process.nextTick(function(){a(s)}):a(s),e._writableState.errorEmitted=!0,e.emit("error",s)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function p(e,i){var t=e._writableState,s=t.sync,a=t.writecb;if(d(t),i)m(e,t,s,i,a);else{var u=f(e,t);u||t.bufferProcessing||!t.buffer.length||h(e,t),s?process.nextTick(function(){v(e,t,u,a)}):v(e,t,u,a)}}function v(e,i,t,s){t||g(e,i),s(),t&&b(e,i)}function g(e,i){0===i.length&&i.needDrain&&(i.needDrain=!1,e.emit("drain"))}function h(e,i){i.bufferProcessing=!0;for(var t=0;i.buffer.length>t;t++){var s=i.buffer[t],a=s.chunk,u=s.encoding,n=s.callback,r=i.objectMode?1:a.length;if(c(e,i,r,a,u,n),i.writing){t++;break}}i.bufferProcessing=!1,i.buffer.length>t?i.buffer=i.buffer.slice(t):i.buffer.length=0}function f(e,i){return i.ending&&0===i.length&&!i.finished&&!i.writing}function b(e,i){var t=f(e,i);return t&&(i.finished=!0,e.emit("finish")),t}function q(e,i,t){i.ending=!0,b(e,i),t&&(i.finished?process.nextTick(t):e.once("finish",t)),i.ended=!0}t.exports=u;var S=e("buffer").Buffer;u.WritableState=a;var y=e("core-util-is");y.inherits=e("inherits");var P=e("stream");y.inherits(u,P),u.prototype.pipe=function(){this.emit("error",Error("Cannot pipe. Not readable."))},u.prototype.write=function(e,i,t){var s=this._writableState,a=!1;return"function"==typeof i&&(t=i,i=null),S.isBuffer(e)?i="buffer":i||(i=s.defaultEncoding),"function"!=typeof t&&(t=function(){}),s.ended?n(this,s,t):r(this,s,e,t)&&(a=o(this,s,e,i,t)),a},u.prototype._write=function(e,i,t){t(Error("not implemented"))},u.prototype.end=function(e,i,t){var s=this._writableState;"function"==typeof e?(t=e,e=null,i=null):"function"==typeof i&&(t=i,i=null),e!==void 0&&null!==e&&this.write(e,i),s.ending||s.finished||q(this,s,t)}}});