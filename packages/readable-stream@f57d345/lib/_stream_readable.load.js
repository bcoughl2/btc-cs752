montageDefine("f57d345","lib/_stream_readable",{dependencies:["isarray","buffer","events","stream","core-util-is","inherits","string_decoder/"],factory:function(e,i,t){function s(i){i=i||{};var t=i.highWaterMark;this.highWaterMark=t||0===t?t:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!i.objectMode,this.defaultEncoding=i.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,i.encoding&&(A||(A=e("string_decoder/").StringDecoder),this.decoder=new A(i.encoding),this.encoding=i.encoding)}function a(e){return this instanceof a?(this._readableState=new s(e,this),this.readable=!0,D.call(this),void 0):new a(e)}function u(e,i,t,s,a){var u=o(i,t);if(u)e.emit("error",u);else if(null===t||void 0===t)i.reading=!1,i.ended||c(e,i);else if(i.objectMode||t&&t.length>0)if(i.ended&&!a){var r=Error("stream.push() after EOF");e.emit("error",r)}else if(i.endEmitted&&a){var r=Error("stream.unshift() after end event");e.emit("error",r)}else!i.decoder||a||s||(t=i.decoder.write(t)),i.length+=i.objectMode?1:t.length,a?i.buffer.unshift(t):(i.reading=!1,i.buffer.push(t)),i.needReadable&&m(e),p(e,i);else a||(i.reading=!1);return n(i)}function n(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function r(e){if(e>=E)e=E;else{e--;for(var i=1;32>i;i<<=1)e|=e>>i;e++}return e}function l(e,i){return 0===i.length&&i.ended?0:i.objectMode?0===e?0:1:isNaN(e)||null===e?i.flowing&&i.buffer.length?i.buffer[0].length:i.length:0>=e?0:(e>i.highWaterMark&&(i.highWaterMark=r(e)),e>i.length?i.ended?i.length:(i.needReadable=!0,0):e)}function o(e,i){var t=null;return N.isBuffer(i)||"string"==typeof i||null===i||void 0===i||e.objectMode||t||(t=new TypeError("Invalid non-string/buffer chunk")),t}function c(e,i){if(i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&(i.buffer.push(t),i.length+=i.objectMode?1:t.length)}i.ended=!0,i.length>0?m(e):S(e)}function m(e){var i=e._readableState;i.needReadable=!1,i.emittedReadable||(i.emittedReadable=!0,i.sync?process.nextTick(function(){d(e)}):d(e))}function d(e){e.emit("readable")}function p(e,i){i.readingMore||(i.readingMore=!0,process.nextTick(function(){v(e,i)}))}function v(e,i){for(var t=i.length;!i.reading&&!i.flowing&&!i.ended&&i.length<i.highWaterMark&&(e.read(0),t!==i.length);)t=i.length;i.readingMore=!1}function g(e){return function(){var i=e._readableState;i.awaitDrain--,0===i.awaitDrain&&h(e)}}function h(e){function i(e){var i=e.write(t);!1===i&&s.awaitDrain++}var t,s=e._readableState;for(s.awaitDrain=0;s.pipesCount&&null!==(t=e.read());)if(1===s.pipesCount?i(s.pipes,0,null):y(s.pipes,i),e.emit("data",t),s.awaitDrain>0)return;return 0===s.pipesCount?(s.flowing=!1,C.listenerCount(e,"data")>0&&b(e),void 0):(s.ranOut=!0,void 0)}function f(){this._readableState.ranOut&&(this._readableState.ranOut=!1,h(this))}function b(e,i){var t=e._readableState;if(t.flowing)throw Error("Cannot switch to old mode now.");var s=i||!1,a=!1;e.readable=!0,e.pipe=D.prototype.pipe,e.on=e.addListener=D.prototype.on,e.on("readable",function(){a=!0;for(var i;!s&&null!==(i=e.read());)e.emit("data",i);null===i&&(a=!1,e._readableState.needReadable=!0)}),e.pause=function(){s=!0,this.emit("pause")},e.resume=function(){s=!1,a?process.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function q(e,i){var t,s=i.buffer,a=i.length,u=!!i.decoder,n=!!i.objectMode;if(0===s.length)return null;if(0===a)t=null;else if(n)t=s.shift();else if(!e||e>=a)t=u?s.join(""):N.concat(s,a),s.length=0;else if(s[0].length>e){var r=s[0];t=r.slice(0,e),s[0]=r.slice(e)}else if(e===s[0].length)t=s.shift();else{t=u?"":new N(e);for(var l=0,o=0,c=s.length;c>o&&e>l;o++){var r=s[0],m=Math.min(e-l,r.length);u?t+=r.slice(0,m):r.copy(t,l,0,m),r.length>m?s[0]=r.slice(m):s.shift(),l+=m}}return t}function S(e){var i=e._readableState;if(i.length>0)throw Error("endReadable called on non-empty stream");!i.endEmitted&&i.calledRead&&(i.ended=!0,process.nextTick(function(){i.endEmitted||0!==i.length||(i.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function y(e,i){for(var t=0,s=e.length;s>t;t++)i(e[t],t)}function P(e,i){for(var t=0,s=e.length;s>t;t++)if(e[t]===i)return t;return-1}t.exports=a;var _=e("isarray"),N=e("buffer").Buffer;a.ReadableState=s;var C=e("events").EventEmitter;C.listenerCount||(C.listenerCount=function(e,i){return e.listeners(i).length});var D=e("stream"),M=e("core-util-is");M.inherits=e("inherits");var A;M.inherits(a,D),a.prototype.push=function(e,i){var t=this._readableState;return"string"!=typeof e||t.objectMode||(i=i||t.defaultEncoding,i!==t.encoding&&(e=new N(e,i),i="")),u(this,t,e,i,!1)},a.prototype.unshift=function(e){var i=this._readableState;return u(this,i,e,"",!0)},a.prototype.setEncoding=function(i){A||(A=e("string_decoder/").StringDecoder),this._readableState.decoder=new A(i),this._readableState.encoding=i};var E=8388608;a.prototype.read=function(e){var i=this._readableState;i.calledRead=!0;var t=e;if(("number"!=typeof e||e>0)&&(i.emittedReadable=!1),0===e&&i.needReadable&&(i.length>=i.highWaterMark||i.ended))return m(this),null;if(e=l(e,i),0===e&&i.ended)return 0===i.length&&S(this),null;var s=i.needReadable;i.length-e<=i.highWaterMark&&(s=!0),(i.ended||i.reading)&&(s=!1),s&&(i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1),s&&!i.reading&&(e=l(t,i));var a;return a=e>0?q(e,i):null,null===a&&(i.needReadable=!0,e=0),i.length-=e,0!==i.length||i.ended||(i.needReadable=!0),i.ended&&!i.endEmitted&&0===i.length&&S(this),a},a.prototype._read=function(){this.emit("error",Error("not implemented"))},a.prototype.pipe=function(e,i){function t(e){e===o&&a()}function s(){e.end()}function a(){e.removeListener("close",n),e.removeListener("finish",r),e.removeListener("drain",p),e.removeListener("error",u),e.removeListener("unpipe",t),o.removeListener("end",s),o.removeListener("end",a),(!e._writableState||e._writableState.needDrain)&&p()}function u(i){l(),e.removeListener("error",u),0===C.listenerCount(e,"error")&&e.emit("error",i)}function n(){e.removeListener("finish",r),l()}function r(){e.removeListener("close",n),l()}function l(){o.unpipe(e)}var o=this,c=this._readableState;switch(c.pipesCount){case 0:c.pipes=e;break;case 1:c.pipes=[c.pipes,e];break;default:c.pipes.push(e)}c.pipesCount+=1;var m=(!i||i.end!==!1)&&e!==process.stdout&&e!==process.stderr,d=m?s:a;c.endEmitted?process.nextTick(d):o.once("end",d),e.on("unpipe",t);var p=g(o);return e.on("drain",p),e._events&&e._events.error?_(e._events.error)?e._events.error.unshift(u):e._events.error=[u,e._events.error]:e.on("error",u),e.once("close",n),e.once("finish",r),e.emit("pipe",o),c.flowing||(this.on("readable",f),c.flowing=!0,process.nextTick(function(){h(o)})),e},a.prototype.unpipe=function(e){var i=this._readableState;if(0===i.pipesCount)return this;if(1===i.pipesCount)return e&&e!==i.pipes?this:(e||(e=i.pipes),i.pipes=null,i.pipesCount=0,this.removeListener("readable",f),i.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var t=i.pipes,s=i.pipesCount;i.pipes=null,i.pipesCount=0,this.removeListener("readable",f),i.flowing=!1;for(var a=0;s>a;a++)t[a].emit("unpipe",this);return this}var a=P(i.pipes,e);return-1===a?this:(i.pipes.splice(a,1),i.pipesCount-=1,1===i.pipesCount&&(i.pipes=i.pipes[0]),e.emit("unpipe",this),this)},a.prototype.on=function(e,i){var t=D.prototype.on.call(this,e,i);if("data"!==e||this._readableState.flowing||b(this),"readable"===e&&this.readable){var s=this._readableState;s.readableListening||(s.readableListening=!0,s.emittedReadable=!1,s.needReadable=!0,s.reading?s.length&&m(this,s):this.read(0))}return t},a.prototype.addListener=a.prototype.on,a.prototype.resume=function(){b(this),this.read(0),this.emit("resume")},a.prototype.pause=function(){b(this,!0),this.emit("pause")},a.prototype.wrap=function(e){var i=this._readableState,t=!1,s=this;e.on("end",function(){if(i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&s.push(e)}s.push(null)}),e.on("data",function(a){if(i.decoder&&(a=i.decoder.write(a)),a&&(i.objectMode||a.length)){var u=s.push(a);u||(t=!0,e.pause())}});for(var a in e)"function"==typeof e[a]&&this[a]===void 0&&(this[a]=function(i){return function(){return e[i].apply(e,arguments)}}(a));var u=["error","close","destroy","pause","resume"];return y(u,function(i){e.on(i,s.emit.bind(s,i))}),s._read=function(){t&&(t=!1,e.resume())},s},a._fromList=q}});