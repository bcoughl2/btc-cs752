montageDefine("3c07db4","core/event/event-manager",{dependencies:["../core","../uuid","./mutable-event","../serialization"],factory:function(e,t){var r,i=e("../core").Montage,n=e("../uuid"),s=e("./mutable-event").MutableEvent,a=e("../serialization").Serializer,o=e("../serialization").Deserializer;if("undefined"!=typeof window){window.Touch===void 0&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(t){window.Touch=t.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),r&&r.isStoringPointerEvents&&(r.isStoringPointerEvents=!1,r.isStoringPointerEvents=!0)},!0)}()),i.specialize({type:{value:null},listener:{value:null},capture:{value:null}}),a.defineSerializationUnit("listeners",function(e,t){var i,n,s,a=r,o=t.uuid,u=[];for(var c in a.registeredEventListeners)if(i=a.registeredEventListeners[c],n=i&&i[o])for(var l in n.listeners)s=n.listeners[l],u.push({type:c,listener:e.addObjectReference(s.listener),capture:s.capture});return u.length>0?u:void 0}),o.defineDeserializationUnit("listeners",function(e,t,r){for(var i,n=0;i=r[n];n++)t.addEventListener(i.type,i.listener,i.capture)});var u=Event.NONE,c=Event.CAPTURING_PHASE,l=Event.AT_TARGET,f=Event.BUBBLING_PHASE,d="function";t.EventManager=i.specialize({constructor:{value:function(){this.super()}},eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=n.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.MediaController&&(e.MediaController.prototype.nativeAddEventListener=e.MediaController.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),e.MediaController&&(e.MediaController.prototype.nativeRemoveEventListener=e.MediaController.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(t,r,i){return e.defaultEventManager.registerEventListener(this,t,r,!!i)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),e.MediaController&&(e.MediaController.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(t,r,i){return e.defaultEventManager.unregisterEventListener(this,t,r,!!i)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.MediaController&&(e.MediaController.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype){var s,a,o=Object.getOwnPropertyNames(e),u=0,c=o.length;for(u;c>u;u++)s=o[u],s.match(/^HTML\w*Element$/)&&"function"==typeof s&&(a=s.prototype,a.nativeAddEventListener=a.addEventListener,a.addEventListener=e.Element.prototype.addEventListener,a.nativeRemoveEventListener=a.removeEventListener,a.removeEventListener=e.Element.prototype.removeEventListener)}i.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),i.defineProperty(e.Element.prototype,"component",{get:function(){return r._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),r=e.defaultEventManager=t.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(t){return e!==t}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var t,r;for(t in Components.interfaces)t.match(/^nsIDOMHTML\w*Element$/)&&(t=t.replace(/^nsIDOM/,""),(t=window[t])&&(r=t.prototype,r.addEventListener=r.nativeAddEventListener,delete r.nativeAddEventListener,r.removeEventListener=r.nativeRemoveEventListener,delete r.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var t,r,i,n,s=this.registeredEventListeners[e];if(!s)return null;n={};for(t in s){r=s[t].listeners;for(i in r)n[i]=r[i]}return n}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,t,r){var i,n;return i=t===r?r.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],i?(n=i[t.uuid],n?n.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var t,r,i=[];for(t in this.registeredEventListeners)r=this.registeredEventListeners[t],e.uuid in r&&i.push(r);return i}},registerEventListener:{enumerable:!1,value:function(e,t,r,i){var n,s,a,o=this.registeredEventListeners[t],u=!1,c=!1;if(e.uuid===void 0)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return o?((n=o[e.uuid])||(n=o[e.uuid]={target:e,listeners:{}},u=!0),s=n.listeners[r.uuid],a=i?"capture":"bubble",s?(s[a]=!0,c=!0):(s={listener:r,capture:i,bubble:!i},n.listeners[r.uuid]=s,c=!0)):(o=this.registeredEventListeners[t]={},o[e.uuid]={target:e,listeners:{}},o[e.uuid].listeners[r.uuid]={listener:r,capture:i,bubble:!i},u=!0,c=!0),u&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,t),c}},unregisterEventListener:{enumerable:!1,value:function(e,t,r,i){var n,s,a,o,u,c=this.registeredEventListeners[t];if(c&&(n=c[e.uuid])){if(s=n.listeners[r.uuid],!s){for(o in n.listeners)if(u=n.listeners[o].listener,u.originalListener&&u.originalListener.uuid===r.uuid){s=n.listeners[o],r=u;break}if(!s)return}a=i?"capture":"bubble",s[a]=!1,s.bubble||s.capture||(delete n.listeners[r.uuid],0===Object.keys(n.listeners).length&&(delete c[e.uuid],0===Object.keys(c).length&&(delete this.registeredEventListeners[t],this._stopObservingTarget_forEventType_(e,t))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,t){if(t.nativeAddEventListener){if(t.defaultView)return t;var r,i=this.eventDefinitions[e];return i?(r=typeof i.bubbles===d?i.bubbles(t):i.bubbles,r?t.screen?t.document:t.ownerDocument:t):t}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,t){var r;!(r=this.actualDOMTargetForEventTypeOnTarget(t,e))||this._observedTarget_byEventType_[t]&&this._observedTarget_byEventType_[t][r.uuid]||(this._observedTarget_byEventType_[t]||(this._observedTarget_byEventType_[t]={}),this._observedTarget_byEventType_[t][r.uuid]=this,r.nativeAddEventListener(t,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,t){var r;r=this.actualDOMTargetForEventTypeOnTarget(t,e),r&&(delete this._observedTarget_byEventType_[t][r.uuid],r.nativeRemoveEventListener(t,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var t=this;this._activationHandler=function(e){var r,i=e.type;if("focus"===i||"mousedown"===i||"touchstart"===i)if(e.changedTouches){r=e.changedTouches.length;for(var n=0;r>n;n++)t._prepareComponentsForActivation(e.changedTouches[n].target)}else t._prepareComponentsForActivation(e.target)}}if(e.Touch?e.document.nativeAddEventListener("touchstart",this._activationHandler,!0):e.document.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var r,i=this.registeredEventListenersOnTarget_(this.application);for(r in i)this._observeTarget_forEventType_(e,r)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var t,r=this.registeredEventListenersOnTarget_(this.application),i=this.registeredEventListenersOnTarget_(e);for(t in r)this._stopObservingTarget_forEventType_(e,t);for(t in i)this._stopObservingTarget_forEventType_(e,t)}},reset:{enumerable:!1,value:function(){var e,t,r,i;for(e in this.registeredEventListeners){t=this.registeredEventListeners[e];for(r in t.targets)i=t.targets[r],this._stopObservingTarget_forEventType_(i.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,r){var i=r?t+"+"+r:t;return e[i]||(e[i]="handle"+(r?r.toCapitalized():"")+t.toCapitalized())}}({})},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,r){var i=r?t+"+"+r:t;return e[i]||(e[i]="capture"+(r?r.toCapitalized():"")+t.toCapitalized())}}({})},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,t){if(!t)throw"Must specify a valid component to see if it claims the specified pointer, '"+t+"' is not valid.";return this._claimedPointers[e]===t}},claimPointer:{value:function(e,t){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!t)throw"Must specify a valid component to claim a pointer, '"+t+"' is not valid.";var r=this._claimedPointers[e];return r===t?!0:r?r.surrenderPointer(e,t)?(this._claimedPointers[e]=t,!0):!1:(this._claimedPointers[e]=t,!0)}},forfeitPointer:{value:function(e,t){if(t!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var t,r;for(t in this._claimedPointers)r=this._claimedPointers[t],e===r&&delete this._claimedPointers[t]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return r.pointerMotion(this.identifier).velocity},set:function(){}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,t){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=t,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var t;switch(e.type){case"mousedown":r._isMouseDragging=!0;case"mousemove":r._isStoringMouseEventsWhileDraggingOnly?r._isMouseDragging&&(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return r.pointerMotion("mouse").velocity},set:function(){}})):(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return r.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return r.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(t=0;e.touches.length>t;t++)this.add(e.touches[t].identifier,{clientX:e.touches[t].clientX,clientY:e.touches[t].clientY,timeStamp:e.timeStamp});break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.add(e.changedTouches[t].identifier,{clientX:e.changedTouches[t].clientX,clientY:e.changedTouches[t].clientY,timeStamp:e.timeStamp})}},removeEvent:function(e){var t;switch(e.type){case"mouseup":r._isMouseDragging=!1,r._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.remove(e.changedTouches[t].identifier)}}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var t,i,n,s,a,o,u,c,l,f=0,d=!0,h={x:[],y:[],time:[]};for(t=r._pointerStorage.getMemory(e),i=t.data.length,n=t.data[(t.pos-1+i)%i],s=a=o=n.timeStamp,u=n.clientX,c=n.clientY;d&&a>s-350&&t.size>f;)n=t.data[(t.pos-f-1+i)%i],a=n.timeStamp,l=u*u+c*c,l>2&&50>=o-a?(h.x.push(n.clientX),h.y.push(n.clientY),h.time.push(a),o=a,u=n.clientX,c=n.clientY,f++):d=!1;return h}},_fitPointerCurve:{enumerable:!1,value:function(e,t){var r,i,n,s,a,o,u,c,l,f,d,h,m,p,b,v,_,y,g,w,O,D,I,S,M,E,T,P,V,x,L,C,A,N,R,k,Y,F,j=1e-4,z=t.length;do{for(d=0,h=0,m=0,p=0,b=0,v=0,y=0,g=0,w=0,O=0,D=0,I=0,M=0,E=0,T=0,P=0,V=0,x=0,C=0,A=0,N=0,R=0,k=0,Y=0,f=0;z>f;f++)a=t[f],o=a.t,c=o*o,l=c*o,u=a.v,_=j*(6*(c-o)-l+2),S=6*j*(l-2*c+o),L=6*j*(c-l),F=2*j*l,v+=_*_,I+=S*S,x+=L*L,Y+=F*F,d+=u*_,y+=u*S,M+=u*L,C+=u*F,m-=_,w-=S,T-=L,N-=F,h-=_*o,g-=S*o,E-=L*o,A-=F*o,p-=_*c,O-=S*c,P-=L*c,R-=F*c,b-=_*l,D-=S*l,V-=L*l,k-=F*l;j*=2}while(0===v||0===I||0===x||0===Y);for(o=j/v,d*=o,h*=3*o,m*=o,p*=3*o,b*=o,o=j/I,y*=o,g*=3*o,w*=o,O*=3*o,D*=o,o=j/x,M*=o,E*=3*o,T*=o,P*=3*o,V*=o,o=j/Y,C*=o,A*=3*o,N*=o,R*=3*o,k*=o,v=e[0],I=e[1],x=e[2],Y=e[3],r=3*(I-x)+Y-v,i=v+x-2*I,n=I-v,s=v,f=0;20>f;f++)o=d+s*m+n*h+i*p+r*b,v+=o,s+=o,r-=o,i+=o,n-=o,o=y+s*w+n*g+i*O+r*D,I+=o,r+=3*o,i-=o+o,n+=o,o=M+s*T+n*E+i*P+r*V,x+=o,r-=3*o,i+=o,o=C+s*N+n*A+i*R+r*k,Y+=o,r+=o;e[0]=v,e[1]=I,e[2]=x,e[3]=Y}},_pointerBezierValue:{enumerable:!1,value:function(e,t){var r=1-e;return r*r*r*t[0]+3*r*r*e*t[1]+3*r*e*e*t[2]+e*e*e*t[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,t){var r,i,n=e.length,s=e[0],a=e[0],o=0;for(i=1;n>i;i++)s>e[i]&&(s=e[i],o=i);if(r=a-s){if(n>5){var u,c,l,f=[];for(i=0;n>i;i++)f[i]={v:t[i],t:(e[i]-s)/r};return u=f[o].v,c=f[0].v,l=[u,(2*u+c)/3,(u+2*c)/3,c],this._fitPointerCurve(l,f),5e3*(this._pointerBezierValue(.8,l)-this._pointerBezierValue(.6,l))/r}return n>1?1e3*(t[0]-t[o])/r:0}return 0}},pointerMotion:{value:function(e){if(r._pointerStorage.isStored(e)){var t={};return Object.defineProperties(t,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=r._getPointerVelocityData(e)),this._x=r._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=r._getPointerVelocityData(e)),this._y=r._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:t}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:i.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},handleEvent:{enumerable:!1,value:function(e){this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var t,r,i,n,a,o,h,m,p,b,v,_,y,g,w=e.type,O=e.bubbles;for("DOMContentLoaded"===w&&(t=e.target.defaultView,t&&this._windowsAwaitingFinalRegistration[t.uuid]&&(this._finalizeWindowRegistration(t),e.target.removeEventListener("DOMContentLoaded",this,!0))),g="boolean"!=typeof e.propagationStopped?s.fromEvent(e):e,p=Element.isElement(g.target)||g.target instanceof Document||g.target===window?this._eventPathForDomTarget(g.target):this._eventPathForTarget(g.target),_=g.target.identifier?this.methodNameForCapturePhaseOfEventType(w,g.target.identifier):null,y=g.target.identifier?this.methodNameForBubblePhaseOfEventType(w,g.target.identifier):null,b=this.methodNameForCapturePhaseOfEventType(w),v=this.methodNameForBubblePhaseOfEventType(w),this.delegate&&typeof this.delegate.willDistributeEvent===d&&this.delegate.willDistributeEvent(g),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(g),g.eventPhase=c,r=p.length-1;!g.propagationStopped&&(i=p[r]);r--)if(g.currentTarget=i,n=this.registeredEventListenersForEventType_onTarget_(w,i))for(h=Object.keys(n),a=0;n&&!g.immediatePropagationStopped&&(o=n[h[a]]);a++)o.capture&&(m=o.listener,_&&typeof m[_]===d?m[_](g):typeof m[b]===d?m[b](g):typeof m.handleEvent===d?m.handleEvent(g):typeof m!==d||m.__isConstructor__||m.call(i,g));if(!g.propagationStopped&&(g.eventPhase=l,g.currentTarget=i=g.target,n=this.registeredEventListenersForEventType_onTarget_(w,i)))for(h=Object.keys(n),a=0;n&&!g.immediatePropagationStopped&&(o=n[h[a]]);a++)m=o.listener,o.capture&&(_&&typeof m[_]===d?m[_](g):typeof m[b]===d?m[b](g):typeof m.handleEvent===d?m.handleEvent(g):typeof m===d&&m.call(i,g)),o.bubble&&(y&&typeof m[y]===d?m[y](g):typeof m[v]===d?m[v](g):typeof m.handleEvent===d?m.handleEvent(g):typeof m===d&&m.call(i,g));for(g.eventPhase=f,r=0;O&&!g.propagationStopped&&(i=p[r]);r++)if(g.currentTarget=i,n=this.registeredEventListenersForEventType_onTarget_(w,i))for(h=Object.keys(n),a=0;n&&!g.immediatePropagationStopped&&(o=n[h[a]]);a++)o.bubble&&(m=o.listener,y&&typeof m[y]===d?m[y](g):typeof m[v]===d?m[v](g):typeof m.handleEvent===d?m.handleEvent(g):typeof m===d&&m.call(i,g));g.eventPhase=u,g.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_prepareComponentsForActivation:{value:function(e){var t,r,i=e,n=i&&i.defaultView?i.defaultView:window,s=n.document?n.document:document,a=!1,o=null;do switch(i&&(r=this.eventHandlerForElement(i),r&&(a||(a=!0,o=this._findActiveTarget(r)),r._preparedForActivationEvents||(r._prepareForActivationEvents(),r._preparedForActivationEvents=!0))),t=i,i){case n:i=null;break;case s:i=n;break;case s.documentElement:i=s;break;default:i=i.parentNode}while(i&&t!==i);this.activeTarget=o}},_findActiveTarget:{value:function(e){for(var t=null,r={};!t&&e&&!(e.uuid in r);)r[e.uuid]=e,e.acceptsActiveTarget?t=e:e=e.nextTarget;return t}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var t=e,r=this.application,i=[],n={};n[e.uuid]=e;do t.uuid in n||(i.push(t),n[t.uuid]=t),t=t.nextTarget,(!t||t.uuid in n)&&(t=r),t&&t.uuid in n&&(t=null);while(t);return i}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var t,r=e,i=r&&r.defaultView?r.defaultView:window,n=i.document?i.document:document,s=this.application,a=[];do switch(r!==e&&a.push(r),t=r,r){case s:r=r.parentApplication,r&&(s=r);break;case i:r=s;break;case n:r=i;break;case n.documentElement:r=n;break;default:r=r.parentNode,r||(r=s)}while(r&&t!==r);return a}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,t){var r=this.eventHandlerForElement(t);r&&this.unregisterEventHandlerForElement(t),this._elementEventHandlerByUUID[t.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e||(e=this.application),e===this._activeTarget||this.activeTarget&&!this.activeTarget.surrendersActiveTarget(e)||(e.willBecomeActiveTarget(this.activeTarget),this._activeTarget=e,e.didBecomeActiveTarget())}}})}}});