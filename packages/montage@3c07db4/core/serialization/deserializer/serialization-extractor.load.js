montageDefine("3c07db4","core/serialization/deserializer/serialization-extractor",{dependencies:["../../core","./montage-reviver","frb/parse"],factory:function(e,t){var r=e("../../core").Montage,n=e("./montage-reviver").MontageReviver,i=e("frb/parse"),a=r.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractObjects:{value:function(e,t){var r=this._serialization,n={};t=t||[];for(var i,a=0;i=e[a];a++)i in r&&(n[i]=r[i],this._findLabels(i,t));for(var i,a=0;i=t[a];a++)!(i in n)&&i in r&&(n[i]={});return JSON.parse(JSON.stringify(n))}},_findLabels:{value:function(e,t){var r;if(-1===t.indexOf(e)){if(!(e in this._serialization))throw Error("Object '"+e+"' not found.");t.push(e),r=this._serialization[e],this._collectLabels(r,t),this._collectLabelsInUnits(r,t)}}},_collectLabels:{value:function(e,t){var r,i=n.getTypeOf(e);if("reference"===i)r=e["@"],this._findLabels(r,t);else if("array"===i)for(var a=0,s=e.length;s>a;a++)this._collectLabels(e[a],t);else if("object"===i)for(var o in e)this._collectLabels(e[o],t)}},_collectLabelsInUnits:{value:function(e,t){"bindings"in e?this._collectLabelsInBindings(e.bindings,t):"localizations"in e&&this._collectLabelsInLocalizations(e.localizations,t)}},_collectLabelsInBindings:{value:function(e,t){var r,n;for(var i in e)r=e[i],n=r["<-"]||r["<->"],this._collectLabelsInBindingPath(n,t)}},_collectLabelsInBindingPath:{value:function(e,t){var r=this,n=i(e);this._traverseBindingParseTree(n,function(e){r._findLabels(e.label,t)})}},_traverseBindingParseTree:{value:function(e,t){var r=e.args;if("component"===e.type&&t(e),r)for(var n=0,i=r.length;i>n;n++)this._traverseBindingParseTree(r[n],t)}},_collectLabelsInLocalizations:{value:function(e,t){for(var r in e)this._collectLabelsInLocalizationProperty(e[r],t)}},_collectLabelsInLocalizationProperty:{value:function(e,t){var r;if("key"in e&&this._collectLabelsInLocalizationBinding(e.key,t),"default"in e&&this._collectLabelsInLocalizationBinding(e.default,t),"data"in e){r=e.data;for(var n in r)this._collectLabelsInLocalizationBinding(r[n],t)}}},_collectLabelsInLocalizationBinding:{value:function(e,t){var r=e["<-"]||e["<->"];r&&this._collectLabelsInBindingPath(r,t)}}});t.SerializationExtractor=a}});