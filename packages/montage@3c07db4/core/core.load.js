montageDefine("3c07db4","core/core",{dependencies:["collections/shim","./shim/object","./shim/array","./shim/string","./extras/object","./extras/date","./extras/element","./extras/function","./extras/regexp","./extras/string","./deprecate","./uuid","collections/listen/property-changes","frb","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/observe","frb/bind","frb/compile-observer","frb/scope","frb/observers","./serialization/bindings","./promise"],factory:function(e,t){function r(e,t){var i=s+t+n;return e.hasOwnProperty(i)?e[i]:Object.defineProperty(e,i,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(r(Object.getPrototypeOf(e),t))})[i]}e("collections/shim"),e("./shim/object"),e("./shim/array"),e("./shim/string"),e("./extras/object"),e("./extras/date"),e("./extras/element"),e("./extras/function"),e("./extras/regexp"),e("./extras/string");var i=e("./deprecate"),n="AttributeProperties",s="_",a="__proto__",o="value",c="enumerable",u="distinct",f="serializable",l=Array.prototype,h=Object.prototype,m=!0,d=t.Montage=function d(){};d.deprecate=i.deprecateMethod(d,i.deprecateMethod,"Montage.deprecate","deprecate module's deprecateMethod"),d.callDeprecatedFunction=i.deprecateMethod(d,i.callDeprecatedFunction,"Montage.callDeprecatedFunction","deprecate module's callDeprecatedFunction");var p={}.__proto__===Object.prototype,b={_montage_metadata:1,__state__:1},_=Object.getOwnPropertyNames(Function);if(Object.defineProperty(d,"specialize",{value:function(e,t){var r,n,s,a,o,c,u,f=this,l=this.specialize===void 0;if(e=e||Object.empty,t=t||Object.empty,r=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?d.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return this.superForValue("constructor")()||this},p)r.__proto__=f;else{s=Object.getOwnPropertyNames(f);for(var c=0;s.length>c;c++)a=s[c],b.hasOwnProperty(a)||(o=Object.getOwnPropertyDescriptor(r,a),(!o||o.configurable)&&d.defineProperty(r,a,Object.getOwnPropertyDescriptor(f,a)));r.__constructorProto__=f,d.defineProperty(r,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(n=Object.create(this.prototype),l){for(s=Object.getOwnPropertyNames(d),c=0;s.length>c;c++)a=s[c],o=Object.getOwnPropertyDescriptor(r,a),(!o||o.configurable)&&d.defineProperty(r,a,Object.getOwnPropertyDescriptor(d,a));for(s=Object.getOwnPropertyNames(d.prototype),c=0;s.length>c;c++)a=s[c],o=Object.getOwnPropertyDescriptor(r,a),(!o||o.configurable)&&d.defineProperty(n,a,Object.getOwnPropertyDescriptor(d.prototype,a))}if(d.defineProperties(n,e),m){u=function(e,t,r){function n(){return this===t&&i.deprecationWarning(d.getInfoForObject(t).objectName+"."+r+" should be moved to constructorProperties",null,3),e.apply(this,arguments)}return n.deprecatedFunction=e,n};for(a in e)_.has(a)?delete e[a]:(o=e[a],o.value&&"function"==typeof o.value&&!o.value.__isConstructor__?o.value=u(o.value,r,a):(o.get&&(o.get=u(o.get,r,a)),o.set&&(o.set=u(o.set,r,a))));d.defineProperties(r,e),d.defineProperty(r,"create",{value:function(){return new r},enumerable:!1})}return d.defineProperties(r,t),d.defineProperty(r,"__isConstructor__",{value:!0,enumerable:!1}),d.defineProperty(r,"_superCache",{value:{},enumerable:!1}),r.prototype=n,d.defineProperty(n,"constructor",{value:r,enumerable:!1}),r},writable:!0,configurable:!0,enumerable:!1}),!p){var y=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:y.apply(Object,arguments)}}Object.defineProperty(d,"create",{configurable:!0,value:function(e,t){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=e===void 0?this:e,"function"==typeof e)return t?e.specialize(t):new e;var r=Object.create(e);return t&&d.defineProperties(r,t),r}});var v=[f];v.forEach(function(e){Object.defineProperty(Object.prototype,s+e+n,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(d,"defineProperty",{value:function(e,t,i){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var n=o in i;if(u in i&&!n)throw new TypeError("Cannot use distinct attribute on non-value property '"+t+"'");if(a in i)i.__proto__=n?"function"==typeof i.value?D:g:w;else{var m;m=n?"function"==typeof i.value?D:g:w;for(var d in m)d in i||(i[d]=m[d])}if(i.hasOwnProperty(c)||t.charAt(0)!==s||(i.enumerable=!1),i.hasOwnProperty(f)||(i.enumerable?i.get&&!i.set?i.serializable=!1:i.writable===!1&&(i.serializable=!1):i.serializable=!1),f in i&&(r(e,f)[t]=i.serializable),i.distinct!==!0||"object"!=typeof i.value){var p,b,_;if(e._superDependencies){if("function"==typeof i.value&&(p=e._superDependencies[t+".value"]))for(b=0,_=p.length;_>b;b++)delete p[b]._superCache[t+".value"];if("function"==typeof i.get&&(p=e._superDependencies[t+".get"]))for(b=0,_=p.length;_>b;b++)delete p[b]._superCache[t+".get"];if("function"==typeof i.set&&(p=e._superDependencies[t+".set"]))for(b=0,_=p.length;_>b;b++)delete p[b]._superCache[t+".set"]}return Object.defineProperty(e,t,i)}(function(e,t,r,i){var n=function(e,t,r){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:r})};r.constructor===Object&&Object.getPrototypeOf(r)===h?0!==Object.keys(r).length?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i;e={};for(i in r)e[i]=r[i];this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e={},this.hasOwnProperty(t)?this[t]=e:n(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}}):(r.__proto__||Object.getPrototypeOf(r))===l?0!==r.length?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i,s;for(e=[],i=0;(s=r[i])!==void 0;i++)e[i]=s;this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e=[],this.hasOwnProperty(t)?this[t]=e:n(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}}):r.constructor.prototype===Object.getPrototypeOf(r)?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i;e=new r.constructor;for(i in r)e[i]=r[i];this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e=Object.create(r.__proto__||Object.getPrototypeOf(r)),this.hasOwnProperty(t)?this[t]=e:n(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:n(this,t,e)}})})(t,s+t,i.value,e)}}),Object.defineProperty(d,"defineProperties",{value:function(e,t){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var r in t)"_bindingDescriptors"!==r&&this.defineProperty(e,r,t[r]);return e}});var w={enumerable:!0,configurable:!0,serializable:!0},g={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},D={writable:!0,enumerable:!1,configurable:!0,serializable:!1};d.defineProperty(d,"didCreate",{value:Function.noop});var I=function(e,t){var r,i,n,s,a,o,c,u,f;if(!t._superPropertyName||!t._superPropertyType)for(d.defineProperty(t,"_superPropertyType",{value:null}),d.defineProperty(t,"_superPropertyName",{value:null}),c=e;!u&&null!==c;){for(r=Object.getOwnPropertyNames(c),i=Object.getPrototypeOf(c),n=0,s=r.length,n;s>n;n++){if(a=r[n],f=Object.getOwnPropertyDescriptor(c,a),null!=(o=f.value)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="value",t._superPropertyName=a,u=!0;break}if(null!=(o=f.get)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="get",t._superPropertyName=a,u=!0;break}if(null!=(o=f.set)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="set",t._superPropertyName=a,u=!0;break}}c=i}return S(e,t._superPropertyType,t._superPropertyName)},O=function(){if("function"!=typeof O.caller)throw new TypeError("Can't get super without caller. Use this.superForValue(methodName) if using strict mode.");var e=I(this,O.caller);return"function"==typeof e?e.bind(this):Function.noop},S=function(e,t,r){var i,n,s,a,o,c=e,u=r+"."+t;if(e._superContext||d.defineProperty(e,"_superContext",{value:{}}),e._superContext[u])c=e._superContext[u];else for(c=e;null!==c&&(!c.hasOwnProperty(r)||(s=Object.getOwnPropertyDescriptor(c,r),"function"!=typeof s[t]));)c=Object.getPrototypeOf(c);if(a=c.constructor,a._superCache&&a._superCache[u])return o=function(e,t,r,i){return function(){t._superContext[e]=r;var n=i.apply(t,arguments);return delete t._superContext[e],n}}(u,e,a._superCache[u].owner,a._superCache[u].func);for(n=c;i===void 0&&(n=Object.getPrototypeOf(n));)if(n._superDependencies||d.defineProperty(n,"_superDependencies",{value:{}}),n._superDependencies[u]||(n._superDependencies[u]=[]),n._superDependencies[u].push(a),s=Object.getOwnPropertyDescriptor(n,r)){if("function"==typeof s[t]){i=s[t];break}break}return"function"==typeof i?(o=function(e,t,r,i){return function(){t._superContext[e]=r;var n=i.apply(t,arguments);return delete t._superContext[e],n}}(u,e,n,i),a._superCache||d.defineProperty(a,"_superCache",{value:{}}),a._superCache[u]={func:i,owner:n},o):Function.noop},M=function(e){return S(this,"value",e)},V=function(e){return S(this,"get",e)},T=function(e){return S(this,"set",e)};d.defineProperty(d,"super",{get:O,enumerable:!1}),d.defineProperty(d.prototype,"super",{get:O,enumerable:!1}),d.defineProperty(d,"superForValue",{value:M,enumerable:!1}),d.defineProperty(d.prototype,"superForValue",{value:M,enumerable:!1}),d.defineProperty(d,"superForGet",{value:V,enumerable:!1}),d.defineProperty(d.prototype,"superForGet",{value:V,enumerable:!1}),d.defineProperty(d,"superForSet",{value:T,enumerable:!1}),d.defineProperty(d.prototype,"superForSet",{value:T,enumerable:!1}),d.defineProperty(d,"getSerializablePropertyNames",{value:function(e){var t=[],r=e._serializableAttributeProperties;if(r)for(var i in r)r[i]&&t.push(i);return t}}),d.defineProperty(d,"getPropertyAttribute",{value:function(e,t,r){var i=s+r+n,a=e[i];return a?a[t]:void 0}}),d.defineProperty(d,"getPropertyAttributes",{value:function(e,t){var r={},i=s+t+n,a=e[i];if(a){for(var o in a)r[o]=a[o];return r}}});var P={isInstance:{value:!0}},x={objectName:{value:"Function"},isInstance:{value:!0}};d.defineProperty(d,"getInfoForObject",{value:function(e){var t,r;if(C.call(e,"_montage_metadata"))return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,r=e.constructor===Function?x:P,e===Object.prototype)return Object.create(t,r);try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,r)})._montage_metadata}catch(i){return e._montage_metadata=Object.create(t,r)}}});var E=e("./uuid");"undefined"!=typeof window&&(window.uuid=E.generate());var C=Object.prototype.hasOwnProperty,N=function(){var e=E.generate(),t=d.getInfoForObject(this);try{null!==t&&t.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:N.call(this)}})):(t.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&t.isInstance&&o in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&a in this||(this._uuid=e))}catch(r){}return this._uuid=e,e},A=function A(){return C.call(this,"_uuid")?this._uuid:N.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:A,set:function(){}}),d.defineProperty(d,"identifier",{value:null,serializable:!0}),d.defineProperty(d.prototype,"identifier",{value:null,serializable:!0}),d.defineProperty(d.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),d.defineProperty(d,"equals",{value:d.prototype.equals}),d.defineProperty(d.prototype,"callDelegateMethod",{value:function(e){var t,r,i=this.delegate;return"string"==typeof this.identifier&&(t=this.identifier+e.toCapitalized(),i&&"function"==typeof(r=i[t]))?(l.shift.call(arguments),r.apply(i,arguments)):i&&"function"==typeof(r=i[e])?(l.shift.call(arguments),r.apply(i,arguments)):void 0}});var L=e("collections/listen/property-changes");Object.addEach(d,L.prototype),Object.addEach(d.prototype,L.prototype);var R=t.Bindings=e("frb"),Y={defineBinding:{value:function(e,t,r){return R.defineBinding(this,e,t,r)}},defineBindings:{value:function(e,t){return R.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return R.cancelBinding(this,e)}},cancelBindings:{value:function(){return R.cancelBindings(this)}},getBinding:{value:function(e){return R.getBinding(this,e)}},getBindings:{value:function(){return R.getBindings(this)}}};d.defineProperties(d,Y),d.defineProperties(d.prototype,Y);var k=e("collections/weak-map"),F=e("collections/map"),z=e("frb/parse"),j=e("frb/evaluate"),X=e("frb/assign");e("frb/observe"),e("frb/bind");var B=e("frb/compile-observer"),q=e("frb/scope"),W=e("frb/observers"),K=W.autoCancelPrevious,U=new k,H={getPath:{value:function(e,t,r,i){return j(e,this,t||this,r,i)}},setPath:{value:function(e,t,r,i,n){return X(this,e,t,r||this,i,n)}},observePath:{value:function(e,t){var r=z(e),i=B(r);return i(K(t),new q(this))}},addRangeAtPathChangeListener:{value:function(e,t,r,i,n,s){function a(e,i,n){if(t[r])t[r](e,i,n);else{if(!t.call)throw Error("Can't dispatch range change to "+t);t.call(null,e,i,n)}}r=r||"handleRangeChange";var o=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(a(e.toArray(),o.toArray(),0),o=e,e.addRangeChangeListener(a)):(e=[],a(e,o,0),o=e,void 0)},void 0,void 0,i,n,s)}},getPathChangeDescriptors:{value:function(){return U.has(this)||U.set(this,{}),U.get(this)}},getPathChangeDescriptor:{value:function(e,t,r){var i=d.getPathChangeDescriptors.call(this);return Object.owns(i,e)||(i[e]={willChangeListeners:new F,changeListeners:new F}),i=i[e],i=r?i.willChangeListeners:i.changeListeners,i.has(t)||i.set(t,{path:e,handler:t,beforeChange:r,cancel:Function.noop}),i.get(t)}},addPathChangeListener:{value:function(e,t,r,i,n,s,a){var o=this;t=t||Function.noop;var c=d.getPathChangeDescriptor.call(this,e,t,i);c.cancel();var u,f,l,h=z(e);if(t===Function.noop)l=function(t){if(f)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));f=!0,u=t};else if(r)l=function(i){return t[r].call(t,i,e,o)};else if(t.handlePathChange)l=function(r){return t.handlePathChange.call(t,r,e,o)};else{if("function"!=typeof t)throw Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");l=function(r){return t.call(o,r,e,o)}}var m=B(h),p=new q(this);p.beforeChange=i,p.parameters=n,p.document=s,p.components=a;var b=m(K(l),p);return c.cancel=b,f?u:b}},removePathChangeListener:{value:function(e,t,r){t=t||Function.noop;var i=d.getPathChangeDescriptors.call(this),n=r?"willChangeListeners":"changeListeners";if(!Object.owns(i,e))throw Error("Can't find "+n+" for "+JSON.stringify(e));var s=i[e],a=s[n];if(!a.has(t))throw Error("Can't find "+n+" for "+JSON.stringify(e));var o=a.get(t);o.cancel(),a["delete"](t),0===s.willChangeListeners.length&&0===s.changeListeners.length&&delete i[e];for(var c in i)return;U["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,r,i,n,s){return d.addPathChangeListener.call(this,e,t,r,!0,i,n,s)}},removeBeforePathChangeListener:{value:function(e,t){return d.removePathChangeListener.call(this,e,t,!0)}}};d.defineProperties(d,H),d.defineProperties(d.prototype,H),e("./serialization/bindings"),t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=d.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=d.getInfoForObject(t);var r=e.moduleId,i=r.lastIndexOf("/"),n=r.lastIndexOf(".");i=-1===i?0:i+1,n=-1===n?r.length:n,n=i>n?r.length:n,d.defineProperty(t,"_blueprintModuleId",{enumerable:!1,value:r.slice(0,n)+".meta"})}return t._blueprintModuleId}},t._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var r=d.getInfoForObject(this),i=r&&!r.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(i,"_blueprint")||!i._blueprint){var n=i.blueprintModuleId;if(""===n)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(i)+"'");t._blueprintDescriptor.BlueprintModulePromise||(t._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/module-blueprint").get("ModuleBlueprint")),d.defineProperty(i,"_blueprint",{enumerable:!1,value:t._blueprintDescriptor.BlueprintModulePromise.then(function(e){var t=d.getInfoForObject(i);return e.getBlueprintWithModuleId(n,t.require).fail(function(t){if(-1!==t.message.indexOf("Can't XHR"))return e.createDefaultBlueprintForObject(i).then(function(e){return e});throw t})})})}return i._blueprint},set:function(t){var r,i=d.getInfoForObject(this),n=i&&!i.isInstance?this:this.constructor;if(null===t)r=null;else{if("function"==typeof t.then)throw new TypeError("Object blueprint should not be a promise");t.blueprintInstanceModule=n.blueprintModule,r=e("./promise").Promise.resolve(t)}d.defineProperty(n,"_blueprint",{enumerable:!1,value:r})}}}});