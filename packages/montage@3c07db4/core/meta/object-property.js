"use strict";var Montage=require("../core").Montage,Exception=require("../exception").Exception,Blueprint=require("./blueprint").Blueprint,Binder=require("./blueprint").Binder,logger=require("../logger").logger("object-property"),ObjectProperty=exports.ObjectProperty=Montage.specialize({constructor:{value:function(){this.superForValue("constructor")()}},init:{serializable:!1,enumerable:!1,value:function(){return this}},apply:{value:function(e,t){if(!e.hasOwnProperty("blueprint")){var r;r=Montage.getInfoForObject(e),null!=r&&r.isInstance===!1&&(t===void 0?t=Binder.manager.blueprintForPrototype(r.objectName,r.moduleId):(t.prototypeName!==r.objectName||t.moduleId!==r.moduleId)&&(t=null),this.applyWithBlueprint(e,t))}}},applyWithBlueprint:{value:function(e,t){null!=t&&(this.addProperties(e,t),null!==t.parent&&this.apply(Object.getPrototypeOf(e),t))}},addProperties:{value:function(e,t){for(var r,n=0;r=t.propertyBlueprints[n++];)r.isDerived?this.addDerivedProperty(e,r):r.isAssociation?this.addAssociation(e,r):this.addProperty(e,r);Montage.defineProperty(e,"_blueprint",{serializable:!1,enumerable:!1,value:t}),Montage.defineProperty(e,"blueprint",{enumerable:!1,serializable:!1,get:function(){return this._blueprint}}),Montage.defineProperty(e,"blueprintGet",{serializable:!1,enumerable:!1,value:this.blueprintGet}),Montage.defineProperty(e,"blueprintSet",{serializable:!1,enumerable:!1,value:this.blueprintSet})}},addProperty:{value:function(e,t){this.addPropertyStorage(e,t),this.addPropertyDefinition(e,t),this.addPropertyStoredValue(e,t)}},addPropertyStorage:{value:function(e,t){var r="_"+t.name,n=null;e.hasOwnProperty(r)?logger.isError&&logger.error("We have an issue here. The developer should not override the storage value for "+r+"."):(n=t.isToMany?{value:[],enumerable:!1,serializable:!0,distinct:!0}:{value:null,enumerable:!1,serializable:!0},Montage.defineProperty(e,r,n))}},addPropertyDefinition:{value:function(e,t){var r=t.name,n=null;e.hasOwnProperty(r)?logger.isDebug&&logger.debug("The developer has already created the property "+r+" method do nothing."):(n={get:function(){return this.blueprintGet(r)},enumerable:!0,serializable:!1},t.readOnly||(n.set=function(e){return this.blueprintSet(r,e)}),Montage.defineProperty(e,r,n))}},blueprintGet:{value:function(e){var t=this.blueprint.propertyBlueprintForName(e),r="_"+t.name;return this[r]},enumerable:!1,serializable:!1},blueprintSet:{value:function(e,t){var r=this.blueprint.propertyBlueprintForName(e),n="_"+r.name;if(null==t&&r.denyDelete)throw(new Exception).initWithMessageTargetAndMethod("Deny Delete",this,r.name);this[n]=t},enumerable:!1,serializable:!1},addPropertyStoredValue:{value:function(e,t){var r=t.name+"$Storage",n=null;e.hasOwnProperty(r)?logger.isError&&logger.error("We have an issue here. The developer should not override the stored value for "+r+"."):(n=t.isToMany?{value:[],enumerable:!1,serializable:!1,distinct:!0}:{value:null,enumerable:!1,serializable:!1},Montage.defineProperty(e,r,n))}},addAssociation:{value:function(e,t){this.addPropertyStorage(e,t),this.addAssociationDefinition(e,t),this.addPropertyStoredValue(e,t)}},addAssociationDefinition:{value:function(e,t){t.isToMany?this.addToManyAssociationDefinition(e,t):this.addToOneAssociationDefinition(e,t)}},addToOneAssociationDefinition:{value:function(e,t){var r=t.name.toCapitalized(),n="addTo"+r;e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="removeFrom"+r,e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="clear"+r,e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}})}},addToManyAssociationDefinition:{value:function(e,t){var r=t.name.toCapitalized(),n="addTo"+r;e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="removeFrom"+r,e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="clear"+r,e.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+n+"."):Montage.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}})}},addDerivedProperty:{value:function(){}}});