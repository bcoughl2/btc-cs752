montageDefine("83b66f4","runtime/animation",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities","runtime/dependencies/o3dgc"],factory:function(e,t){function n(e){function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function i(e){return 3*e}function r(e,r,a){return((t(r,a)*e+n(r,a))*e+i(r))*e}function a(e,r,a){return 3*t(r,a)*e*e+2*n(r,a)*e+i(r)}function s(e){for(var t=e,n=0;4>n;++n){var i=a(t,o,u);if(0==i)return t;var s=r(t,o,u)-e;t-=s/i}return t}var o=e[0],l=e[1],u=e[2],c=e[3];this.get=function(e){return o==l&&u==c?e:r(s(e),l,c)}}function i(e,t,n){var i=Object.create(s).init();return e.interpolateToTransform(t,n,i),i}function r(e,t,n){return e+(t-e)*n}e("runtime/dependencies/gl-matrix");var a=e("runtime/base").Base,s=e("runtime/transform").Transform;e("runtime/utilities").Utilities;var o=e("runtime/dependencies/o3dgc").o3dgc,l={ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},u=t.Channel=Object.create(a,{startTime:{value:0,writable:!0},endTime:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(e){this._target=e}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(e){this._path=e}},parameterDelegate:{value:{handleError:function(e,t){console.log("ERROR:parameterDelegate:"+e+" :"+t)},decode:function(e,t){function n(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,r=e.length;r>i;i++)n[i]=e.charCodeAt(i);return t}if(t){var i="ascii"==t.extensions["Open3DGC-compression"].compressedData.mode?"text":"arraybuffer";if("text"===i)var r=new o.BinaryStream(n(e)),a=e.length;else var r=new o.BinaryStream(e),a=e.byteLength;var s=new o.DynamicVectorDecoder,l=new o.DynamicVector,u=new o.Timer;return u.Tic(),s.DecodeHeader(l,r),u.Toc(),console.log("DecodeHeader time (ms) "+u.GetElapsedTime()),l.GetNVector()>0&&l.GetDimVector()&&(l.SetVectors(new Float32Array(l.GetNVector()*l.GetDimVector())),l.SetMinArray(new Float32Array(l.GetDimVector())),l.SetMaxArray(new Float32Array(l.GetDimVector())),l.SetStride(l.GetDimVector())),console.log("Dynamic vector info:"+t.id),console.log("	# vectors   "+l.GetNVector()),console.log("	dim         "+l.GetDimVector()),u.Tic(),s.DecodePlayload(l,r),u.Toc(),console.log("DecodePlayload time "+u.GetElapsedTime()+" ms, "+a+" bytes ("+8*a/l.GetNVector()+" bpv)"),l.GetVectors()}},convert:function(e,t,n){var i=n;if(i.extensions){var r=i.extensions,a=r["Open3DGC-compression"];if(a){var s=a.compressedData;if(s)return this.decode(t,n)}}return new Float32Array(t)},resourceAvailable:function(){}}},getParameterArray:{value:function(e,t){if(e.extensions){var n=e.extensions,i=n["Open3DGC-compression"];if(i){var r=i.compressedData;if(r)return t.getResource(r,this.parameterDelegate,e)}}return t.getResource(e,this.parameterDelegate,e)}},updateTargetsAtTime:{value:function(e,t){var n=this.sampler.input,i=this.sampler.output,r=this.getParameterArray(n,t),a=this.getParameterArray(i,t);if(r&&a){e/=1e3;var s=n.count;this.endTime=r[s-1],this.startTime=r[0];var o,l=0,u=0,c=0;if(s>0){if(this.startTime>e)u=0,l=0;else if(e>=this.endTime)u=1,l=s-2;else for(o=l;s-1>o;o++)if(e>=r[o]&&r[o+1]>e){l=o,c=r[o+1]-r[o],u=(e-r[o])/c;break}null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var h=null;switch(i.componentsPerAttribute){case 4:h=this.__vec4;break;case 3:h=this.__vec3;break;case 2:h=this.__vec2;break;case 1:console.log("float interpolation not handled yet");break;default:}this.index=l;var d=l*i.componentsPerAttribute,f=d+i.componentsPerAttribute,m=this.path;if("rotation"===m){m="orientation";var p=0,v=1,g=2,_=g;if(_==p){var b=vec4.createFrom(a[d+0],a[d+1],a[d+2],a[d+3]),y=vec4.createFrom(a[f+0],a[f+1],a[f+2],a[f+3]);vec3.normalize(b),vec3.normalize(y);var w=vec3.create();vec3.cross(b,y,w),Math.sqrt(vec3.dot(b,b)),Math.sqrt(vec3.dot(y,y));var D=Math.acos(vec3.dot(b,y)),E=mat4.identity();mat4.rotate(E,D*u,w),mat4.multiplyVec3(E,b,w),vec3.normalize(w);var S=b[3]+(y[3]-b[3])*u;quat4.fromAngleAxis(S,w,h)}else if(_==v){var b=vec4.createFrom(a[d+0],a[d+1],a[d+2],a[d+3]),y=vec4.createFrom(a[f+0],a[f+1],a[f+2],a[f+3]);for(o=0;h.length>o;o++){var T=b[o],C=y[o];y[o]=T+(C-T)*u}quat4.fromAngleAxis(y[3],y,h)}else if(_==g){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=a[d+0],this._vecs[0][1]=a[d+1],this._vecs[0][2]=a[d+2],this._vecs[1][0]=a[f+0],this._vecs[1][1]=a[f+1],this._vecs[1][2]=a[f+2];var O=this._quats[0],P=this._quats[1];quat4.fromAngleAxis(a[d+3],this._vecs[0],O),quat4.fromAngleAxis(a[f+3],this._vecs[1],P),quat4.slerp(O,P,u,h)}}else for(o=0;h.length>o;o++){var T=a[d+o],C=a[f+o];h[o]=T+(C-T)*u}this.target.transform[m]=h}}}},initWithDescription:{value:function(e){return this.init(),this.index=0,this.target=e.target,this}},init:{value:function(){return this.__Base_init(),this}}}),c=Object.create(a,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(e){this._input=e}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(e){this._output=e}},initWithDescription:{value:function(){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}}),h=t.Animation=Object.create(Object.prototype,{KEYFRAME:{value:"KEYFRAME",writable:!0},BASIC:{value:"BASIC",writable:!0},_type:{value:null,writable:!0},type:{set:function(e){this._type=e},get:function(){return this._type}},_delegate:{value:null,writable:!0},delegate:{set:function(e){this._delegate=e},get:function(){return this._delegate}}});t.BasicAnimation=Object.create(h,{_startTime:{value:0,writable:!0},_from:{value:null,writable:!0},_to:{value:null,writable:!0},_duration:{value:0,writable:!0},path:{value:null,writable:!0},target:{value:null,writable:!0},_interpolator:{value:null,writable:!0},extras:{value:null,writable:!0},_timingFunction:{value:null,writable:!0},_bezier:{value:null,writable:!0},timingFunction:{set:function(e){this._timingFunction=e},get:function(){return this._timingFunction||"ease"}},_inferInterpolatorFromValue:{value:function(e){return isNaN(e-0)||null==e?e instanceof Object?i:nil:r}},to:{set:function(e){this._interpolator=this._inferInterpolatorFromValue(e),this._to=e},get:function(){return this._to}},from:{set:function(e){this._from=e},get:function(){return this._from}},duration:{set:function(e){this._duration=e},get:function(){return this._duration}},_evaluateAtTime:{value:function(e){var t=(e-this._startTime)/this.duration;if(t>1&&(t=1),0>t&&(t=0),null==this._bezier){var i=l[this.timingFunction]||"ease";this._bezier=new n(i)}t=this._bezier.get(t);var r=this._interpolator(this._from,this._to,t);this.target&&this.path&&(this.target[this.path]=r,this.delegate.animationDidUpdate(this))}},animationWasAddedToTarget:{value:function(){this._startTime=Date.now()}},animationWasRemovedFromTarget:{value:function(){this._startTime=0}},init:{value:function(){return this.type=h.BASIC,this.extras={},this}}}),t.KeyframeAnimation=Object.create(h,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_startTime:{value:0,writable:!0},_endTime:{value:-1,writable:!0},channels:{get:function(){return this._channels},set:function(e){this._channels=e}},samplers:{get:function(){return this._samplers},set:function(e){this._samplers=e}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},count:{get:function(){return this._count},set:function(e){this._count=e}},startTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].startTime,t=1;this.channels.length>t;t++)e>this.channels[t].startTime&&(e=this.channels[t].startTime);return e}return 0}}},endTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].endTime,t=1;this.channels.length>t;t++)this.channels[t].endTime>e&&(e=this.channels[t].endTime);return e}return-1}}},updateTargetsAtTime:{value:function(e,t){this.channels.forEach(function(n){n.updateTargetsAtTime(e,t)},this)}},initWithDescription:{value:function(e){return this.init(),this.count=e.count,Object.keys(e.samplers).forEach(function(t){var n=e.samplers[t],i=Object.create(c).initWithDescription(n);this.samplers[t]=i},this),e.channels.forEach(function(e){var t=Object.create(u).initWithDescription(e);t.sampler=this.samplers[e.sampler],t.target=e.target,this.channels.push(t)},this),this}},init:{value:function(){return this.channels=[],this.samplers={},this.type=h.KEYFRAME,this}}})}});