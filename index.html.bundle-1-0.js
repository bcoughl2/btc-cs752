montageDefine("83b66f4","runtime/dependencies/o3dgc",{dependencies:[],factory:function(e,i){i.o3dgc=function(){"use strict";function e(){var e,i,t;return i=new ArrayBuffer(4),e=new Uint32Array(i),t=new Uint8Array(i),e[0]=1,1===t[0]?o.O3DGC_LITTLE_ENDIAN:o.O3DGC_BIG_ENDIAN}function i(e,i,t,s){var a,u,n,r,l,c,m;for(a=-1,u=!1,r=i.m_value,l=0,n=l;r>n;++n){if(e.Equal(t[n].m_id)){u=!0;break}if(e.Less(t[n].m_id)){for(i.m_value<o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&++i.m_value,c=i.m_value-1;c>n;--c)for(t[c].m_id.m_a=t[c-1].m_id.m_a,t[c].m_id.m_b=t[c-1].m_id.m_b,t[c].m_id.m_c=t[c-1].m_id.m_c,m=0;s>m;++m)t[c].m_pred[m]=t[c-1].m_pred[m];t[n].m_id.m_a=e.m_a,t[n].m_id.m_b=e.m_b,t[n].m_id.m_c=e.m_c,a=n,u=!0;break}}return!u&&i.m_value<o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&(a=i.m_value++,t[a].m_id.m_a=e.m_a,t[a].m_id.m_b=e.m_b,t[a].m_id.m_c=e.m_c),a}function t(e,i){var t,s,a;t=Math.abs(e.m_x),s=Math.abs(e.m_y),a=Math.abs(e.m_z),a>=t&&a>=s?e.m_z>=0?(i.m_z=0,i.m_x=e.m_x,i.m_y=e.m_y):(i.m_z=1,i.m_x=-e.m_x,i.m_y=-e.m_y):s>=t&&s>=a?e.m_y>=0?(i.m_z=2,i.m_x=e.m_z,i.m_y=e.m_x):(i.m_z=3,i.m_x=-e.m_z,i.m_y=-e.m_x):e.m_x>=0?(i.m_z=4,i.m_x=e.m_y,i.m_y=e.m_z):(i.m_z=5,i.m_x=-e.m_y,i.m_y=-e.m_z)}function s(e){return 0>e?-1-2*e:2*e}function a(e){return 1&e?-(e+1>>>1):e>>>1}function u(e,t,s,a,u,n,r,o){var c,m,d,p,v,g;for(g=new l.SC3DMCTriplet(-1,-1,-1),m=0;3>m;++m)if(p=e[3*t+m],s>p&&(g.m_a=-1,g.m_b=-1,g.m_c=p,d=i(g,a,u,n),-1!==d))for(c=p*o,v=0;n>v;++v)u[d].m_pred[v]=r[c+v]}function n(e,t,s,a,u,n,r,o,c,m){var d,p,v,g,h,f,b,q,S,y,_,P,C,N,D,M,A,E;if(d=3*t,E=new l.SC3DMCTriplet(-1,-1,-1),e[d]===s?(f=e[d+1],b=e[d+2]):e[d+1]===s?(f=e[d],b=e[d+2]):(f=e[d],b=e[d+1]),s>f&&s>b)for(P=c.Begin(f),C=c.End(f),N=P;C>N&&(D=m[N],!(0>D));++N){for(p=3*D,q=-1,M=!1,_=0;3>_;++_)S=e[p+_],S===b?M=!0:s>S&&S!==f&&(q=S);if(-1!==q&&M&&(b>f?(E.m_a=f,E.m_b=b):(E.m_a=b,E.m_b=f),E.m_c=-q-1,A=i(E,a,u,n),-1!==A))for(v=f*o,g=b*o,h=q*o,y=0;n>y;++y)u[A].m_pred[y]=r[v+y]+r[g+y]-r[h+y]}}function r(e,i,t,s,a){var u,n,r,o,c,m,d,p,v,g;for(g=new l.Vec3,p=new l.Vec3,v=new l.Vec3,r=3*s,n=0;r>n;++n)a[n]=0;for(o=0;i>o;++o)u=3*o,c=3*e[u],m=3*e[u+1],d=3*e[u+2],p.m_x=t[m]-t[c],p.m_y=t[m+1]-t[c+1],p.m_z=t[m+2]-t[c+2],v.m_x=t[d]-t[c],v.m_y=t[d+1]-t[c+1],v.m_z=t[d+2]-t[c+2],g.m_x=p.m_y*v.m_z-p.m_z*v.m_y,g.m_y=p.m_z*v.m_x-p.m_x*v.m_z,g.m_z=p.m_x*v.m_y-p.m_y*v.m_x,a[c]+=g.m_x,a[c+1]+=g.m_y,a[c+2]+=g.m_z,a[m]+=g.m_x,a[m+1]+=g.m_y,a[m+2]+=g.m_z,a[d]+=g.m_x,a[d+1]+=g.m_y,a[d+2]+=g.m_z}var l,o;return l={},o={},o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0=7,o.O3DGC_BINARY_STREAM_MAX_SYMBOL0=127,o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1=6,o.O3DGC_BINARY_STREAM_MAX_SYMBOL1=63,o.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32=5,o.O3DGC_BIG_ENDIAN=0,o.O3DGC_LITTLE_ENDIAN=1,o.O3DGC_MAX_DOUBLE=1.79769e308,o.O3DGC_MIN_LONG=-2147483647,o.O3DGC_MAX_LONG=2147483647,o.O3DGC_MAX_UCHAR8=255,o.O3DGC_MAX_TFAN_SIZE=256,o.O3DGC_MAX_ULONG=4294967295,o.O3DGC_SC3DMC_START_CODE=497,o.O3DGC_DV_START_CODE=498,o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES=256,o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES=256,o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES=32,o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS=2,o.O3DGC_SC3DMC_BINARIZATION_FL=0,o.O3DGC_SC3DMC_BINARIZATION_BP=1,o.O3DGC_SC3DMC_BINARIZATION_FC=2,o.O3DGC_SC3DMC_BINARIZATION_AC=3,o.O3DGC_SC3DMC_BINARIZATION_AC_EGC=4,o.O3DGC_SC3DMC_BINARIZATION_ASCII=5,o.O3DGC_STREAM_TYPE_UNKOWN=0,o.O3DGC_STREAM_TYPE_ASCII=1,o.O3DGC_STREAM_TYPE_BINARY=2,o.O3DGC_SC3DMC_NO_PREDICTION=0,o.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION=1,o.O3DGC_SC3DMC_XOR_PREDICTION=2,o.O3DGC_SC3DMC_ADAPTIVE_DIFFERENTIAL_PREDICTION=3,o.O3DGC_SC3DMC_CIRCULAR_DIFFERENTIAL_PREDICTION=4,o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION=5,o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION=6,o.O3DGC_SC3DMC_ENCODE_MODE_QBCR=0,o.O3DGC_SC3DMC_ENCODE_MODE_SVA=1,o.O3DGC_SC3DMC_ENCODE_MODE_TFAN=2,o.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT=0,o.O3DGC_MIN_NEIGHBORS_SIZE=128,o.O3DGC_MIN_NUM_NEIGHBORS_SIZE=16,o.O3DGC_TFANS_MIN_SIZE_ALLOCATED_VERTICES_BUFFER=128,o.O3DGC_TFANS_MIN_SIZE_TFAN_SIZE_BUFFER=8,o.O3DGC_DEFAULT_VECTOR_SIZE=32,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_UNKOWN=0,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_POSITION=1,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_NORMAL=2,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_COLOR=3,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_TEXCOORD=4,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_WEIGHT=5,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_UNKOWN=0,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX=1,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_JOINT_ID=2,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX_BUFFER_ID=3,l.O3DGC_OK=0,l.O3DGC_ERROR_BUFFER_FULL=1,l.O3DGC_ERROR_CORRUPTED_STREAM=5,l.O3DGC_ERROR_NON_SUPPORTED_FEATURE=6,l.O3DGC_ERROR_AC=7,l.SC3DMCStats=function(){this.m_timeCoord=0,this.m_timeNormal=0,this.m_timeCoordIndex=0,this.m_timeFloatAttribute=new Float32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_timeIntAttribute=new Float32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_timeReorder=0,this.m_streamSizeCoord=0,this.m_streamSizeNormal=0,this.m_streamSizeCoordIndex=0,this.m_streamSizeFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_streamSizeIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES)},l.SC3DMCTriplet=function(e,i,t){this.m_a=e,this.m_b=i,this.m_c=t},l.SC3DMCTriplet.prototype.Less=function(e){var i;return i=this.m_c!==e.m_c?this.m_c<e.m_c:this.m_b!==e.m_b?this.m_b<e.m_b:this.m_a<e.m_a},l.SC3DMCTriplet.prototype.Equal=function(e){return this.m_c===e.m_c&&this.m_b===e.m_b&&this.m_a===e.m_a},l.SC3DMCPredictor=function(){this.m_id=new l.SC3DMCTriplet(-1,-1,-1),this.m_pred=new Float32Array(o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES)},void 0===window.performance&&(window.performance={}),window.performance.now||(o.nowOffset=Date.now(),performance.timing&&performance.timing.navigationStart&&(o.nowOffset=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-o.nowOffset}),l.Timer=function(){this.m_start=0,this.m_end=0},l.Timer.prototype.Tic=function(){this.m_start=window.performance.now()},l.Timer.prototype.Toc=function(){this.m_end=window.performance.now()},l.Timer.prototype.GetElapsedTime=function(){return this.m_end-this.m_start},l.Vec3=function(e,i,t){this.m_x=e,this.m_y=i,this.m_z=t},l.Vec3.prototype.Set=function(e,i,t){this.m_x=e,this.m_y=i,this.m_z=t},l.Vec3.prototype.Sub=function(e,i){this.m_x=e.m_x-i.m_x,this.m_y=e.m_y-i.m_y,this.m_z=e.m_z-i.m_z},l.Vec3.prototype.Add=function(e,i){this.m_x=e.m_x+i.m_x,this.m_y=e.m_y+i.m_y,this.m_z=e.m_z+i.m_z},l.Vec3.prototype.SelfAdd=function(e){this.m_x+=e.m_x,this.m_y+=e.m_y,this.m_z+=e.m_z},l.Vec3.prototype.Cross=function(e,i){this.m_x=e.m_y*i.m_z-e.m_z*i.m_y,this.m_y=e.m_z*i.m_x-e.m_x*i.m_z,this.m_z=e.m_x*i.m_y-e.m_y*i.m_x},l.Vec3.prototype.GetNorm=function(){return Math.sqrt(this.m_x*this.m_x+this.m_y*this.m_y+this.m_z*this.m_z)},o.CubeToSphere={0:function(e,i){i.m_x=e.m_x,i.m_y=e.m_y,i.m_z=Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_y*i.m_y))},1:function(e,i){i.m_x=-e.m_x,i.m_y=-e.m_y,i.m_z=-Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_y*i.m_y))},2:function(e,i){i.m_z=e.m_x,i.m_x=e.m_y,i.m_y=Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_z*i.m_z))},3:function(e,i){i.m_z=-e.m_x,i.m_x=-e.m_y,i.m_y=-Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_z*i.m_z))},4:function(e,i){i.m_y=e.m_x,i.m_z=e.m_y,i.m_x=Math.sqrt(Math.max(0,1-i.m_y*i.m_y-i.m_z*i.m_z))},5:function(e,i){i.m_y=-e.m_x,i.m_z=-e.m_y,i.m_x=-Math.sqrt(Math.max(0,1-i.m_y*i.m_y-i.m_z*i.m_z))}},l.Iterator=function(){this.m_count=0},l.NumberRef=function(){this.m_value=0},l.BinaryStream=function(i){this.m_endianness=e(),this.m_buffer=i,this.m_stream=new Uint8Array(this.m_buffer),this.m_localBuffer=new ArrayBuffer(4),this.m_localBufferViewUChar8=new Uint8Array(this.m_localBuffer),this.m_localBufferViewFloat32=new Float32Array(this.m_localBuffer),this.m_localBufferViewUInt32=new Uint32Array(this.m_localBuffer)},l.BinaryStream.prototype.ReadFloat32Bin=function(e){return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewFloat32[0]},l.BinaryStream.prototype.ReadUInt32Bin=function(e){return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewUInt32[0]},l.BinaryStream.prototype.ReadUChar8Bin=function(e){return this.m_stream[e.m_count++]},l.BinaryStream.prototype.ReadUInt32ASCII=function(e){var i,t,s;for(i=0,t=0,s=0;o.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32>s;++s)i+=this.m_stream[e.m_count++]<<t>>>0,t+=o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;return i},l.BinaryStream.prototype.ReadFloat32ASCII=function(e){var i=this.ReadUInt32ASCII(e);return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[0]=i&o.O3DGC_MAX_UCHAR8):(this.m_localBufferViewUChar8[0]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[3]=i&o.O3DGC_MAX_UCHAR8),this.m_localBufferViewFloat32[0]},l.BinaryStream.prototype.ReadIntASCII=function(e){return a(this.ReadUIntASCII(e))},l.BinaryStream.prototype.ReadUIntASCII=function(e){var i,t,s;if(s=this.m_stream[e.m_count++],s===o.O3DGC_BINARY_STREAM_MAX_SYMBOL0){i=0;do t=this.m_stream[e.m_count++],s+=t>>>1<<i>>>0,i+=o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1;while(1&t)}return s},l.BinaryStream.prototype.ReadUCharASCII=function(e){return this.m_stream[e.m_count++]},l.BinaryStream.prototype.ReadFloat32=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadFloat32ASCII(e):this.ReadFloat32Bin(e)},l.BinaryStream.prototype.ReadUInt32=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadUInt32ASCII(e):this.ReadUInt32Bin(e)},l.BinaryStream.prototype.ReadUChar=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadUCharASCII(e):this.ReadUChar8Bin(e)},l.BinaryStream.prototype.GetBuffer=function(e,i){return new Uint8Array(this.m_buffer,e.m_count,i)},o.O3DGC_AC_MIN_LENGTH=16777216,o.O3DGC_AC_MAX_LENGTH=4294967295,o.O3DGC_AC_BM_LENGTH_SHIFT=13,o.O3DGC_AC_BM_MAX_COUNT=1<<o.O3DGC_AC_BM_LENGTH_SHIFT>>>0,o.O3DGC_AC_DM_LENGTH_SHIFT=15,o.O3DGC_AC_DM_MAX_COUNT=1<<o.O3DGC_AC_DM_LENGTH_SHIFT>>>0,l.StaticBitModel=function(){this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0},l.StaticBitModel.prototype.SetProbability=function(e){this.m_bit0Prob=Math.floor(e*(1<<o.O3DGC_AC_BM_LENGTH_SHIFT>>>0))},l.AdaptiveBitModel=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},l.AdaptiveBitModel.prototype.Reset=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},l.AdaptiveBitModel.prototype.Update=function(){(this.m_bitCount+=this.m_updateCycle)>o.O3DGC_AC_BM_MAX_COUNT&&(this.m_bitCount=this.m_bitCount+1>>>1,this.m_bit0Count=this.m_bit0Count+1>>>1,this.m_bit0Count===this.m_bitCount&&++this.m_bitCount);var e=Math.floor(2147483648/this.m_bitCount);this.m_bit0Prob=this.m_bit0Count*e>>>31-o.O3DGC_AC_BM_LENGTH_SHIFT,this.m_updateCycle=5*this.m_updateCycle>>>2,this.m_updateCycle>64&&(this.m_updateCycle=64),this.m_bitsUntilUpdate=this.m_updateCycle},l.AdaptiveDataModel=function(){this.m_buffer={},this.m_distribution={},this.m_symbolCount={},this.m_decoderTable={},this.m_totalCount=0,this.m_updateCycle=0,this.m_symbolsUntilUpdate=0,this.m_dataSymbols=0,this.m_lastSymbol=0,this.m_tableSize=0,this.m_tableShift=0},l.AdaptiveDataModel.prototype.Update=function(){var e,i,t,s,a,u,n;if((this.m_totalCount+=this.m_updateCycle)>o.O3DGC_AC_DM_MAX_COUNT)for(this.m_totalCount=0,e=0;this.m_dataSymbols>e;++e)this.m_totalCount+=this.m_symbolCount[e]=this.m_symbolCount[e]+1>>>1;if(i=0,t=0,s=Math.floor(2147483648/this.m_totalCount),0===this.m_tableSize)for(a=0;this.m_dataSymbols>a;++a)this.m_distribution[a]=s*i>>>31-o.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[a];else{for(a=0;this.m_dataSymbols>a;++a)for(this.m_distribution[a]=s*i>>>31-o.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[a],n=this.m_distribution[a]>>>this.m_tableShift;n>t;)this.m_decoderTable[++t]=a-1;for(this.m_decoderTable[0]=0;this.m_tableSize>=t;)this.m_decoderTable[++t]=this.m_dataSymbols-1}this.m_updateCycle=5*this.m_updateCycle>>>2,u=this.m_dataSymbols+6<<3>>>0,this.m_updateCycle>u&&(this.m_updateCycle=u),this.m_symbolsUntilUpdate=this.m_updateCycle},l.AdaptiveDataModel.prototype.Reset=function(){var e;if(0!==this.m_dataSymbols){for(this.m_totalCount=0,this.m_updateCycle=this.m_dataSymbols,e=0;this.m_dataSymbols>e;++e)this.m_symbolCount[e]=1;this.Update(),this.m_symbolsUntilUpdate=this.m_updateCycle=this.m_dataSymbols+6>>>1}},l.AdaptiveDataModel.prototype.SetAlphabet=function(e){if(2>e||e>2048)return Console.log("invalid number of data symbols"),l.O3DGC_ERROR_AC;if(this.m_dataSymbols!==e)if(this.m_dataSymbols=e,this.m_lastSymbol=this.m_dataSymbols-1,this.m_dataSymbols>16){for(var i=3;this.m_dataSymbols>1<<i+2>>>0;)++i;this.m_tableSize=1<<i>>>0,this.m_tableShift=o.O3DGC_AC_DM_LENGTH_SHIFT-i,this.m_buffer=new ArrayBuffer(4*(2*this.m_dataSymbols+this.m_tableSize+2)),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable=new Uint32Array(this.m_buffer,8*this.m_dataSymbols,this.m_tableSize+2)}else this.m_tableSize=this.m_tableShift=0,this.m_buffer=new ArrayBuffer(8*this.m_dataSymbols),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable={};return this.Reset(),l.O3DGC_OK},l.ArithmeticDecoder=function(){this.m_codeBuffer={},this.m_acShift=0,this.m_base=0,this.m_value=0,this.m_length=0,this.m_bufferSize=0,this.m_mode=0},l.ArithmeticDecoder.prototype.SetBuffer=function(e,i){return 0===e?(Console.log("invalid codec buffer size"),l.O3DGC_ERROR_AC):0!==this.m_mode?(Console.log("cannot set buffer while encoding or decoding"),l.O3DGC_ERROR_AC):(this.m_bufferSize=e,this.m_codeBuffer=i,void 0)},l.ArithmeticDecoder.prototype.StartDecoder=function(){return 0!==this.m_mode?(Console.log("cannot start decoder"),l.O3DGC_ERROR_AC):0===this.m_bufferSize?(Console.log("no code buffer set"),l.O3DGC_ERROR_AC):(this.m_mode=2,this.m_length=o.O3DGC_AC_MAX_LENGTH,this.m_acShift=3,this.m_value=(this.m_codeBuffer[0]<<24|this.m_codeBuffer[1]<<16|this.m_codeBuffer[2]<<8|this.m_codeBuffer[3])>>>0,void 0)},l.ArithmeticDecoder.prototype.StopDecoder=function(){return 2!==this.m_mode?(Console.log("invalid to stop decoder"),l.O3DGC_ERROR_AC):(this.m_mode=0,void 0)},l.ArithmeticDecoder.prototype.GetBit=function(){this.m_length>>>=1;var e=this.m_value>=this.m_length;return e&&(this.m_value-=this.m_length),this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),e},l.ArithmeticDecoder.prototype.GetBits=function(e){var i=Math.floor(this.m_value/(this.m_length>>>=e));return this.m_value-=this.m_length*i,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),i},l.ArithmeticDecoder.prototype.DecodeStaticBitModel=function(e){var i,t;return i=e.m_bit0Prob*(this.m_length>>>o.O3DGC_AC_BM_LENGTH_SHIFT),t=this.m_value>=i,t?(this.m_value-=i,this.m_length-=i):this.m_length=i,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),t},l.ArithmeticDecoder.prototype.DecodeAdaptiveBitModel=function(e){var i,t;return i=e.m_bit0Prob*(this.m_length>>>o.O3DGC_AC_BM_LENGTH_SHIFT),t=this.m_value>=i,t?(this.m_value-=i,this.m_length-=i):(this.m_length=i,++e.m_bit0Count),this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),0===--e.m_bitsUntilUpdate&&e.Update(),t},l.ArithmeticDecoder.prototype.DecodeAdaptiveDataModel=function(e){var i,t,s,a,u,n,r,l;if(a=this.m_length,e.m_tableSize>0){for(n=Math.floor(this.m_value/(this.m_length>>>=o.O3DGC_AC_DM_LENGTH_SHIFT)),u=n>>>e.m_tableShift,t=e.m_decoderTable[u],i=e.m_decoderTable[u+1]+1;i>t+1;)l=t+i>>>1,e.m_distribution[l]>n?i=l:t=l;s=e.m_distribution[t]*this.m_length,t!==e.m_lastSymbol&&(a=e.m_distribution[t+1]*this.m_length)}else{s=t=0,this.m_length>>>=o.O3DGC_AC_DM_LENGTH_SHIFT,l=(i=e.m_dataSymbols)>>>1;do r=this.m_length*e.m_distribution[l],r>this.m_value?(i=l,a=r):(t=l,s=r);while((l=t+i>>>1)!==t)}return this.m_value-=s,this.m_length=a-s,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),++e.m_symbolCount[t],0===--e.m_symbolsUntilUpdate&&e.Update(!1),t},l.ArithmeticDecoder.prototype.ExpGolombDecode=function(e,i,t){var s,a,u;s=0,a=0;do u=this.DecodeAdaptiveBitModel(t),u&&(s+=1<<e>>>0,e++);while(u);for(;e--;)this.DecodeStaticBitModel(i)&&(a=(a|1<<e)>>>0);return s+a},l.ArithmeticDecoder.prototype.RenormDecInterval=function(){do this.m_value=(this.m_value<<8|this.m_codeBuffer[++this.m_acShift])>>>0,this.m_length=this.m_length<<8>>>0;while(this.m_length<o.O3DGC_AC_MIN_LENGTH)},l.ArithmeticDecoder.prototype.DecodeIntACEGC=function(e,i,t,s,u){var n=this.DecodeAdaptiveDataModel(e);return n===u&&(n+=this.ExpGolombDecode(s,i,t)),a(n)},l.ArithmeticDecoder.prototype.DecodeUIntACEGC=function(e,i,t,s,a){var u=this.DecodeAdaptiveDataModel(e);return u===a&&(u+=this.ExpGolombDecode(s,i,t)),u},l.FIFO=function(){this.m_data={},this.m_allocated=0,this.m_size=0,this.m_start=0,this.m_end=0},l.FIFO.prototype.Clear=function(){this.m_start=this.m_end=this.m_size=0},l.FIFO.prototype.GetAllocatedSize=function(){return this.m_allocated},l.FIFO.prototype.GetSize=function(){return this.m_size},l.FIFO.prototype.Allocate=function(e){return e>this.m_allocated&&(this.m_allocated=e,this.m_data=new Int32Array(this.m_allocated)),this.Clear(),l.O3DGC_OK},l.FIFO.prototype.PopFirst=function(){--this.m_size;var e=this.m_start++;return this.m_start===this.m_allocated&&(this.m_end=0),this.m_data[e]},l.FIFO.prototype.PushBack=function(e){--this.m_size,this.m_data[this.m_end]=e,++this.m_size,++this.m_end,this.m_end===this.m_allocated&&(this.m_end=0)},l.IndexedFaceSet=function(){this.m_nCoordIndex=0,this.m_nCoord=0,this.m_nNormal=0,this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_creaseAngle=30,this.m_ccw=!0,this.m_solid=!0,this.m_convex=!0,this.m_isTriangularMesh=!0,this.m_coordMin=new Float32Array(3),this.m_coordMax=new Float32Array(3),this.m_normalMin=new Float32Array(3),this.m_normalMax=new Float32Array(3),this.m_nFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_nIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_dimFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_dimIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_typeFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_typeIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_minFloatAttributeBuffer=new ArrayBuffer(4*o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minFloatAttribute=new Float32Array(this.m_minFloatAttributeBuffer),this.m_maxFloatAttributeBuffer=new ArrayBuffer(4*o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_maxFloatAttribute=new Float32Array(this.m_maxFloatAttributeBuffer),this.m_coordIndex={},this.m_coord={},this.m_normal={},this.m_floatAttribute=[],this.m_intAttribute=[]},l.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},l.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},l.IndexedFaceSet.prototype.GetNCoord=function(){return this.m_nCoord},l.IndexedFaceSet.prototype.GetNNormal=function(){return this.m_nNormal},l.IndexedFaceSet.prototype.GetNFloatAttribute=function(e){return this.m_nFloatAttribute[e]},l.IndexedFaceSet.prototype.GetNIntAttribute=function(e){return this.m_nIntAttribute[e]},l.IndexedFaceSet.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},l.IndexedFaceSet.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},l.IndexedFaceSet.prototype.GetCoordMinArray=function(){return this.m_coordMin},l.IndexedFaceSet.prototype.GetCoordMaxArray=function(){return this.m_coordMax},l.IndexedFaceSet.prototype.GetNormalMinArray=function(){return this.m_normalMin},l.IndexedFaceSet.prototype.GetNormalMaxArray=function(){return this.m_normalMax},l.IndexedFaceSet.prototype.GetFloatAttributeMinArray=function(e){return new Float32Array(this.m_minFloatAttributeBuffer,4*e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES,this.GetFloatAttributeDim(e))},l.IndexedFaceSet.prototype.GetFloatAttributeMaxArray=function(e){return new Float32Array(this.m_maxFloatAttributeBuffer,4*e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES,this.GetFloatAttributeDim(e))},l.IndexedFaceSet.prototype.GetFloatAttributeDim=function(e){return this.m_dimFloatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttributeDim=function(e){return this.m_dimIntAttribute[e]},l.IndexedFaceSet.prototype.GetFloatAttributeType=function(e){return this.m_typeFloatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttributeType=function(e){return this.m_typeIntAttribute[e]},l.IndexedFaceSet.prototype.GetFloatAttributeMax=function(e,i){return this.m_maxFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]},l.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},l.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},l.IndexedFaceSet.prototype.GetCCW=function(){return this.m_ccw},l.IndexedFaceSet.prototype.GetSolid=function(){return this.m_solid},l.IndexedFaceSet.prototype.GetConvex=function(){return this.m_convex},l.IndexedFaceSet.prototype.GetIsTriangularMesh=function(){return this.m_isTriangularMesh},l.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},l.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},l.IndexedFaceSet.prototype.GetCoord=function(){return this.m_coord},l.IndexedFaceSet.prototype.GetNormal=function(){return this.m_normal},l.IndexedFaceSet.prototype.GetFloatAttribute=function(e){return this.m_floatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttribute=function(e){return this.m_intAttribute[e]},l.IndexedFaceSet.prototype.SetNCoordIndex=function(e){this.m_nCoordIndex=e},l.IndexedFaceSet.prototype.SetNNormalIndex=function(){},l.IndexedFaceSet.prototype.SetNormalPerVertex=function(){},l.IndexedFaceSet.prototype.SetNFloatAttributeIndex=function(){},l.IndexedFaceSet.prototype.SetNIntAttributeIndex=function(){},l.IndexedFaceSet.prototype.SetFloatAttributePerVertex=function(){},l.IndexedFaceSet.prototype.SetIntAttributePerVertex=function(){},l.IndexedFaceSet.prototype.SetNCoord=function(e){this.m_nCoord=e},l.IndexedFaceSet.prototype.SetNNormal=function(e){this.m_nNormal=e},l.IndexedFaceSet.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},l.IndexedFaceSet.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},l.IndexedFaceSet.prototype.SetCreaseAngle=function(e){this.m_creaseAngle=e},l.IndexedFaceSet.prototype.SetCCW=function(e){this.m_ccw=e},l.IndexedFaceSet.prototype.SetSolid=function(e){this.m_solid=e},l.IndexedFaceSet.prototype.SetConvex=function(e){this.m_convex=e},l.IndexedFaceSet.prototype.SetIsTriangularMesh=function(e){this.m_isTriangularMesh=e},l.IndexedFaceSet.prototype.SetCoordMin=function(e,i){this.m_coordMin[e]=i},l.IndexedFaceSet.prototype.SetCoordMax=function(e,i){this.m_coordMax[e]=i},l.IndexedFaceSet.prototype.SetNormalMin=function(e,i){this.m_normalMin[e]=i},l.IndexedFaceSet.prototype.SetNormalMax=function(e,i){this.m_normalMax[e]=i},l.IndexedFaceSet.prototype.SetNFloatAttribute=function(e,i){this.m_nFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetNIntAttribute=function(e,i){this.m_nIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeDim=function(e,i){this.m_dimFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttributeDim=function(e,i){this.m_dimIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeType=function(e,i){this.m_typeFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttributeType=function(e,i){this.m_typeIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeMin=function(e,i,t){this.m_minFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=t},l.IndexedFaceSet.prototype.SetFloatAttributeMax=function(e,i,t){this.m_maxFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=t},l.IndexedFaceSet.prototype.SetCoordIndex=function(e){this.m_coordIndex=e},l.IndexedFaceSet.prototype.SetCoord=function(e){this.m_coord=e},l.IndexedFaceSet.prototype.SetNormal=function(e){this.m_normal=e},l.IndexedFaceSet.prototype.SetFloatAttribute=function(e,i){this.m_floatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttribute=function(e,i){this.m_intAttribute[e]=i},l.SC3DMCEncodeParams=function(){var e;for(this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_floatAttributeQuantBits=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_floatAttributePredMode=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_intAttributePredMode=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_encodeMode=o.O3DGC_SC3DMC_ENCODE_MODE_TFAN,this.m_streamTypeMode=o.O3DGC_STREAM_TYPE_ASCII,this.m_coordQuantBits=14,this.m_normalQuantBits=8,this.m_coordPredMode=o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,this.m_normalPredMode=o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION,e=0;o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES>e;++e)this.m_floatAttributePredMode[e]=o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION;for(e=0;o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES>e;++e)this.m_intAttributePredMode[e]=o.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION},l.SC3DMCEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},l.SC3DMCEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},l.SC3DMCEncodeParams.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},l.SC3DMCEncodeParams.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},l.SC3DMCEncodeParams.prototype.GetCoordQuantBits=function(){return this.m_coordQuantBits},l.SC3DMCEncodeParams.prototype.GetNormalQuantBits=function(){return this.m_normalQuantBits},l.SC3DMCEncodeParams.prototype.GetFloatAttributeQuantBits=function(e){return this.m_floatAttributeQuantBits[e]},l.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},l.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},l.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},l.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},l.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},l.SC3DMCEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},l.SC3DMCEncodeParams.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},l.SC3DMCEncodeParams.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},l.SC3DMCEncodeParams.prototype.SetCoordQuantBits=function(e){this.m_coordQuantBits=e},l.SC3DMCEncodeParams.prototype.SetNormalQuantBits=function(e){this.m_normalQuantBits=e},l.SC3DMCEncodeParams.prototype.SetFloatAttributeQuantBits=function(e,i){this.m_floatAttributeQuantBits[e]=i},l.SC3DMCEncodeParams.prototype.SetCoordPredMode=function(e){this.m_coordPredMode=e},l.SC3DMCEncodeParams.prototype.SetNormalPredMode=function(e){this.m_normalPredMode=e},l.SC3DMCEncodeParams.prototype.SetFloatAttributePredMode=function(e,i){this.m_floatAttributePredMode[e]=i},l.SC3DMCEncodeParams.prototype.SetIntAttributePredMode=function(e,i){this.m_intAttributePredMode[e]=i},l.AdjacencyInfo=function(){this.m_neighborsSize=0,this.m_numNeighborsSize=0,this.m_numElements=0,this.m_neighbors={},this.m_numNeighbors={}},l.AdjacencyInfo.prototype.Allocate=function(e,i){return this.m_numElements=e,i>this.m_neighborsSize&&(this.m_neighborsSize=i,this.m_neighbors=new Int32Array(this.m_neighborsSize)),e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),l.O3DGC_OK},l.AdjacencyInfo.prototype.AllocateNumNeighborsArray=function(e){return e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),this.m_numElements=e,l.O3DGC_OK},l.AdjacencyInfo.prototype.AllocateNeighborsArray=function(){var e;for(e=1;this.m_numElements>e;++e)this.m_numNeighbors[e]+=this.m_numNeighbors[e-1];return this.m_numNeighbors[this.m_numElements-1]>this.m_neighborsSize&&(this.m_neighborsSize=this.m_numNeighbors[this.m_numElements-1],this.m_neighbors=new Int32Array(this.m_neighborsSize)),l.O3DGC_OK},l.AdjacencyInfo.prototype.ClearNumNeighborsArray=function(){var e;for(e=0;this.m_numElements>e;++e)this.m_numNeighbors[e]=0;return l.O3DGC_OK},l.AdjacencyInfo.prototype.ClearNeighborsArray=function(){var e;for(e=0;this.m_neighborsSize>e;++e)this.m_neighbors[e]=-1;return l.O3DGC_OK},l.AdjacencyInfo.prototype.Begin=function(e){return e>0?this.m_numNeighbors[e-1]:0},l.AdjacencyInfo.prototype.End=function(e){return this.m_numNeighbors[e]},l.AdjacencyInfo.prototype.AddNeighbor=function(e,i){var t,s,a;for(s=this.Begin(e),a=this.End(e),t=s;a>t;++t)if(-1===this.m_neighbors[t])return this.m_neighbors[t]=i,l.O3DGC_OK;return l.O3DGC_ERROR_BUFFER_FULL},l.AdjacencyInfo.prototype.GetNeighbor=function(e){return this.m_neighbors[e]},l.AdjacencyInfo.prototype.GetNumNeighbors=function(e){return this.End(e)-this.Begin(e)},l.AdjacencyInfo.prototype.GetNumNeighborsBuffer=function(){return this.m_numNeighbors},l.AdjacencyInfo.prototype.GetNeighborsBuffer=function(){return this.m_neighbors},l.Vector=function(){this.m_data={},this.m_allocated=0,this.m_size=0},l.Vector.prototype.Clear=function(){this.m_size=0},l.Vector.prototype.Get=function(e){return this.m_data[e]},l.Vector.prototype.GetAllocatedSize=function(){return this.m_allocated},l.Vector.prototype.GetSize=function(){return this.m_size},l.Vector.prototype.GetBuffer=function(){return this.m_data},l.Vector.prototype.SetSize=function(e){this.m_size=e},l.Vector.prototype.Allocate=function(e){var i,t;if(e>this.m_allocated){if(this.m_allocated=e,t=new Int32Array(this.m_allocated),this.m_size>0)for(i=0;this.m_size>i;++i)t[i]=this.m_data[i];this.m_data=t}},l.Vector.prototype.PushBack=function(e){var i,t;if(this.m_size===this.m_allocated){if(this.m_allocated*=2,this.m_allocated<o.O3DGC_DEFAULT_VECTOR_SIZE&&(this.m_allocated=o.O3DGC_DEFAULT_VECTOR_SIZE),t=new Int32Array(this.m_allocated),this.m_size>0)for(i=0;this.m_size>i;++i)t[i]=this.m_data[i];this.m_data=t}this.m_data[this.m_size++]=e},l.CompressedTriangleFans=function(){this.m_numTFANs=new l.Vector,this.m_degrees=new l.Vector,this.m_configs=new l.Vector,this.m_operations=new l.Vector,this.m_indices=new l.Vector,this.m_trianglesOrder=new l.Vector,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN
},l.CompressedTriangleFans.prototype.GetStreamType=function(){return this.m_streamType},l.CompressedTriangleFans.prototype.SetStreamType=function(e){this.m_streamType=e},l.CompressedTriangleFans.prototype.Clear=function(){return this.m_numTFANs.Clear(),this.m_degrees.Clear(),this.m_configs.Clear(),this.m_operations.Clear(),this.m_indices.Clear(),l.O3DGC_OK},l.CompressedTriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs.Allocate(e),this.m_degrees.Allocate(2*e),this.m_configs.Allocate(2*e),this.m_operations.Allocate(2*e),this.m_indices.Allocate(2*e),this.m_trianglesOrder.Allocate(i),this.Clear(),l.O3DGC_OK},l.CompressedTriangleFans.prototype.PushNumTFans=function(e){this.m_numTFANs.PushBack(e)},l.CompressedTriangleFans.prototype.ReadNumTFans=function(e){return this.m_numTFANs.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushDegree=function(e){this.m_degrees.PushBack(e)},l.CompressedTriangleFans.prototype.ReadDegree=function(e){return this.m_degrees.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushConfig=function(e){this.m_configs.PushBack(e)},l.CompressedTriangleFans.prototype.ReadConfig=function(e){return this.m_configs.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushOperation=function(e){this.m_operations.PushBack(e)},l.CompressedTriangleFans.prototype.ReadOperation=function(e){return this.m_operations.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushIndex=function(e){this.m_indices.PushBack(e)},l.CompressedTriangleFans.prototype.ReadIndex=function(e){return this.m_indices.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushTriangleIndex=function(e){this.m_trianglesOrder.PushBack(s(e))},l.CompressedTriangleFans.prototype.ReadTriangleIndex=function(e){return a(this.m_trianglesOrder.Get(e.m_count++))},l.CompressedTriangleFans.prototype.LoadUIntData=function(e,i,t){var s,a;for(i.ReadUInt32ASCII(t),s=i.ReadUInt32ASCII(t),e.Allocate(s),e.Clear(),a=0;s>a;++a)e.PushBack(i.ReadUIntASCII(t));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadIntData=function(e,i,t){var s,a;for(i.ReadUInt32ASCII(t),s=i.ReadUInt32ASCII(t),e.Allocate(s),e.Clear(),a=0;s>a;++a)e.PushBack(i.ReadIntASCII(t));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadBinData=function(e,i,t){var s,a,u,n;for(i.ReadUInt32ASCII(t),s=i.ReadUInt32ASCII(t),e.Allocate(s*o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0),e.Clear(),u=0;s>u;)for(a=i.ReadUCharASCII(t),n=0;o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0>n;++n)e.PushBack(1&a),a>>>=1,++u;return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadUIntAC=function(e,i,t,s){var a,u,n,r,o,c,m;if(a=t.ReadUInt32Bin(s)-12,u=t.ReadUInt32Bin(s),0===u)return l.O3DGC_OK;for(n=t.ReadUInt32Bin(s),r=t.GetBuffer(s,a),s.m_count+=a,e.Allocate(u),o=new l.ArithmeticDecoder,o.SetBuffer(a,r),o.StartDecoder(),c=new l.AdaptiveDataModel,c.SetAlphabet(i+1),m=0;u>m;++m)e.PushBack(o.DecodeAdaptiveDataModel(c)+n);return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadIntACEGC=function(e,i,t,s){var a,u,n,r,c,m,d,p,v,g;if(a=t.ReadUInt32Bin(s)-12,u=t.ReadUInt32Bin(s),0===u)return l.O3DGC_OK;for(n=t.ReadUInt32Bin(s)-o.O3DGC_MAX_LONG,r=t.GetBuffer(s,a),s.m_count+=a,e.Allocate(u),c=new l.ArithmeticDecoder,c.SetBuffer(a,r),c.StartDecoder(),m=new l.AdaptiveDataModel,m.SetAlphabet(i+2),d=new l.StaticBitModel,p=new l.AdaptiveBitModel,g=0;u>g;++g)v=c.DecodeAdaptiveDataModel(m),v===i&&(v+=c.ExpGolombDecode(0,d,p)),e.PushBack(v+n);return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadBinAC=function(e,i,t){var s,a,u,n,r,o;if(s=i.ReadUInt32Bin(t)-8,a=i.ReadUInt32Bin(t),0===a)return l.O3DGC_OK;for(u=i.GetBuffer(t,s),t.m_count+=s,e.Allocate(a),n=new l.ArithmeticDecoder,n.SetBuffer(s,u),n.StartDecoder(),r=new l.AdaptiveBitModel,o=0;a>o;++o)e.PushBack(n.DecodeAdaptiveBitModel(r));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.Load=function(e,i,t,s){return s===o.O3DGC_STREAM_TYPE_ASCII?(this.LoadUIntData(this.m_numTFANs,e,i),this.LoadUIntData(this.m_degrees,e,i),this.LoadUIntData(this.m_configs,e,i),this.LoadBinData(this.m_operations,e,i),this.LoadIntData(this.m_indices,e,i),t&&this.LoadUIntData(this.m_trianglesOrder,e,i)):(this.LoadIntACEGC(this.m_numTFANs,4,e,i),this.LoadIntACEGC(this.m_degrees,16,e,i),this.LoadUIntAC(this.m_configs,10,e,i),this.LoadBinAC(this.m_operations,e,i),this.LoadIntACEGC(this.m_indices,8,e,i),t&&this.LoadIntACEGC(this.m_trianglesOrder,16,e,i)),l.O3DGC_OK},l.TriangleFans=function(){this.m_verticesAllocatedSize=0,this.m_sizeTFANAllocatedSize=0,this.m_numTFANs=0,this.m_numVertices=0,this.m_sizeTFAN={},this.m_vertices={}},l.TriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs=0,this.m_numVertices=0,i>this.m_verticesAllocatedSize&&(this.m_verticesAllocatedSize=i,this.m_vertices=new Int32Array(this.m_verticesAllocatedSize)),e>this.m_sizeTFANAllocatedSize&&(this.m_sizeTFANAllocatedSize=e,this.m_sizeTFAN=new Int32Array(this.m_sizeTFANAllocatedSize)),l.O3DGC_OK},l.TriangleFans.prototype.Clear=function(){return this.m_numTFANs=0,this.m_numVertices=0,l.O3DGC_OK},l.TriangleFans.prototype.AddVertex=function(e){var i,t;if(++this.m_numVertices,this.m_numVertices>this.m_verticesAllocatedSize){for(this.m_verticesAllocatedSize*=2,t=new Int32Array(this.m_verticesAllocatedSize),i=0;this.m_numVertices>i;++i)t[i]=this.m_vertices[i];this.m_vertices=t}return this.m_vertices[this.m_numVertices-1]=e,++this.m_sizeTFAN[this.m_numTFANs-1],l.O3DGC_OK},l.TriangleFans.prototype.AddTFAN=function(){var e,i;if(++this.m_numTFANs,this.m_numTFANs>this.m_sizeTFANAllocatedSize){for(this.m_sizeTFANAllocatedSize*=2,i=new Int32Array(this.m_sizeTFANAllocatedSize),e=0;this.m_numTFANs>e;++e)i[e]=this.m_sizeTFAN[e];this.m_sizeTFAN=i}return this.m_sizeTFAN[this.m_numTFANs-1]=this.m_numTFANs>1?this.m_sizeTFAN[this.m_numTFANs-2]:0,l.O3DGC_OK},l.TriangleFans.prototype.Begin=function(e){return e>0?this.m_sizeTFAN[e-1]:0},l.TriangleFans.prototype.End=function(e){return this.m_sizeTFAN[e]},l.TriangleFans.prototype.GetVertex=function(e){return this.m_vertices[e]},l.TriangleFans.prototype.GetTFANSize=function(e){return this.End(e)-this.Begin(e)},l.TriangleFans.prototype.GetNumTFANs=function(){return this.m_numTFANs},l.TriangleFans.prototype.GetNumVertices=function(){return this.m_numVertices},l.TriangleListDecoder=function(){this.m_itNumTFans=new l.Iterator,this.m_itDegree=new l.Iterator,this.m_itConfig=new l.Iterator,this.m_itOperation=new l.Iterator,this.m_itIndex=new l.Iterator,this.m_maxNumVertices=0,this.m_maxNumTriangles=0,this.m_numTriangles=0,this.m_numVertices=0,this.m_tempTrianglesSize=0,this.m_vertexCount=0,this.m_triangleCount=0,this.m_numConqueredTriangles=0,this.m_numVisitedVertices=0,this.m_triangles={},this.m_tempTriangles={},this.m_visitedVertices={},this.m_visitedVerticesValence={},this.m_vertexToTriangle=new l.AdjacencyInfo,this.m_ctfans=new l.CompressedTriangleFans,this.m_tfans=new l.TriangleFans,this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII,this.m_decodeTrianglesOrder=!1,this.m_decodeVerticesOrder=!1,this.m_processConfig={0:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),t=1;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},1:function(e,i,t){var s,a,u;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),s=1;i-1>s;++s)a=e.m_ctfans.ReadOperation(e.m_itOperation),1===a?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[1])},2:function(e,i){var t;for(t=0;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},3:function(e,i){var t;for(t=0;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},4:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),t=1;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},5:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),t=1;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},6:function(e,i){var t;for(t=0;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},7:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),t=1;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},8:function(e,i,t){var s,a,u;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),s=1;i-1>s;++s)a=e.m_ctfans.ReadOperation(e.m_itOperation),1===a?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[0])},9:function(e,i,t){var s,a,u;for(s=0;i>s;++s)a=e.m_ctfans.ReadOperation(e.m_itOperation),1===a?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++))}}},l.TriangleListDecoder.prototype.GetStreamType=function(){return this.m_streamType},l.TriangleListDecoder.prototype.GetReorderTriangles=function(){return this.m_decodeTrianglesOrder},l.TriangleListDecoder.prototype.GetReorderVertices=function(){return this.m_decodeVerticesOrder},l.TriangleListDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},l.TriangleListDecoder.prototype.GetVertexToTriangle=function(){return this.m_vertexToTriangle},l.TriangleListDecoder.prototype.Reorder=function(){var e,i,t,s,u,n,r,o;if(this.m_decodeTrianglesOrder)for(e=this.m_triangles,i=this.m_numTriangles,t=this.m_ctfans.m_trianglesOrder.m_data,n=this.m_tempTriangles,n.set(e),s=0,u=0,o=0;i>o;++o)r=a(t[s++])+u,e[3*r]=n[3*o],e[3*r+1]=n[3*o+1],e[3*r+2]=n[3*o+2],u=r+1;return l.O3DGC_OK},l.TriangleListDecoder.prototype.CompueLocalConnectivityInfo=function(e){var i,t,s,a,u,n,r,o,c,m,d,p,v,g,h,f,b,q,S;for(i=this.m_visitedVertices,t=this.m_visitedVerticesValence,s=this.m_triangles,a=this.m_vertexToTriangle,u=a.Begin(e),n=a.End(e),r=0,c=0,b=0,d=u;b>=0&&n>d;++d)if(b=a.GetNeighbor(d),b>=0)for(++r,q=3*b,v=0;3>v;++v)if(S=s[q+v],S>e){for(o=!1,p=0;c>p;++p){if(S===i[p]){t[p]++,o=!0;break}if(i[p]>S){for(++c,g=c-1;g>p;--g)i[g]=i[g-1],t[g]=t[g-1];i[p]=S,t[p]=1,o=!0;break}}o||(i[c]=S,t[c]=1,c++)}if(c>2)for(h=1;c>h;++h)if(1===t[h])for(f=h;f>0&&t[f]<t[f-1];)m=t[f],t[f]=t[f-1],t[f-1]=m,m=i[f],i[f]=i[f-1],i[f-1]=m,--f;return this.m_numConqueredTriangles=r,this.m_numVisitedVertices=c,l.O3DGC_OK},l.TriangleListDecoder.prototype.DecompressTFAN=function(e){var i,t,s,a,u,n,r,o,c,m,d,p,v,g,h,f,b,q,S;if(i=this.m_vertexToTriangle,t=this.m_triangles,s=this.m_itDegree,a=this.m_itConfig,u=this.m_tfans,r=this.m_processConfig,o=this.m_ctfans,c=this.m_triangleCount,m=this.m_numConqueredTriangles,n=o.ReadNumTFans(this.m_itNumTFans),n>0)for(q=0;n>q;++q)for(u.AddTFAN(),d=o.ReadDegree(s)+2-m,p=o.ReadConfig(a),v=u.GetNumVertices(),u.AddVertex(e),r[p](this,d,e),g=u.GetNumVertices(),h=u.GetVertex(v+1),S=v+2;g>S;++S)f=u.GetVertex(S),b=3*c,t[b++]=e,t[b++]=h,t[b]=f,i.AddNeighbor(e,c),i.AddNeighbor(h,c),i.AddNeighbor(f,c),h=f,c++;return this.m_triangleCount=c,l.O3DGC_OK},l.TriangleListDecoder.prototype.Decompress=function(){var e;for(e=0;this.m_numVertices>e;++e)e===this.m_vertexCount&&this.m_vertexCount++,this.CompueLocalConnectivityInfo(e),this.DecompressTFAN(e);return l.O3DGC_OK},l.TriangleListDecoder.prototype.Init=function(e,i,t,s){var a,u;for(this.m_numTriangles=i,this.m_numVertices=t,this.m_triangles=e,this.m_vertexCount=0,this.m_triangleCount=0,this.m_itNumTFans.m_count=0,this.m_itDegree.m_count=0,this.m_itConfig.m_count=0,this.m_itOperation.m_count=0,this.m_itIndex.m_count=0,this.m_numVertices>this.m_maxNumVertices&&(this.m_maxNumVertices=this.m_numVertices,this.m_visitedVerticesValence=new Int32Array(this.m_numVertices),this.m_visitedVertices=new Int32Array(this.m_numVertices)),this.m_decodeTrianglesOrder&&this.m_tempTrianglesSize<this.m_numTriangles&&(this.m_tempTrianglesSize=this.m_numTriangles,this.m_tempTriangles=new Int32Array(3*this.m_tempTrianglesSize)),this.m_ctfans.SetStreamType(this.m_streamType),this.m_ctfans.Allocate(this.m_numVertices,this.m_numTriangles),this.m_tfans.Allocate(2*this.m_numVertices,8*this.m_numVertices),this.m_vertexToTriangle.AllocateNumNeighborsArray(t),u=this.m_vertexToTriangle.GetNumNeighborsBuffer(),a=0;t>a;++a)u[a]=s;return this.m_vertexToTriangle.AllocateNeighborsArray(),this.m_vertexToTriangle.ClearNeighborsArray(),l.O3DGC_OK},l.TriangleListDecoder.prototype.Decode=function(e,i,t,s,a){var u,n;return u=s.ReadUChar(a,this.m_streamType),this.m_decodeTrianglesOrder=0!==(2&u),this.m_decodeVerticesOrder=0!==(1&u),this.m_decodeVerticesOrder?l.O3DGC_ERROR_NON_SUPPORTED_FEATURE:(n=s.ReadUInt32(a,this.m_streamType),this.Init(e,i,t,n),this.m_ctfans.Load(s,a,this.m_decodeTrianglesOrder,this.m_streamType),this.Decompress(),l.O3DGC_OK)},l.SC3DMCDecoder=function(){var e;for(this.m_iterator=new l.Iterator,this.m_streamSize=0,this.m_params=new l.SC3DMCEncodeParams,this.m_triangleListDecoder=new l.TriangleListDecoder,this.m_quantFloatArray={},this.m_orientation={},this.m_normals={},this.m_quantFloatArraySize=0,this.m_normalsSize=0,this.m_orientationSize=0,this.m_stats=new l.SC3DMCStats,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN,this.m_neighbors=[],this.m_idelta=new Float32Array(o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minNormal=new Float32Array(2),this.m_maxNormal=new Float32Array(2),this.m_minNormal[0]=this.m_minNormal[1]=-2,this.m_maxNormal[0]=this.m_maxNormal[1]=2,e=0;o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES>e;++e)this.m_neighbors[e]=new l.SC3DMCPredictor},l.SC3DMCDecoder.prototype.GetStats=function(){return this.m_stats},l.SC3DMCDecoder.prototype.DecodeHeader=function(e,i){var t,s,a,u,n,r;if(t=this.m_iterator.m_count,s=i.ReadUInt32(this.m_iterator,o.O3DGC_STREAM_TYPE_BINARY),s!==o.O3DGC_SC3DMC_START_CODE){if(this.m_iterator.m_count=t,s=i.ReadUInt32(this.m_iterator,o.O3DGC_STREAM_TYPE_ASCII),s!==o.O3DGC_SC3DMC_START_CODE)return l.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=o.O3DGC_STREAM_TYPE_BINARY;if(this.m_streamSize=i.ReadUInt32(this.m_iterator,this.m_streamType),this.m_params.SetEncodeMode(i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetCreaseAngle(i.ReadFloat32(this.m_iterator,this.m_streamType)),a=i.ReadUChar(this.m_iterator,this.m_streamType),e.SetCCW(1===(1&a)),e.SetSolid(1===(2&a)),e.SetConvex(1===(4&a)),e.SetIsTriangularMesh(1===(8&a)),e.SetNCoord(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNNormal(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumFloatAttributes(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumIntAttributes(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNCoord()>0){for(e.SetNCoordIndex(i.ReadUInt32(this.m_iterator,this.m_streamType)),u=0;3>u;++u)e.SetCoordMin(u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetCoordMax(u,i.ReadFloat32(this.m_iterator,this.m_streamType));this.m_params.SetCoordQuantBits(i.ReadUChar(this.m_iterator,this.m_streamType))}if(e.GetNNormal()>0){for(e.SetNNormalIndex(i.ReadUInt32(this.m_iterator,this.m_streamType)),u=0;3>u;++u)e.SetNormalMin(u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetNormalMax(u,i.ReadFloat32(this.m_iterator,this.m_streamType));e.SetNormalPerVertex(1===i.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetNormalQuantBits(i.ReadUChar(this.m_iterator,this.m_streamType))}for(n=0;e.GetNumFloatAttributes()>n;++n)if(e.SetNFloatAttribute(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNFloatAttribute(n)>0){for(e.SetNFloatAttributeIndex(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),r=i.ReadUChar(this.m_iterator,this.m_streamType),e.SetFloatAttributeDim(n,r),u=0;r>u;++u)e.SetFloatAttributeMin(n,u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetFloatAttributeMax(n,u,i.ReadFloat32(this.m_iterator,this.m_streamType));e.SetFloatAttributePerVertex(n,1===i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetFloatAttributeType(n,i.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetFloatAttributeQuantBits(n,i.ReadUChar(this.m_iterator,this.m_streamType))}for(n=0;e.GetNumIntAttributes()>n;++n)e.SetNIntAttribute(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNIntAttribute(n)>0&&(e.SetNIntAttributeIndex(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetIntAttributeDim(n,i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributePerVertex(n,1===i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributeType(n,i.ReadUChar(this.m_iterator,this.m_streamType)));return l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArrayBinary=function(e,i,t,s,a,n,r){var c,m,d,p,v,g,h,f,b,q,S,y,_,P,C,N,D,M,A,E,I,w,x,T,L,V,j,O,F,R,k,U;if(b=this.m_iterator,q=this.m_streamType,y=new l.ArithmeticDecoder,_=new l.StaticBitModel,P=new l.AdaptiveBitModel,C=new l.AdaptiveDataModel,C.SetAlphabet(o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS+1),N=this.m_triangleListDecoder.GetVertexToTriangle(),D=N.m_neighbors,M=a.GetCoordIndex(),A=i*t,E=b.m_count,I=r.ReadUInt32(b,q),w=r.ReadUChar(b,q),x=7&w>>>4,n.m_value=7&w,I-=b.m_count-E,T=new l.Iterator,T.m_count=b.m_count+I,L=0,V=0,j=new l.SC3DMCTriplet(-1,-1,-1),x!==o.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return l.O3DGC_ERROR_CORRUPTED_STREAM;for(f=r.GetBuffer(b,I),b.m_count+=I,y.SetBuffer(I,f),y.StartDecoder(),L=y.ExpGolombDecode(0,_,P),V=y.ExpGolombDecode(0,_,P),O=new l.AdaptiveDataModel,O.SetAlphabet(V+2),F=this.m_neighbors,R=this.m_normals,k=new l.NumberRef,c=n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,U=0;i>U;++U){if(k.m_value=0,N.GetNumNeighbors(U)>0&&c)for(g=N.Begin(U),h=N.End(U),p=g;h>p&&(v=D[p],!(0>v));++p)u(M,v,U,k,F,t,e,s);if(k.m_value>1)for(m=y.DecodeAdaptiveDataModel(C),d=0;t>d;++d)S=y.DecodeIntACEGC(O,_,P,L,V),e[U*s+d]=S+F[m].m_pred[d];else if(U>0&&n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(d=0;t>d;++d)S=y.DecodeIntACEGC(O,_,P,L,V),e[U*s+d]=S+e[(U-1)*s+d];else for(d=0;t>d;++d)S=y.DecodeUIntACEGC(O,_,P,L,V),e[U*s+d]=S}return b.m_count=T.m_count,l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArrayASCII=function(e,i,t,s,a,n,r){var c,m,d,p,v,g,h,f,b,q,S,y,_,P,C,N,D,M,A,E,I,w,x,T;if(m=this.m_iterator,d=this.m_streamType,v=this.m_triangleListDecoder.GetVertexToTriangle(),g=v.m_neighbors,h=a.GetCoordIndex(),f=i*t,b=m.m_count,q=r.ReadUInt32(m,d),S=r.ReadUChar(m,d),y=7&S>>>4,n.m_value=7&S,q-=m.m_count-b,_=new l.Iterator,_.m_count=m.m_count+q,P=new l.SC3DMCTriplet(-1,-1,-1),y!==o.O3DGC_SC3DMC_BINARIZATION_ASCII)return l.O3DGC_ERROR_CORRUPTED_STREAM;for(r.ReadUInt32(_,d),C=this.m_neighbors,N=this.m_normals,D=new l.NumberRef,c=n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,M=0;i>M;++M){if(D.m_value=0,v.GetNumNeighbors(M)>0&&c)for(A=v.Begin(M),E=v.End(M),I=A;E>I&&(w=g[I],!(0>w));++I)u(h,w,M,D,C,t,e,s);if(D.m_value>1)for(T=r.ReadUCharASCII(_),x=0;t>x;++x)p=r.ReadIntASCII(m),e[M*s+x]=p+C[T].m_pred[x];else if(M>0&&n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(x=0;t>x;++x)p=r.ReadIntASCII(m),e[M*s+x]=p+e[(M-1)*s+x];else for(x=0;t>x;++x)p=r.ReadUIntASCII(m),e[M*s+x]=p}return m.m_count=_.m_count,l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArray=function(e,i,t,s,a,u,n){return this.m_streamType===o.O3DGC_STREAM_TYPE_ASCII?this.DecodeIntArrayASCII(e,i,t,s,a,u,n):this.DecodeIntArrayBinary(e,i,t,s,a,u,n)},l.SC3DMCDecoder.prototype.ProcessNormals=function(e){var i,s,a,u,n,o,c,m,d,p,v,g,h,f,b;for(a=e.GetNNormal(),u=3*e.GetNNormal(),u>this.m_normalsSize&&(this.m_normalsSize=u,this.m_normals=new Float32Array(this.m_normalsSize)),n=this.m_normals,o=this.m_quantFloatArray,c=this.m_orientation,m=e.GetCoordIndex(),r(m,e.GetNCoordIndex(),o,a,n),d=new l.Vec3,p=new l.Vec3,v=0;a>v;++v)i=3*v,d.m_x=n[i],d.m_y=n[i+1],d.m_z=n[i+2],b=Math.sqrt(d.m_x*d.m_x+d.m_y*d.m_y+d.m_z*d.m_z),0===b&&(b=1),t(d,p),g=p.m_x/b,h=p.m_y/b,f=p.m_z+c[v],c[v]=f,f>>>1!==p.m_z>>>1&&(g=0,h=0),s=2*v,n[s]=g,n[s+1]=h;return l.O3DGC_OK},l.SC3DMCDecoder.prototype.IQuantize=function(e,i,t,s,a,u,n,r){var c,m,d,p,v,g;if(r.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION)for(g=o.CubeToSphere,p=this.m_orientation,v=this.m_normals,m=new l.Vec3(0,0,0),d=new l.Vec3(0,0,0),this.IQuantizeFloatArray(e,i,t,s,this.m_minNormal,this.m_maxNormal,n+1),c=0;i>c;++c)m.m_x=e[s*c]+v[2*c],m.m_y=e[s*c+1]+v[2*c+1],m.m_z=p[c],g[m.m_z](m,d),e[s*c]=d.m_x,e[s*c+1]=d.m_y,e[s*c+2]=d.m_z;else this.IQuantizeFloatArray(e,i,t,s,a,u,n)},l.SC3DMCDecoder.prototype.DecodeFloatArrayBinary=function(e,i,t,s,r,c,m,d,p,v){var g,h,f,b,q,S,y,_,P,C,N,D,M,A,E,I,w,x,T,L,V,j,O,F,R,k,U,z,B,Q,G,W,H,X,Y,K;if(w=this.m_iterator,x=this.m_orientation,T=this.m_streamType,V=new l.ArithmeticDecoder,j=new l.StaticBitModel,O=new l.AdaptiveBitModel,F=new l.AdaptiveDataModel,g=o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,F.SetAlphabet(g+1),R=this.m_triangleListDecoder.GetVertexToTriangle(),k=R.m_neighbors,U=d.GetCoordIndex(),z=i*t,B=w.m_count,Q=v.ReadUInt32(w,T),G=v.ReadUChar(w,T),W=7&G>>>4,p.m_value=7&G,Q-=w.m_count-B,H=new l.Iterator,H.m_count=w.m_count+Q,X=0,Y=0,W!==o.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return l.O3DGC_ERROR_CORRUPTED_STREAM;if(S=v.GetBuffer(w,Q),w.m_count+=Q,V.SetBuffer(Q,S),V.StartDecoder(),X=V.ExpGolombDecode(0,j,O),Y=V.ExpGolombDecode(0,j,O),K=new l.AdaptiveDataModel,K.SetAlphabet(Y+2),p.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(z>this.m_orientationSize&&(this.m_orientationSize=z,this.m_orientation=new Int8Array(this.m_orientationSize),x=this.m_orientation),q=new l.AdaptiveDataModel,q.SetAlphabet(12),D=0;i>D;++D)x[D]=a(V.DecodeAdaptiveDataModel(q));this.ProcessNormals(d),t=2}for(z>this.m_quantFloatArraySize&&(this.m_quantFloatArraySize=z,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),y=this.m_quantFloatArray,_=this.m_neighbors,P=this.m_normals,C=new l.NumberRef,h=p.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,f=p.m_value===o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,M=0;i>M;++M){if(C.m_value=0,R.GetNumNeighbors(M)>0&&h){if(E=R.Begin(M),I=R.End(M),f)for(A=E;I>A&&(N=k[A],!(0>N));++A)n(U,N,M,C,_,t,y,s,R,k);if(g>C.m_value)for(A=E;I>A&&(N=k[A],!(0>N));++A)u(U,N,M,C,_,t,y,s)}if(C.m_value>1)for(b=V.DecodeAdaptiveDataModel(F),D=0;t>D;++D)L=V.DecodeIntACEGC(K,j,O,X,Y),y[M*s+D]=L+_[b].m_pred[D];else if(M>0&&h)for(D=0;t>D;++D)L=V.DecodeIntACEGC(K,j,O,X,Y),y[M*s+D]=L+y[(M-1)*s+D];else for(D=0;t>D;++D)L=V.DecodeUIntACEGC(K,j,O,X,Y),y[M*s+D]=L}return w.m_count=H.m_count,this.IQuantize(e,i,t,s,r,c,m,p),l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeFloatArrayASCII=function(e,i,t,s,a,r,c,m,d,p){var v,g,h,f,b,q,S,y,_,P,C,N,D,M,A,E,I,w,x,T,L,V,j,O,F,R,k;if(v=o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,f=this.m_iterator,b=this.m_orientation,q=this.m_streamType,y=this.m_triangleListDecoder.GetVertexToTriangle(),_=y.m_neighbors,P=m.GetCoordIndex(),C=i*t,N=f.m_count,D=p.ReadUInt32(f,q),M=p.ReadUChar(f,q),A=7&M>>>4,d.m_value=7&M,D-=f.m_count-N,E=new l.Iterator,E.m_count=f.m_count+D,A!==o.O3DGC_SC3DMC_BINARIZATION_ASCII)return l.O3DGC_ERROR_CORRUPTED_STREAM;if(p.ReadUInt32(E,q),d.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(i>this.m_orientationSize&&(this.m_orientationSize=i,this.m_orientation=new Int8Array(this.m_orientationSize),b=this.m_orientation),R=0;i>R;++R)b[R]=p.ReadIntASCII(f);this.ProcessNormals(m),t=2}for(C>this.m_quantFloatArraySize&&(this.m_quantFloatArraySize=C,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),I=this.m_quantFloatArray,w=this.m_neighbors,x=this.m_normals,T=new l.NumberRef,g=d.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,h=d.m_value===o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,L=0;i>L;++L){if(T.m_value=0,y.GetNumNeighbors(L)>0&&g){if(j=y.Begin(L),O=y.End(L),h)for(V=j;O>V&&(F=_[V],!(0>F));++V)n(P,F,L,T,w,t,I,s,y,_);if(v>T.m_value)for(V=j;O>V&&(F=_[V],!(0>F));++V)u(P,F,L,T,w,t,I,s)}if(T.m_value>1)for(k=p.ReadUCharASCII(E),R=0;t>R;++R)S=p.ReadIntASCII(f),I[L*s+R]=S+w[k].m_pred[R];else if(L>0&&d.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(R=0;t>R;++R)S=p.ReadIntASCII(f),I[L*s+R]=S+I[(L-1)*s+R];else for(R=0;t>R;++R)S=p.ReadUIntASCII(f),I[L*s+R]=S}return f.m_count=E.m_count,this.IQuantize(e,i,t,s,a,r,c,d),l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeFloatArray=function(e,i,t,s,a,u,n,r,l,c){return this.m_streamType===o.O3DGC_STREAM_TYPE_ASCII?this.DecodeFloatArrayASCII(e,i,t,s,a,u,n,r,l,c):this.DecodeFloatArrayBinary(e,i,t,s,a,u,n,r,l,c)},l.SC3DMCDecoder.prototype.IQuantizeFloatArray=function(e,i,t,s,a,u,n){var r,o,c,m,d;for(r=this.m_idelta,o=this.m_quantFloatArray,c=0;t>c;++c)m=u[c]-a[c],r[c]=m>0?m/((1<<n>>>0)-1):1;for(d=0;i>d;++d)for(c=0;t>c;++c)e[d*s+c]=o[d*s+c]*r[c]+a[c];return l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodePlayload=function(e,i){var t,s,a,u,n,r,o;if(t=this.m_params,s=this.m_iterator,a=this.m_stats,u=new l.NumberRef,n=new l.Timer,r=l.O3DGC_OK,this.m_triangleListDecoder.SetStreamType(this.m_streamType),a.m_streamSizeCoordIndex=s.m_count,n.Tic(),this.m_triangleListDecoder.Decode(e.GetCoordIndex(),e.GetNCoordIndex(),e.GetNCoord(),i,s),n.Toc(),a.m_timeCoordIndex=n.GetElapsedTime(),a.m_streamSizeCoordIndex=s.m_count-a.m_streamSizeCoordIndex,a.m_streamSizeCoord=s.m_count,n.Tic(),e.GetNCoord()>0&&(r=this.DecodeFloatArray(e.GetCoord(),e.GetNCoord(),3,3,e.GetCoordMinArray(),e.GetCoordMaxArray(),t.GetCoordQuantBits(),e,u,i),t.SetCoordPredMode(u.m_value)),r!==l.O3DGC_OK)return r;if(n.Toc(),a.m_timeCoord=n.GetElapsedTime(),a.m_streamSizeCoord=s.m_count-a.m_streamSizeCoord,a.m_streamSizeNormal=s.m_count,n.Tic(),e.GetNNormal()>0&&(r=this.DecodeFloatArray(e.GetNormal(),e.GetNNormal(),3,3,e.GetNormalMinArray(),e.GetNormalMaxArray(),t.GetNormalQuantBits(),e,u,i),t.SetNormalPredMode(u.m_value)),r!==l.O3DGC_OK)return r;for(n.Toc(),a.m_timeNormal=n.GetElapsedTime(),a.m_streamSizeNormal=s.m_count-a.m_streamSizeNormal,o=0;e.GetNumFloatAttributes()>o;++o)a.m_streamSizeFloatAttribute[o]=s.m_count,n.Tic(),r=this.DecodeFloatArray(e.GetFloatAttribute(o),e.GetNFloatAttribute(o),e.GetFloatAttributeDim(o),e.GetFloatAttributeDim(o),e.GetFloatAttributeMinArray(o),e.GetFloatAttributeMaxArray(o),t.GetFloatAttributeQuantBits(o),e,u,i),t.SetFloatAttributePredMode(o,u.m_value),n.Toc(),a.m_timeFloatAttribute[o]=n.GetElapsedTime(),a.m_streamSizeFloatAttribute[o]=s.m_count-a.m_streamSizeFloatAttribute[o];if(r!==l.O3DGC_OK)return r;for(o=0;e.GetNumIntAttributes()>o;++o)a.m_streamSizeIntAttribute[o]=s.m_count,n.Tic(),r=this.DecodeIntArray(e.GetIntAttribute(o),e.GetNIntAttribute(o),e.GetIntAttributeDim(o),e.GetIntAttributeDim(o),e,u,i),t.SetIntAttributePredMode(o,u.m_value),n.Toc(),a.m_timeIntAttribute[o]=n.GetElapsedTime(),a.m_streamSizeIntAttribute[o]=s.m_count-a.m_streamSizeIntAttribute[o];return r!==l.O3DGC_OK?r:(n.Tic(),this.m_triangleListDecoder.Reorder(),n.Toc(),a.m_timeReorder=n.GetElapsedTime(),r)},l.DVEncodeParams=function(){this.m_encodeMode=o.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT,this.m_streamTypeMode=o.O3DGC_STREAM_TYPE_ASCII,this.m_quantBits=10},l.DVEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},l.DVEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},l.DVEncodeParams.prototype.GetQuantBits=function(){return this.m_quantBits},l.DVEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},l.DVEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},l.DVEncodeParams.prototype.SetQuantBits=function(e){this.m_quantBits=e},l.DynamicVector=function(){this.m_num=0,this.m_dim=0,this.m_stride=0,this.m_max={},this.m_min={},this.m_vectors={}},l.DynamicVector.prototype.GetNVector=function(){return this.m_num},l.DynamicVector.prototype.GetDimVector=function(){return this.m_dim},l.DynamicVector.prototype.GetStride=function(){return this.m_stride},l.DynamicVector.prototype.GetMinArray=function(){return this.m_min},l.DynamicVector.prototype.GetMaxArray=function(){return this.m_max},l.DynamicVector.prototype.GetVectors=function(){return this.m_vectors},l.DynamicVector.prototype.GetMin=function(e){return this.m_min[e]},l.DynamicVector.prototype.GetMax=function(e){return this.m_max[e]},l.DynamicVector.prototype.SetNVector=function(e){this.m_num=e},l.DynamicVector.prototype.SetDimVector=function(e){this.m_dim=e},l.DynamicVector.prototype.SetStride=function(e){this.m_stride=e},l.DynamicVector.prototype.SetMinArray=function(e){this.m_min=e},l.DynamicVector.prototype.SetMaxArray=function(e){this.m_max=e},l.DynamicVector.prototype.SetMin=function(e,i){this.m_min[e]=i},l.DynamicVector.prototype.SetMax=function(e,i){this.m_max[e]=i},l.DynamicVector.prototype.SetVectors=function(e){this.m_vectors=e},l.DynamicVectorDecoder=function(){this.m_streamSize=0,this.m_maxNumVectors=0,this.m_numVectors=0,this.m_dimVectors=0,this.m_quantVectors={},this.m_iterator=new l.Iterator,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN,this.m_params=new l.DVEncodeParams},l.DynamicVectorDecoder.prototype.GetStreamType=function(){return this.m_streamType},l.DynamicVectorDecoder.prototype.GetIterator=function(){return this.m_iterator},l.DynamicVectorDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},l.DynamicVectorDecoder.prototype.SetIterator=function(e){this.m_iterator=e},l.DynamicVectorDecoder.prototype.IUpdate=function(e,i,t){var s,a;for(a=t-1,s=2,e[i]-=e[i+1]>>1;a>s;)e[i+s]-=e[i+s-1]+e[i+s+1]+2>>2,s+=2;return s===a&&(e[i+s]-=e[i+s-1]>>1),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.IPredict=function(e,i,t){var s,a;for(a=t-1,s=1;a>s;)e[i+s]+=e[i+s-1]+e[i+s+1]+1>>1,s+=2;return s===a&&(e[i+s]+=e[i+s-1]),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.Merge=function(e,i,t){var s,a,u,n,r;for(a=(t>>1)+(1&t),u=a-1,n=a;u>0;){for(s=u;n>s;s+=2)r=e[i+s],e[i+s]=e[i+s+1],e[i+s+1]=r;--u,++n}return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.ITransform=function(e,i,t){var s,a,u,n;for(s=t,a=0,u=0,a+=(1&s)<<u++>>>0;s>1;)s=(s>>1)+((1&s)>>>0),a+=(1&s)<<u++>>>0;for(n=u-2;n>=0;--n)s=(s<<1>>>0)-(1&a>>>n)>>>0,this.Merge(e,i,s),this.IUpdate(e,i,s),this.IPredict(e,i,s);return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.IQuantize=function(e,i,t,s,a,u,n){var r,o,c,m,d,p;for(r=this.m_quantVectors,m=i*t,d=0;t>d;++d)for(o=u[d]-a[d],c=o>0?o/((1<<n>>>0)-1):1,p=0;i>p;++p)e[p*s+d]=r[p+d*i]*c+a[d];return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.DecodeHeader=function(e,i){var t,s,a,u;if(t=this.m_iterator,s=t.m_count,a=i.ReadUInt32(t,o.O3DGC_STREAM_TYPE_BINARY),a!==o.O3DGC_DV_START_CODE){if(t.m_count=s,a=i.ReadUInt32(t,o.O3DGC_STREAM_TYPE_ASCII),a!==o.O3DGC_DV_START_CODE)return l.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=o.O3DGC_STREAM_TYPE_BINARY;return u=this.m_streamType,this.m_streamSize=i.ReadUInt32(t,u),this.m_params.SetEncodeMode(i.ReadUChar(t,u)),e.SetNVector(i.ReadUInt32(t,u)),e.GetNVector()>0&&(e.SetDimVector(i.ReadUInt32(t,u)),this.m_params.SetQuantBits(i.ReadUChar(t,u))),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.DecodePlayload=function(e,i){var t,s,a,u,n,r,c,m,d,p,v,g,h,f,b,q,S,y,_;for(s=this.m_iterator,a=this.m_streamType,u=l.O3DGC_OK,n=s.m_count,r=i.ReadUInt32(s,a),c=e.GetDimVector(),m=e.GetNVector(),t=c*m,d=0;e.GetDimVector()>d;++d)e.SetMin(d,i.ReadFloat32(s,a)),e.SetMax(d,i.ReadFloat32(s,a));if(p=new l.ArithmeticDecoder,v=new l.StaticBitModel,g=new l.AdaptiveBitModel,r-=s.m_count-n,h=0,f=0,a===o.O3DGC_STREAM_TYPE_BINARY&&(b=i.GetBuffer(s,r),s.m_count+=r,p.SetBuffer(r,b),p.StartDecoder(),h=p.ExpGolombDecode(0,v,g),f=p.ExpGolombDecode(0,v,g)),q=new l.AdaptiveDataModel,q.SetAlphabet(f+2),t>this.m_maxNumVectors&&(this.m_maxNumVectors=t,this.m_quantVectors=new Int32Array(this.m_maxNumVectors)),S=this.m_quantVectors,a===o.O3DGC_STREAM_TYPE_ASCII)for(y=0;m>y;++y)for(_=0;c>_;++_)S[_*m+y]=i.ReadIntASCII(s);else for(y=0;m>y;++y)for(_=0;c>_;++_)S[_*m+y]=p.DecodeIntACEGC(q,v,g,h,f);
for(_=0;c>_;++_)this.ITransform(S,_*m,m);return this.IQuantize(e.GetVectors(),m,c,e.GetStride(),e.GetMinArray(),e.GetMaxArray(),this.m_params.GetQuantBits()),u},l}()}}),montageDefine("83b66f4","runtime/dependencies/gl-matrix",{dependencies:[],factory:function(e,i,t){var s=window;(function(e,a){"object"==typeof i?t.exports=a(s):"function"==typeof define&&define.amd?define([],function(){return a(e)}):a(e)})(this,function(e){"use strict";function i(e){return u=e}function t(){return u="undefined"!=typeof Float32Array?Float32Array:Array}var s=1e-6,a={};(function(){if("undefined"!=typeof Float32Array){var e=new Float32Array(1),i=new Int32Array(e.buffer);a.invsqrt=function(t){var s=.5*t;e[0]=t;var a=1.5;i[0]=1597463007-(i[0]>>1);var u=e[0];return u*(a-s*u*u)}}else a.invsqrt=function(e){return 1/Math.sqrt(e)}})();var u=null;t();var n={};n.create=function(e){var i=new u(3);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2]):i[0]=i[1]=i[2]=0,i},n.createFrom=function(e,i,t){var s=new u(3);return s[0]=e,s[1]=i,s[2]=t,s},n.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},n.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])},n.add=function(e,i,t){return t&&e!==t?(t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t):(e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e)},n.subtract=function(e,i,t){return t&&e!==t?(t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t):(e[0]-=i[0],e[1]-=i[1],e[2]-=i[2],e)},n.multiply=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t):(e[0]*=i[0],e[1]*=i[1],e[2]*=i[2],e)},n.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},n.scale=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t):(e[0]*=i,e[1]*=i,e[2]*=i,e)},n.normalize=function(e,i){i||(i=e);var t=e[0],s=e[1],a=e[2],u=Math.sqrt(t*t+s*s+a*a);return u?1===u?(i[0]=t,i[1]=s,i[2]=a,i):(u=1/u,i[0]=t*u,i[1]=s*u,i[2]=a*u,i):(i[0]=0,i[1]=0,i[2]=0,i)},n.cross=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=i[0],r=i[1],l=i[2];return t[0]=a*l-u*r,t[1]=u*n-s*l,t[2]=s*r-a*n,t},n.length=function(e){var i=e[0],t=e[1],s=e[2];return Math.sqrt(i*i+t*t+s*s)},n.squaredLength=function(e){var i=e[0],t=e[1],s=e[2];return i*i+t*t+s*s},n.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},n.direction=function(e,i,t){t||(t=e);var s=e[0]-i[0],a=e[1]-i[1],u=e[2]-i[2],n=Math.sqrt(s*s+a*a+u*u);return n?(n=1/n,t[0]=s*n,t[1]=a*n,t[2]=u*n,t):(t[0]=0,t[1]=0,t[2]=0,t)},n.lerp=function(e,i,t,s){return s||(s=e),s[0]=e[0]+t*(i[0]-e[0]),s[1]=e[1]+t*(i[1]-e[1]),s[2]=e[2]+t*(i[2]-e[2]),s},n.dist=function(e,i){var t=i[0]-e[0],s=i[1]-e[1],a=i[2]-e[2];return Math.sqrt(t*t+s*s+a*a)};var r=null,l=new u(4);n.unproject=function(e,i,t,s,a){a||(a=e),r||(r=v.create());var u=r,n=l;return n[0]=2*(e[0]-s[0])/s[2]-1,n[1]=2*(e[1]-s[1])/s[3]-1,n[2]=2*e[2]-1,n[3]=1,v.multiply(t,i,u),v.inverse(u)?(v.multiplyVec4(u,n),0===n[3]?null:(a[0]=n[0]/n[3],a[1]=n[1]/n[3],a[2]=n[2]/n[3],a)):null};var o=n.createFrom(1,0,0),c=n.createFrom(0,1,0),m=n.createFrom(0,0,1),d=n.create();n.rotationTo=function(e,i,t){t||(t=g.create());var s=n.dot(e,i),a=d;if(s>=1)g.set(h,t);else if(1e-6-1>s)n.cross(o,e,a),1e-6>n.length(a)&&n.cross(c,e,a),1e-6>n.length(a)&&n.cross(m,e,a),n.normalize(a),g.fromAngleAxis(Math.PI,a,t);else{var u=Math.sqrt(2*(1+s)),r=1/u;n.cross(e,i,a),t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=.5*u,g.normalize(t)}return t[3]>1?t[3]=1:-1>t[3]&&(t[3]=-1),t},n.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var p={};p.create=function(e){var i=new u(9);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8]):i[0]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=0,i},p.createFrom=function(e,i,t,s,a,n,r,l,o){var c=new u(9);return c[0]=e,c[1]=i,c[2]=t,c[3]=s,c[4]=a,c[5]=n,c[6]=r,c[7]=l,c[8]=o,c},p.determinant=function(e){var i=e[0],t=e[1],s=e[2],a=e[3],u=e[4],n=e[5],r=e[6],l=e[7],o=e[8];return i*(o*u-n*l)+t*(-o*a+n*r)+s*(l*a-u*r)},p.inverse=function(e,i){var t,s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=m*r-l*c,v=-m*n+l*o,g=c*n-r*o,h=s*d+a*v+u*g;return h?(t=1/h,i||(i=p.create()),i[0]=d*t,i[1]=(-m*a+u*c)*t,i[2]=(l*a-u*r)*t,i[3]=v*t,i[4]=(m*s-u*o)*t,i[5]=(-l*s+u*n)*t,i[6]=g*t,i[7]=(-c*s+a*o)*t,i[8]=(r*s-a*n)*t,i):null},p.multiply=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=i[0],p=i[1],v=i[2],g=i[3],h=i[4],f=i[5],b=i[6],q=i[7],S=i[8];return t[0]=d*s+p*n+v*o,t[1]=d*a+p*r+v*c,t[2]=d*u+p*l+v*m,t[3]=g*s+h*n+f*o,t[4]=g*a+h*r+f*c,t[5]=g*u+h*l+f*m,t[6]=b*s+q*n+S*o,t[7]=b*a+q*r+S*c,t[8]=b*u+q*l+S*m,t},p.multiplyVec2=function(e,i,t){t||(t=i);var s=i[0],a=i[1];return t[0]=s*e[0]+a*e[3]+e[6],t[1]=s*e[1]+a*e[4]+e[7],t},p.multiplyVec3=function(e,i,t){t||(t=i);var s=i[0],a=i[1],u=i[2];return t[0]=s*e[0]+a*e[3]+u*e[6],t[1]=s*e[1]+a*e[4]+u*e[7],t[2]=s*e[2]+a*e[5]+u*e[8],t},p.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},p.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])&&s>Math.abs(e[3]-i[3])&&s>Math.abs(e[4]-i[4])&&s>Math.abs(e[5]-i[5])&&s>Math.abs(e[6]-i[6])&&s>Math.abs(e[7]-i[7])&&s>Math.abs(e[8]-i[8])},p.identity=function(e){return e||(e=p.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,i){if(!i||e===i){var t=e[1],s=e[2],a=e[5];return e[1]=e[3],e[2]=e[6],e[3]=t,e[5]=e[7],e[6]=s,e[7]=a,e}return i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8],i},p.toMat4=function(e,i){return i||(i=v.create()),i[15]=1,i[14]=0,i[13]=0,i[12]=0,i[11]=0,i[10]=e[8],i[9]=e[7],i[8]=e[6],i[7]=0,i[6]=e[5],i[5]=e[4],i[4]=e[3],i[3]=0,i[2]=e[2],i[1]=e[1],i[0]=e[0],i},p.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var v={};v.create=function(e){var i=new u(16);return e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},v.createFrom=function(e,i,t,s,a,n,r,l,o,c,m,d,p,v,g,h){var f=new u(16);return f[0]=e,f[1]=i,f[2]=t,f[3]=s,f[4]=a,f[5]=n,f[6]=r,f[7]=l,f[8]=o,f[9]=c,f[10]=m,f[11]=d,f[12]=p,f[13]=v,f[14]=g,f[15]=h,f},v.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])&&s>Math.abs(e[3]-i[3])&&s>Math.abs(e[4]-i[4])&&s>Math.abs(e[5]-i[5])&&s>Math.abs(e[6]-i[6])&&s>Math.abs(e[7]-i[7])&&s>Math.abs(e[8]-i[8])&&s>Math.abs(e[9]-i[9])&&s>Math.abs(e[10]-i[10])&&s>Math.abs(e[11]-i[11])&&s>Math.abs(e[12]-i[12])&&s>Math.abs(e[13]-i[13])&&s>Math.abs(e[14]-i[14])&&s>Math.abs(e[15]-i[15])},v.identity=function(e){return e||(e=v.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},v.transpose=function(e,i){if(!i||e===i){var t=e[1],s=e[2],a=e[3],u=e[6],n=e[7],r=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=s,e[9]=u,e[11]=e[14],e[12]=a,e[13]=n,e[14]=r,e}return i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15],i},v.determinant=function(e){var i=e[0],t=e[1],s=e[2],a=e[3],u=e[4],n=e[5],r=e[6],l=e[7],o=e[8],c=e[9],m=e[10],d=e[11],p=e[12],v=e[13],g=e[14],h=e[15];return p*c*r*a-o*v*r*a-p*n*m*a+u*v*m*a+o*n*g*a-u*c*g*a-p*c*s*l+o*v*s*l+p*t*m*l-i*v*m*l-o*t*g*l+i*c*g*l+p*n*s*d-u*v*s*d-p*t*r*d+i*v*r*d+u*t*g*d-i*n*g*d-o*n*s*h+u*c*s*h+o*t*r*h-i*c*r*h-u*t*m*h+i*n*m*h},v.inverse=function(e,i){i||(i=e);var t,s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],g=e[12],h=e[13],f=e[14],b=e[15],q=s*l-a*r,S=s*o-u*r,y=s*c-n*r,_=a*o-u*l,P=a*c-n*l,C=u*c-n*o,N=m*h-d*g,D=m*f-p*g,M=m*b-v*g,A=d*f-p*h,E=d*b-v*h,I=p*b-v*f,w=q*I-S*E+y*A+_*M-P*D+C*N;return w?(t=1/w,i[0]=(l*I-o*E+c*A)*t,i[1]=(-a*I+u*E-n*A)*t,i[2]=(h*C-f*P+b*_)*t,i[3]=(-d*C+p*P-v*_)*t,i[4]=(-r*I+o*M-c*D)*t,i[5]=(s*I-u*M+n*D)*t,i[6]=(-g*C+f*y-b*S)*t,i[7]=(m*C-p*y+v*S)*t,i[8]=(r*E-l*M+c*N)*t,i[9]=(-s*E+a*M-n*N)*t,i[10]=(g*P-h*y+b*q)*t,i[11]=(-m*P+d*y-v*q)*t,i[12]=(-r*A+l*D-o*N)*t,i[13]=(s*A-a*D+u*N)*t,i[14]=(-g*_+h*S-f*q)*t,i[15]=(m*_-d*S+p*q)*t,i):null},v.toRotationMat=function(e,i){return i||(i=v.create()),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.toMat3=function(e,i){return i||(i=p.create()),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},v.toInverseMat3=function(e,i){var t,s=e[0],a=e[1],u=e[2],n=e[4],r=e[5],l=e[6],o=e[8],c=e[9],m=e[10],d=m*r-l*c,v=-m*n+l*o,g=c*n-r*o,h=s*d+a*v+u*g;return h?(t=1/h,i||(i=p.create()),i[0]=d*t,i[1]=(-m*a+u*c)*t,i[2]=(l*a-u*r)*t,i[3]=v*t,i[4]=(m*s-u*o)*t,i[5]=(-l*s+u*n)*t,i[6]=g*t,i[7]=(-c*s+a*o)*t,i[8]=(r*s-a*n)*t,i):null},v.multiply=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],g=e[12],h=e[13],f=e[14],b=e[15],q=i[0],S=i[1],y=i[2],_=i[3];return t[0]=q*s+S*r+y*m+_*g,t[1]=q*a+S*l+y*d+_*h,t[2]=q*u+S*o+y*p+_*f,t[3]=q*n+S*c+y*v+_*b,q=i[4],S=i[5],y=i[6],_=i[7],t[4]=q*s+S*r+y*m+_*g,t[5]=q*a+S*l+y*d+_*h,t[6]=q*u+S*o+y*p+_*f,t[7]=q*n+S*c+y*v+_*b,q=i[8],S=i[9],y=i[10],_=i[11],t[8]=q*s+S*r+y*m+_*g,t[9]=q*a+S*l+y*d+_*h,t[10]=q*u+S*o+y*p+_*f,t[11]=q*n+S*c+y*v+_*b,q=i[12],S=i[13],y=i[14],_=i[15],t[12]=q*s+S*r+y*m+_*g,t[13]=q*a+S*l+y*d+_*h,t[14]=q*u+S*o+y*p+_*f,t[15]=q*n+S*c+y*v+_*b,t},v.multiply3=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],g=e[12],h=e[13],f=e[14],b=e[15],q=i[0],S=i[1],y=i[2],_=0;return t[0]=q*s+S*r+y*m+_*g,t[1]=q*a+S*l+y*d+_*h,t[2]=q*u+S*o+y*p+_*f,t[3]=q*n+S*c+y*v+_*b,q=i[4],S=i[5],y=i[6],_=0,t[4]=q*s+S*r+y*m+_*g,t[5]=q*a+S*l+y*d+_*h,t[6]=q*u+S*o+y*p+_*f,t[7]=q*n+S*c+y*v+_*b,q=i[8],S=i[9],y=i[10],_=0,t[8]=q*s+S*r+y*m+_*g,t[9]=q*a+S*l+y*d+_*h,t[10]=q*u+S*o+y*p+_*f,t[11]=q*n+S*c+y*v+_*b,t},v.multiplyVec3=function(e,i,t){t||(t=i);var s=i[0],a=i[1],u=i[2];return t[0]=e[0]*s+e[4]*a+e[8]*u+e[12],t[1]=e[1]*s+e[5]*a+e[9]*u+e[13],t[2]=e[2]*s+e[6]*a+e[10]*u+e[14],t},v.rotateVec3=function(e,i,t){t||(t=i);var s=i[0],a=i[1],u=i[2];return t[0]=e[0]*s+e[4]*a+e[8]*u,t[1]=e[1]*s+e[5]*a+e[9]*u,t[2]=e[2]*s+e[6]*a+e[10]*u,t},v.multiplyVec4=function(e,i,t){t||(t=i);var s=i[0],a=i[1],u=i[2],n=i[3];return t[0]=e[0]*s+e[4]*a+e[8]*u+e[12]*n,t[1]=e[1]*s+e[5]*a+e[9]*u+e[13]*n,t[2]=e[2]*s+e[6]*a+e[10]*u+e[14]*n,t[3]=e[3]*s+e[7]*a+e[11]*u+e[15]*n,t},v.translate=function(e,i,t){var s,a,u,n,r,l,o,c,m,d,p,v,g=i[0],h=i[1],f=i[2];return t&&e!==t?(s=e[0],a=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],t[0]=s,t[1]=a,t[2]=u,t[3]=n,t[4]=r,t[5]=l,t[6]=o,t[7]=c,t[8]=m,t[9]=d,t[10]=p,t[11]=v,t[12]=s*g+r*h+m*f+e[12],t[13]=a*g+l*h+d*f+e[13],t[14]=u*g+o*h+p*f+e[14],t[15]=n*g+c*h+v*f+e[15],t):(e[12]=e[0]*g+e[4]*h+e[8]*f+e[12],e[13]=e[1]*g+e[5]*h+e[9]*f+e[13],e[14]=e[2]*g+e[6]*h+e[10]*f+e[14],e[15]=e[3]*g+e[7]*h+e[11]*f+e[15],e)},v.scale=function(e,i,t){var s=i[0],a=i[1],u=i[2];return t&&e!==t?(t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):(e[0]*=s,e[1]*=s,e[2]*=s,e[3]*=s,e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a,e[8]*=u,e[9]*=u,e[10]*=u,e[11]*=u,e)},v.rotate=function(e,i,t,s){var a,u,n,r,l,o,c,m,d,p,v,g,h,f,b,q,S,y,_,P,C,N,D,M,A=t[0],E=t[1],I=t[2],w=Math.sqrt(A*A+E*E+I*I);return w?(1!==w&&(w=1/w,A*=w,E*=w,I*=w),a=Math.sin(i),u=Math.cos(i),n=1-u,r=e[0],l=e[1],o=e[2],c=e[3],m=e[4],d=e[5],p=e[6],v=e[7],g=e[8],h=e[9],f=e[10],b=e[11],q=A*A*n+u,S=E*A*n+I*a,y=I*A*n-E*a,_=A*E*n-I*a,P=E*E*n+u,C=I*E*n+A*a,N=A*I*n+E*a,D=E*I*n-A*a,M=I*I*n+u,s?e!==s&&(s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]):s=e,s[0]=r*q+m*S+g*y,s[1]=l*q+d*S+h*y,s[2]=o*q+p*S+f*y,s[3]=c*q+v*S+b*y,s[4]=r*_+m*P+g*C,s[5]=l*_+d*P+h*C,s[6]=o*_+p*P+f*C,s[7]=c*_+v*P+b*C,s[8]=r*N+m*D+g*M,s[9]=l*N+d*D+h*M,s[10]=o*N+p*D+f*M,s[11]=c*N+v*D+b*M,s):null},v.rotateX=function(e,i,t){var s=Math.sin(i),a=Math.cos(i),u=e[4],n=e[5],r=e[6],l=e[7],o=e[8],c=e[9],m=e[10],d=e[11];return t?e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[4]=u*a+o*s,t[5]=n*a+c*s,t[6]=r*a+m*s,t[7]=l*a+d*s,t[8]=u*-s+o*a,t[9]=n*-s+c*a,t[10]=r*-s+m*a,t[11]=l*-s+d*a,t},v.rotateY=function(e,i,t){var s=Math.sin(i),a=Math.cos(i),u=e[0],n=e[1],r=e[2],l=e[3],o=e[8],c=e[9],m=e[10],d=e[11];return t?e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[0]=u*a+o*-s,t[1]=n*a+c*-s,t[2]=r*a+m*-s,t[3]=l*a+d*-s,t[8]=u*s+o*a,t[9]=n*s+c*a,t[10]=r*s+m*a,t[11]=l*s+d*a,t},v.rotateZ=function(e,i,t){var s=Math.sin(i),a=Math.cos(i),u=e[0],n=e[1],r=e[2],l=e[3],o=e[4],c=e[5],m=e[6],d=e[7];return t?e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[0]=u*a+o*s,t[1]=n*a+c*s,t[2]=r*a+m*s,t[3]=l*a+d*s,t[4]=u*-s+o*a,t[5]=n*-s+c*a,t[6]=r*-s+m*a,t[7]=l*-s+d*a,t},v.frustum=function(e,i,t,s,a,u,n){n||(n=v.create());var r=i-e,l=s-t,o=u-a;return n[0]=2*a/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*a/l,n[6]=0,n[7]=0,n[8]=(i+e)/r,n[9]=(s+t)/l,n[10]=-(u+a)/o,n[11]=-1,n[12]=0,n[13]=0,n[14]=-(2*u*a)/o,n[15]=0,n},v.perspective=function(e,i,t,s,a){var u=t*Math.tan(e*Math.PI/360),n=u*i;return v.frustum(-n,n,-u,u,t,s,a)},v.ortho=function(e,i,t,s,a,u,n){n||(n=v.create());var r=i-e,l=s-t,o=u-a;return n[0]=2/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/o,n[11]=0,n[12]=-(e+i)/r,n[13]=-(s+t)/l,n[14]=-(u+a)/o,n[15]=1,n},v.lookAt=function(e,i,t,s){s||(s=v.create());var a,u,n,r,l,o,c,m,d,p,g=e[0],h=e[1],f=e[2],b=t[0],q=t[1],S=t[2],y=i[0],_=i[1],P=i[2];return g===y&&h===_&&f===P?v.identity(s):(c=g-y,m=h-_,d=f-P,p=1/Math.sqrt(c*c+m*m+d*d),c*=p,m*=p,d*=p,a=q*d-S*m,u=S*c-b*d,n=b*m-q*c,p=Math.sqrt(a*a+u*u+n*n),p?(p=1/p,a*=p,u*=p,n*=p):(a=0,u=0,n=0),r=m*n-d*u,l=d*a-c*n,o=c*u-m*a,p=Math.sqrt(r*r+l*l+o*o),p?(p=1/p,r*=p,l*=p,o*=p):(r=0,l=0,o=0),s[0]=a,s[1]=r,s[2]=c,s[3]=0,s[4]=u,s[5]=l,s[6]=m,s[7]=0,s[8]=n,s[9]=o,s[10]=d,s[11]=0,s[12]=-(a*g+u*h+n*f),s[13]=-(r*g+l*h+o*f),s[14]=-(c*g+m*h+d*f),s[15]=1,s)},v.fromRotationTranslation=function(e,i,t){t||(t=v.create());var s=e[0],a=e[1],u=e[2],n=e[3],r=s+s,l=a+a,o=u+u,c=s*r,m=s*l,d=s*o,p=a*l,g=a*o,h=u*o,f=n*r,b=n*l,q=n*o;return t[0]=1-(p+h),t[1]=m+q,t[2]=d-b,t[3]=0,t[4]=m-q,t[5]=1-(c+h),t[6]=g+f,t[7]=0,t[8]=d+b,t[9]=g-f,t[10]=1-(c+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},v.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var g={};g.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):i[0]=i[1]=i[2]=i[3]=0,i},g.createFrom=function(e,i,t,s){var a=new u(4);return a[0]=e,a[1]=i,a[2]=t,a[3]=s,a},g.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},g.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])&&s>Math.abs(e[3]-i[3])},g.identity=function(e){return e||(e=g.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var h=g.identity();g.calculateW=function(e,i){var t=e[0],s=e[1],a=e[2];return i&&e!==i?(i[0]=t,i[1]=s,i[2]=a,i[3]=-Math.sqrt(Math.abs(1-t*t-s*s-a*a)),i):(e[3]=-Math.sqrt(Math.abs(1-t*t-s*s-a*a)),e)},g.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]},g.inverse=function(e,i){var t=e[0],s=e[1],a=e[2],u=e[3],n=t*t+s*s+a*a+u*u,r=n?1/n:0;return i&&e!==i?(i[0]=-e[0]*r,i[1]=-e[1]*r,i[2]=-e[2]*r,i[3]=e[3]*r,i):(e[0]*=-r,e[1]*=-r,e[2]*=-r,e[3]*=r,e)},g.conjugate=function(e,i){return i&&e!==i?(i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},g.length=function(e){var i=e[0],t=e[1],s=e[2],a=e[3];return Math.sqrt(i*i+t*t+s*s+a*a)},g.normalize=function(e,i){i||(i=e);var t=e[0],s=e[1],a=e[2],u=e[3],n=Math.sqrt(t*t+s*s+a*a+u*u);return 0===n?(i[0]=0,i[1]=0,i[2]=0,i[3]=0,i):(n=1/n,i[0]=t*n,i[1]=s*n,i[2]=a*n,i[3]=u*n,i)},g.add=function(e,i,t){return t&&e!==t?(t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t):(e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e[3]+=i[3],e)},g.multiply=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=i[0],l=i[1],o=i[2],c=i[3];return t[0]=s*c+n*r+a*o-u*l,t[1]=a*c+n*l+u*r-s*o,t[2]=u*c+n*o+s*l-a*r,t[3]=n*c-s*r-a*l-u*o,t},g.multiplyVec3=function(e,i,t){t||(t=i);var s=i[0],a=i[1],u=i[2],n=e[0],r=e[1],l=e[2],o=e[3],c=o*s+r*u-l*a,m=o*a+l*s-n*u,d=o*u+n*a-r*s,p=-n*s-r*a-l*u;return t[0]=c*o+p*-n+m*-l-d*-r,t[1]=m*o+p*-r+d*-n-c*-l,t[2]=d*o+p*-l+c*-r-m*-n,t},g.scale=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t):(e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e)},g.toMat3=function(e,i){i||(i=p.create());var t=e[0],s=e[1],a=e[2],u=e[3],n=t+t,r=s+s,l=a+a,o=t*n,c=t*r,m=t*l,d=s*r,v=s*l,g=a*l,h=u*n,f=u*r,b=u*l;return i[0]=1-(d+g),i[1]=c+b,i[2]=m-f,i[3]=c-b,i[4]=1-(o+g),i[5]=v+h,i[6]=m+f,i[7]=v-h,i[8]=1-(o+d),i},g.toMat4=function(e,i){i||(i=v.create());var t=e[0],s=e[1],a=e[2],u=e[3],n=t+t,r=s+s,l=a+a,o=t*n,c=t*r,m=t*l,d=s*r,p=s*l,g=a*l,h=u*n,f=u*r,b=u*l;return i[0]=1-(d+g),i[1]=c+b,i[2]=m-f,i[3]=0,i[4]=c-b,i[5]=1-(o+g),i[6]=p+h,i[7]=0,i[8]=m+f,i[9]=p-h,i[10]=1-(o+d),i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},g.slerp=function(e,i,t,s){s||(s=e);var a,u,n,r,l=e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3],o=1;return 0>l&&(l=-l,o=-1),Math.abs(l)>=1?(s!==e&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3]),s):(a=Math.acos(l),u=Math.sqrt(1-l*l),.001>Math.abs(u)?(s[0]=.5*e[0]+.5*i[0],s[1]=.5*e[1]+.5*i[1],s[2]=.5*e[2]+.5*i[2],s[3]=.5*e[3]+.5*i[3],s):(n=Math.sin((1-t)*a)/u,r=Math.sin(t*a)/u,s[0]=e[0]*n+i[0]*o*r,s[1]=e[1]*n+i[1]*o*r,s[2]=e[2]*n+i[2]*o*r,s[3]=e[3]*n+i[3]*o*r,s))},g.fromRotationMatrix=function(e,i){i||(i=g.create());var t=p.create();p.transpose(e,t);var s,a=t[0]+t[4]+t[8];if(a>0)s=Math.sqrt(a+1),i[3]=.5*s,s=.5/s,i[0]=(t[7]-t[5])*s,i[1]=(t[2]-t[6])*s,i[2]=(t[3]-t[1])*s;else{var u=g.fromRotationMatrix.s_iNext=g.fromRotationMatrix.s_iNext||[1,2,0],n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var r=u[n],l=u[r];s=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*l+l]+1),i[n]=.5*s,s=.5/s,i[3]=(t[3*l+r]-t[3*r+l])*s,i[r]=(t[3*r+n]+t[3*n+r])*s,i[l]=(t[3*l+n]+t[3*n+l])*s}return i},p.toQuat4=g.fromRotationMatrix,function(){var e=p.create();g.fromAxes=function(i,t,s,a){return e[0]=t[0],e[3]=t[1],e[6]=t[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=i[0],e[5]=i[1],e[8]=i[2],g.fromRotationMatrix(e,a)}}(),g.identity=function(e){return e||(e=g.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},g.fromAngleAxis=function(e,i,t){t||(t=g.create());var s=.5*e,a=Math.sin(s);return t[3]=Math.cos(s),t[0]=a*i[0],t[1]=a*i[1],t[2]=a*i[2],t},g.toAngleAxis=function(e,i){i||(i=e);var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(t>0){i[3]=2*Math.acos(e[3]);var s=a.invsqrt(t);i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s}else i[3]=0,i[0]=1,i[1]=0,i[2]=0;return i},g.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var f={};f.create=function(e){var i=new u(2);return e?(i[0]=e[0],i[1]=e[1]):(i[0]=0,i[1]=0),i},f.createFrom=function(e,i){var t=new u(2);return t[0]=e,t[1]=i,t},f.add=function(e,i,t){return t||(t=i),t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},f.subtract=function(e,i,t){return t||(t=i),t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},f.multiply=function(e,i,t){return t||(t=i),t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},f.divide=function(e,i,t){return t||(t=i),t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},f.scale=function(e,i,t){return t||(t=e),t[0]=e[0]*i,t[1]=e[1]*i,t},f.dist=function(e,i){var t=i[0]-e[0],s=i[1]-e[1];return Math.sqrt(t*t+s*s)},f.set=function(e,i){return i[0]=e[0],i[1]=e[1],i},f.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])},f.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i},f.normalize=function(e,i){i||(i=e);var t=e[0]*e[0]+e[1]*e[1];return t>0?(t=Math.sqrt(t),i[0]=e[0]/t,i[1]=e[1]/t):i[0]=i[1]=0,i},f.cross=function(e,i,t){var s=e[0]*i[1]-e[1]*i[0];return t?(t[0]=t[1]=0,t[2]=s,t):s},f.length=function(e){var i=e[0],t=e[1];return Math.sqrt(i*i+t*t)},f.squaredLength=function(e){var i=e[0],t=e[1];return i*i+t*t},f.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]},f.direction=function(e,i,t){t||(t=e);var s=e[0]-i[0],a=e[1]-i[1],u=s*s+a*a;return u?(u=1/Math.sqrt(u),t[0]=s*u,t[1]=a*u,t):(t[0]=0,t[1]=0,t[2]=0,t)},f.lerp=function(e,i,t,s){return s||(s=e),s[0]=e[0]+t*(i[0]-e[0]),s[1]=e[1]+t*(i[1]-e[1]),s},f.str=function(e){return"["+e[0]+", "+e[1]+"]"};var b={};b.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):i[0]=i[1]=i[2]=i[3]=0,i},b.createFrom=function(e,i,t,s){var a=new u(4);return a[0]=e,a[1]=i,a[2]=t,a[3]=s,a},b.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},b.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])&&s>Math.abs(e[3]-i[3])},b.identity=function(e){return e||(e=b.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},b.transpose=function(e,i){if(!i||e===i){var t=e[1];return e[1]=e[2],e[2]=t,e}return i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3],i},b.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},b.inverse=function(e,i){i||(i=e);var t=e[0],s=e[1],a=e[2],u=e[3],n=t*u-a*s;return n?(n=1/n,i[0]=u*n,i[1]=-s*n,i[2]=-a*n,i[3]=t*n,i):null},b.multiply=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3];return t[0]=s*i[0]+a*i[2],t[1]=s*i[1]+a*i[3],t[2]=u*i[0]+n*i[2],t[3]=u*i[1]+n*i[3],t},b.rotate=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=Math.sin(i),l=Math.cos(i);return t[0]=s*l+a*r,t[1]=s*-r+a*l,t[2]=u*l+n*r,t[3]=u*-r+n*l,t},b.multiplyVec2=function(e,i,t){t||(t=i);var s=i[0],a=i[1];return t[0]=s*e[0]+a*e[1],t[1]=s*e[2]+a*e[3],t},b.scale=function(e,i,t){t||(t=e);var s=e[0],a=e[1],u=e[2],n=e[3],r=i[0],l=i[1];return t[0]=s*r,t[1]=a*l,t[2]=u*r,t[3]=n*l,t},b.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var q={};return q.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i},q.createFrom=function(e,i,t,s){var a=new u(4);return a[0]=e,a[1]=i,a[2]=t,a[3]=s,a},q.add=function(e,i,t){return t||(t=i),t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},q.subtract=function(e,i,t){return t||(t=i),t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},q.multiply=function(e,i,t){return t||(t=i),t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},q.divide=function(e,i,t){return t||(t=i),t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},q.scale=function(e,i,t){return t||(t=e),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},q.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},q.equal=function(e,i){return e===i||s>Math.abs(e[0]-i[0])&&s>Math.abs(e[1]-i[1])&&s>Math.abs(e[2]-i[2])&&s>Math.abs(e[3]-i[3])},q.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},q.length=function(e){var i=e[0],t=e[1],s=e[2],a=e[3];return Math.sqrt(i*i+t*t+s*s+a*a)},q.squaredLength=function(e){var i=e[0],t=e[1],s=e[2],a=e[3];return i*i+t*t+s*s+a*a},q.lerp=function(e,i,t,s){return s||(s=e),s[0]=e[0]+t*(i[0]-e[0]),s[1]=e[1]+t*(i[1]-e[1]),s[2]=e[2]+t*(i[2]-e[2]),s[3]=e[3]+t*(i[3]-e[3]),s},q.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},e&&(e.glMatrixArrayType=u,e.MatrixArray=u,e.setMatrixArrayType=i,e.determineMatrixArrayType=t,e.glMath=a,e.vec2=f,e.vec3=n,e.vec4=q,e.mat2=b,e.mat3=p,e.mat4=v,e.quat4=g),{glMatrixArrayType:u,MatrixArray:u,setMatrixArrayType:i,determineMatrixArrayType:t,glMath:a,vec2:f,vec3:n,vec4:q,mat2:b,mat3:p,mat4:v,quat4:g}})}}),montageDefine("83b66f4","ui/scene-view.reel/scene-view",{dependencies:["runtime/dependencies/gl-matrix","montage","montage/ui/component","runtime/glsl-program","runtime/helpers/resource-manager","runtime/glTF-scene","runtime/glTF-node","runtime/scene","runtime/node","runtime/scene-renderer","runtime/glTF-material","runtime/utilities","montage/core/dom","montage/core/geometry/point","montage/composer/translate-composer","runtime/builtin-assets","runtime/webgl-renderer","runtime/projection","runtime/animation","runtime/camera","runtime/scene-helper","controllers/camera-controller","runtime/transform","runtime/component-3d","runtime/action-dispatcher","montage/core/application","runtime/dependencies/webgl-debug"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage,s=e("montage/ui/component").Component;e("runtime/glsl-program").GLSLProgram,e("runtime/helpers/resource-manager").ResourceManager,e("runtime/glTF-scene").glTFScene,e("runtime/glTF-node").glTFNode;var a=e("runtime/scene").Scene;e("runtime/node").Node;var u=e("runtime/scene-renderer").SceneRenderer;e("runtime/glTF-material").glTFMaterial,e("runtime/utilities").Utilities;var n=e("montage/core/dom"),r=e("montage/core/geometry/point").Point,l=e("montage/composer/translate-composer").TranslateComposer,o=e("runtime/builtin-assets").BuiltInAssets,c=e("runtime/webgl-renderer").WebGLRenderer;e("runtime/projection").Projection;var m=e("runtime/animation").BasicAnimation;e("runtime/camera").Camera;var d=e("runtime/utilities").BBox,p=e("runtime/scene-helper").SceneHelper,v=e("controllers/camera-controller").CameraController,g=e("runtime/transform").Transform,h=e("runtime/component-3d").Component3D,f=e("runtime/action-dispatcher").ActionDispatcher;e("montage/core/application").Application,e("runtime/dependencies/webgl-debug"),i.SceneView=s.specialize({automaticallyCyclesThroughViewPoints:{value:!0,writable:!0},allowsProgressiveSceneLoading:{value:!1,writable:!0},allowsViewPointControl:{value:!0,writable:!0},scene:{get:function(){return this._scene},set:function(e){if(e){if(e.isLoaded()===!1)return e.addOwnPropertyChangeListener("status",this),void 0;this.needsDraw=!0}this.scene!=e&&(this.sceneWillChange(e),this._scene=e,this.sceneDidChange())}},viewPoint:{get:function(){return this._viewPoint},set:function(e){var i=this._viewPoint?this._viewPoint.id:null,t=e?e.id:null;if(i!=t){var s=null;this._viewPoint&&e&&this._viewPoint.scene==e.scene&&(s=this._viewPoint),this.viewPointWillChange(s,e),this._viewPoint=e;var a=this.getAnimationManager();a&&(a.sceneTime=0),e&&this.scene&&null==this._viewPoint.scene&&(this._viewPoint.scene=this.scene),this.viewPointDidChange()}}},play:{value:function(){switch(this._state){case this.PAUSE:case this.STOP:this._lastTime=Date.now(),this._state=this.PLAY,this.needsDraw=!0;break;default:}this._state=this.PLAY}},pause:{value:function(){this._state=this.PAUSE}},stop:{value:function(){var e=this.getAnimationManager();e&&(e.sceneTime=0),this._state=this.STOP,this.needsDraw=!0}},loops:{value:!0,writable:!0},STOP:{value:0,writable:!0},PLAY:{value:1,writable:!0},PAUSE:{value:2,writable:!0},_internalViewPoint:{value:null,writable:!0},_firstFrameDidRender:{value:!1,writable:!0},_sceneResourcesLoaded:{value:!1,writable:!0},_scene:{value:null,writable:!0},_consideringPointerForPicking:{writable:!0,value:!1},_mousePosition:{writable:!0,value:null},_showGradient:{value:!1,writable:!0},_showReflection:{value:!1,writable:!0},_showBBOX:{value:!1,writable:!0},_width:{value:null,writable:!0},_height:{value:null,writable:!0},_lastTime:{value:0,writable:!0},_state:{value:0,writable:!0},_viewPoint:{value:null,writable:!0},_sceneRenderer:{value:null,writable:!0},_disableRendering:{value:!1,writable:!0},_contextAttributes:{value:null,writable:!0},_shouldForceClear:{value:!1,writable:!0},_viewPointIndex:{value:0,writable:!0},_cameraController:{value:null,writable:!0},_defaultViewPoint:{value:null,writable:!0},translateComposer:{value:null,writable:!0},scaleFactor:{value:window.devicePixelRatio||1,writable:!0},selectedNode:{value:null,writable:!0},cameraController:{get:function(){return null==this._cameraController&&(this._cameraController=t.create(v)),this._cameraController}},sceneTimeWillChange:{value:function(){}},sceneTimeDidChange:{value:function(){if(null!=this.scene&&null!=this.scene.glTFElement){var e=this.scene.glTFElement.endTime;if(-1!==e&&null!=this.sceneView){var i=this.scene.glTFElement.animationManager;if(i.sceneTime/1e3>e&&1==this.automaticallyCyclesThroughViewPoints){var t=this.sceneView._viewPointIndex,s=p.getViewPoints(this.scene);if(s.length>0){var a,u=0;do i.sceneTime=0,u++,t=++t%s.length,a=s[t];while(s.length>u&&0==i.nodeHasAnimatedAncestor(a.glTFElement));this.sceneView.viewPoint=a}}}}}},sceneWillChange:{value:function(e){this.getResourceManager()&&this.getResourceManager().reset(),this._firstFrameDidRender=!1,this.delegate&&this.delegate.sceneWillChange&&this.delegate.sceneWillChange(e),this._scene&&(this._scene.removeEventListener("cursorUpdate",this),this._scene.removeEventListener("materialUpdate",this),this._scene.removeEventListener("textureUpdate",this),this.application.removeEventListener("sceneNodeSelected",this))}},sceneDidChange:{value:function(){this._scene&&(this._sceneResourcesLoaded=!1,this._scene.addEventListener("cursorUpdate",this),this._scene.addEventListener("textureUpdate",this),this._scene.addEventListener("materialUpdate",this),this.application.addEventListener("sceneNodeSelected",this),this.applyScene(),this.delegate&&this.delegate.sceneDidChange&&this.delegate.sceneDidChange())}},resourceAvailable:{value:function(){if(0==this.allowsProgressiveSceneLoading){var e=this.getResourceManager();e&&0==e.hasPendingRequests()&&(this.needsDraw=!0)}}},handleTextureUpdate:{value:function(e){var i=this.getResourceManager();if(i&&this.sceneRenderer&&this.sceneRenderer.webGLRenderer){var t=this.sceneRenderer.webGLRenderer.webGLContext,s=i.getResource(e.detail.value,this.sceneRenderer.webGLRenderer.textureDelegate,t);s&&this.resourceAvailable()}}},handleMaterialUpdate:{value:function(){this.needsDraw=!0}},handleCursorUpdate:{value:function(e){null!=this.element&&(this.element.style.cursor=e.detail)}},constructor:{value:function(){this.super()}},animationDidStart:{value:function(){this.needsDraw=!0,this.element.style.cursor="default"}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(e){var i=this._viewPointAnimationStep,t=e.extras.previousViewPoint;null==this.__matrix&&(this.__matrix=mat4.create()),null==this.__transform&&(this.__transform=Object.create(g).init());var s=t.glTFElement.transform,a=this.viewPoint.glTFElement.transform;s.interpolateToTransform(a,i,this.__transform),mat4.multiply(this.viewPoint.glTFElement.parent.worldMatrix,this.__transform.matrix,this.__matrix),this._internalViewPoint.transform.matrix=this.__matrix}},viewPointWillChange:{value:function(e,i){if(this.sceneRenderer&&i&&this.scene.glTFElement){var t=this.getAnimationManager(),s=0==t.nodeHasAnimatedAncestor(i.glTFElement);if(0==s&&null!=e&&(s|=0==t.nodeHasAnimatedAncestor(e.glTFElement)),s&&null!=e){var a=Object.create(m).init();a.path="_viewPointAnimationStep",a.target=this,a.delegate=this,a.from=Number(0),a.to=Number(1),a.duration=1e3,a.timingFunction="ease-out",a.extras.previousViewPoint=e,t.playAnimation(a),a.animationWasAddedToTarget()}}}},viewPointDidChange:{value:function(){this.cameraController.viewPoint=this.viewPoint,this.sceneRenderer&&this._viewPoint&&this.scene&&this.scene.glTFElement&&(this.sceneRenderer.technique.rootPass.viewPoint=this._internalViewPoint,this._viewPointIndex=this._getViewPointIndex(this.viewPoint),this.needsDraw=!0)}},viewPoint:{get:function(){return this._viewPoint},set:function(e){var i=this._viewPoint?this._viewPoint.id:null,t=e?e.id:null;if(i!=t){var s=null;this._viewPoint&&e&&this._viewPoint.scene==e.scene&&(s=this._viewPoint),this.viewPointWillChange(s,e),this._viewPoint=e;var a=this.getAnimationManager();a&&(a.sceneTime=0),e&&this.scene&&null==this._viewPoint.scene&&(this._viewPoint.scene=this.scene),this.viewPointDidChange()
}}},canvas:{get:function(){return this.templateObjects?this.templateObjects.canvas:null}},sceneRenderer:{get:function(){return this._sceneRenderer},set:function(e){e!=this._sceneRenderer&&(this._sceneRenderer=e)}},handleStatusChange:{value:function(e,i,t){"loaded"===e&&(this.scene=t,this.needsDraw=!0,this.scene.glTFElement&&this.scene.glTFElement.animationManager&&this.scene.glTFElement.animationManager&&(this.scene.glTFElement.animationManager.delegate=this))}},_getViewPointIndex:{value:function(e){for(var i=p.getGLTFViewPoints(e.scene),t=0;i.length>t;t++)if(i[t].baseId===e.id)return t;return 0}},applyScene:{value:function(){var e=this.scene,i=e.glTFElement,t=this;if(this.sceneRenderer&&this.sceneRenderer.technique.rootPass){if(i){var s=p.getViewPoints(e),a=s.length>0;if(a){var u=!1;this.viewPoint&&this.viewPoint.scene&&(u=this.viewPoint.scene===this.scene),u===!1&&(this.viewPoint=s[0])}else{var n=i.rootNode.getBoundingBox(!0);Object.create(d).init(n[0],n[1]),i.rootNode.transform._updateDirtyFlag(!1);var r=this.scene.glTFElement,n=r.rootNode.getBoundingBox(!0),l=[(n[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2,(n[0][2]+n[1][2])/2];l[2];var o=[l[0],l[1],l[2]];o[2]+=n[1][0]-n[0][0]+(n[1][2]-n[0][2]),this._defaultViewPoint=p.createNodeIncludingCamera("camera01",e);var c=p.getGLTFCamera(this._defaultViewPoint);c.projection.zfar=o[2]+n[1][2]-n[0][2],this._defaultViewPoint.glTFElement.transform.translation=o,this.viewPoint=this._defaultViewPoint}this.sceneRenderer.scene=i}if(this.viewPoint&&(null==this.viewPoint.scene&&(this.viewPoint.scene=e),this.sceneRenderer&&this.viewPointDidChange()),this.allowsProgressiveSceneLoading===!1){var m=this.scene.prepareToRender(this.sceneRenderer.webGLRenderer);m.then(function(){t._sceneResourcesLoaded=!0,t.needsDraw=!0},function(){},function(){})}else this.needsDraw=!0}}},getRelativePositionToCanvas:{value:function(e){return n.convertPointFromPageToNode(this.canvas,r.create().init(e.pageX,e.pageY))}},captureResize:{value:function(){this.needsDraw=!0}},enterDocument:{value:function(){var e=this;window.addEventListener("resize",this,!0),this.scene&&(this.scene.dispatchEventNamed("enteredDocument",!0,!1,this),this.scene.loadCSSStyles()),this.element.addEventListener("wheel",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.zoom(i)),i.stopPropagation(),i.preventDefault()},!1),this.element.addEventListener("gesturestart",function(e){e.preventDefault()},!1),this.element.addEventListener("gesturechange",function(e){e.preventDefault()},!1);var i=this.translateComposer;i.addEventListener("translate",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.translate(i)),e.needsDraw=!0}),i.addEventListener("translateStart",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.beginTranslate(i))},!1),i.addEventListener("translateEnd",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.endTranslate(i))},!1),this.addComposerForElement(i,this.canvas);var s;s=void 0!==window.onwheel?"wheel":"mousewheel",this.canvas.removeEventListener(s,i,!0),this.canvas.removeEventListener(s,i,!1);var n=!1;n&&(this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas));var r={premultipliedAlpha:!0,antialias:!0,preserveDrawingBuffer:!1},l=this.canvas.getContext("experimental-webgl",r)||this.canvas.getContext("webgl",r);if(null==l)return console.log("Please check that your browser enables & supports WebGL"),void 0;this._contextAttributes=l.getContextAttributes();var m=!1;if(this._contextAttributes&&(m=this._contextAttributes.antialias),0==m&&console.log("WARNING: anti-aliasing is not supported/enabled"),navigator){var d=null!=navigator.userAgent.match(/iPad/i);if(0==d){var v=navigator.userAgent;d=/iPad/i.test(v)||/iPhone OS 3_1_2/i.test(v)||/iPhone OS 3_2_2/i.test(v)}d&&(this._shouldForceClear=!0)}var g=Object.create(c).initWithWebGLContext(l);l.enable(l.DEPTH_TEST);var h=null;this.sceneRenderer=Object.create(u),this.sceneRenderer.init(g,h);var b=this.getResourceManager();b.isObserving()||(b.observers.push(this),b.startObserving()),this.scene&&this.applyScene(),this.canvas.addEventListener("webglcontextlost",function(i){console.log("context was lost"),i.preventDefault(),e.getResourceManager.stopObserving(),e.sceneRenderer.webGLRenderer.resourceManager.reset(),e.needsDraw=!1,e._disableRendering=!0},!1),this.canvas.addEventListener("webglcontextrestored",function(i){console.log("context was restored"),i.preventDefault(),l.enable(l.DEPTH_TEST),e.needsDraw=!0,e._disableRendering=!1},!1),n&&setTimeout(function(){e.canvas.loseContext()},5e3);var e=this,q=o.assetWithName("gradient");q.then(function(i){var s=t.create(a).init(i);e.gradientRenderer=Object.create(u),e.gradientRenderer.init(g,null),e.gradientRenderer.scene=s.glTFElement;var n=p.getViewPoints(s);n&&n.length&&(e.gradientRenderer.technique.rootPass.viewPoint=n[0].glTFElement),e.needsDraw=!0},function(){},function(){}),this.actionDispatcher=f.create().initWithScene(this.scene),this.needsDraw=!0,this.canvas.addEventListener("touchstart",this.start.bind(this),!0),this.canvas.addEventListener("touchend",this.end.bind(this),!0),this.canvas.addEventListener("touchcancel",this.end.bind(this),!0),this.canvas.addEventListener("touchmove",this.move.bind(this),!0),this.canvas.addEventListener("gesturechange",this,!0),this.canvas.addEventListener("mousedown",this.start.bind(this),!0),this.canvas.addEventListener("mouseup",this.end.bind(this),!0),this.canvas.addEventListener("mousemove",this.move.bind(this),!0),this.canvas.addEventListener("wheel",this,!0)}},exitDocument:{value:function(){window.removeEventListener("resize",this,!0)}},captureMousewheel:{value:function(){this.needsDraw=!0}},captureWheel:{value:function(){this.needsDraw=!0}},captureGesturechange:{value:function(){this.needsDraw=!0}},_TOUCH_DOWN:{value:0},_TOUCH_UP:{value:1},_TOUCH_MOVE:{value:2},_eventType:{value:-1,writable:!0},_previousNodeEventType:{value:-1,writable:!0},_previousHandledNode:{value:null,writable:!0},handleSelectedNode:{value:function(e){var i=null,t=this._previousHandledNode,s=t?t.component3D:null;if(this._eventType===this._TOUCH_UP&&(t&&s&&s.handleActionOnGlTFElement(t,h._TOUCH_UP),this._eventType=-1),e&&(i=this.scene.glTFElement.ids[e],this._eventType===this._TOUCH_DOWN)){var a=p.createNodeFromGlTFElementIfNeeded(i,this.scene);this.application.dispatchEventNamed("sceneNodeSelected",!0,!0,a)}t&&s&&this._previousNodeEventType===this._TOUCH_MOVE&&i!==t&&s.handleActionOnGlTFElement(t,h._EXIT),this._eventType===this._TOUCH_MOVE&&i!==t?i?this.actionDispatcher.dispatchActionOnGlTFElement(h._ENTER,i):this._eventType=-1:i&&this._eventType===this._TOUCH_DOWN&&(this.actionDispatcher.dispatchActionOnGlTFElement(h._TOUCH_DOWN,i),this._eventType=-1),this._previousHandledNode=i,this._previousNodeEventType=this._eventType}},_previousMaterialEventType:{value:-1,writable:!0},_previousHandledMaterial:{value:null,writable:!0},handleSelectedMaterial:{value:function(e){var i=null,t=this._previousHandledMaterial,s=t?t.component3D:null;if(this._eventType===this._TOUCH_UP&&(t&&s&&s.handleActionOnGlTFElement(t,h._TOUCH_UP),this._eventType=-1),e&&(i=this.scene.glTFElement.ids[e],this._eventType===this._TOUCH_DOWN)){var a=p.createMaterialFromGlTFElementIfNeeded(i,this.scene);this.application.dispatchEventNamed("sceneMaterialSelected",!0,!0,a)}t&&s&&this._previousMaterialEventType===this._TOUCH_MOVE&&i!==t&&s.handleActionOnGlTFElement(t,h._EXIT),this._eventType===this._TOUCH_MOVE&&i!==t?i?this.actionDispatcher.dispatchActionOnGlTFElement(h._ENTER,i):this._eventType=-1:i&&this._eventType===this._TOUCH_DOWN&&(this.actionDispatcher.dispatchActionOnGlTFElement(h._TOUCH_DOWN,i),this._eventType=-1),this._previousHandledMaterial=i,this._previousNodeEventType=this._eventType}},move:{value:function(e){var i=this.getRelativePositionToCanvas(e);this._mousePosition=[i.x*this.scaleFactor,this.height*this.scaleFactor-i.y*this.scaleFactor],this._eventType=this._TOUCH_MOVE,this.needsDraw=!0}},start:{value:function(e){e.preventDefault(),this._consideringPointerForPicking=!0;var i=this.getRelativePositionToCanvas(e);this._mousePosition=[i.x*this.scaleFactor,this.height*this.scaleFactor-i.y*this.scaleFactor],this._state===this.PLAY&&this.pause(),this._eventType=this._TOUCH_DOWN,this.needsDraw=!0}},end:{value:function(e){if(this._consideringPointerForPicking&&e.target===this.canvas&&e.preventDefault(),this._state===this.PAUSE&&this.scene&&this.viewPoint&&this.scene.glTFElement){var i=this.getAnimationManager();i.nodeHasAnimatedAncestor(this.viewPoint.glTFElement)&&this.play()}this._consideringPointerForPicking=!1,this._eventType=this._TOUCH_UP,this.handleSelectedNode(null),this._mousePosition=null}},getWebGLRenderer:{value:function(){return this.sceneRenderer?this.sceneRenderer.webGLRenderer:null}},getWebGLContext:{value:function(){var e=this.getWebGLRenderer();return e?e.webGLContext:null}},getResourceManager:{value:function(){var e=this.getWebGLRenderer();return e?e.resourceManager:null}},getAnimationManager:{value:function(){return this.scene&&this.scene.glTFElement?this.scene.glTFElement.animationManager:null}},showBBOX:{get:function(){return this._showBBOX},set:function(e){e!=this._showBBOX&&(this._showBBOX=e,this.needsDraw=!0)}},showGradient:{get:function(){return this._showGradient},set:function(e){e!=this._showGradient&&(this._showGradient=e,this.needsDraw=!0)}},showReflection:{get:function(){return this._showReflection},set:function(e){this._showReflection=e,this.needsDraw=!0}},handleSceneNodeSelected:{value:function(e){this.selectedNode=e.detail,this.needsDraw=!0}},_displayBBOX:{value:function(e){if(this.scene&&this.scene.glTFElement&&null!=e.getBoundingBox){var i=this.sceneRenderer.technique.rootPass.scenePassRenderer._viewPointMatrix,t=p.getGLTFCamera(this.viewPoint);if(null!=t){var s=t.projection.matrix;this.getWebGLRenderer().drawBBOX(e.getBoundingBox(!0),i,mat4.identity(),s)}}}},_displayAllBBOX:{value:function(){if(this.scene&&this.scene.glTFElement){this.sceneRenderer.technique.rootPass.scenePassRenderer._viewPointMatrix;var e=mat4.identity(),i=this.scene.glTFElement.rootNode,t=this;i.apply(function(e){return t._displayBBOX(e),null},!0,e)}}},width:{get:function(){if(null!=this._width)return this._width;var e=this.getWebGLContext();return null!=e?e.canvas.clientWidth:0},set:function(e){this._width!=e&&(this._width=e,this.needsDraw=!0)}},height:{get:function(){if(null!=this._height)return this._height;var e=this.getWebGLContext();return null!=e?e.canvas.clientHeight:0},set:function(e){this._height!=e&&(this._height=e,this.needsDraw=!0)}},_forwardToNextAnimatedViewPointIfNeeded:{value:function(){var e=this.getAnimationManager();if(e){if(1==e.nodeHasAnimatedAncestor(this.viewPoint.glTFElement))return;var i=this._viewPointIndex,t=p.getViewPoints(this.scene);if(t.length>1){for(var s=this.viewPoint,a=0;t.length>a&&0==e.nodeHasAnimatedAncestor(s.glTFElement);)i=++i%t.length,s=t[i],a++;this.viewPoint=s}}}},draw:{value:function(){var e=this.getWebGLContext();if(!(null==e||this._disableRendering||(this.sceneRenderer.technique.rootPass.viewPoint=this._internalViewPoint,(this._shouldForceClear||null==this._contextAttributes.preserveDrawingBuffer||1==this._contextAttributes.preserveDrawingBuffer)&&(e.clearColor(0,0,0,0),e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT)),this.delegate&&this.delegate.sceneWillDraw&&this.delegate.sceneWillDraw(),this.allowsProgressiveSceneLoading===!1&&this._sceneResourcesLoaded===!1||null==this._scene||null==this.viewPoint||this._disableRendering))){this.resizeIfNeeded();var i=this.viewPoint,t=Date.now();if(this.sceneRenderer&&this.scene){var s=this.getAnimationManager();if(this._state==this.PLAY&&s){this._forwardToNextAnimatedViewPointIfNeeded(),s.sceneTime+=t-this._lastTime;var a=this.scene.glTFElement.endTime;s.sceneTime/1e3>a&&(this.loops?s.sceneTime=0==a?0:s.sceneTime%a:this.stop()),s.updateTargetsAtTime(s.sceneTime,this.getResourceManager())}if(i.glTFElement){var u=p.getGLTFCamera(i);u.projection.aspectRatio=this.width/this.height,this._internalViewPoint.transform.matrix=i.glTFElement.worldMatrix,null!=this._internalViewPoint.cameras&&this._internalViewPoint.cameras.length>0&&(this._internalViewPoint.cameras[0]=u)}s.evaluateAtTime(t,this.getResourceManager()),s.hasActiveAnimations()&&(this.needsDraw=!0)}if(this._lastTime=t,this._state==this.PLAY&&(this.needsDraw=!0),this.scene&&(this.sceneRenderer.webGLRenderer,e)){null==this.__renderOptions&&(this.__renderOptions={});var n=this.showReflection;if(n){e.depthFunc(e.LESS),e.enable(e.DEPTH_TEST),e.frontFace(e.CW),e.depthMask(!0);var r=this.scene.glTFElement.rootNode,l=r.getBoundingBox(!0),o=mat4.create(r.transform.matrix),c=mat4.scale(mat4.identity(),[1,1,-1]);mat4.multiply(c,r.transform.matrix),r.transform.matrix=c;var m=r.getBoundingBox(!0),d=mat4.identity(),v=mat4.translate(mat4.identity(),[0,0,l[0][2]-m[1][2]]);mat4.multiply(d,v),mat4.multiply(d,c),r.transform.matrix=d,this.sceneRenderer.render(t,this.__renderOptions),r.transform.matrix=o,e.frontFace(e.CCW)}(this.showGradient||n)&&this.viewPoint===this._defaultViewPoint&&this.gradientRenderer&&(e.enable(e.BLEND),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.depthMask(!1),this.gradientRenderer.render(t,this.__renderOptions),e.depthMask(!0),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.disable(e.BLEND)),null!=this._mousePosition&&(this.scene.nodesShouldBeHitTested&&(this.__renderOptions.picking=!0,this.__renderOptions.coords=this._mousePosition,this.__renderOptions.delegate=this,this.__renderOptions.pickingMode="node",this.sceneRenderer.render(t,this.__renderOptions)),this.scene.materialsShouldBeHitTested&&(this.__renderOptions.picking=!0,this.__renderOptions.coords=this._mousePosition,this.__renderOptions.delegate=this,this.__renderOptions.pickingMode="material",this.sceneRenderer.render(t,this.__renderOptions))),this.__renderOptions.picking=!1,this.__renderOptions.coords=null,this.__renderOptions.delegate=null,this.__renderOptions.pickingMode=null,this.sceneRenderer.render(t,this.__renderOptions),this.showBBOX&&this._displayAllBBOX(),this.delegate&&this.delegate.sceneDidDraw&&this.delegate.sceneDidDraw(),e.flush(),this._firstFrameDidRender===!1&&(this._firstFrameDidRender=!0,this.dispatchEventNamed("firstFrameDidRender",!0,!1,this))}}}},resizeIfNeeded:{value:function(){var e=this.getWebGLContext();if(null!=e){var i=this.width*this.scaleFactor,t=this.height*this.scaleFactor;(e.canvas.width!=i||e.canvas.height!=t)&&(e.canvas.width=i,e.canvas.height=t,null!=this._width&&(this.element.style.width=this.width+"px"),null!=this._height&&(this.element.style.height=this.height+"px"),e.viewport(0,0,i,t))}}},templateDidLoad:{value:function(){this.parentComponent;var e=l.create();e.animateMomentum=!0,e.hasMomentum=!0,e.allowFloats=!0,e.pointerSpeedMultiplier=.15,this._internalViewPoint=p.createGLTFNodeIncludingCamera("__internal_viewPoint__"),this.translateComposer=e,this.needsDraw=!0}}})}}),montageDefine("83b66f4","runtime/webgl-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/glsl-program","runtime/helpers/resource-manager"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/glsl-program").GLSLProgram,s=e("runtime/helpers/resource-manager").WebGLTFResourceManager;i.WebGLRenderer=Object.create(Object.prototype,{MODEL:{value:"MODEL",writable:!1},VIEW:{value:"VIEW",writable:!1},PROJECTION:{value:"PROJECTION",writable:!1},MODELVIEW:{value:"MODELVIEW",writable:!1},VIEWPROJECTION:{value:"VIEWPROJECTION",writable:!1},MODELVIEWPROJECTION:{value:"MODELVIEWPROJECTION",writable:!1},MODELINVERSE:{value:"MODELINVERSE",writable:!1},VIEWINVERSE:{value:"VIEWINVERSE",writable:!1},PROJECTIONINVERSE:{value:"PROJECTIONINVERSE",writable:!1},MODELVIEWINVERSE:{value:"MODELVIEWINVERSE",writable:!1},VIEWPROJECTIONINVERSE:{value:"VIEWPROJECTIONINVERSE",writable:!1},MODELVIEWPROJECTIONINVERSE:{value:"MODELVIEWPROJECTIONINVERSE",writable:!1},MODELTRANSPOSE:{value:"MODELTRANSPOSE",writable:!1},VIEWTRANSPOSE:{value:"VIEWTRANSPOSE",writable:!1},PROJECTIONTRANSPOSE:{value:"PROJECTIONTRANSPOSE",writable:!1},MODELVIEWTRANSPOSE:{value:"MODELVIEWTRANSPOSE",writable:!1},VIEWPROJECTIONTRANSPOSE:{value:"VIEWPROJECTIONTRANSPOSE",writable:!1},MODELVIEWPROJECTIONTRANSPOSE:{value:"MODELVIEWPROJECTIONTRANSPOSE",writable:!1},MODELINVERSETRANSPOSE:{value:"MODELINVERSETRANSPOSE",writable:!1},VIEWINVERSETRANSPOSE:{value:"VIEWINVERSETRANSPOSE",writable:!1},PROJECTIONINVERSETRANSPOSE:{value:"PROJECTIONINVERSETRANSPOSE",writable:!1},MODELVIEWINVERSETRANSPOSE:{value:"MODELVIEWINVERSETRANSPOSE",writable:!1},VIEWPROJECTIONINVERSETRANSPOSE:{value:"VIEWPROJECTIONINVERSETRANSPOSE",writable:!1},MODELVIEWPROJECTIONINVERSETRANSPOSE:{value:"MODELVIEWPROJECTIONINVERSETRANSPOSE",writable:!1},_bindedProgram:{value:null,writable:!0},_debugProgram:{value:null,writable:!0},_resourceManager:{value:null,writable:!0},_webGLContext:{value:null,writable:!0},_projectionMatrix:{value:null,writable:!0},shininess:{value:200,writable:!0},light:{value:[0,0,-1],writable:!0},specularColor:{value:[1,1,1],writable:!0},GLContextDidChange:{value:function(){}},initWithWebGLContext:{value:function(e){return this.webGLContext=e,this._states={},this}},bindedProgram:{get:function(){return this._bindedProgram},set:function(e){this._bindedProgram!==e&&this._webGLContext&&(this._bindedProgram=e,this._bindedProgram&&this._bindedProgram.use(this._webGLContext,!1))}},projectionMatrix:{get:function(){return this._projectionMatrix},set:function(e){this._projectionMatrix=e}},debugProgram:{get:function(){if(!this._debugProgram){this._debugProgram=Object.create(t);var e="precision highp float;attribute vec3 vert;uniform mat4 u_mvMatrix; uniform mat4 u_projMatrix; void main(void) { gl_Position = u_projMatrix * u_mvMatrix * vec4(vert,1.0); }",i="precision highp float;void main(void) { gl_FragColor = vec4(1.,0.,0.,1.); }";this._debugProgram.initWithShaders({"x-shader/x-vertex":e,"x-shader/x-fragment":i}),this._debugProgram.build(this.webGLContext)||console.log(this._debugProgram.errorLogs)}return this._debugProgram}},webGLContext:{get:function(){return this._webGLContext},set:function(e){this._webGLContext=e,this.GLContextDidChange()}},resourceManager:{get:function(){return this._resourceManager||(this._resourceManager=Object.create(s),this._resourceManager.init()),this._resourceManager}},indicesDelegate:{value:{webGLContext:{value:null,writable:!0},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i,t){var s=t,a=s.getParameter(s.ELEMENT_ARRAY_BUFFER_BINDING),u=s.createBuffer();return s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,u),s.bufferData(s.ELEMENT_ARRAY_BUFFER,i,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,a),u},resourceAvailable:function(){}}},setupCompressedMesh:{value:function(e,i,t){var s=e.primitives[0],a=this.webGLContext,u=a.getParameter(a.ELEMENT_ARRAY_BUFFER_BINDING),n=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),a.bufferData(a.ELEMENT_ARRAY_BUFFER,t,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,u),n.count=t.length,this.resourceManager.setResource(s.indices.id,n),s.indices={id:s.indices.id,count:n.count};var r,l=i.length/8,o=new Float32Array(3*l),c=new Float32Array(3*l),m=new Float32Array(2*l);for(r=0;l>r;r++){var d=8*r;o[3*r+0]=i[d+0],o[3*r+1]=i[d+1],o[3*r+2]=i[d+2],c[3*r+0]=i[d+5],c[3*r+1]=i[d+6],c[3*r+2]=i[d+7],m[2*r+0]=i[d+3],m[2*r+1]=i[d+4]}u=a.getParameter(a.ARRAY_BUFFER_BINDING),n=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,o,a.STATIC_DRAW),n.componentType=a.FLOAT,n.componentsPerAttribute=3,this.resourceManager.setResource(s.semantics.POSITION.id,n),s.semantics.POSITION={id:s.semantics.POSITION.id,count:l,byteStride:12},n=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW),n.componentType=a.FLOAT,n.componentsPerAttribute=3,this.resourceManager.setResource(s.semantics.NORMAL.id,n),s.semantics.NORMAL={id:s.semantics.NORMAL.id,count:l,byteStride:12},m.length>0&&(n=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,m,a.STATIC_DRAW),n.componentType=a.FLOAT,n.componentsPerAttribute=2,this.resourceManager.setResource(s.semantics.TEXCOORD_0.id,n),s.semantics.TEXCOORD_0={id:s.semantics.TEXCOORD_0.id,count:l,byteStride:8}),a.bindBuffer(a.ARRAY_BUFFER,u)}},setupCompressedMesh2:{value:function(e,i,t,s,a,u,n){for(var r=this.webGLContext,l=0,o=0,c=e.primitives,m=0;c.length>m;m++){var d=e.primitives[m],p=d.indices.id;l=d.indices.count;var v=new Int16Array(n.subarray(o,o+l)),g=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,g),r.bufferData(r.ELEMENT_ARRAY_BUFFER,v,r.STATIC_DRAW),this.resourceManager.setResource(p,g),g.count=l,d.indices={id:p,count:g.count},o+=l}for(var h,f={},m=0;c.length>m;m++){var d=e.primitives[m];for(h in d.semantics){var b=d.semantics[h];f[b.baseId]=h}}for(var q in f){var S=u[q];if(null!=S){var y=a.GetFloatAttribute(S),h=f[q];if("JOINT"===h)for(var _=0;y.length>_;_++)y[_]=Math.floor(y[_]+.5);var P=a.GetFloatAttributeDim(S);g=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,g),r.bufferData(r.ARRAY_BUFFER,y,r.STATIC_DRAW),g.componentType=r.FLOAT,g.componentsPerAttribute=P,this.resourceManager.setResource(d.semantics[h].id,g),d.semantics[h]={id:d.semantics[h].id,count:l,byteStride:4*P}}}l=i,previousBuffer=r.getParameter(r.ARRAY_BUFFER_BINDING),g=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,g),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW),g.componentType=r.FLOAT,g.componentsPerAttribute=3,this.resourceManager.setResource(d.semantics.POSITION.id,g),d.semantics.POSITION={id:d.semantics.POSITION.id,count:l,byteStride:12},null!=s&&(g=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,g),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW),g.componentType=r.FLOAT,g.componentsPerAttribute=3,this.resourceManager.setResource(d.semantics.NORMAL.id,g),d.semantics.NORMAL={id:d.semantics.NORMAL.id,count:l,byteStride:12}),r.bindBuffer(r.ARRAY_BUFFER,previousBuffer)}},vertexAttributeBufferDelegate:{value:{_componentTypeForGLType:function(e,i){switch(i){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:return e.FLOAT;case e.UNSIGNED_BYTE:return e.UNSIGNED_BYTE;case e.UNSIGNED_SHORT:return e.UNSIGNED_SHORT;default:return null}},_componentsPerElementForGLType:function(e,i){switch(i){case e.FLOAT:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:return 4;default:return null}},webGLContext:{value:null,writable:!0},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i,t){var s=e,a=t,u=a.getParameter(a.ARRAY_BUFFER_BINDING),n=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,i,a.STATIC_DRAW),n.componentType=this._componentTypeForGLType(a,s.type),n.componentsPerAttribute=this._componentsPerElementForGLType(a,s.type),a.bindBuffer(a.ARRAY_BUFFER,u),n},resourceAvailable:function(){}}},textureDelegate:{value:{getGLFilter:function(e){return null==e?WebGLRenderingContext.LINEAR:e},getGLWrapMode:function(e){return null==e?WebGLRenderingContext.REPEAT:e},handleError:function(e,i){console.log("ERROR:textureDelegate:"+e+" :"+i)},nextHighestPowerOfTwo:function(e){--e;for(var i=1;32>i;i<<=1)e|=e>>i;return e+1},isPowerOfTwo:function(e){return 0==(e&e-1)},installCubemapSide:function(e,i,t,s){e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.texImage2D(i,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},createTextureFromImageAndSampler:function(e,i,t){var s=t.getParameter(t.ACTIVE_TEXTURE),a=t.getParameter(t.TEXTURE_BINDING_2D);t.activeTexture(t.TEXTURE0);var u=null,n=this.getGLFilter(i.minFilter),r=this.getGLFilter(i.magFilter),l=this.getGLWrapMode(i.wrapS),o=this.getGLWrapMode(i.wrapT),c=!1,m=n===t.NEAREST_MIPMAP_NEAREST||n===t.LINEAR_MIPMAP_NEAREST||n===t.NEAREST_MIPMAP_LINEAR||n===t.LINEAR_MIPMAP_LINEAR;if(m||l===t.REPEAT||o===t.REPEAT){var d=parseInt(e.width),p=parseInt(e.height);if(this.isPowerOfTwo(d)||(d=this.nextHighestPowerOfTwo(d),c=!0),this.isPowerOfTwo(p)||(p=this.nextHighestPowerOfTwo(p),c=!0),c){u=document.createElement("canvas"),u.width=d,u.height=p;var v=u.getContext("2d");v.drawImage(e,0,0,parseInt(u.width),parseInt(u.height)),u.id=e.id,e=u}}var g=t.createTexture();return g.contextID=t.contextID,t.bindTexture(t.TEXTURE_2D,g),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),m&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,a),t.activeTexture(s),g},convert:function(e,i,t){var s=t;if(e){if(6===e.length){var a=s.createTexture();return s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_POSITIVE_X,a,e[0]),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_NEGATIVE_X,a,e[1]),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_POSITIVE_Y,a,e[2]),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,a,e[3]),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_POSITIVE_Z,a,e[4]),this.installCubemapSide(s,s.TEXTURE_CUBE_MAP_NEGATIVE_Z,a,e[5]),a}}else if("video"==e.type){i.source.videoElement=e;var u=s.createTexture();return s.bindTexture(s.TEXTURE_2D,u),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,i.source.videoElement),s.bindTexture(s.TEXTURE_2D,null),u}return this.createTextureFromImageAndSampler(e,i.sampler,s)},resourceAvailable:function(){}}},_lastMaxEnabledArray:{value:0,writable:!0},_states:{value:null,writable:!0},setState:{value:function(e,i,t){var s=this.webGLContext;(null==this._states[e]||1==t||this._states[e]!==i)&&(this._states[e]=i,i?s.enable(e):s.disable(e))}},resetStates:{value:function(){var e=this.webGLContext;if(e&&-1!==this._lastMaxEnabledArray)for(var i=0;this._lastMaxEnabledArray>i;i++)e.disableVertexAttribArray(i);this._lastMaxEnabledArray=-1,this.bindedProgram=null,this.setState(e.BLEND,!1)}},renderPrimitive:{value:function(e,i,t,s){var a=!1,u=null,n=e.primitive;e.node&&e.node.instanceSkin&&e.node.instanceSkin.skin.process(e.node,this.resourceManager);var r,l=-1,o=this.webGLContext,c=this.bindedProgram,m=0;s||(s=n.material.parameters);var d=c.uniformSymbols;for(r=0;d.length>r;r++){var p=d[r],v=i.instanceProgram.uniforms[p];if(u=null,v=s[v],v&&null!=v.semantic){var g=e.nodeWrapper;v.source&&(g=e.nodeWrapper.scenePassRenderer._nodeWrappers[v.source.id]);var h=v.semantic;h===this.PROJECTION?u=this.projectionMatrix:h===this.MODELVIEW?u=g.worldViewMatrix:h===this.MODELVIEWINVERSETRANSPOSE?u=g.worldViewInverseTransposeMatrix:h===this.MODELVIEWINVERSE&&(u=g.worldViewInverseMatrix)}if(null==u&&null!=v)if(v.source&&null==h){var g=e.nodeWrapper.scenePassRenderer._nodeWrappers[v.source.id];u=g.worldViewMatrix}else u=v.value;var f=null;if(null!=u){var b=c.getTypeForSymbol(p),q=b===o.SAMPLER_CUBE,S=b===o.SAMPLER_2D;if(q){if(f=this.resourceManager.getResource(u,this.textureDelegate,this.webGLContext)){o.activeTexture(o.TEXTURE0+m),o.bindTexture(o.TEXTURE_CUBE_MAP,f);var y=c.getLocationForSymbol(p);void 0!==y&&(c.setValueForSymbol(p,m),m++)}}else if(S){if(f=this.resourceManager.getResource(u,this.textureDelegate,this.webGLContext),null!=f){o.activeTexture(o.TEXTURE0+m),o.bindTexture(o.TEXTURE_2D,f),v.value.source.videoElement&&v.value.source.timeStamp!=t&&(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,v.value.source.videoElement),v.value.source.timeStamp=t);var y=c.getLocationForSymbol(p);void 0!==y&&(c.setValueForSymbol(p,m),m++)}}else c.setValueForSymbol(p,u)}}c.commit(o);var _=0,P=i.instanceProgram.attributes,C=c.attributeSymbols;for(r=0;C.length>r;r++){var p=C[r],v=P[p];v=s[v];var h=v.semantic,N=n.semantics[h],D=null;if(D=e.compressed?this.resourceManager._getResource(N.id):this.resourceManager.getResource(N,this.vertexAttributeBufferDelegate,this.webGLContext)){o.bindBuffer(o.ARRAY_BUFFER,D);var M=c.getLocationForSymbol(p);void 0!==M&&(M>l&&(l=M),o.enableVertexAttribArray(M),o.vertexAttribPointer(M,D.componentsPerAttribute,D.componentType,!1,N.byteStride,0),a&&"POSITION"==h&&o.drawArrays(o.POINTS,0,N.count)),_++}else this._lastMaxEnabledArray=-1}var A=_===C.length;if(!a){if(A)for(var r=l+1;this._lastMaxEnabledArray>r;r++)o.disableVertexAttribArray(r);var E=null;E=e.compressed?this.resourceManager._getResource(n.indices.id):this.resourceManager.getResource(n.indices,this.indicesDelegate,this.webGLContext),E&&A&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,E),o.drawElements(o.TRIANGLES,n.indices.count,o.UNSIGNED_SHORT,0))}return this._lastMaxEnabledArray=l,A}},programDelegate:{value:{handleError:function(e,i){console.log("ERROR:programDelegate:"+e+" :"+i)},convert:function(e,i,s){var a=s,u=Object.create(t);return u.initWithShaders(i),u.build(a)||(console.log(i),console.log(u.errorLogs)),u},resourceAvailable:function(){}}},bindRenderTarget:{value:function(e){var i=this.webGLContext,t=e.FBO?!1:!0;e.previousFBO=i.getParameter(i.FRAMEBUFFER_BINDING),e.FBO||(e.FBO=i.createFramebuffer(),t=!0),i.bindFramebuffer(i.FRAMEBUFFER,e.FBO);var s=e.extras,a=i.drawingBufferWidth!=e.width||i.drawingBufferHeight!=e.height,u=i.drawingBufferWidth,n=i.drawingBufferHeight;(t||a)&&e.attachments.forEach(function(e){if("COLOR_ATTACHMENT0"==e.semantic&&s.picking){var r=i.getParameter(i.TEXTURE_BINDING_2D);t&&(s.pickingTexture=i.createTexture()),a&&(i.bindTexture(i.TEXTURE_2D,s.pickingTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,u,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),t&&i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s.pickingTexture,0),i.bindTexture(i.TEXTURE_2D,r)}if("DEPTH_ATTACHMENT"==e.semantic&&s.picking){var l=i.getParameter(i.RENDERBUFFER_BINDING);t&&(s.pickingRenderBuffer=i.createRenderbuffer()),a&&(i.bindRenderbuffer(i.RENDERBUFFER,s.pickingRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,u,n)),t&&i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,s.pickingRenderBuffer),i.bindRenderbuffer(i.RENDERBUFFER,l)}},this),i.clearColor(0,0,0,1),i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT)}},unbindRenderTarget:{value:function(e){var i=this.webGLContext;e.extras.picking&&(e.extras.pickedPixel||(e.extras.pickedPixel=new Uint8Array(4)),i.finish(),i.readPixels(e.extras.coords[0],e.extras.coords[1],1,1,i.RGBA,i.UNSIGNED_BYTE,e.extras.pickedPixel)),i.bindFramebuffer(i.FRAMEBUFFER,e.previousFBO);var t=!1;t&&e.attachments.forEach(function(i){"COLOR_ATTACHMENT0"===i.semantic&&e.extras.picking&&this.drawTexture(e.extras.pickingTexture)},this)}},renderPrimitivesWithPass:{value:function(e,i,t,s,a){var u=e.length,n=this.webGLContext;if(i.instanceProgram){var r=n,l=this.resourceManager.getResource(i.instanceProgram.program,this.programDelegate,r);if(l){var o=0,c=1,m=1,d=1,p=i.states,v=n.FUNC_ADD,g=n.SRC_ALPHA,h=n.ONE_MINUS_SRC_ALPHA,f="__PickingPass"===i.id;if(p&&(null!=p.blendEnable&&(o=p.blendEnable),null!=p.depthTestEnable&&(c=p.depthTestEnable),null!=p.depthMask&&(m=p.depthMask),null!=p.cullFaceEnable&&(d=p.cullFaceEnable),null!=p.blendEquation)){var b=p.blendFunc;
null!=b&&(null!=b.sfactor&&(g=b.sfactor),null!=b.dfactor&&(h=b.dfactor))}if(this.setState(n.DEPTH_TEST,c),this.setState(n.CULL_FACE,d),n.enable(n.SAMPLE_ALPHA_TO_COVERAGE),n.depthMask(m),this.setState(n.BLEND,o),1===o&&(n.blendEquation(v),n.blendFunc(g,h)),this.bindedProgram=l,f)for(var q=0;u>q;q++){var S=e[q];if(!S.node.hidden){if(!S.pickingColor)if("node"===a){var y=S.node.baseId;if(y){var _=i.extras.nodeIDToColor[y];_||(_=vec4.createFrom(Math.random(),Math.random(),Math.random(),1),i.extras.nodeIDToColor[y]=_),S.pickingColor=_}}else if("material"===a){var P=S.primitive.material.baseId;if(P){var C=i.extras.materialIDToColor[P];C||(C=vec4.createFrom(Math.random(),Math.random(),Math.random(),1),i.extras.materialIDToColor[P]=C),S.pickingColor=C}}this.bindedProgram.setValueForSymbol("u_pickingColor",S.pickingColor),this.renderPrimitive(S,i,s,t)}}else for(var q=0;u>q;q++){var S=e[q];if(!S.node.hidden){var N=1;t=S.primitive.material.parameters;var D=t.transparency;D&&null!=D.value&&(N*=D.value);var M=t.filterColor;M&&null!=M.value&&(N*=M.value[3]),1e-5>N||(1>N&&!o?(this.setState(n.BLEND,!0),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.renderPrimitive(S,i,s),this.setState(n.BLEND,!1)):this.renderPrimitive(S,i,s))}}}}}},_BBOXProgram:{value:null,writable:!0},drawBBOX:{value:function(e,i,s,a){if(null!=e){var u=this.webGLContext;if(this.bindedProgram=null,this.setState(u.CULL_FACE,!1),!this._BBOXProgram){this._BBOXProgram=Object.create(t);var n="precision highp float;attribute vec3 vert;uniform mat4 u_projMatrix; uniform mat4 u_vMatrix; uniform mat4 u_mMatrix; void main(void) { gl_Position = u_projMatrix * u_vMatrix * u_mMatrix * vec4(vert,1.0); }",r="precision highp float;uniform float u_transparency;  void main(void) {  gl_FragColor = vec4(vec3(1.,1.,1.) , u_transparency);}";this._BBOXProgram.initWithShaders({"x-shader/x-vertex":n,"x-shader/x-fragment":r}),this._BBOXProgram.build(u)||console.log(this._BBOXProgram.errorLogs)}var l=[e[0][0],e[0][1],e[0][2]],o=[e[1][0],e[1][1],e[1][2]],c=0,m=1,d=2;if(!this._BBOXIndices){var p=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,3,7,2,6,0,4,1,5];this._BBOXIndices=u.createBuffer(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this._BBOXIndices),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),u.STATIC_DRAW)}u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this._BBOXIndices),this._BBOXVertexBuffer||(this._BBOXVertexBuffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this._BBOXVertexBuffer)),u.bindBuffer(u.ARRAY_BUFFER,this._BBOXVertexBuffer);var v=[o[c],l[m],l[d],o[c],o[m],l[d],l[c],o[m],l[d],l[c],l[m],l[d],o[c],l[m],o[d],o[c],o[m],o[d],l[c],o[m],o[d],l[c],l[m],o[d]];u.bufferData(u.ARRAY_BUFFER,new Float32Array(v),u.STATIC_DRAW);var g=this._BBOXProgram.getLocationForSymbol("vert");null!=g&&(u.enableVertexAttribArray(g),u.vertexAttribPointer(g,3,u.FLOAT,!1,12,0)),this.bindedProgram=this._BBOXProgram;var h=this._BBOXProgram.getLocationForSymbol("u_projMatrix");h&&this._BBOXProgram.setValueForSymbol("u_projMatrix",a);var f=this._BBOXProgram.getLocationForSymbol("u_mMatrix");f&&this._BBOXProgram.setValueForSymbol("u_mMatrix",s);var b=this._BBOXProgram.getLocationForSymbol("u_vMatrix");b&&this._BBOXProgram.setValueForSymbol("u_vMatrix",i);var q=this._BBOXProgram.getLocationForSymbol("u_transparency");q&&this._BBOXProgram.setValueForSymbol("u_transparency",1),this._BBOXProgram.commit(u),u.drawElements(u.LINES,24,u.UNSIGNED_SHORT,0),u.disableVertexAttribArray(g),this.setState(u.BLEND,!1),this.setState(u.CULL_FACE,!0)}}},drawTexture:{value:function(e){var i=this.webGLContext,s=i.isEnabled(i.DEPTH_TEST),a=i.isEnabled(i.CULL_FACE),u=i.isEnabled(i.BLEND);if(this.setState(i.DEPTH_TEST,0),this.setState(i.CULL_FACE,0),this.setState(i.BLEND,0),!this.displayTexture){this.displayTexture={},this.displayTexture.program=Object.create(t);var n="precision highp float;attribute vec3 vert;attribute vec2 uv;uniform mat4 u_projMatrix; varying vec2 v_uv;void main(void) { v_uv = uv;gl_Position = u_projMatrix * vec4(vert,1.0); }",r="precision highp float;uniform sampler2D u_texture;varying vec2 v_uv; void main(void) {  vec4 color = texture2D(u_texture, v_uv);  gl_FragColor = color; }";this.displayTexture.program.initWithShaders({"x-shader/x-vertex":n,"x-shader/x-fragment":r}),this.displayTexture.program.build(i)||console.log(this.displayTexture.program.errorLogs);var l=[-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,-1,1,0,0,1,1,-1,0,1,0,1,1,0,1,1];this.displayTexture.vertexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.displayTexture.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(l),i.STATIC_DRAW)}var o=this.displayTexture.program,c=this.displayTexture.vertexBuffer;i.bindBuffer(i.ARRAY_BUFFER,c);var m=mat4.ortho(-1,1,-1,1,0,1e3),d=o.getLocationForSymbol("vert"),p=void 0!==d;p&&(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,3,i.FLOAT,!1,20,0));var v=o.getLocationForSymbol("uv"),g=void 0!==v;g&&(i.enableVertexAttribArray(v),i.vertexAttribPointer(v,2,i.FLOAT,!1,20,12));var h=i.getParameter(i.TEXTURE_BINDING_2D);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),this.bindedProgram=o;var f=o.getLocationForSymbol("u_projMatrix");f&&o.setValueForSymbol("u_projMatrix",m);var b=o.getLocationForSymbol("u_texture");b&&o.setValueForSymbol("u_texture",0),o.commit(i),i.drawArrays(i.TRIANGLES,0,6),i.bindTexture(i.TEXTURE_2D,h),p&&i.disableVertexAttribArray(d),g&&i.disableVertexAttribArray(v),this.setState(i.DEPTH_TEST,s),this.setState(i.CULL_FACE,a),this.setState(i.BLEND,u)}}})}}),montageDefine("83b66f4","runtime/helpers/resource-manager",{dependencies:[],factory:function(e,i){var t=Object.create(Object,{kind:{value:"multi-parts",writable:!0},range:{value:null,writable:!0},_requests:{value:null,writable:!0},requests:{get:function(){return this._requests},set:function(e){this._requests=e}},canMergeRequest:{value:function(e,i){var t=e.range[1]-e.range[0],s=this.range[1]-this.range[0];return t+s>i?!1:(e.range[0]===this.range[1]||e.range[1]===this.range[0])&&e.type===this.type}},mergeRequest:{value:function(e){0===this.requests.length?(this.requests.push(e),this.range=[e.range[0],e.range[1]]):e.range[0]===this.range[1]?(this.requests.push(e),this.range[1]=e.range[1]):e.range[1]===this.range[0]?(this.requests.unshift(e),this.range[0]=e.range[0]):console.log("ERROR: should not reach")}},mergeRequests:{value:function(e){if(this.range)if(e[0].range[1]<this.range[0])for(var i=e.length-1;i>=0;i--)this.mergeRequest(e[i]);else for(var i=0;e.length>i;i++)this.mergeRequest(e[i]);else e.forEach(function(e){this.mergeRequest(e)},this)}},id:{value:null,writable:!0},initWithRequests:{value:function(e){return this.requests=[],this.mergeRequests(e),this.id=e[0].id,this}}}),s=Object.create(Object,{_content:{value:null,writable:!0},content:{get:function(){return this._content},set:function(e){this._content=e}},_parent:{value:null,writable:!0},parent:{get:function(){return this._parent},set:function(e){this._parent=e}},_left:{value:null,writable:!0},left:{get:function(){return this._left},set:function(e){this._left=e}},_right:{value:null,writable:!0},right:{get:function(){return this._right},set:function(e){this._right=e}},_checkConsistency:{value:function(e){e.length>=50||(this.left&&this.left._checkConsistency(e),e.push(this.content.range),this.right&&this.right._checkConsistency(e))}},checkConsistency:{value:function(){var e=[];if(this._checkConsistency(e),e.length>1)for(var i=0;e.length-1>i;i++){var t=e[0],s=e[1];t[1]<=s[0]||console("ERROR: INCONSISTENCY CHECK Failed, ranges are not ordered in btree")}}},_collect:{value:function(e,i){this.left&&this.left._collect(e,i),e.length>=i||(e.push(this),this.right&&this.right._collect(e,i))}},collect:{value:function(e){var i=[];return this._collect(i,e),i}},insert:{value:function(e,i){if(e.range[1]<=this.content.range[0]){if(e.range[1]===this.content.range[0])return"multi-parts"===e.kind?this.content.mergeRequests(e.requests):this.content.mergeRequests(e),this.left&&this.content.canMergeRequest(this.left.content,i)&&(this.content.mergeRequests(this.left.content._requests),this.left.remove(this.left.content)),this.parent&&this.parent.content.canMergeRequest(this.content,i)&&(this.parent.content.mergeRequests(this.content._requests),this.remove(this.content)),null;if(this.left)return this.left.insert(e,i);var t=Object.create(s);return t.parent=this,t.content=e,this.left=t,t}if(e.range[0]>=this.content.range[1]){if(e.range[0]===this.content.range[1])return"multi-parts"===e.kind?this.content.mergeRequests(e.requests):this.content.mergeRequests(e),this.right&&this.content.canMergeRequest(this.right.content,i)&&(this.content.mergeRequests(this.right.content._requests),this.right.remove(this.right.content)),this.parent&&this.parent.content.canMergeRequest(this.content,i)&&(this.parent.content.mergeRequests(this.content._requests),this.remove(this.content)),null;if(this.right)return this.right.insert(e,i);var t=Object.create(s);return t.parent=this,t.content=e,this.right=t,t}console.log("ERROR: should not reach")}},contains:{value:function(e){return this.node===e?!0:this.left&&this.left.contains(e)?!0:this.right&&this.right.contains(e)?!0:!1}},min:{value:function(){for(var e=this;e.left;)e=e.left;return e}},_updateParentWithNode:{value:function(e){this.parent&&(this===this.parent.left?this.parent.left=e:this.parent.right=e),e&&(e.parent=this.parent)}},removeMin:{value:function(){this.parent;for(var e=this;e.left||e.right;)e.left&&(e=e.min()),e.right&&(e=e.right.min());return e._updateParentWithNode(null),e}},remove:{value:function(e){if(e.range[1]<=this.content.range[0])this.left.remove(e);else if(e.range[0]>=this.content.range[1])this.right.remove(e);else if(e===this.content)if(this.left&&this.right){var i=this.right.min();this.content=i.content,i._updateParentWithNode(i.right)}else this.left||this.right?this.left?this._updateParentWithNode(this.left):this._updateParentWithNode(this.right):this._updateParentWithNode(null)}}});i.WebGLTFResourceManager=Object.create(Object,{MISSING_DESCRIPTION:{value:"MISSING_DESCRIPTION"},INVALID_PATH:{value:"INVALID_PATH"},INVALID_TYPE:{value:"INVALID_TYPE"},XMLHTTPREQUEST_STATUS_ERROR:{value:"XMLHTTPREQUEST_STATUS_ERROR"},NOT_FOUND:{value:"NOT_FOUND"},_resources:{value:null,writable:!0},_requestTrees:{value:null,writable:!0},requestTrees:{get:function(){return this._requestTrees}},_resourcesStatus:{value:null,writable:!0},_resourcesBeingProcessedCount:{value:0,writable:!0},_observers:{value:null,writable:!0},_maxConcurrentRequests:{value:1,writable:!0},observers:{get:function(){return this._observers},set:function(e){this._observers=e}},maxConcurrentRequests:{get:function(){return this._maxConcurrentRequests},set:function(e){this._maxConcurrentRequests=e}},reset:{value:function(){if(this._resourcesStatus){var e=Object.keys(this._resourcesStatus);e.forEach(function(e){var i=this._resourcesStatus[e];i&&i.xhr&&i.xhr.abort()},this)}var i=Object.keys(this._resources);i.forEach(function(e){var i=this._resources[e];i&&"VIDEO"===i.nodeName&&i.pause()},this),this._resources={},this._requestTrees={},this._resourcesStatus={},this._resourcesBeingProcessedCount=0,this._wholeBuffers={}}},_bytesLimit:{value:5e5,writable:!0},bytesLimit:{get:function(){return this._bytesLimit},set:function(e){this._bytesLimit!==e&&(this._bytesLimit=e)}},_containsResource:{enumerable:!1,value:function(e){return this._resources[e]?!0:!1}},init:{value:function(){this._requestTrees={},this._resources={},this._resourcesStatus={},this._observers=[],this._resourcesBeingProcessedCount=0}},_storeResource:{enumerable:!1,value:function(e,i){return e?(this._containsResource[e]&&console.log("WARNING: resource:"+e+" is already stored, overriding"),this._resources[e]=i,void 0):(console.log("ERROR: entry does not contain id, cannot store"),void 0)}},_getResource:{enumerable:!1,value:function(e){return this._resources[e]}},_loadResource:{value:function(e,i){var t,s=this,a=e.path;if("multi-parts"===e.kind?(t=e.requests[0].type,a=e.requests[0].path):(t=e.type,a=e.path),!t)return i.handleError(WebGLTFResourceManager.INVALID_TYPE,null),void 0;if(!a)return i.handleError(WebGLTFResourceManager.INVALID_PATH),void 0;var u=new XMLHttpRequest;if(u.open("GET",a,!0),u.responseType=t,e.range){var n="bytes="+e.range[0]+"-"+(e.range[1]-1);u.setRequestHeader("Range",n)}u.onload=function(){200==this.status||206==this.status?(s._resourcesBeingProcessedCount--,"multi-parts"===e.kind?e.requests.forEach(function(t){var a=this.response.slice(t.range[0]-e.range[0],t.range[1]-e.range[0]);i.resourceAvailable(s,t,a)},this):i.resourceAvailable(s,e,this.response)):i.handleError(WebGLTFResourceManager.XMLHTTPREQUEST_STATUS_ERROR,this.status)},u.send(null);var r=this._resourcesStatus[e.id];r&&(r.xhr=u)}},_processNextResource:{value:function(e){if(e){var i=!e.left&&!e.right;if(i)return this._handleRequest(e.content),!1;var t=e.removeMin();this._handleRequest(t.content)}return!0}},_observingEnabled:{value:!1,writable:!0},isObserving:{value:function(){return this._observingEnabled}},startObserving:{value:function(){this._observingEnabled=!0}},stopObserving:{value:function(){this._observingEnabled=!1}},fireResourceAvailable:{value:function(e){this._observingEnabled&&this.observers&&this.observers.forEach(function(i){i.resourceAvailable&&i.resourceAvailable(e)},this)}},send:{value:0,writable:!0},requested:{value:0,writable:!0},_handleRequest:{value:function(e){var i=this._resourcesStatus[e.id],a=null,u=null,n=this.requestTrees?this.requestTrees[e.path]:null;if(i){if("loading"===i.status)return;a=i.node,u=i.status}if("arraybuffer"!==e.type){var r=this,l={};"multi-parts"===e.kind?e.requests.forEach(function(e){this._resourcesStatus[e.id]={status:"loading"}},this):this._resourcesStatus[e.id]={status:"loading"},l.resourceAvailable=function(e,i,t){var s=i.delegate.convert(i,t,i.ctx);if(r._storeResource(i.id,s),i.delegate.resourceAvailable(s,i.ctx),delete r._resourcesStatus[i.id],r.fireResourceAvailable.call(r,i.id),r._resourcesBeingProcessedCount<r.maxConcurrentRequests){var a=e.requestTrees?e.requestTrees[i.path]:null;r._processNextResource(a)||a&&delete e.requestTrees[i.path]}},l.handleError=function(i,t){e.delegate.handleError(i,t)},r._resourcesBeingProcessedCount++,this._loadResource(e,l)}else if(!u){var o,c=null;if(o="multi-parts"===e.kind?Object.create(t).initWithRequests(e.requests):Object.create(t).initWithRequests([e]),n)c=n.insert(o,this.bytesLimit);else{var m=Object.create(s);m.content=o,this._requestTrees[e.path]=m,n=m,c=m}"multi-parts"===e.kind?e.requests.forEach(function(e){this._resourcesStatus[e.id]={status:"queued",node:c}},this):this._resourcesStatus[e.id]={status:"queued",node:c}}}},_elementSizeForGLType:{value:function(e){switch(e){case WebGLRenderingContext.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC2:return 2*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC3:return 3*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC4:return 4*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_MAT4:return 16*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_MAT3:return 9*Float32Array.BYTES_PER_ELEMENT;default:return null}}},_allowRangedRequests:{value:!1,writable:!1},_wholeBuffers:{value:null,writable:!0},_handleWrappedBufferViewResourceLoading:{value:function(e,i,t){var s="arraybuffer",a=e.bufferView;if(a){var u=a.buffer,n=e.byteOffset+a.description.byteOffset,r=[n,this._elementSizeForGLType(e.type)*e.count+n];u.description&&u.description.type&&(s=u.description.type);var l={source:e,id:e.id,range:r,type:s,path:u.description.path,delegate:i,ctx:t,kind:"single-part"}}if(this._allowRangedRequests)this._handleRequest(l,null);else{this._wholeBuffers||(this._wholeBuffers={});var a=e.bufferView;if(a){var o=this,u=a.buffer,c=this._wholeBuffers[u.id];if(null==c){var m={};m.resourceAvailable=function(e,i,t){var s=o._wholeBuffers[i.id];e._storeResource(i.id,t),s.pendingRequests&&(s.pendingRequests.forEach(function(i){delete o._resourcesStatus[i.id];var s=t.slice(i.range[0],i.range[1]),a=i.delegate;if(null==this._resources[i.id]){var u=a.convert(i.source,s,i.ctx);e._storeResource(i.id,u),a.resourceAvailable(u,i.ctx)}o.fireResourceAvailable.call(o,i.id)},o),s.pendingRequests=[])},m.handleError=function(){};var d={id:u.id,type:s,path:u.description.path,delegate:i,ctx:t,kind:"single-part"};o._resourcesBeingProcessedCount++,this._loadResource(d,m),c={activeRequest:"bufferRequest",pendingRequests:[]},this._wholeBuffers[u.id]=c}else{var p=this._getResource(u.id);if(p){var v=p.slice(l.range[0],l.range[1]),i=l.delegate,g=i.convert(e,v,l.ctx);return o._storeResource(l.id,g),i.resourceAvailable(g,l.ctx),o.fireResourceAvailable.call(o,l.id),void 0}}var h=this._resourcesStatus[l.id];if(h&&"loading"===h.status)return;c.pendingRequests.push(l),this._resourcesStatus[l.id]={status:"loading"}}}}},shaderDelegate:{value:{handleError:function(e,i){console.log("ERROR:shaderDelegate:"+e+" :"+i)},convert:function(e,i){return i},resourceAvailable:function(e,i){if(i.sources[i.stage]=e,i.sources["x-shader/x-fragment"]&&i.sources["x-shader/x-vertex"]){var t=i.programCtx.delegate,s=t.convert(null,i.sources,i.programCtx.ctx);i.programCtx.resourceManager._storeResource(i.programCtx.id,s),t.resourceAvailable(s,i.programCtx.ctx),i.programCtx.resourceManager.fireResourceAvailable.call(i.programCtx.resourceManager,i.programCtx.id)}}}},_handleProgramLoading:{value:function(e,i,t){var s={delegate:i,ctx:t,resourceManager:this,id:e.id},a={},u={stage:"x-shader/x-fragment",sources:a,programCtx:s},n={stage:"x-shader/x-vertex",sources:a,programCtx:s};this.getResource(e["x-shader/x-fragment"],this.shaderDelegate,u),this.getResource(e["x-shader/x-vertex"],this.shaderDelegate,n)}},_handleShaderLoading:{value:function(e,i,t){this._handleRequest({id:e.id,type:"text",path:e.description.path,delegate:i,ctx:t,kind:"single-part"},null)}},_handleVideoLoading:{value:function(e,i,t){var s=this._resourcesStatus[e.id];if(!s||"loading"!==s.status){this._resourcesStatus[e.id]={status:"loading"};var a=this;if(e.description.path){this._resourcesBeingProcessedCount++;var u=document.createElement("video");u.preload="auto",u.loop="loop",u.addEventListener("canplaythrough",function(){a._resourcesBeingProcessedCount--,u.play(),delete a._resourcesStatus[e.id],a._storeResource(e.id,u),i(u,e.id,t)}),u.src=e.description.path}}}},_handleImageLoading:{value:function(e,i,t,s){var a=this._resourcesStatus[e.id];if(!a||"loading"!==a.status){this._resourcesStatus[e.id]={status:"loading"};var u=this;if(e.description.path){this._resourcesBeingProcessedCount++;var n=new Image;n.onload=function(){u._resourcesBeingProcessedCount--,delete u._resourcesStatus[e.id],u._storeResource(e.id,n),i(n,e.id,t,s)},n.src=e.description.path}else e.description.image&&i(e.description.image,e.id,t,s)}}},_handleTextureLoading:{value:function(e,i,t){var s=this._resourcesStatus[e.id];if(!s||"loading"!==s.status){this._resourcesStatus[e.id]={status:"loading"};var a=this;if(e.source)"image"===e.source.type&&this._handleImageLoading(e.source,function(t,s,u){var n=i.convert(t,e,u);delete a._resourcesStatus[e.id],a._storeResource(e.id,n),i.resourceAvailable(n,u),a.fireResourceAvailable.call(a,e.id)},t),"video"===e.source.type&&this._handleVideoLoading(e.source,function(t,s,u){var n=i.convert(t,e,u);delete a._resourcesStatus[e.id],a._storeResource(e.id,n),i.resourceAvailable(n,u),a.fireResourceAvailable.call(a,e.id)},t);else if(e.sources){var u=0,n=[null,null,null,null,null,null],r=0;e.sources.forEach(function(s){"image"===s.type&&this._handleImageLoading(s,function(t,s,r,l){if(u++,n[l]=t,u==e.sources.length){var o=i.convert(n,e,r);delete a._resourcesStatus[e.id],a._storeResource(e.id,o),i.resourceAvailable(o,r),a.fireResourceAvailable.call(a,e.id)}},t,r++),"video"===s.type&&this._handleVideoLoading(s,function(t,s,l){if(u++,n[r]=t,u==e.sources.length){var o=i.convert(n,e,l);delete a._resourcesStatus[e.id],a._storeResource(e.id,o),i.resourceAvailable(o,l),a.fireResourceAvailable.call(a,e.id)}},t,r++)},this)}}}},setResource:{value:function(e,i){this._resources[e],this._resources[e]=i}},getResource:{value:function(e,i,t){var s=this._getResource(e.id);return s?s:("program"===e.type?this._handleProgramLoading(e,i,t):"shader"===e.type?this._handleShaderLoading(e,i,t):"image"===e.type?this._handleImageLoading(e,i,t):"texture"===e.type?this._handleTextureLoading(e,i,t):this._handleWrappedBufferViewResourceLoading(e,i,t),null)}},hasPendingRequests:{value:function(){return this._resourcesBeingProcessedCount>0}},removeAllResources:{value:function(){this._resources={}}}})}}),montageDefine("3c07db4","composer/translate-composer",{dependencies:["./composer","../core/event/event-manager"],factory:function(e,i){var t=e("./composer").Composer,s=e("../core/event/event-manager").defaultEventManager,a=i.TranslateComposer=t.specialize({constructor:{value:function a(){this.super()}},_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},stealChildrenPointer:{value:!1},stealChildrenPointerThreshold:{value:130},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var i=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateX&&this._minTranslateX>i&&(i=this._minTranslateX),null!==this._maxTranslateX&&i>this._maxTranslateX&&(i=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=i}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var i=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateY&&this._minTranslateY>i&&(i=this._minTranslateY),null!==this._maxTranslateY&&i>this._maxTranslateY&&(i=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=i}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateX!==e&&(null!==e&&e>this._translateX&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateX!==e&&(null!==e&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateY!==e&&(null!==e&&e>this._translateY&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateY!==e&&(null!==e&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},startTranslateSpeed:{value:500},startTranslateRadius:{value:8},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,1>this.__momentumDuration&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_start:{value:function(e,i,t,s){this.pointerStartEventPosition={pageX:e,pageY:i,target:t,timeStamp:s},this._pointerX=e,this._pointerY=i,window.Touch?(this._element.addEventListener("touchend",this,!0),this._element.addEventListener("touchcancel",this,!0),this._element.addEventListener("touchmove",this,!0),this._element.addEventListener("touchmove",this,!1)):(document.addEventListener("mouseup",this,!0),this._element.addEventListener("mousemove",this,!0)),this.isAnimating&&(this.isAnimating=!1,this._dispatchTranslateEnd()),this._isFirstMove=!0}},_observedPointer:{value:null},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&-1===a._NATIVE_ELEMENTS.indexOf(e.target.tagName)&&!e.target.isContentEditable}},handleMousedown:{value:function(e){this._observedPointer="mouse",0!==e.button||this.eventManager.componentClaimingPointer(this._observedPointer)||(this._start(e.clientX,e.clientY,e.target,e.timeStamp),this.eventManager.claimPointer(this._observedPointer,this))}},captureMousemove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(e.preventDefault(),this._isFirstMove?this._firstMove():this._move(e.clientX,e.clientY))}},captureMouseup:{value:function(e){this._end(e)}},_releaseInterest:{value:function(){window.Touch?(this._element.removeEventListener("touchend",this,!0),this._element.removeEventListener("touchcancel",this,!0),this._isFirstMove&&this._element.removeEventListener("touchmove",this,!0),this._element.removeEventListener("touchmove",this,!1)):(document.removeEventListener("mouseup",this,!0),this._isFirstMove?this._element.removeEventListener("mousemove",this,!0):document.removeEventListener("mousemove",this,!0)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},captureTouchstart:{value:function(e){this._shouldPreventDefault(e)&&e.preventDefault(),null!==this._observedPointer&&this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)||e.targetTouches&&1===e.targetTouches.length&&(this._observedPointer=e.targetTouches[0].identifier,this._start(e.targetTouches[0].clientX,e.targetTouches[0].clientY,e.targetTouches[0].target,e.timeStamp))}},captureTouchmove:{value:function(e){var i;this.stealChildrenPointer&&this._isAxisMovement(e.targetTouches[0])&&(i=e.timeStamp-this.pointerStartEventPosition.timeStamp,this.stealChildrenPointerThreshold>i&&this.eventManager.claimPointer(this._observedPointer,this))}},handleTouchmove:{value:function(e){for(var i=0,t=e.changedTouches.length;t>i&&e.changedTouches[i].identifier!==this._observedPointer;)i++;t>i&&(this._isFirstMove&&(this.eventManager.componentClaimingPointer(this._observedPointer)||this.eventManager.claimPointer(this._observedPointer,this)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._isFirstMove?this._firstMove():this._move(e.changedTouches[i].clientX,e.changedTouches[i].clientY)):this._releaseInterest())}},captureTouchend:{value:function(e){for(var i=0,t=e.changedTouches.length;t>i&&e.changedTouches[i].identifier!==this._observedPointer;)i++;t>i&&this._end(e.changedTouches[i])}},captureTouchcancel:{value:function(e){for(var i=0,t=e.changedTouches.length;t>i&&e.changedTouches[i].identifier!==this._observedPointer;)i++;t>i&&this._cancel(e.changedTouches[i])}},_isAxisMovement:{value:function(e){var i,t,s,a,u,n,r,l=e.velocity,o=.7853981633974483,c=2.356194490192345,m=-2.356194490192345,d=-.7853981633974483;if("both"===this.axis)return!0;if(!l||0===l.speed||isNaN(l.speed)?(n=this.pointerStartEventPosition.pageX-e.clientX,r=this.pointerStartEventPosition.pageY-e.clientY,u=Math.atan2(r,n)):u=l.angle,"horizontal"===this.axis){if(s=o>=u&&u>=d,a=u>=c||m>=u,s||a)return!0}else if("vertical"===this.axis&&(i=d>=u&&u>=m,t=u>=o&&c>=u,i||t))return!0;return!1}},_translateEndTimeout:{value:null},captureWheel:{value:function(){this.eventManager.componentClaimingPointer(this._WHEEL_POINTER)||this.eventManager.claimPointer(this._WHEEL_POINTER,this.component)}},handleWheel:{value:function(e){var i=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var t=this._translateY,s=e.wheelDeltaY||-e.deltaY||0;this._dispatchTranslateStart(),this.translateY=this._translateY-20*s/120,this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){i._dispatchTranslateEnd()},400),t!==this._translateY&&this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0,window.Touch?this._element.removeEventListener("touchmove",this,!0):(document.addEventListener("mousemove",this,!0),this._element.removeEventListener("mousemove",this,!0)))}},_move:{value:function(e,i){var t;this._isSelfUpdate=!0,"vertical"!==this._axis&&(t=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=t*this._pointerSpeedMultiplier),"horizontal"!==this._axis&&(t=this._invertYAxis?this._pointerY-i:i-this._pointerY,this.translateY+=t*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=i,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_bezierTValue:{value:function(e,i,t,s,a){var u,n,r,l,o=1-3*s+3*i,c=3*s-6*i,m=3*i,d=.5;for(n=0;10>n;n++)l=d*d,u=3*o*l+2*c*d+m,r=1-d,d-=(3*(r*r*d*i+r*l*s)+l*d-e)/u;return l=d*d,r=1-d,3*(r*r*d*t+r*l*a)+l*d}},_dispatchTranslateStart:{value:function(e,i){var t=document.createEvent("CustomEvent");t.initCustomEvent("translateStart",!0,!0,null),t.translateX=e,t.translateY=i,t.scroll=0,t.pointer=this._observedPointer,this.dispatchEvent(t)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e,i,t,s,a=Date.now(),u=!1;
this.animateMomentum&&(e=a-this.startTime,this.__momentumDuration>e?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=a),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=a)):this.animateMomentum=!1),i=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&a-this.startStrideXTime>0&&(a-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((a-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-e)+i*this.translateStrideX*e,u=!0):this.posX=i*this.translateStrideX),i=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&a-this.startStrideYTime>0&&(a-this.startStrideYTime<this.translateStrideDuration?(e=this._bezierTValue((a-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-e)+i*this.translateStrideY*e,u=!0):this.posY=i*this.translateStrideY),t=this.posX,s=this.posY,this._isSelfUpdate=!0,this.translateX=t,this.translateY=s,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||u,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!==this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!==this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},_cancel:{value:function(){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this.animateMomentum=!1,this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateCancel()),this._releaseInterest()}},surrenderPointer:{value:function(e,i){return!this.isMoving&&i.stealChildrenPointer&&i.stealChildrenPointerThreshold<=this.stealChildrenPointerThreshold}},eventManager:{get:function(){return s}},load:{value:function(){if(window.Touch)this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("touchstart",this,!1);else{this._element.addEventListener("mousedown",this,!1);var e;e=void 0!==window.onwheel?"wheel":"mousewheel",this._element.addEventListener(e,this,!1),this._element.addEventListener(e,this,!0)}this.eventManager.isStoringPointerEvents=!0}},addEventListener:{value:function(e,i,s){t.addEventListener.call(this,e,i,s),"translate"===e&&(this._shouldDispatchTranslate=!0)}}});a.prototype.handleMousewheel=a.prototype.handleWheel,a.prototype.captureMousewheel=a.prototype.captureWheel}}),montageDefine("83b66f4","runtime/component-3d",{dependencies:["montage","runtime/glTF-node","runtime/transform","montage/core/target","collections/set","cssom","runtime/dependencies/gl-matrix"],factory:function(e,i){var t=e("montage").Montage;e("runtime/glTF-node").glTFNode;var s=e("runtime/transform").Transform,a=e("montage/core/target").Target,u=e("collections/set");e("cssom"),e("runtime/dependencies/gl-matrix"),i.Component3D=a.specialize({_ENTER:{value:"COMPONENT_ENTER"},_EXIT:{value:"COMPONENT_EXIT"},_TOUCH_DOWN:{value:"_TOUCH_DOWN"},_TOUCH_UP:{value:"_TOUCH_UP"},self:{get:function(){return this}},constructor:{value:function(){this._hasUnresolvedId=!0,this._state=this.__STYLE_DEFAULT__,this.super()}},handleEnteredDocument:{value:function(){}},shouldPerformHitTest:{value:!1},addEventListener:{value:function(e,i,s){if(this.scene){var a=t.getInfoForObject(this).objectName;"Node"==a?this.scene.nodesShouldBeHitTested=!0:"Material"==a&&(this.scene.materialsShouldBeHitTested=!0)}this.shouldPerformHitHest=!0,this.super(e,i,s)}},_glTFElement:{value:null,writable:!0},glTFElement:{get:function(){return this._glTFElement},set:function(e){this._glTFElement=e}},_scene:{value:null,writable:!0},scene:{get:function(){return this._scene},set:function(e){this._scene=e,this._sceneDidChange()}},baseURL:{get:function(){return this.scene?this.scene.glTFElement.baseURL:null}},_isAbsolutePath:{value:function(e){var i=RegExp("^"+window.location.protocol,"i");return e.match(i)?!0:!1}},resolvePathIfNeeded:{value:function(e){return this._isAbsolutePath(e)?e:this.baseURL+e}},name:{get:function(){return this.glTFElement?this.glTFElement.name:void 0},set:function(e){this.glTFElement&&(this.glTFElement.name=e)}},_hasUnresolvedId:{value:!1,writable:!0},handleStatusChange:{value:function(e){"loaded"===e&&this._id&&(this.glTFElement=this.scene.glTFElement.ids[this._id],null==this.glTFElement&&this.scene.glTFElement.rootNode.id==this._id&&(this.glTFElement=this.scene.glTFElement.rootNode),this.glTFElement&&(this._hasUnresolvedId=!1,this.glTFElement.component3D=this,this.classListDidChange(),this.shouldPerformHitHest&&(this.scene.shouldBeHitTested=!0)))}},resolveIdIfNeeded:{value:function(){if(this._hasUnresolvedId&&null!=this.scene){if("loaded"!==this.scene.status)return this.scene.addOwnPropertyChangeListener("status",this),void 0;this._id&&this.handleStatusChange(this.scene.status,"status",this.scene)}}},_idDidChange:{value:function(){this.resolveIdIfNeeded()}},_sceneDidChange:{value:function(){this.resolveIdIfNeeded(),this.scene&&(this.scene.addEventListener("enteredDocument",this),this.scene.addEventListener("styleSheetsDidLoad",this))}},__STYLE_DEFAULT__:{value:"__default__"},_state:{value:this.__STYLE_DEFAULT__,writable:!0},_stateForSelectorName:{value:function(e){return-1!==e.indexOf(":active")?(this.scene&&(this.scene.shouldBeHitTested=!0),"active"):-1!==e.indexOf(":hover")?(this.scene&&(this.scene.shouldBeHitTested=!0),"hover"):-1!==e.indexOf(":")?null:this.__STYLE_DEFAULT__}},_style:{value:null,writable:!0},_defaultTransition:{value:{duration:0,timingFunction:"ease",delay:0}},_createDefaultStyleIfNeeded:{value:function(){return null==this._style&&(this._style={}),null==this._style.transitions&&(this._style.transitions={}),this._style}},_createStyleStateAndPropertyIfNeeded:{value:function(e,i){var t=this._createDefaultStyleIfNeeded();null==t[e]&&(t[e]={});var s=t[e];return null==s[i]&&(s[i]={}),s[i]}},_getStylePropertyObject:{value:function(e,i){return this._createStyleStateAndPropertyIfNeeded(e,i)}},_checkTransformConsistency:{value:function(e,i){return e.length!=i?(console.log("Component3D: CSS transform ignored got:"+e.length+" but expecting:"+i),!1):!0}},_createVectorFromCSSTransformOriginDeclaration:{value:function(e){var i,t=e.split(" ");return t.length>=2?(i=vec2.create(),i[0]=parseFloat(t[0]),i[1]=parseFloat(t[1]),i):vec2.createFrom(50,50)}},_createTransformFromCSS:{value:function(e){var i,t,a,u=3.1415926535,n=u/180,r=Object.create(s).init(),l=mat4.identity(),o=0;e=e.trim();for(var c,m=0,d=0,p=0,v=0,g=0;-1!==m&&(m=e.indexOf("(",o),-1!==m)&&(c=e.substring(o,m),o=m+1,m=e.indexOf(")",o),-1!==m);){for(var h=e.substring(o,m),f=-1!==h.indexOf(",")?h.split(","):[h],b=new Float32Array(f.length),q=0;f.length>q;q++)b[q]=parseFloat(f[q]);switch(o=m+1,c.trim()){case"matrix3d":if(this._checkTransformConsistency(b,16)){var S=b,y=mat4.createFrom(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15]);mat4.multiply(l,y),g++}break;case"translate3d":this._checkTransformConsistency(b,3)&&(0===v&&(r.translation=vec3.create(b)),mat4.translate(l,b),v++);break;case"translateX":this._checkTransformConsistency(b,1)&&(t=[b[0],0,0],0===v&&(r.translation=vec3.create(t)),mat4.translate(l,t),v++);break;case"translateY":this._checkTransformConsistency(b,1)&&(t=[0,b[0],0],0===v&&(r.translation=vec3.create(t)),mat4.translate(l,t),v++);break;case"translateZ":this._checkTransformConsistency(b,1)&&(t=[0,0,b[0]],0===v&&(r.translation=vec3.create(t)),mat4.translate(l,t),v++);break;case"scale3d":this._checkTransformConsistency(b,3)&&(0===d&&(r.scale=vec3.create(b)),mat4.scale(l,b),v++);break;case"scaleX":this._checkTransformConsistency(b,1)&&(a=[b[0],1,1],0===d&&(r.scale=vec3.create(a)),mat4.scale(l,a),d++);break;case"scaleY":this._checkTransformConsistency(b,1)&&(a=[1,b[0],1],0===d&&(r.scale=vec3.create(a)),mat4.scale(l,a),d++);break;case"scaleZ":this._checkTransformConsistency(b,1)&&(a=[1,1,b[0]],0===d&&(r.scale=vec3.create(a)),mat4.scale(l,a),d++);break;case"rotate3d":this._checkTransformConsistency(b,4)&&(b[3]*=n,0===p&&(r.rotation=b),mat4.rotate(l,b[3],b),p++);break;case"rotateX":this._checkTransformConsistency(b,1)&&(i=[1,0,0,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"rotateY":this._checkTransformConsistency(b,1)&&(i=[0,1,0,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"rotateZ":this._checkTransformConsistency(b,1)&&(i=[0,0,1,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"perspective":m=-1;break;default:m=-1}}return(d>1||p>1||v>1||g>0)&&(r.matrix=l),r}},_createTransitionFromComponents:{value:function(e){var i={},t=["duration","timing-function","delay"],s=["ease","linear","ease-in","ease-out","ease-in-out","step-start"],a=0;return e.forEach(function(u){var n=!1,r=a;do"duration"===t[r]?-1===s.indexOf(u)&&(n=!0,i.duration=parseFloat(u),a=r):"timing-function"===t[r]?-1!==s.indexOf(u)&&(n=!0,i.timingFunction=u,a=r):"delay"===t[r]&&r==e.length-1&&(n=!0,i.delay=parseFloat(u)),r++;while(t.length>a&&0==n)},this),null==i.duration&&(i.duration=0),null==i.timingFunction&&(i.timingFunction="ease"),null==i.delay&&(i.delay=0),i}},_applyCSSPropertyWithValueForState:{value:function(e,i,t){if(null==t||null==i)return!1;if("transition"!==i&&-1===this.styleableProperties.indexOf(i))return!1;var s=this._getStylePropertyObject(e,i);switch(i){case"transition":var a=t.split(" ");if(a.length>0){var u=a.shift();if(u=this.propertyNameFromCSS(u),-1!==this.styleableProperties.indexOf(u)&&a.length>0){var n=this._createTransitionFromComponents(a);if(null!=n){var r=this._createDefaultStyleIfNeeded();r.transitions[u]=n}}}break;case"offsetTransform":s.value="string"==typeof t?this._createTransformFromCSS(t):t;break;case"transformOrigin":s.value="string"==typeof t?this._createVectorFromCSSTransformOriginDeclaration(t):t;break;case"transformZOrigin":s.value="string"==typeof t?parseFloat(t):t;break;case"visibility":s.value=t;break;case"opacity":s.value="string"==typeof t?parseFloat(t):t;break;case"cursor":s.value=t;break;default:return!1}return!0}},propertyNameFromCSS:{value:function(e){return"-webkit-transform"===e&&(e="transform"),"-webkit-transform-origin"===e&&(e="transform-origin"),"-montage-transform-z-origin"===e&&(e="transformZOrigin"),"transform"===e&&(e="offsetTransform"),"transform-origin"===e&&(e="transformOrigin"),e}},_dumpStyle:{value:function(e){console.log("**dump style:"+e);var i=this._style[e];for(var t in i){var s=i[t];if(null!=s.value)switch(t){case"offsetTransform":console.log("property:"+t+" value:"+mat4.str(s.value.matrix));break;default:console.log("property:"+t+" value:"+s.value)}}}},_dumpAllStyles:{value:function(){console.log("******** dump styles ********");for(var e in this._style)this._dumpStyle(e)}},_applyStyleRule:{value:function(e,i){var t=this._stateForSelectorName(e),s=null;if(i.style){t===this.__STYLE_DEFAULT__&&this.styleableProperties.forEach(function(e){s=this._getStylePropertyObject(t,e),null==s.value&&this._applyCSSPropertyWithValueForState(t,e,this.initialValueForStyleableProperty(e))},this);var a=i.style.length;if(a>0){for(var u=null,n=0;a>n;n++){var r=i.style[n],l=i.style[r];r=this.propertyNameFromCSS(r),-1!=r.indexOf("transition-")?(null==u&&(u={}),u[r]=l):this._applyCSSPropertyWithValueForState(t,r,l)}if(null!=u){r="transition";var o="";null!=u["transition-property"]&&(o+=u["transition-property"],null!=u["transition-duration"]&&(o+=" ",o+=u["transition-duration"]),null!=u["transition-timing-function"]&&(o+=" ",o+=u["transition-timing-function"]),null!=u["transition-timing-delay"]&&(o+=" ",o+=u["transition-timing-delay"]),this._applyCSSPropertyWithValueForState(t,r,o))}}}}},_removeStyleRule:{value:function(e,i){if(i.style){var t=i.style.length;if(t>0)for(var s=0;t>s;s++){var a=i.style[s];i.style[a],a=this.propertyNameFromCSS(a);var u=this._stateForSelectorName(e);if(null!=u){var n=this._getStylePropertyObject(u,a);n.value=this.initialValueForStyleableProperty(a)}}}}},appliedProperties:{value:null,writable:!0},_executeStylesForState:{value:function(e){null==this.appliedProperties&&(this.appliedProperties={}),null!=this.styleableProperties&&this.styleableProperties.forEach(function(i){var t=this._getStylePropertyObject(e,i),s=!1;t&&(null!=t.value&&(s=!0,this.appliedProperties[i]!==t.value&&(this[i]=t.value,this.appliedProperties[i]=t.value)),0==s&&(t=this._getStylePropertyObject(this.__STYLE_DEFAULT__,i),null!=t.value&&(s=!0,this.appliedProperties[i]!==t.value&&(this[i]=t.value,this.appliedProperties[i]=t.value))))},this)}},_applySelectorNamed:{value:function(e){var i=this.retrieveCSSRule(e);i&&this._applyStyleRule(e,i)}},_applyClassNamed:{value:function(e){this._applySelectorNamed("."+e),this._applySelectorNamed("."+e+":hover"),this._applySelectorNamed("."+e+":active")}},_removeSelectorNamed:{value:function(e){var i=this.retrieveCSSRule(e);i&&this._removeStyleRule(e,i)}},_removeClassNamed:{value:function(e){this._removeSelectorNamed("."+e+":hover"),this._removeSelectorNamed("."+e+":active"),this._removeSelectorNamed("."+e)}},_removeSelectorsForState:{value:function(e){for(var i=this.classList.enumerate(),t=0;i.length>t;t++){var s=i[t][1];this._removeClassNamed(s,e)}}},classListDidChange:{value:function(){if(this.classList){for(var e=this.classList.enumerate(),i=0;e.length>i;i++){var t=e[i][1];this._applyClassNamed(t)}this._executeStylesForState(this._state)}}},_id:{value:null,writable:!0},id:{get:function(){return this._id},set:function(e){e!=this._id&&(this._id=e,this._idDidChange())}},initWithScene:{value:function(e){return this.scene=e,this}},_classList:{value:null},classList:{get:function(){return null==this._classList&&(this._classList=new u,this._classList.addRangeChangeListener(this,"classList")),this._classList},set:function(e){if(this._classList!==e){if(null!=this._classList&&this._classList.removeRangeChangeListener(this,"classList"),null!=e){var i=this;e instanceof Array?(this._classList=new u,e.forEach(function(e){i._classList.add(e)},this),e=this._classList):this._classList=e}this._classList.addRangeChangeListener(this,"classList"),this.classListDidChange()}}},handleClassListRangeChange:{value:function(e,i){return null!=e&&e.forEach(function(e){this._applyClassNamed(e)},this),null!=i?(i.forEach(function(e){this._removeClassNamed(e)},this),this.classListDidChange(),void 0):(this._executeStylesForState(this._state),void 0)}},cssDescriptions:{value:null,writable:!0},handleStyleSheetsDidLoad:{value:function(){this.scene.removeEventListener("styleSheetsDidLoad",this),this.classListDidChange()}},retrieveCSSRule:{value:function(e){for(var i in this.scene.styleSheets)for(var t=this.scene.styleSheets[i],s=t.cssRules,a=0;s.length>a;a++){var u=s[a];if(null!=u.selectorText&&u.selectorText===e)return u}}},handleActionOnGlTFElement:{value:function(e,i){var t=this.__STYLE_DEFAULT__;switch(i){case this._ENTER:t="hover";var s=document.createEvent("CustomEvent");s.initCustomEvent("hover",!0,!0,{glTFElement:e}),this.dispatchEvent(s);break;case this._EXIT:t=this.__STYLE_DEFAULT__;break;case this._TOUCH_DOWN:t="active";var a=document.createEvent("CustomEvent");a.initCustomEvent("action",!0,!0,{glTFElement:e}),this.dispatchEvent(a);break;case this._TOUCH_UP:t=this.__STYLE_DEFAULT__}t!==this._state&&(this._state=t,this._executeStylesForState(t))}},deserializedFromTemplate:{value:function(e,i){this.nextTarget=e,this.identifier=i}},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("83b66f4","runtime/runtime-tf-loader",{dependencies:["runtime/dependencies/gl-matrix","runtime/glTF-parser","runtime/resource-description","runtime/technique","runtime/pass","runtime/glsl-program","runtime/glTF-material","runtime/mesh","runtime/glTF-node","runtime/primitive","runtime/projection","runtime/camera","runtime/skin","runtime/glTF-scene","runtime/transform","runtime/animation","runtime/animation-manager"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/glTF-parser").glTFParser,s=e("runtime/resource-description").ResourceDescription,a=e("runtime/technique").Technique,u=e("runtime/pass").ProgramPass;e("runtime/pass").Pass,e("runtime/pass").ScenePass;var n=e("runtime/glsl-program").GLSLProgram,r=e("runtime/glTF-material").glTFMaterial,l=e("runtime/mesh").Mesh,o=e("runtime/glTF-node").glTFNode,c=e("runtime/primitive").Primitive,m=e("runtime/projection").Projection,d=e("runtime/camera").Camera,p=e("runtime/skin").Skin,v=e("runtime/glTF-scene").glTFScene,g=e("runtime/transform").Transform,h=e("runtime/animation").KeyframeAnimation,f=e("runtime/animation-manager").AnimationManager;i.RuntimeTFLoader=Object.create(t,{_materials:{writable:!0,value:null},_scenes:{writable:!0,value:null},_animations:{writable:!0,value:null},totalBufferSize:{value:0,writable:!0},handleBuffer:{value:function(e,i){var t=Object.create(s).init(e,i);return t.id=e,this.storeEntry(e,t,i),this.totalBufferSize+=i.byteLength,!0}},handleBufferView:{value:function(e,i){var t=Object.create(s).init(e,i);t.id=e;var a=this.getEntry(t.description.buffer);return i.type="ArrayBufferView",t.buffer=a,this.storeEntry(e,t,i),!0}},handleShader:{value:function(e,i){var t=Object.create(s).init(e,i);return t.id=e,t.type="shader",this.storeEntry(e,t,i),!0}},handleProgram:{value:function(e,i){var t=Object.create(s).init(e,i);t.id=e,t.type="program";var a=this.getEntry(t.description.vertexShader),u=this.getEntry(t.description.fragmentShader);return t[n.VERTEX_SHADER]=a.entry,t[n.FRAGMENT_SHADER]=u.entry,this.storeEntry(e,t,i),!0}},handleImage:{value:function(e,i){var t=i.path,a=Object.create(s).init(t,{path:t});return a.type="image",this.storeEntry(e,a,i),!0}},handleVideo:{value:function(e,i){var t=i.path,a=Object.create(s).init(t,{path:t});return a.type="video",this.storeEntry(e,a,i),!0}},handleTechnique:{value:function(e,i){var t=Object.create(a);t.id=e;var s=this.storeEntry(e,t,i),n=i.pass;t.passName=n;var r=i.passes;if(!r)return console.log("ERROR: technique does not contain pass"),!1;var l={},o=Object.keys(i.passes);return o.forEach(function(e){var i=r[e],t=i.instanceProgram;if(!t)return console.log("ERROR: A Pass with type=program must have a program property"),!1;var a=Object.create(u).init();a.id=s+"_"+n,a.instanceProgram=i.instanceProgram,a.instanceProgram.program=this.getEntry(t.program).entry,a.states=i.states,l[e]=a},this),t.parameters=i.parameters,t.passes=l,!0}},handleMaterial:{value:function(e,i){var t=Object.create(r).init(e);this.storeEntry(e,t,i);var s=i.instanceTechnique,a=s.values;t.name=i.name;var u=this.getEntry(s.technique);if(!u)return console.log("ERROR: invalid file, cannot find referenced technique:"+i.technique),!1;t.technique=u.entry;var n=t.technique.parameters;if(t.parameters=JSON.parse(JSON.stringify(n)),a){var l;for(l in a){var o=t.parameters[l];if(o)switch(o.value=a[l],o.type){case WebGLRenderingContext.SAMPLER_CUBE:case WebGLRenderingContext.SAMPLER_2D:var c=this.getEntry(o.value);c&&(o.value=c.entry);break;default:}}}return this._materials||(this._materials=[]),this._materials.push(t),!0}},handleLight:{value:function(){return!0}},handleAccessor:{value:function(e,i){i.id=e;var t=this.getEntry(i.bufferView);i.bufferView=t.entry,i.byteOffset||(i.byteOffset=0),this.storeEntry(e,i,i)}},handleMesh:{value:function(e,i){var t=Object.create(l).init();t.id=e,t.name=i.name;var s=!1,a=i.extensions;a&&(a["won-compression"]&&(s=!0,t.compression=a["won-compression"],t.compression.type="won-compression",t.compression.compressedData.bufferView=this.getEntry(t.compression.compressedData.bufferView).entry,t.compression.compressedData.id=e+"_compressedData"),a["Open3DGC-compression"]&&(s=!0,t.compression=a["Open3DGC-compression"],t.compression.type="Open3DGC-compression",t.compression.compressedData.bufferView=this.getEntry(t.compression.compressedData.bufferView).entry,t.compression.compressedData.id=e+"_compressedData")),this.storeEntry(e,t,i);var u=i[l.PRIMITIVES];if(!u)return console.log("MISSING_PRIMITIVES for mesh:"+e),!1;for(var n=0;u.length>n;n++){var r=u[n];if(r.primitive===WebGLRenderingContext.TRIANGLES){var o=Object.create(c).init(),m=this.getEntry(r.material);o.material=m.entry,t.primitives.push(o);var d=r.attributes,p=Object.keys(d);p.forEach(function(e){var i=d[e],t=this.getEntry(i);o.addVertexAttribute({semantic:e,attribute:t.entry})},this);var v=r.indices,g=this.getEntry(v);o.indices=g.entry}}return!0}},handleCamera:{value:function(e,i){var t=Object.create(d).init();t.id=e,this.storeEntry(e,t,i);var s=Object.create(m);return s.initWithDescription(i),t.projection=s,!0}},handleLight:{value:function(){return!0}},buildNodeHirerachy:{value:function(e){var i=e.entry,t=e.description.children;t&&t.forEach(function(e){var t=this.getEntry(e),s=t.entry;null==s.parent?i.children.push(s):i.children.push(s.copy()),this.buildNodeHirerachy(t)},this)}},resolveParameterSources:{value:function(){this._materials&&this._materials.forEach(function(e){if(e.parameters){var i=Object.keys(e.parameters);i.forEach(function(i){var t=e.parameters[i];t&&t.source&&(t.source=this.getEntry(t.source).entry)},this)}},this)}},buildSkeletons:{value:function(e){if(e.instanceSkin){var i=e.instanceSkin.skin;if(i){e.instanceSkin.skeletons.forEach(function(e){var t=this.getEntry(e);if(t){var s=t.entry,a=i.jointsIds,u=[];a.forEach(function(i){var t=s.nodeWithJointID(i);t?u.push(t):console.log("WARNING: jointId:"+i+" cannot be found in skeleton:"+e)},this),i.nodesForSkeleton[e]=u}},this);var t=[];e.instanceSkin.sources.forEach(function(e){var i=this.getEntry(e);i&&t.push(i.entry)},this),i.sources=t}}var s=e.children;s&&s.forEach(function(e){this.buildSkeletons(e)},this)}},handleScene:{value:function(e,i){if(this._scenes||(this._scenes=[]),!i.nodes)return console.log("ERROR: invalid file required nodes property is missing from scene"),!1;var t=Object.create(v).init();t.ids=this._ids,t.id=e,t.name=i.name,t.baseURL=this.baseURL,this.storeEntry(e,t,i);var s=Object.create(o).initWithID();return i.nodes&&i.nodes.forEach(function(e){var i=this.getEntry(e);s.children.push(i.entry),this.buildNodeHirerachy(i)},this),this.resolveParameterSources(),this.buildSkeletons(s),t.rootNode=s,this._scenes.push(t),!0}},handleSkin:{value:function(e,i){var t=Object.create(p).init();t.bindShapeMatrix=mat4.create(i.bindShapeMatrix),t.jointsIds=i.joints,t.inverseBindMatricesDescription=i.inverseBindMatrices,t.inverseBindMatricesDescription.id=e+"_inverseBindMatrices",t.inverseBindMatricesDescription.bufferView=this.getEntry(t.inverseBindMatricesDescription.bufferView).entry,this.storeEntry(e,t,i)}},handleNode:{value:function(e,i){var t=Object.create(o).init();t.id=e,t.jointId=i.jointId,t.name=i.name,this.storeEntry(e,t,i),t.transform=Object.create(g).initWithDescription(i);var s;if(i.mesh&&(s=this.getEntry(i.mesh),t.meshes.push(s.entry)),i.meshes&&i.meshes.forEach(function(e){s=this.getEntry(e),s&&t.meshes.push(s.entry)},this),i.camera){var a=this.getEntry(i.camera);a&&t.cameras.push(a.entry)}if(i.instanceSkin){i.instanceSkin.skin=this.getEntry(i.instanceSkin.skin).entry,t.instanceSkin=i.instanceSkin;var u=t.instanceSkin.sources;u&&u.forEach(function(e){s=this.getEntry(e),s&&t.meshes.push(s.entry)},this)}return!0}},handleLoadCompleted:{value:function(){if(this.delegate){var e=null;if(this._state.options&&(e=this._state.options.ids),e)e.forEach(function(e){var i=this.getEntry(e);i&&this.delegate.loadCompleted(i.entry)},this);else if(this._scenes&&this.delegate&&this._scenes.length>0){var i=Object.create(f).init();i.animations=this._animations,this._scenes[0].animationManager=i,this.delegate.loadCompleted(this._scenes[0])}}}},handleAnimation:{value:function(e,i){this._animations||(this._animations=[]);var t=Object.create(h).initWithDescription(i);t.id=e,this.storeEntry(e,t,i);var s={};Object.keys(i.parameters).forEach(function(a){var u=i.parameters[a];switch(parameterDescription=this.getEntry(u).entry,parameterDescription.type){case WebGLRenderingContext.FLOAT_VEC4:componentsPerAttribute=4;break;case WebGLRenderingContext.FLOAT_VEC3:componentsPerAttribute=3;break;case WebGLRenderingContext.FLOAT_VEC2:componentsPerAttribute=2;break;case WebGLRenderingContext.FLOAT:componentsPerAttribute=1;break;default:console.log("type:"+parameterDescription.type+" byteStride not handled")}if(parameterDescription.extensions){var n=parameterDescription.extensions;if(n){var r=n["Open3DGC-compression"];if(r){var l=r.compressedData;l&&"object"!=typeof l.bufferView&&(l.bufferView=this.getEntry(l.bufferView).entry,l.id=e+a+"_compressedData")}}}parameterDescription.byteStride=4*componentsPerAttribute,parameterDescription.componentsPerAttribute=componentsPerAttribute,parameterDescription.id=t.id+a,s[a]=parameterDescription},this),t.parameters=s,t.channels.forEach(function(e){var i=e.target.id;e.path=e.target.path,e.target=this.getEntry(i).entry},this),Object.keys(t.samplers).forEach(function(e){var a=i.samplers[e],u=t.samplers[e],n=a.input,r=a.output;u.input=s[n],u.output=s[r]},this),this._animations.push(t)}},handleTexture:{value:function(e,i){if(i.source&&i.sampler)i.type="texture",i.source=this.getEntry(i.source).entry,i.sampler=this.getEntry(i.sampler).entry,i.id=e,this.storeEntry(e,i,i);else if(i.sources&&i.sampler){i.type="texture";for(var t=0;i.sources.length>t;t++)i.sources[t]=this.getEntry(i.sources[t]).entry;i.sampler=this.getEntry(i.sampler).entry,i.id=e,this.storeEntry(e,i,i)}else console.log("ERROR: texture"+e+" must contain both source and sampler properties")}},handleSampler:{value:function(e,i){i.id=i,this.storeEntry(e,i,i)}},handleError:{value:function(){}},_delegate:{value:null,writable:!0},delegate:{enumerable:!0,get:function(){return this._delegate},set:function(e){this._delegate=e}},_entries:{enumerable:!1,value:null,writable:!0},removeAllEntries:{value:function(){this._entries={}}},containsEntry:{enumerable:!1,value:function(e){return this._entries?this._entries[e]?!0:!1:!1}},storeEntry:{enumerable:!1,value:function(e,i,t){return null==this._entries&&(this._entries={}),null==this._ids&&(this._ids={}),i.baseId=e,this._ids[e]=i,(e+=this.loaderContext())?(i.id=e,this.containsEntry[e]&&console.log("WARNING: entry:"+e+" is already stored, overriding"),this._entries[e]={id:e,entry:i,description:t},e):(console.log("ERROR: not id provided, cannot store"),void 0)}},getEntry:{enumerable:!1,value:function(e){return e+=this.loaderContext(),this._entries?this._entries[e]:null}}})}}),montageDefine("83b66f4","runtime/pass",{dependencies:["runtime/dependencies/gl-matrix","montage","runtime/glTF-node","runtime/node-wrapper","runtime/projection","runtime/camera","runtime/utilities","runtime/webgl-renderer","runtime/transform","runtime/resource-description"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage;e("runtime/glTF-node").glTFNode;var s=e("runtime/node-wrapper").NodeWrapper;e("runtime/projection").Projection,e("runtime/camera").Camera,e("runtime/utilities").Utilities,e("runtime/webgl-renderer").WebGLRenderer,e("runtime/transform").Transform,e("runtime/resource-description").ResourceDescription,Object.create(Object.prototype,{_content:{value:null,writable:!0},content:{get:function(){return this._content},set:function(e){this._content=e}},_previous:{value:null,writable:!0},previous:{get:function(){return this._previous},set:function(e){this._previous=e}},_next:{value:null,writable:!0},next:{get:function(){return this._next},set:function(e){this._next=e}},init:{value:function(e){this.content=e,this.previous=null,this.next=null}},removeFromList:{value:function(){this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous),this.next=null,this.previous=null}}}),Object.create(Object.prototype,{_tail:{value:null,writable:!0},tail:{get:function(){return this._tail},set:function(e){this._tail=e}},_head:{value:null,writable:!0},head:{get:function(){return this._head},set:function(e){this._head=e}},append:{value:function(e){this.head||(this.head=e),this.tail&&(e.previous=this.tail,this.tail.next=e),this.tail=e}},remove:{value:function(e){e.content.id;var i=!1,t=!1;this.tail===e&&(i=!0,this.tail=e.previous),this.head===e&&(t=!0,this.head=e.next)}}});var a=i.RenderTarget=Object.create(Object.prototype,{_extras:{value:null,writable:!0},_width:{value:0,writable:!0},_height:{value:0,writable:!0},_attachments:{value:null,writable:!0},attachments:{get:function(){return this._attachments},set:function(e){this._attachments=e}},init:{value:function(){return this.attachments=[],this.extras={},this}},width:{get:function(){return this._width},set:function(e){this._width=e}},height:{get:function(){return this._height},set:function(e){this._height=e}},extras:{get:function(){return this._extras},set:function(e){this._extras=e}}}),u=Object.create(Object.prototype,{_extras:{value:null,writable:!0},PROGRAM:{value:"program",writable:!1},SCENE:{value:"scene",writable:!1},_type:{value:null,writable:!0},type:{get:function(){return this._type}},extras:{get:function(){return this._extras},set:function(e){this._extras=e}}});i.ProgramPass=t.create(u,{_attributes:{value:null,writable:!0},_uniforms:{value:null,writable:!0},_states:{value:null,writable:!0},_program:{value:null,writable:!0},states:{get:function(){return this._states},set:function(e){this._states=e}},program:{get:function(){return this._program},set:function(e){this._program=e}},init:{value:function(){return this.attributes={},this.uniforms={},this.states={},this._type=u.PROGRAM,this.extras={},this}}});var n=Object.create(Object.prototype,{_nodeWrappers:{value:null,writable:!0},_pathIDsForNodeID:{value:null,writable:!0},_primitivesPerPass:{value:null,writable:!0},_viewPoint:{value:null,writable:!0},_scene:{value:null,writable:!0},_observers:{value:null,writable:!0},_viewPointMatrix:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in sceneRenderer")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}},viewPoint:{get:function(){return this._viewPoint},set:function(e){if(this._observers)for(var i=0;this._observers.length>i;i++)this._observers[i].viewPointWillChange(this,this._viewPoint,e);if(this._viewPoint!=e&&(this._viewPoint=e),this._observers)for(var i=0;this._observers.length>i;i++)this._observers[i].viewPointMatrixDidUpdate(this),this._observers[i].viewPointDidChange(this)}},setupNodeAtPath:{value:function(e){var i=this._nodeWrappers[e.id];null==i&&(i=Object.create(s).init(e),this._nodeWrappers[e.id]=i,i.scenePassRenderer=this),e.meshes&&e.meshes.forEach(function(t){t.primitives&&t.primitives.forEach(function(s){if(s.material){var a=s.material.technique;if(a&&a.rootPass){var u,n=a.rootPass.id,r=null;for(u=0;this._primitivesPerPass.length>u;u++)this._primitivesPerPass[u].pass===n&&(r=this._primitivesPerPass[u]);
null==r&&(r=this._primitivesPerPass[n]={pass:a.rootPass,primitives:[]},this._primitivesPerPass.push(r));var l={};t.compression&&(l.compressed=!0),l.primitive=s,l.node=e,l.nodeWrapper=i,r.primitives.push(l)}}},this)},this)}},sceneWillChange:{value:function(){this._viewPointMatrix=mat4.identity()}},sceneDidChange:{value:function(){this._primitivesPerPass=[],this._nodeWrappers={};var e=this;this.scene&&this.scene.rootNode.apply(function(i){return e.setupNodeAtPath(i),null},!0,null)}},render:{value:function(e,i,t){if(this.scene&&this.viewPoint){if(null==this.__matrix&&(this.__matrix=mat4.create()),this.viewPoint&&(mat4.set(this.viewPoint.worldMatrix,this.__matrix),mat4.inverse(this.__matrix),mat4.equal(this._viewPointMatrix,this.__matrix)===!1&&(mat4.set(this.__matrix,this._viewPointMatrix),this._observers)))for(var s=0;this._observers.length>s;s++)this._observers[s].viewPointMatrixDidUpdate(this);var a,u=t?t.picking===!0&&null!=t.coords:!1;for(u&&(this.pickingRenderTarget.extras.coords=t.coords,e.bindRenderTarget(this.pickingRenderTarget)),e.projectionMatrix=this.viewPoint.cameras[0].projection.matrix,null==this.__nonOpaquePassesWithPrimitives&&(this.__nonOpaquePassesWithPrimitives=[]),this.__nonOpaquePassesWithPrimitives.length=0,a=0;this._primitivesPerPass.length>a;a++){var n=this._primitivesPerPass[a],r=u?this.pickingPass:n.pass,l=r.states;l.blendEnable&&!u?this.__nonOpaquePassesWithPrimitives.push(n):u&&this.pickingTechnique?e.renderPrimitivesWithPass(n.primitives,r,this.pickingTechnique.parameters,i,t.pickingMode):e.renderPrimitivesWithPass(n.primitives,r,null,i,t.pickingMode)}if(u){e.unbindRenderTarget(this.pickingRenderTarget);var o=this.pickingRenderTarget.extras.pickedPixel;if("node"===t.pickingMode&&null!=this.pickingPass.extras.nodeIDToColor){var c=null,m=Object.keys(this.pickingPass.extras.nodeIDToColor);m.forEach(function(e){var i=this.pickingPass.extras.nodeIDToColor[e];1>=Math.abs(Math.round(255*i[0])-o[0])&&1>=Math.abs(Math.round(255*i[1])-o[1])&&1>=Math.abs(Math.round(255*i[2])-o[2])&&(c=e)},this),t.delegate&&t.delegate.handleSelectedNode&&t.delegate.handleSelectedNode(c)}if("material"===t.pickingMode&&null!=this.pickingPass.extras.materialIDToColor){var d=null,p=Object.keys(this.pickingPass.extras.materialIDToColor);p.forEach(function(e){var i=this.pickingPass.extras.materialIDToColor[e];1>=Math.abs(Math.round(255*i[0])-o[0])&&1>=Math.abs(Math.round(255*i[1])-o[1])&&1>=Math.abs(Math.round(255*i[2])-o[2])&&(d=e)},this),t.delegate&&t.delegate.handleSelectedMaterial&&t.delegate.handleSelectedMaterial(d)}}else for(a=0;this.__nonOpaquePassesWithPrimitives.length>a;a++){var n=this.__nonOpaquePassesWithPrimitives[a];e.renderPrimitivesWithPass(n.primitives,n.pass,null,i)}}}},scene:{get:function(){return this._scene},set:function(e){this._scene!=e&&(this.sceneWillChange(this._scene,e),this._scene=e,this.sceneDidChange())}},_pickingPass:{value:null,writable:!0},pickingPass:{get:function(){return this._pickingPass},set:function(e){this._pickingPass=e,this._pickingPass.id="__PickingPass",this._pickingPass.extras.nodeIDToColor={},this._pickingPass.extras.materialIDToColor={}}},_pickingTechnique:{value:null,writable:!0},pickingTechnique:{get:function(){return this._pickingTechnique},set:function(e){this._pickingTechnique=e,this.pickingPass=this._pickingTechnique.rootPass}},_pickingRenderTarget:{value:null,writable:!0},pickingRenderTarget:{get:function(){return this._pickingRenderTarget},set:function(e){this._pickingRenderTarget=e}},createPickingRenderTargetIfNeeded:{value:function(){return this._pickingRenderTarget||(this._pickingRenderTarget=Object.create(a).init(),this._pickingRenderTarget.attachments.push({semantic:"COLOR_ATTACHMENT0",parameter:"__pickingTexture"}),this._pickingRenderTarget.attachments.push({semantic:"DEPTH_ATTACHMENT",parameter:"__pickingRenderBuffer"}),this.pickingRenderTarget.extras.picking=!0),this._pickingRenderTarget}},init:{value:function(){return this.pickingRenderTarget=this.createPickingRenderTargetIfNeeded(),this.pickingRenderTarget.width=512,this.pickingRenderTarget.height=512,this._nodeWrappers={},this}}});i.ScenePass=Object.create(u,{_scenePassRenderer:{value:null,writable:!0},createScenePassRendererIfNeeded:{value:function(){this._scenePassRenderer||(this._scenePassRenderer=Object.create(n).init())}},scenePassRenderer:{get:function(){return this.createScenePassRendererIfNeeded(),this._scenePassRenderer},set:function(e){this.createScenePassRendererIfNeeded(),this._scenePassRenderer!=e&&(this._scenePassRenderer=e)}},viewPoint:{get:function(){return this.scenePassRenderer?this.scenePassRenderer.viewPoint:null},set:function(e){this.scenePassRenderer&&(this.scenePassRenderer.viewPoint=e)}},scene:{get:function(){return this.scenePassRenderer.scene},set:function(e){this.scenePassRenderer.scene=e}},execute:{value:function(e,i,t){this.scenePassRenderer.render(e,i,t)}},init:{value:function(){return this._type=u.SCENE,this.extras={},this}}})}}),montageDefine("83b66f4","runtime/animation",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities","runtime/dependencies/o3dgc"],factory:function(e,i){function t(e){function i(e,i){return 1-3*i+3*e}function t(e,i){return 3*i-6*e}function s(e){return 3*e}function a(e,a,u){return((i(a,u)*e+t(a,u))*e+s(a))*e}function u(e,a,u){return 3*i(a,u)*e*e+2*t(a,u)*e+s(a)}function n(e){for(var i=e,t=0;4>t;++t){var s=u(i,r,o);if(0==s)return i;var n=a(i,r,o)-e;i-=n/s}return i}var r=e[0],l=e[1],o=e[2],c=e[3];this.get=function(e){return r==l&&o==c?e:a(n(e),l,c)}}function s(e,i,t){var s=Object.create(n).init();return e.interpolateToTransform(i,t,s),s}function a(e,i,t){return e+(i-e)*t}e("runtime/dependencies/gl-matrix");var u=e("runtime/base").Base,n=e("runtime/transform").Transform;e("runtime/utilities").Utilities;var r=e("runtime/dependencies/o3dgc").o3dgc,l={ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},o=i.Channel=Object.create(u,{startTime:{value:0,writable:!0},endTime:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(e){this._target=e}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(e){this._path=e}},parameterDelegate:{value:{handleError:function(e,i){console.log("ERROR:parameterDelegate:"+e+" :"+i)},decode:function(e,i){function t(e){for(var i=new ArrayBuffer(e.length),t=new Uint8Array(i),s=0,a=e.length;a>s;s++)t[s]=e.charCodeAt(s);return i}if(i){var s="ascii"==i.extensions["Open3DGC-compression"].compressedData.mode?"text":"arraybuffer";if("text"===s)var a=new r.BinaryStream(t(e)),u=e.length;else var a=new r.BinaryStream(e),u=e.byteLength;var n=new r.DynamicVectorDecoder,l=new r.DynamicVector,o=new r.Timer;return o.Tic(),n.DecodeHeader(l,a),o.Toc(),console.log("DecodeHeader time (ms) "+o.GetElapsedTime()),l.GetNVector()>0&&l.GetDimVector()&&(l.SetVectors(new Float32Array(l.GetNVector()*l.GetDimVector())),l.SetMinArray(new Float32Array(l.GetDimVector())),l.SetMaxArray(new Float32Array(l.GetDimVector())),l.SetStride(l.GetDimVector())),console.log("Dynamic vector info:"+i.id),console.log("	# vectors   "+l.GetNVector()),console.log("	dim         "+l.GetDimVector()),o.Tic(),n.DecodePlayload(l,a),o.Toc(),console.log("DecodePlayload time "+o.GetElapsedTime()+" ms, "+u+" bytes ("+8*u/l.GetNVector()+" bpv)"),l.GetVectors()}},convert:function(e,i,t){var s=t;if(s.extensions){var a=s.extensions,u=a["Open3DGC-compression"];if(u){var n=u.compressedData;if(n)return this.decode(i,t)}}return new Float32Array(i)},resourceAvailable:function(){}}},getParameterArray:{value:function(e,i){if(e.extensions){var t=e.extensions,s=t["Open3DGC-compression"];if(s){var a=s.compressedData;if(a)return i.getResource(a,this.parameterDelegate,e)}}return i.getResource(e,this.parameterDelegate,e)}},updateTargetsAtTime:{value:function(e,i){var t=this.sampler.input,s=this.sampler.output,a=this.getParameterArray(t,i),u=this.getParameterArray(s,i);if(a&&u){e/=1e3;var n=t.count;this.endTime=a[n-1],this.startTime=a[0];var r,l=0,o=0,c=0;if(n>0){if(this.startTime>e)o=0,l=0;else if(e>=this.endTime)o=1,l=n-2;else for(r=l;n-1>r;r++)if(e>=a[r]&&a[r+1]>e){l=r,c=a[r+1]-a[r],o=(e-a[r])/c;break}null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var m=null;switch(s.componentsPerAttribute){case 4:m=this.__vec4;break;case 3:m=this.__vec3;break;case 2:m=this.__vec2;break;case 1:console.log("float interpolation not handled yet");break;default:}this.index=l;var d=l*s.componentsPerAttribute,p=d+s.componentsPerAttribute,v=this.path;if("rotation"===v){v="orientation";var g=0,h=1,f=2,b=f;if(b==g){var q=vec4.createFrom(u[d+0],u[d+1],u[d+2],u[d+3]),S=vec4.createFrom(u[p+0],u[p+1],u[p+2],u[p+3]);vec3.normalize(q),vec3.normalize(S);var y=vec3.create();vec3.cross(q,S,y),Math.sqrt(vec3.dot(q,q)),Math.sqrt(vec3.dot(S,S));var _=Math.acos(vec3.dot(q,S)),P=mat4.identity();mat4.rotate(P,_*o,y),mat4.multiplyVec3(P,q,y),vec3.normalize(y);var C=q[3]+(S[3]-q[3])*o;quat4.fromAngleAxis(C,y,m)}else if(b==h){var q=vec4.createFrom(u[d+0],u[d+1],u[d+2],u[d+3]),S=vec4.createFrom(u[p+0],u[p+1],u[p+2],u[p+3]);for(r=0;m.length>r;r++){var N=q[r],D=S[r];S[r]=N+(D-N)*o}quat4.fromAngleAxis(S[3],S,m)}else if(b==f){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=u[d+0],this._vecs[0][1]=u[d+1],this._vecs[0][2]=u[d+2],this._vecs[1][0]=u[p+0],this._vecs[1][1]=u[p+1],this._vecs[1][2]=u[p+2];var M=this._quats[0],A=this._quats[1];quat4.fromAngleAxis(u[d+3],this._vecs[0],M),quat4.fromAngleAxis(u[p+3],this._vecs[1],A),quat4.slerp(M,A,o,m)}}else for(r=0;m.length>r;r++){var N=u[d+r],D=u[p+r];m[r]=N+(D-N)*o}this.target.transform[v]=m}}}},initWithDescription:{value:function(e){return this.init(),this.index=0,this.target=e.target,this}},init:{value:function(){return this.__Base_init(),this}}}),c=Object.create(u,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(e){this._input=e}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(e){this._output=e}},initWithDescription:{value:function(){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}}),m=i.Animation=Object.create(Object.prototype,{KEYFRAME:{value:"KEYFRAME",writable:!0},BASIC:{value:"BASIC",writable:!0},_type:{value:null,writable:!0},type:{set:function(e){this._type=e},get:function(){return this._type}},_delegate:{value:null,writable:!0},delegate:{set:function(e){this._delegate=e},get:function(){return this._delegate}}});i.BasicAnimation=Object.create(m,{_startTime:{value:0,writable:!0},_from:{value:null,writable:!0},_to:{value:null,writable:!0},_duration:{value:0,writable:!0},path:{value:null,writable:!0},target:{value:null,writable:!0},_interpolator:{value:null,writable:!0},extras:{value:null,writable:!0},_timingFunction:{value:null,writable:!0},_bezier:{value:null,writable:!0},timingFunction:{set:function(e){this._timingFunction=e},get:function(){return this._timingFunction||"ease"}},_inferInterpolatorFromValue:{value:function(e){return isNaN(e-0)||null==e?e instanceof Object?s:nil:a}},to:{set:function(e){this._interpolator=this._inferInterpolatorFromValue(e),this._to=e},get:function(){return this._to}},from:{set:function(e){this._from=e},get:function(){return this._from}},duration:{set:function(e){this._duration=e},get:function(){return this._duration}},_evaluateAtTime:{value:function(e){var i=(e-this._startTime)/this.duration;if(i>1&&(i=1),0>i&&(i=0),null==this._bezier){var s=l[this.timingFunction]||"ease";this._bezier=new t(s)}i=this._bezier.get(i);var a=this._interpolator(this._from,this._to,i);this.target&&this.path&&(this.target[this.path]=a,this.delegate.animationDidUpdate(this))}},animationWasAddedToTarget:{value:function(){this._startTime=Date.now()}},animationWasRemovedFromTarget:{value:function(){this._startTime=0}},init:{value:function(){return this.type=m.BASIC,this.extras={},this}}}),i.KeyframeAnimation=Object.create(m,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_startTime:{value:0,writable:!0},_endTime:{value:-1,writable:!0},channels:{get:function(){return this._channels},set:function(e){this._channels=e}},samplers:{get:function(){return this._samplers},set:function(e){this._samplers=e}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},count:{get:function(){return this._count},set:function(e){this._count=e}},startTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].startTime,i=1;this.channels.length>i;i++)e>this.channels[i].startTime&&(e=this.channels[i].startTime);return e}return 0}}},endTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].endTime,i=1;this.channels.length>i;i++)this.channels[i].endTime>e&&(e=this.channels[i].endTime);return e}return-1}}},updateTargetsAtTime:{value:function(e,i){this.channels.forEach(function(t){t.updateTargetsAtTime(e,i)},this)}},initWithDescription:{value:function(e){return this.init(),this.count=e.count,Object.keys(e.samplers).forEach(function(i){var t=e.samplers[i],s=Object.create(c).initWithDescription(t);this.samplers[i]=s},this),e.channels.forEach(function(e){var i=Object.create(o).initWithDescription(e);i.sampler=this.samplers[e.sampler],i.target=e.target,this.channels.push(i)},this),this}},init:{value:function(){return this.channels=[],this.samplers={},this.type=m.KEYFRAME,this}}})}}),montageDefine("83b66f4","runtime/dependencies/webgl-debug",{dependencies:[],factory:function(){WebGLDebugUtils=function(){function e(e){if(null==p){p={};for(var i in e)"number"==typeof e[i]&&(p[e[i]]=i)}}function i(){if(null==p)throw"WebGLDebugUtils.init(ctx) not called"}function t(e){return i(),void 0!==p[e]}function s(e){i();var t=p[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function a(e,i,t,a){var u=d[e];if(void 0!==u){var u=u[i];if(void 0!==u&&u[t])return s(a)}return null===a?"null":void 0===a?"undefined":""+a}function u(e,i){for(var t="",s=i.length,u=0;s>u;++u)t+=(0==u?"":", ")+a(e,s,u,i[u]);return t}function n(e,i,t){e.__defineGetter__(t,function(){return i[t]}),e.__defineSetter__(t,function(e){i[t]=e})}function r(i,t,u){function r(e,i){return function(){u&&u(i,arguments);var s=e[i].apply(e,arguments),a=e.getError();return 0!=a&&(l[a]=!0,t(a,i,arguments)),s}}e(i),t=t||function(e,i,t){for(var u="",n=t.length,r=0;n>r;++r)u+=(0==r?"":", ")+a(i,n,r,t[r]);m("WebGL error "+s(e)+" in "+i+"("+u+")")};var l={},o={};for(var c in i)"function"==typeof i[c]?o[c]=r(i,c):n(o,i,c);return o.getError=function(){for(var e in l)if(l.hasOwnProperty(e)&&l[e])return l[e]=!1,e;return i.NO_ERROR},o}function l(e){var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t);for(var s=0;i>s;++s)e.disableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(s,0);e.deleteBuffer(t);for(var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),s=0;a>s;++s)e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function o(e){function i(e){return"function"==typeof e?e:function(i){e.handleEvent(i)}}function t(e){var i=e.addEventListener;e.addEventListener=function(t,s){switch(t){case"webglcontextlost":P(s);break;case"webglcontextrestored":C(s);break;default:i.apply(e,arguments)}}}function s(){for(var e=Object.keys(_),i=0;e.length>i;++i)delete _[e]}function a(){++q,h||b==q&&e.loseContext()}function u(e,i){var t=e[i];return function(){if(a(),!h){var i=t.apply(e,arguments);return i}}}function r(){for(var e=0;f.length>e;++e){var i=f[e];i instanceof WebGLBuffer?m.deleteBuffer(i):i instanceof WebGLFramebuffer?m.deleteFramebuffer(i):i instanceof WebGLProgram?m.deleteProgram(i):i instanceof WebGLRenderbuffer?m.deleteRenderbuffer(i):i instanceof WebGLShader?m.deleteShader(i):i instanceof WebGLTexture&&m.deleteTexture(i)}}function o(e){return{statusMessage:e,preventDefault:function(){S=!0}}}function c(e){for(var i in e)"function"==typeof e[i]?d[i]=u(e,i):n(d,e,i);d.getError=function(){if(a(),!h)for(var e;e=m.getError();)_[e]=!0;for(var e in _)if(_[e])return delete _[e],e;return d.NO_ERROR};for(var t=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],s=0;t.length>s;++s){var r=t[s];d[r]=function(i){return function(){if(a(),h)return null;var t=i.apply(e,arguments);return t.__webglDebugContextLostId__=g,f.push(t),t}}(e[r])}for(var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],s=0;l.length>s;++s){var r=l[s];d[r]=function(i){return function(){return a(),h?null:i.apply(e,arguments)}}(d[r])}for(var o=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],s=0;o.length>s;++s){var r=o[s];d[r]=function(i){return function(){return a(),h?!1:i.apply(e,arguments)}}(d[r])}return d.checkFramebufferStatus=function(i){return function(){return a(),h?d.FRAMEBUFFER_UNSUPPORTED:i.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(i){return function(){return a(),h?-1:i.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(i){return function(){return a(),h?0:i.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return h},d}var m,d,p=[],v=[],d={},g=1,h=!1,f=[],b=0,q=0,S=!1,y=0,_={};e.getContext=function(i){return function(){var t=i.apply(e,arguments);if(t instanceof WebGLRenderingContext){if(t!=m){if(m)throw"got different context";m=t,d=c(m)}return d}return t}}(e.getContext);var P=function(e){p.push(i(e))},C=function(e){v.push(i(e))};return t(e),e.loseContext=function(){if(!h){for(h=!0,b=0,++g;m.getError(););s(),_[m.CONTEXT_LOST_WEBGL]=!0;var i=o("context lost"),t=p.slice();setTimeout(function(){for(var s=0;t.length>s;++s)t[s](i);y>=0&&setTimeout(function(){e.restoreContext()},y)},0)}},e.restoreContext=function(){h&&v.length&&setTimeout(function(){if(!S)throw"can not restore. webglcontestlost listener did not call event.preventDefault";r(),l(m),h=!1,q=0,S=!1;for(var e=v.slice(),i=o("context restored"),t=0;e.length>t;++t)e[t](i)},0)},e.loseContextInNCalls=function(e){if(h)throw"You can not ask a lost contet to be lost";b=q+e},e.getNumCalls=function(){return q},e.setRestoreTimeout=function(e){y=e},e}var c=function(e){window.console&&window.console.log&&window.console.log(e)},m=function(e){window.console&&window.console.error?window.console.error(e):c(e)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:!0}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}}},p=null;return{init:e,mightBeEnum:t,glEnumToString:s,glFunctionArgToString:a,glFunctionArgsToString:u,makeDebugContext:r,makeLostContextSimulatingCanvas:o,resetToInitialState:l}}()}}),montageDefine("83b66f4","runtime/glsl-program",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=i.GLSLProgram=Object.create(Object.prototype,{VERTEX_SHADER:{value:"x-shader/x-vertex"},FRAGMENT_SHADER:{value:"x-shader/x-fragment"},_shaders:{enumerable:!1,value:null,writable:!0},shaders:{enumerable:!1,get:function(){return this._shaders},set:function(e){this._shaders=e}},_errorLogs:{enumerable:!1,value:null,writable:!0},errorLogs:{enumerable:!1,get:function(){return this._errorLogs},set:function(e){this._errorLogs=e}},_pendingCommits:{value:null,writable:!0},pendingCommits:{get:function(){return this._pendingCommits},set:function(e){this._pendingCommits=e}},_symbolToLocation:{value:null,writable:!0},symbolToLocation:{enumerable:!1,get:function(){return this._symbolToLocation},set:function(e){this._symbolToLocation=e}},_symbolToActiveInfo:{enumerable:!1,value:null,writable:!0},symbolToActiveInfo:{get:function(){return this._symbolToActiveInfo},set:function(e){this._symbolToActiveInfo=e}},_semanticToSymbol:{value:null,writable:!0},semanticToSymbol:{enumerable:!1,get:function(){return this._semanticToSymbol},set:function(e){this._semanticToSymbol=e}},_symbolToSemantic:{value:null,writable:!0},symbolToSemantic:{get:function(){return this._symbolToSemantic},set:function(e){this._symbolToSemantic=e}},_symbolToValue:{value:null,writable:!0},symbolToValue:{get:function(){return this._symbolToValue},set:function(e){this._symbolToValue=e}},_uniformSymbols:{value:null,writable:!0},uniformSymbols:{enumerable:!1,get:function(){return this._uniformSymbols},set:function(e){this._uniformSymbols=e}},_attributeSymbols:{value:null,writable:!0},attributeSymbols:{enumerable:!1,get:function(){return this._attributeSymbols},set:function(e){this._attributeSymbols=e}},_GLProgram:{enumerable:!1,value:null,writable:!0},GLProgram:{enumerable:!1,get:function(){return this._GLProgram},set:function(e){this._GLProgram=e}},getTypeForSymbol:{value:function(e){var i=null,t=this.symbolToActiveInfo[e];return t&&(i=t.type),i}},getLocationForSymbol:{value:function(e){return this.symbolToLocation[e]}},getSymbolForSemantic:{value:function(e){return this.semanticToSymbol[e]}},setSymbolForSemantic:{value:function(e,i){if("none"===e&&(e=null),"none"===i&&(i=null),!this.symbolToActiveInfo[e])return!1;if(i&&this.semanticToSymbol[i])return!1;if(e){var t=this.symbolToSemantic[e];t&&t!==i&&(this.semanticToSymbol[t]=null),this.symbolToSemantic[e]=i}return i&&(this.semanticToSymbol[i]=e),!0}},setSemanticForSymbol:{value:function(e,i){this.setSymbolForSemantic(e,i)}},getSemanticForSymbol:{value:function(e){return this.symbolToSemantic[e]}},setValueForSymbol:{value:function(e,i){var t=this.symbolToValue[e],s=this.getTypeForSymbol(e),a=WebGLRenderingContext;if(null!=i&&null!=t){if(s===a.FLOAT){if(i===t)return}else if(s===a.FLOAT_MAT4){if(16==i.length&&mat4.equal(t,i))return}else if(s===a.FLOAT_MAT3){if(9==i.length&&mat3.equal(t,i))return}else if(s===a.FLOAT_VEC3){if(3==i.length&&vec3.equal(t,i))return}else if(s===a.FLOAT_VEC4){if(4==i.length&&vec4.equal(t,i))return}else if(s===a.FLOAT_VEC2&&2==i.length&&vec4.equal(t,i))return}else s===a.FLOAT_MAT4?16===i.length&&(t=mat4.create()):s===a.FLOAT_MAT3?t=mat3.create():s===a.FLOAT_VEC3?t=vec3.create():s===a.FLOAT_VEC4?t=vec4.create():s===a.FLOAT_VEC2&&(t=vec2.create());null!==this.symbolToActiveInfo[e]&&-1===this.pendingCommits.indexOf(e)&&this.pendingCommits.push(e),null!=i&&(s===a.FLOAT_MAT4?16===i.length&&(i=mat4.set(i,t)):s===a.FLOAT_MAT3?i=mat3.set(i,t):s===a.FLOAT_VEC3?i=vec3.set(i,t):s===a.FLOAT_VEC4?i=vec4.set(i,t):s===a.FLOAT_VEC2&&(i=vec2.set(i,t))),this.symbolToValue[e]=i}},getValueForSymbol:{value:function(e){return this.symbolToValue[e]}},_commitSwitch:{value:function(){var e=[];return e[WebGLRenderingContext.FLOAT_MAT2]=function(e,i,t,s){e.uniformMatrix2fv(i,t,s)},e[WebGLRenderingContext.FLOAT_MAT3]=function(e,i,t,s){e.uniformMatrix3fv(i,t,s)},e[WebGLRenderingContext.FLOAT_MAT4]=function(e,i,t,s){e.uniformMatrix4fv(i,t,s)},e[WebGLRenderingContext.FLOAT]=function(e,i,t,s){e.uniform1f(i,s)},e[WebGLRenderingContext.FLOAT_VEC2]=function(e,i,t,s){e.uniform2fv(i,s)},e[WebGLRenderingContext.FLOAT_VEC3]=function(e,i,t,s){e.uniform3fv(i,s)},e[WebGLRenderingContext.FLOAT_VEC4]=function(e,i,t,s){e.uniform4fv(i,s)},e[WebGLRenderingContext.INT]=function(e,i,t,s){e.uniform1i(i,s)},e[WebGLRenderingContext.SAMPLER_2D]=function(e,i,t,s){e.uniform1i(i,s)},e[WebGLRenderingContext.SAMPLER_CUBE]=function(e,i,t,s){e.uniform1i(i,s)},e}()},commit:{value:function(e){if(this.pendingCommits.length){for(var i,t=this.pendingCommits.length-1;i=this.pendingCommits[t--];)this._commitSwitch[this.getTypeForSymbol(i)](e,this.symbolToLocation[i],!1,this.getValueForSymbol(i));this.pendingCommits.length=0}}},use:{value:function(e,i){e.useProgram(this.GLProgram),i&&this.commit(e)}},createShaderWithSourceAndType:{value:function(e,i,t){var s;if("x-shader/x-fragment"===t)s=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==t)return null;s=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(s,i),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(this.errorLogs=e.getShaderInfoLog(s),null)}},build:{value:function(e){var i,s,a=this.shaders[t.VERTEX_SHADER],u=this.shaders[t.FRAGMENT_SHADER],n=!1,r=this.createShaderWithSourceAndType(e,a,t.VERTEX_SHADER);if(null==r)return!1;var l=this.createShaderWithSourceAndType(e,u,t.FRAGMENT_SHADER);if(null==l)return!1;if(this.GLProgram=e.createProgram(),e.attachShader(this.GLProgram,r),e.attachShader(this.GLProgram,l),e.linkProgram(this.GLProgram),e.getProgramParameter(this.GLProgram,e.LINK_STATUS)){this.pendingCommits=[],this.symbolToActiveInfo={},this.symbolToValue={},this.symbolToLocation={},this.uniformSymbols=[],this.attributeSymbols=[],this.symbolToSemantic={},this.semanticToSymbol={};var o=e.getParameter(e.CURRENT_PROGRAM);e.useProgram(this.GLProgram);var c=e.getProgramParameter(this.GLProgram,e.ACTIVE_UNIFORMS);for(i=0;c>i;i++){s=e.getActiveUniform(this.GLProgram,i);var m=s.name,d=m.indexOf("[0]");-1!=d&&(m=m.substring(0,d)),this.symbolToActiveInfo[m]=s,this.symbolToLocation[m]=e.getUniformLocation(this.GLProgram,m),this.uniformSymbols.push(m)}var p=e.getProgramParameter(this.GLProgram,e.ACTIVE_ATTRIBUTES);for(i=0;p>i;i++)s=e.getActiveAttrib(this.GLProgram,i),this.symbolToActiveInfo[s.name]=s,this.symbolToLocation[s.name]=e.getAttribLocation(this.GLProgram,s.name),this.attributeSymbols.push(s.name);n=!0,e.useProgram(o)}return this.errorLogs=e.getProgramInfoLog(this.GLProgram),n}},initWithShaders:{value:function(e){this.shaders=e}},initWithProgram:{value:function(e){this.shaders=e.shaders,this.semanticToSymbol=e.semanticToSymbol,this.symbolToSemantic=e.symbolToSemantic}}})}}),montageDefine("4db6a52","url",{dependencies:["punycode","querystring"],factory:function(e,i){(function(){"use strict";function t(e,i,t){if(e&&"object"==typeof e&&e.href)return e;if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a={},u=e;u=u.trim();var o=l.exec(u);if(o){o=o[0];var c=o.toLowerCase();a.protocol=c,u=u.substr(o.length)}if(t||o||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===u.substr(0,2);!m||o&&q[o]||(u=u.substr(2),a.slashes=!0)}if(!q[o]&&(m||o&&!S[o])){var _=u.indexOf("@");if(-1!==_){for(var P=u.slice(0,_),C=!0,N=0,D=v.length;D>N;N++)if(-1!==P.indexOf(v[N])){C=!1;break}C&&(a.auth=decodeURIComponent(P),u=u.substr(_+1))}for(var M=-1,N=0,D=p.length;D>N;N++){var A=u.indexOf(p[N]);-1!==A&&(0>M||M>A)&&(M=A)}-1!==M?(a.host=u.substr(0,M),u=u.substr(M)):(a.host=u,u="");for(var E=n(a.host),I=Object.keys(E),N=0,D=I.length;D>N;N++){var w=I[N];a[w]=E[w]}a.hostname=a.hostname||"";var x="["===a.hostname[0]&&"]"===a.hostname[a.hostname.length-1];if(a.hostname.length>g)a.hostname="";else if(!x)for(var T=a.hostname.split(/\./),N=0,D=T.length;D>N;N++){var L=T[N];if(L&&!L.match(h)){for(var V="",j=0,O=L.length;O>j;j++)V+=L.charCodeAt(j)>127?"x":L[j];if(!V.match(h)){var F=T.slice(0,N),R=T.slice(N+1),k=L.match(f);k&&(F.push(k[1]),R.unshift(k[2])),R.length&&(u="/"+R.join(".")+u),a.hostname=F.join(".");break}}}if(a.hostname=a.hostname.toLowerCase(),!x){for(var U=a.hostname.split("."),z=[],N=0;U.length>N;++N){var B=U[N];z.push(B.match(/[^A-Za-z0-9_-]/)?"xn--"+r.encode(B):B)}a.hostname=z.join(".")}a.host=(a.hostname||"")+(a.port?":"+a.port:""),a.href+=a.host,x&&(a.hostname=a.hostname.substr(1,a.hostname.length-2),"/"!==u[0]&&(u="/"+u))}if(!b[c])for(var N=0,D=d.length;D>N;N++){var Q=d[N],G=encodeURIComponent(Q);G===Q&&(G=escape(Q)),u=u.split(Q).join(G)}var W=u.indexOf("#");-1!==W&&(a.hash=u.substr(W),u=u.slice(0,W));var H=u.indexOf("?");return-1!==H?(a.search=u.substr(H),a.query=u.substr(H+1),i&&(a.query=y.parse(a.query)),u=u.slice(0,H)):i&&(a.search="",a.query={}),u&&(a.pathname=u),S[o]&&a.hostname&&!a.pathname&&(a.pathname="/"),(a.pathname||a.search)&&(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=s(a),a}function s(e){"string"==typeof e&&(e=t(e));var i=e.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var s=e.protocol||"",a=e.pathname||"",u=e.hash||"",n=!1,r="";void 0!==e.host?n=i+e.host:void 0!==e.hostname&&(n=i+(-1===e.hostname.indexOf(":")?e.hostname:"["+e.hostname+"]"),e.port&&(n+=":"+e.port)),e.query&&"object"==typeof e.query&&Object.keys(e.query).length&&(r=y.stringify(e.query));var l=e.search||r&&"?"+r||"";return s&&":"!==s.substr(-1)&&(s+=":"),e.slashes||(!s||S[s])&&n!==!1?(n="//"+(n||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):n||(n=""),u&&"#"!==u.charAt(0)&&(u="#"+u),l&&"?"!==l.charAt(0)&&(l="?"+l),s+n+a+l+u}function a(e,i){return s(u(e,i))}function u(e,i){if(!e)return i;if(e=t(s(e),!1,!0),i=t(s(i),!1,!0),e.hash=i.hash,""===i.href)return e.href=s(e),e;if(i.slashes&&!i.protocol)return i.protocol=e.protocol,S[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=s(i),i;
if(i.protocol&&i.protocol!==e.protocol){if(!S[i.protocol])return i.href=s(i),i;if(e.protocol=i.protocol,!i.host&&!q[i.protocol]){for(var a=(i.pathname||"").split("/");a.length&&!(i.host=a.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),""!==a[0]&&a.unshift(""),2>a.length&&a.unshift(""),i.pathname=a.join("/")}return e.pathname=i.pathname,e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.slashes=e.slashes||i.slashes,e.href=s(e),e}var u=e.pathname&&"/"===e.pathname.charAt(0),n=void 0!==i.host||i.pathname&&"/"===i.pathname.charAt(0),r=n||u||e.host&&i.pathname,l=r,o=e.pathname&&e.pathname.split("/")||[],a=i.pathname&&i.pathname.split("/")||[],c=e.protocol&&!S[e.protocol];if(c&&(delete e.hostname,delete e.port,e.host&&(""===o[0]?o[0]=e.host:o.unshift(e.host)),delete e.host,i.protocol&&(delete i.hostname,delete i.port,i.host&&(""===a[0]?a[0]=i.host:a.unshift(i.host)),delete i.host),r=r&&(""===a[0]||""===o[0])),n)e.host=i.host||""===i.host?i.host:e.host,e.hostname=i.hostname||""===i.hostname?i.hostname:e.hostname,e.search=i.search,e.query=i.query,o=a;else if(a.length)o||(o=[]),o.pop(),o=o.concat(a),e.search=i.search,e.query=i.query;else if("search"in i){if(c){e.hostname=e.host=o.shift();var m=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;m&&(e.auth=m.shift(),e.host=e.hostname=m.shift())}return e.search=i.search,e.query=i.query,(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=s(e),e}if(!o.length)return delete e.pathname,e.search?delete e.path:e.path="/"+e.search,e.href=s(e),e;for(var d=o.slice(-1)[0],p=(e.host||i.host)&&("."===d||".."===d)||""===d,v=0,g=o.length;g>=0;g--)d=o[g],"."==d?o.splice(g,1):".."===d?(o.splice(g,1),v++):v&&(o.splice(g,1),v--);if(!r&&!l)for(;v--;v)o.unshift("..");!r||""===o[0]||o[0]&&"/"===o[0].charAt(0)||o.unshift(""),p&&"/"!==o.join("/").substr(-1)&&o.push("");var h=""===o[0]||o[0]&&"/"===o[0].charAt(0);if(c){e.hostname=e.host=h?"":o.length?o.shift():"";var m=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;m&&(e.auth=m.shift(),e.host=e.hostname=m.shift())}return r=r||e.host&&o.length,r&&!h&&o.unshift(""),e.pathname=o.join("/"),(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=s(e),e}function n(e){var i={},t=o.exec(e);return t&&(t=t[0],":"!==t&&(i.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(i.hostname=e),i}var r=e("punycode");i.parse=t,i.resolve=a,i.resolveObject=u,i.format=s;var l=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,c=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","~","`"].concat(c),d=["'"].concat(c),p=["%","/","?",";","#"].concat(m).concat(d),v=["/","@","?","#"].concat(c),g=255,h=/^[a-zA-Z0-9][a-z0-9A-Z_-]{0,62}$/,f=/^([a-zA-Z0-9][a-z0-9A-Z_-]{0,62})(.*)$/,b={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=e("querystring")})()}}),montageDefine("3c07db4","composer/press-composer",{dependencies:["../core/core","./composer","../core/event/mutable-event"],factory:function(e,i){var t=e("../core/core").Montage,s=e("./composer").Composer,a=e("../core/event/mutable-event").MutableEvent,u=i.PressComposer=s.specialize({load:{value:function(){window.Touch?this._element.addEventListener("touchstart",this,!0):this._element.addEventListener("mousedown",this,!0)}},unload:{value:function(){window.Touch?this._element.removeEventListener("touchstart",this,!0):this._element.removeEventListener("mousedown",this,!0)}},delegate:{value:null},cancelPress:{value:function(){return this._state===u.PRESSED?(this._dispatchPressCancel(),this._endInteraction(),!0):!1}},addEventListener:{value:function(e,i,t){s.addEventListener.call(this,e,i,t),"longPress"===e&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{enumerable:!1,value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{enumerable:!1,value:!1},_longPressThreshold:{enumerable:!1,value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{enumberable:!1,value:null},_observedPointer:{enumerable:!1,value:null},_startInteraction:{enumerable:!1,value:function(e){if("enabled"in this.component&&!this.component.enabled||null!==this._observedPointer)return!1;var i;"touchstart"===e.type?(i=e.changedTouches.length,1===i&&(this._observedPointer=e.changedTouches[0].identifier),document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)):"mousedown"===e.type&&(this._observedPointer="mouse",document.addEventListener("mouseup",this,!1),document.addEventListener("click",this,!1)),this._element.addEventListener("dragstart",this,!1),this.component.eventManager.claimPointer(this._observedPointer,this),this._dispatchPressStart(e)}},_interpretInteraction:{value:function(e){var i,t,s;if(null===this._observedPointer)return this._endInteraction(e),void 0;for(i=!this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this),t=e.target;t!==this._element&&t&&t.parentNode;)t=t.parentNode;if(s=t===this._element,i&&"click"===e.type)return e.preventDefault(),this._endInteraction(e),void 0;if("mouseup"===e.type){if(!i&&s)return this._dispatchPress(e),this._endInteraction(e),void 0;if(!i&&!s)return this._dispatchPressCancel(e),this._endInteraction(e),void 0;this._endInteraction(e)}}},_endInteraction:{value:function(){document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this),document.removeEventListener("click",this),document.removeEventListener("mouseup",this),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=u.UNPRESSED}},_changedTouchisObserved:{value:function(e){if(null===this._observedPointer)return!1;for(var i=0,t=e.length;t>i;i++)if(e[i].identifier===this._observedPointer)return i;return!1}},surrenderPointer:{value:function(e,i){var t=this.callDelegateMethod("surrenderPointer",e,i);return void 0!==t&&t===!1?!1:(this._dispatchPressCancel(),!0)}},captureTouchstart:{value:function(e){this._startInteraction(e)}},handleTouchend:{value:function(e){return null===this._observedPointer?(this._endInteraction(e),void 0):(this._changedTouchisObserved(e.changedTouches)!==!1&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._dispatchPress(e):e.preventDefault(),this._endInteraction(e)),void 0)}},handleTouchcancel:{value:function(e){(null===this._observedPointer||this._changedTouchisObserved(e.changedTouches)!==!1)&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e))}},captureMousedown:{value:function(e){this._startInteraction(e)}},handleClick:{value:function(e){this._interpretInteraction(e)}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},handleDragstart:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},_createPressEvent:{enumerable:!1,value:function(e,i){var t,s;return i||(i=document.createEvent("CustomEvent"),i.initCustomEvent(e,!0,!0,null)),t=new n,t.event=i,t.type=e,t.pointer=this._observedPointer,t.targetElement=i.target,i.changedTouches&&(s=this._changedTouchisObserved(i.changedTouches))!==!1&&(t.touch=i.changedTouches[s]),t}},_dispatchPressStart:{enumerable:!1,value:function(e){if(this._state=u.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e)),this._shouldDispatchLongPress){var i=this;this._longPressTimeout=setTimeout(function(){i._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=u.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=u.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}}),n=function(){var e,i,s,u,n,r;for(e=a.specialize({type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),i=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],s=["clientX","clientY","pageX","pageY","screenX","screenY","target"],u=function(e){return{get:function(){return this._event[e]}}},n=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}},r=i.length-1;r>=0;r--)t.defineProperty(e,i[r],u(i[r]));for(r=s.length-1;r>=0;r--)t.defineProperty(e,s[r],n(s[r]));return e}()}}),montageDefine("3c07db4","core/range-controller",{dependencies:["./core","collections/generic-collection"],factory:function(e,i){var t=e("./core").Montage,s=e("collections/generic-collection"),a=function(e,i){var t=e.clone();t.makeObservable(),t.rangeController=i,t.contentEquals=e&&e.contentEquals||Object.is,Object.defineProperty(t,"clone",{value:function(){return t.slice()}});var s=t.splice;return Object.defineProperty(t,"splice",{configurable:!1,value:function(e,i){var t=this.rangeController.content;this.contentEquals=t&&t.contentEquals||Object.is,e=e>=0?e:this.length+e;var a=this.length,u=Math.min(i,a-e),n=[].slice.call(arguments,2);n.contentEquals=this.contentEquals;var r,l=n.filter(function(i,s){if(t&&!t.has(i))return!1;if(n.findLast(i)>s)return!1;var a=this.find(i);return 0>a||a>=e&&e+u>a},this),o=Math.max(l.length,0),c=o-u,m=Math.max(a+c,e+o);if(!this.rangeController.multiSelect&&m>1){var d=o?l[o-1]:this.one();r=[0,a,d]}else r=this.rangeController.avoidsEmptySelection&&0===m?t.has(this[0])?[1,this.length-1]:[0,this.length,t.one()]:[e,i].concat(l);return s.apply(this,r)}}),t};i.RangeController=t.specialize({constructor:{value:function(e){this.content=null,this._selection=new a([],this),this.sortPath=null,this.filterPath=null,this.visibleIndexes=null,this.reversed=!1,this.start=null,this.length=null,this.selectAddedContent=!1,this.deselectInvisibleContent=!1,this.clearSelectionOnOrderChange=!1,this.avoidsEmptySelection=!1,this.multiSelect=!1,this.organizedContent=[],this.organizedContent.addRangeChangeListener(this,"organizedContent"),this.defineBinding("_orderedContent",{"<-":"content.($filterPath.defined() ? filter{path($filterPath)} : ()).($sortPath.defined() ? sorted{path($sortPath)} : ()).($reversed ?? 0 ? reversed() : ())"}),this.defineBinding("organizedContent.rangeContent()",{"<-":"_orderedContent.($visibleIndexes.defined() ?$visibleIndexes.filter{<$_orderedContent.length}.map{$_orderedContent[()]} : ()).($start.defined() && $length.defined() ?view($start, $length) : ())"}),this.addRangeAtPathChangeListener("content",this,"handleContentRangeChange"),this.addPathChangeListener("sortPath",this,"handleOrderChange"),this.addPathChangeListener("reversed",this,"handleOrderChange"),this.addOwnPropertyChangeListener("multiSelect",this),this.iterations=[],e&&this.initWithContent(e)}},initWithContent:{value:function(e){return this.content=e,this}},sortPath:{value:null},reversed:{value:null},filterPath:{value:null},visibleIndexes:{value:null},start:{value:null},length:{value:null},selectAddedContent:{value:!1},deselectInvisibleContent:{value:!1},clearSelectionOnOrderChange:{value:!1},avoidsEmptySelection:{value:!1},multiSelect:{value:!1},_orderedContent:{value:null},organizedContent:{value:null},iterations:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(e){var i=[0,this._selection.length];e&&e.toArray&&(i=i.concat(e.toArray())),this._selection.splice.apply(this._selection,i)}},select:{value:function(e){!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e)}},deselect:{value:function(e){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection["delete"](e)}},clearSelection:{value:function(){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection.clear()}},add:{value:function(e){var i;return this.content||(this.content=[]),i=this.content.add(e),i&&this.handleAdd(e),i}},push:{value:function(){for(var e=this.content.push.apply(this.content,arguments),i=0;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},pop:{value:function(){return this.content.pop()}},shift:{value:function(){return this.content.shift()}},unshift:{value:function(){for(var e=this.content.unshift.apply(this.content,arguments),i=0;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},splice:{value:function(){for(var e=this.content.splice.apply(this.content,arguments),i=2;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},swap:{value:function(e,i,t){var s=this.content.swap.apply(this.content,arguments);if(t)for(var e=2;t.length>e;e++)this.handleAdd(t[e]);return s}},"delete":{value:function(e){return this.content["delete"](e)}},has:{value:function(e){return this.content?this.content.has(e):!1}},addEach:{value:s.prototype.addEach},deleteEach:{value:s.prototype.deleteEach},clear:{value:function(){this.content.clear()}},addContent:{value:function(){var e=new this.contentConstructor;return this.add(e),e}},_contentConstructor:{value:null},contentConstructor:{get:function(){return this._contentConstructor?this._contentConstructor:this.content&&this.content.contentConstructor?this.content.contentConstructor:Object},set:function(e){this._contentConstructor=e}},handleContentRangeChange:{value:function(e,i){if(this.selection.length>0){var t=this.content&&this.content.contentEquals||Object.is;i.deleteEach(e,t),this.selection&&this.selection.deleteEach(i)}}},handleSelectionRangeChange:{value:function(e,i){if(this.selection)if(this.content){for(var t=[],s=0;e.length>s;s++)this.content.has(e[s])||t.push(e[s]);if(this._selection.deleteEach(t),!this.multiSelect&&this._selection.length>1){var a=this._selection.pop();this._selection.clear(),this._selection.add(a)}this.avoidsEmptySelection&&0==this._selection.length&&this._selection.add(i[0])}else this._selection.clear()}},handleOrganizedContentRangeChange:{value:function(e,i){if(this.deselectInvisibleContent&&this.selection){var t=i.clone(1);t.deleteEach(e),this.selection.deleteEach(i)}}},handleOrderChange:{value:function(){this.clearSelectionOnOrderChange&&this.selection&&this.selection.clear()}},handleAdd:{value:function(e){this.selectAddedContent&&this.selection&&(!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e))}},handleMultiSelectChange:{value:function(){if(this.selection){var e=this.selection.length;if(!this.multiSelect&&e>1){var i=this._selection.pop();this._selection.clear(),this._selection.add(i)}}}}},{blueprintModuleId:e("./core")._blueprintModuleIdDescriptor,blueprint:e("./core")._blueprintDescriptor})}}),montageDefine("83b66f4","runtime/transform",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base,s=e("runtime/utilities").Utilities,a=i.Transform=Object.create(t,{_matrix:{value:null,writable:!0},_dirty:{value:!0,writable:!0},_dirtyTranslation:{value:!1,writable:!0},_dirtyRotation:{value:!1,writable:!0},_dirtyScale:{value:!1,writable:!0},_translation:{value:null,writable:!0},_orientation:{value:null,writable:!0},_rotation:{value:null,writable:!0},_scale:{value:null,writable:!0},_id:{value:0,writable:!0},_AXIS_ANGLE:{value:1,writable:!0},_QUATERNION:{value:2,writable:!0},_rotationMode:{value:1,writable:!0},_fireTransformDidUpdate:{value:function(){if(this._observers)for(var e=0;this._observers.length>e;e++)this._observers[e].transformDidUpdate(this)}},_updateDirtyFlag:{value:function(e){this._dirty=e,this._fireTransformDidUpdate()}},interpolateToTransform:{value:function(e,i,t){if(this._rebuildAffinesIfNeeded(),e._rebuildAffinesIfNeeded(),s.interpolateVec(this._translation,e._translation,i,t._translation),s.interpolateVec(this._scale,e._scale,i,t._scale),e._rotationMode===a._AXIS_ANGLE){var u=vec4.create();this._rotationMode==a._QUATERNION&&(this.rotation=vec4.createFrom(e._rotation[0],e._rotation[1],e._rotation[2],-this.rotation[3])),s.interpolateVec(this.rotation,e._rotation,i,u),t.rotation=u}else{var n=vec4.create();quat4.slerp(this.orientation,e.orientation,i,n),t.orientation=n}t._updateDirtyFlag(!0)}},matrix:{get:function(){return this._dirty&&(null==this._matrix&&(this._matrix=mat4.create()),null==this._intermediateMatrices&&(this._intermediateMatrices=[],this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity())),mat4.identity(this._matrix),mat4.identity(this._intermediateMatrices[0]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[1]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[2]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[3]),mat4.translate(this._intermediateMatrices[1],this._translation),mat4.scale(this._intermediateMatrices[2],this._scale),this._rotationMode===a._AXIS_ANGLE?(mat4.identity(this._intermediateMatrices[3]),mat4.rotate(this._intermediateMatrices[3],this._rotation[3],this._rotation)):quat4.toMat4(this._orientation,this._intermediateMatrices[3]),mat4.multiply(this._matrix,this._intermediateMatrices[1]),mat4.multiply(this._matrix,this._intermediateMatrices[2]),mat4.multiply(this._matrix,this._intermediateMatrices[3]),this._dirty=!1),this._matrix},set:function(e){null==this._matrix&&(this._matrix=mat4.create()),mat4.set(e,this._matrix),this._updateDirtyFlag(!1),this._dirtyTranslation=this._dirtyRotation=this._dirtyScale=!0,this._rotationMode=this._QUATERNION}},_rebuildAffinesIfNeeded:{value:function(){(this._dirtyTranslation||this._dirtyRotation||this._dirtyScale)&&(s.decomposeMat4(this.matrix,this._dirtyTranslation?this._translation:null,this._dirtyRotation?this._orientation:null,this._dirtyScale?this._scale:null),this._dirtyTranslation=this._dirtyRotation=this._dirtyScale=!1,this._rotationMode==a._AXIS_ANGLE?this.rotation=vec4.create(this.rotation):this.orientation=vec4.create(this.orientation))}},translation:{set:function(e){this._translation=e,this._dirtyTranslation=!1,this._updateDirtyFlag(!0)},get:function(){return this._dirtyTranslation&&this._rebuildAffinesIfNeeded(),this._translation}},orientation:{set:function(e){this._dirtyRotation=!1,this._rotationMode=a._QUATERNION,this._orientation=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyRotation&&this._rebuildAffinesIfNeeded(),this._rotationMode!==a._QUATERNION&&quat4.fromAngleAxis(this._rotation[3],this._rotation,this._orientation),this._orientation}},rotation:{set:function(e){this._dirtyRotation=!1,this._rotationMode=a._AXIS_ANGLE,this._rotation=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyRotation&&this._rebuildAffinesIfNeeded(),this._rotationMode!==a._AXIS_ANGLE&&quat4.toAngleAxis(this._orientation,this._rotation),this._rotation}},scale:{set:function(e){this._dirtyScale=!1,this._scale=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyScale&&this._rebuildAffinesIfNeeded(),this._scale}},_commonInit:{value:function(){this.translation=vec3.createFrom(0,0,0),this.rotation=vec4.createFrom(0,0,0,0),this.orientation=vec4.createFrom(0,0,0,0),this.scale=vec3.createFrom(1,1,1),this.matrix=mat4.identity(),this._id=a.bumpId()}},initWithDescription:{value:function(e){return this._commonInit(),e.matrix?this.matrix=mat4.create(e.matrix):e.translation||e.rotation||e.scale?(this.translation=e.translation?vec3.create(e.translation):vec3.createFrom(0,0,0),e.rotation?this.orientation=quat4.fromAngleAxis(e.rotation[3],vec3.createFrom(e.rotation[0],e.rotation[1],e.rotation[2])):e.orientation&&(this.orientation=quat4.create(e.orientation)),this.scale=e.scale?vec3.create(e.scale):vec3.createFrom(1,1,1)):this.matrix=mat4.identity(),this}},init:{value:function(){return this._commonInit(),this}},bumpId:{value:function(){return a._id++,a._id}},copy:{value:function(){var e=Object.create(a).init();return null!=this._translation&&(e.translation=vec3.create(this._translation)),null!=this._scale&&(e.scale=vec3.create(this._scale)),null!=this._orientation&&(e.orientation=quat4.create(this._orientation)),null!=this._rotation&&(e.rotation=vec4.create(this._rotation)),e.matrix=mat4.create(this.matrix),e}},_observers:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in transform")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}}})}}),montageDefine("83b66f4","runtime/utilities",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,t){e("runtime/dependencies/gl-matrix"),t.BBox=Object.create(Object.prototype,{_dirty:{value:!0,writable:!0},_size:{value:null,writable:!0},_min:{value:null,writable:!0},_max:{value:null,writable:!0},min:{get:function(){return this._min},set:function(e){this._min=e,this._dirty=!0}},max:{get:function(){return this._max},set:function(e){this._max=e,this._dirty=!0}},init:{value:function(e,i){return this.min=e,this.max=i,this}},size:{get:function(){if(this._dirty){var e=this.min,i=this.max;this._size=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],this._dirty=!1}return this._size}},computeScaleFactor:{value:function(){var e=this.size,i=e[0]>e[1]?e[0]:e[1];return i=e[2]>i?e[2]:i,i=1/i}},computeUnitMatrix:{value:function(e){var i=this.size,t=this.min;null==e&&(e=[0,0,0]);var s=this.computeScaleFactor(),a=mat4.scale(mat4.identity(),[s,s,s]),u=vec3.createFrom(e[0]-(i[0]/2+t[0]),e[1]-(i[1]/2+t[1]),e[2]-(i[2]/2+t[2])),n=mat4.translate(a,[u[0],u[1],u[2]]);return n}}}),t.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(e,i){i[0]<e[0]&&(e[0]=i[0]),i[1]<e[1]&&(e[1]=i[1]),i[2]<e[2]&&(e[2]=i[2])}},vec3Max:{value:function(e,i){i[0]>e[0]&&(e[0]=i[0]),i[1]>e[1]&&(e[1]=i[1]),i[2]>e[2]&&(e[2]=i[2])}},mergeBBox:{value:function(e,i){var t=e[0],s=e[1],a=i[0],u=i[1],n=[t[0]<a[0]?t[0]:a[0],t[1]<a[1]?t[1]:a[1],t[2]<a[2]?t[2]:a[2]],r=[s[0]>u[0]?s[0]:u[0],s[1]>u[1]?s[1]:u[1],s[2]>u[2]?s[2]:u[2]];return[n,r]}},computeBBOXFromVec3Array:{value:function(e){if(0===e.length)return null;for(var i=[e[0][0],e[0][1],e[0][2]],t=[e[0][0],e[0][1],e[0][2]],s=0;8>s;s++)e[s][0]<i[0]&&(i[0]=e[s][0]),e[s][1]<i[1]&&(i[1]=e[s][1]),e[s][2]<i[2]&&(i[2]=e[s][2]),e[s][0]>t[0]&&(t[0]=e[s][0]),e[s][1]>t[1]&&(t[1]=e[s][1]),e[s][2]>t[2]&&(t[2]=e[s][2]);return[i,t]}},transformBBox:{value:function(e,i){var t=e[0],s=e[1],a=0,u=1,n=2,r=mat4.multiplyVec3(i,vec3.createFrom(t[a],t[u],t[n])),l=mat4.multiplyVec3(i,vec3.createFrom(s[a],t[u],t[n])),o=mat4.multiplyVec3(i,vec3.createFrom(t[a],s[u],t[n])),c=mat4.multiplyVec3(i,vec3.createFrom(s[a],s[u],t[n])),m=mat4.multiplyVec3(i,vec3.createFrom(t[a],t[u],s[n])),d=mat4.multiplyVec3(i,vec3.createFrom(s[a],t[u],s[n])),p=mat4.multiplyVec3(i,vec3.createFrom(t[a],s[u],s[n])),v=mat4.multiplyVec3(i,vec3.createFrom(s[a],s[u],s[n]));return this.computeBBOXFromVec3Array([r,l,o,c,m,d,p,v])}},rayIntersectsMesh:{value:function(e,i,t,s,a){var u=i.verticesBuffer;if(null===u)return!1;var n=!1,r=i.primitives.length;vec3.create(),vec3.create(),vec3.create();for(var l=0;r>l;l++){var o=i.primitives[l];if(a){var c=a.materials;if(c&&-1==c.indexOf(o.material.name))continue}if(!(null!==o.material.inputs.transparency&&void 0!==o.material.inputs.transparency&&1>o.material.inputs.transparency)){var m=o.boundingBox;if(this.intersectsBBOX(m,e))return!0}}return n}},intersectsBBOX:{value:function(e,i){var t,s,a,u,n,r,l=0,o=1,c=2,m=i[1],d=i[0],p=e[0],v=e[1];return m[l]>=0?(t=(p[l]-d[l])/m[l],s=(v[l]-d[l])/m[l]):(t=(v[l]-d[l])/m[l],s=(p[l]-d[l])/m[l]),m[o]>=0?(a=(p[o]-d[o])/m[o],u=(v[o]-d[o])/m[o]):(a=(v[o]-d[o])/m[o],u=(p[o]-d[o])/m[o]),t>u||a>s?!1:(a>t&&(t=a),s>u&&(s=u),m[c]>=0?(n=(p[c]-d[c])/m[c],r=(v[c]-d[c])/m[c]):(n=(v[c]-d[c])/m[c],r=(p[c]-d[c])/m[c]),t>r||n>s?!1:(n>t&&(t=n),s>r&&(s=r),!0))}},inverpolateAxisAngle:{value:function(e,t,s,a){var u=0,n=1,r=2,l=n,o=e,c=t;if(l==u){vec3.normalize(o),vec3.normalize(c);var m=vec3.create();vec3.cross(o,c,m),Math.sqrt(vec3.dot(o,o)),Math.sqrt(vec3.dot(c,c));var d=Math.acos(vec3.dot(o,c)),p=mat4.identity();mat4.rotate(p,d*s,m),mat4.multiplyVec3(p,o,m),vec3.normalize(m);var v=o[3]+(c[3]-o[3])*s;quat4.fromAngleAxis(v,m,a)}else if(l==n){for(i=0;a.length>i;i++){var g=o[i],h=c[i];c[i]=g+(h-g)*s}quat4.fromAngleAxis(c[3],c,a)}else l==r&&quat4.slerp(e,t,s,a)}},interpolateVec:{value:function(e,t,s,a){for(i=0;a.length>i;i++){var u=e[i],n=t[i];a[i]=u+(n-u)*s}}},idx:{value:function(e,i){return 4*e+i}},decomposeMat4:{value:function(e,i,t,s){var a,u,n=mat4.create(),r=mat4.create();mat4.create(),mat4.create();var l=[vec3.create(),vec3.create(),vec3.create()];mat4.set(e,n);var o,c;for(a=0;4>a;a++)for(u=0;4>u;u++)o=this.idx(a,u),c=this.idx(3,3),n[o]/=n[c];for(mat4.set(n,r),a=0;3>a;a++)o=this.idx(a,3),r[o]=0;for(o=this.idx(3,3),r[o]=1,(0!=n[this.idx(0,3)]||0!=n[this.idx(1,3)]||0!=n[this.idx(2,3)])&&(n[this.idx(0,3)]=0,n[this.idx(1,3)]=0,n[this.idx(2,3)]=0,n[this.idx(3,3)]=1),i&&(i[0]=n[this.idx(3,0)],i[1]=n[this.idx(3,1)],i[2]=n[this.idx(3,2)]),n[this.idx(3,0)]=0,n[this.idx(3,1)]=0,n[this.idx(3,2)]=0,a=0;3>a;a++)l[a][0]=n[this.idx(a,0)],l[a][1]=n[this.idx(a,1)],l[a][2]=n[this.idx(a,2)];null!=s&&(s[0]=vec3.length(l[0]),s[1]=vec3.length(l[1]),s[2]=vec3.length(l[2])),vec3.normalize(l[0]),vec3.normalize(l[1]),vec3.normalize(l[2]);var m=vec3.create();if(vec3.cross(l[1],l[2],m),0>vec3.dot(l[0],m))for(a=0;3>a;a++)null!=s&&(s[a]*=-1),l[a][0]*=-1,l[a][1]*=-1,l[a][2]*=-1;null!=t&&(t[0]=.5*Math.sqrt(Math.max(1+l[0][0]-l[1][1]-l[2][2],0)),t[1]=.5*Math.sqrt(Math.max(1-l[0][0]+l[1][1]-l[2][2],0)),t[2]=.5*Math.sqrt(Math.max(1-l[0][0]-l[1][1]+l[2][2],0)),t[3]=.5*Math.sqrt(Math.max(1+l[0][0]+l[1][1]+l[2][2],0)),l[2][1]>l[1][2]&&(t[0]=-t[0]),l[0][2]>l[2][0]&&(t[1]=-t[1]),l[1][0]>l[0][1]&&(t[2]=-t[2]))}}})}}),montageDefine("83b66f4","runtime/node",{dependencies:["montage","runtime/component-3d","runtime/transform","runtime/animation","runtime/dependencies/gl-matrix"],factory:function(e,i){e("montage").Montage;var t=e("runtime/component-3d").Component3D,s=e("runtime/transform").Transform,a=e("runtime/animation").BasicAnimation;e("runtime/dependencies/gl-matrix"),i.Node=t.specialize({constructor:{value:function(){this.super(),this._hidden=!1,this._visibility="visible",this._offsetTransform=Object.create(s).init(),this.addOwnPropertyChangeListener("hidden",this),this.addOwnPropertyChangeListener("visibility",this),this.addOwnPropertyChangeListener("offsetTransform",this),this.addOwnPropertyChangeListener("originVector",this),this.addOwnPropertyChangeListener("glTFElement",this),this.addOwnPropertyChangeListener("transformOrigin",this),this.addOwnPropertyChangeListener("transformZOrigin",this),this.addOwnPropertyChangeListener("cursor",this)}},animationDidStart:{value:function(){}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(){}},handleGlTFElementChange:{value:function(){this.handleHiddenChange(),this.handleVisibilityChange(),this.handleOffsetTransformChange(),this.handleOriginVectorChange(),this.handleTransformOriginChange(),this.handleTransformZOriginChange(),this._applyCSSPropertyWithValueForState(this.__STYLE_DEFAULT__,"offsetTransform",this._offsetTransform)}},handleHiddenChange:{value:function(){null!=this.glTFElement&&(this.glTFElement.hidden=this._hidden,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleVisibilityChange:{value:function(){null!=this.glTFElement&&(this.glTFElement.hidden=this.visibility?"hidden"===this.visibility:!1,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},offsetTransform_animationSetter:{set:function(e){this._offsetTransform=e,this.handleOffsetTransformChange()}},handleCursorChange:{value:function(){this.scene.dispatchEventNamed("cursorUpdate",!0,!1,this.cursor)}},handleTransformOriginChange:{value:function(){var e=this.transformOrigin;null==e&&(e=this.initialValueForStyleableProperty("transformOrigin")),this.originVector=vec3.createFrom(e[0],e[1],this.transformZOrigin)}},handleTransformZOriginChange:{value:function(){var e=this.transformOrigin;null==e&&(e=this.initialValueForStyleableProperty("transformOrigin")),this.originVector=vec3.createFrom(e[0],e[1],this.transformZOrigin)}},handleOffsetTransformChange:{value:function(){null!=this.glTFElement&&(this.glTFElement._offsetTransform=this._offsetTransform,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleOriginVectorChange:{value:function(){null!=this.glTFElement&&(this.glTFElement._originVector=this._originVector,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},_hidden:{value:!1,writable:!0},hidden:{set:function(e){this._hidden!=e&&(this.visibility=e===!0?"hidden":"visible",this._hidden=e)},get:function(){return this._hidden}},_visibility:{value:!1,writable:!0},visibility:{set:function(e){this._visibility=e},get:function(){return this._visibility}},_transform:{value:null,writable:!0},transform:{set:function(e){this._transform=e},get:function(){return this._transform}},_offsetTransform:{value:null,writable:!0},offsetTransform:{set:function(e){if(this.glTFElement){var i=this.scene.glTFElement.animationManager;if(i.removeAnimationWithTargetAndPath(this,"offsetTransform_animationSetter"),this._style&&this._style.transitions){var t=this._style.transitions.offsetTransform;if(null!=t&&t.duration>0){this._offsetTransform.matrix=this._offsetTransform.matrix,fromTr=this._offsetTransform,toTr=e;var s=Object.create(a).init();return s.path="offsetTransform_animationSetter",s.target=this,s.delegate=this,s.from=fromTr,s.to=toTr,s.duration=1e3*t.duration,i.playAnimation(s),s.animationWasAddedToTarget(),i.evaluateAtTime(Date.now()),void 0}}}this._offsetTransform=e},get:function(){return this._offsetTransform}},_originVector:{value:null,writable:!0},originVector:{set:function(e){this._originVector=e},get:function(){return this._originVector}},_transformOrigin:{value:null,writable:!0},transformOrigin:{set:function(e){this._transformOrigin=e},get:function(){return this._transformOrigin}},_transformZOrigin:{value:50,writable:!0},transformZOrigin:{set:function(e){this._transformZOrigin=e},get:function(){return this._transformZOrigin}},_observers:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in glTFNode")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}},_stylableProperties:{value:["visibility","offsetTransform","transformOrigin","transformZOrigin","cursor"]},styleableProperties:{get:function(){return this._stylableProperties}},initialValueForStyleableProperty:{value:function(e){return"visibility"===e?"visible":"offsetTransform"===e?Object.create(s).init():"originVector"===e?vec3.createFrom(50,50,50):"offsetMatrix"===e?mat4.identity():"transformOrigin"===e?vec2.createFrom(50,50):"transformZOrigin"===e?50:"cursor"===e?"auto":void 0
}}})}}),montageDefine("9804a56","ui/main.reel/main.html",{text:'<!DOCTYPE html><html><head>\n    <meta http-equiv=content-type content="text/html; charset=utf-8">\n    <title>Main</title>\n\n    <link rel=stylesheet type=text/css href=main.css>\n\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"main"}},"bindings":{"status":{"<-":"@scene.status"}}},"sceneView":{"prototype":"mjs-volume/ui/scene-view.reel","properties":{"element":{"#":"sceneView"},"scene":{"@":"scene"}}},"scene":{"prototype":"mjs-volume/runtime/scene","properties":{"path":"/assets/3d/SwissArmyKnife.json"}},"Bottle_Opener":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID23","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'bottle\')":{"<-":"true"},"classList.has(\'bottle-openR\')":{"<-":"@Bottle_Opener_radio.checked"}}},"Small_Blade":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID15","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'bottle\')":{"<-":"true"},"classList.has(\'bottle-openR\')":{"<-":"@Small_Blade_radio.checked"}}},"Saw":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID97","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'bottle\')":{"<-":"true"},"classList.has(\'bottle-openR\')":{"<-":"@Saw_radio.checked"}}},"Can_Opener":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID31","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'can_opener\')":{"<-":"true"},"classList.has(\'blade-openL\')":{"<-":"@Can_Opener_radio.checked"}}},"Awl":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID89","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'awl\')":{"<-":"true"},"classList.has(\'awl-open\')":{"<-":"@Awl_radio.checked"}}},"Tweezers":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID153","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'tweezer-slide\')":{"<-":"@Tweezer_radio.checked"}}},"BLADE_MAIN":{"prototype":"mjs-volume/runtime/node","properties":{"id":"ID5","scene":{"@":"scene"}},"bindings":{"classList.has(\'all_moving_parts\')":{"<-":"true"},"classList.has(\'blade\')":{"<-":"true"},"classList.has(\'blade-openL\')":{"<-":"@Main_Blade_radio.checked"}}},"RBcontroller":{"prototype":"montage/core/radio-button-controller"},"Main_Blade_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Main_Blade_radio"},"checked":false,"value":"Main Blade","radioButtonController":{"@":"RBcontroller"}}},"Bottle_Opener_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Bottle_Opener_radio"},"checked":false,"value":"Bottle Opener","radioButtonController":{"@":"RBcontroller"}}},"Small_Blade_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Small_Blade_radio"},"checked":false,"value":"Small Blade","radioButtonController":{"@":"RBcontroller"}}},"Can_Opener_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Can_Opener_radio"},"checked":false,"value":"Can Opener","radioButtonController":{"@":"RBcontroller"}}},"Awl_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Awl_radio"},"checked":false,"value":"Awl","radioButtonController":{"@":"RBcontroller"}}},"Tweezer_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Tweezer_radio"},"checked":false,"value":"Tweezer","radioButtonController":{"@":"RBcontroller"}}},"Saw_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Saw_radio"},"checked":false,"value":"Saw","radioButtonController":{"@":"RBcontroller"}}},"Reset_All_Tools_radio":{"prototype":"digit/ui/radio-button.reel","properties":{"element":{"#":"Reset_All_Tools_radio"},"checked":false,"value":"Reset All Tools","radioButtonController":{"@":"RBcontroller"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=main data-montage-skin=light>\n    	<h1 align=center>Swiss Army Knife - Tools Demo</h1>\n    			<div align=center data-montage-id=sceneView class=scene></div>\n    			<h2>Please Select a Tool:</h2>\n    			<div align=center data-montage-id=component><strong>\n					<input type=radio data-montage-id=Main_Blade_radio> Main Blade\n					<input type=radio data-montage-id=Small_Blade_radio> Small Blade\n					<input type=radio data-montage-id=Saw_radio> Saw\n					<input type=radio data-montage-id=Tweezer_radio> Tweezers\n					<br><br>\n					<input type=radio data-montage-id=Awl_radio> Awl\n					<input type=radio data-montage-id=Bottle_Opener_radio> Bottle Opener\n					<input type=radio data-montage-id=Can_Opener_radio> Can Opener\n					</strong>\n					&nbsp;&nbsp;<input type=radio data-montage-id=Reset_All_Tools_radio> Reset All Tools\n					<br>\n				</div>\n	<a class=MontageMade href=http://montagejs.org>Made with Montage</a>\n    </div>\n\n\n\n</body></html>'}),montageDefine("4927fd7","lib/parse",{dependencies:["./CSSStyleSheet","./CSSStyleRule","./CSSImportRule","./CSSMediaRule","./CSSFontFaceRule","./CSSStyleDeclaration","./CSSKeyframeRule","./CSSKeyframesRule","./CSSValueExpression","./CSSDocumentRule"],factory:function(e,i){var t={};t.parse=function(e){for(var i,s,a,u,n,r,l,o,c,m,d=0,p="before-selector",v="",g={selector:!0,value:!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0,"documentRule-begin":!0},h=new t.CSSStyleSheet,f=h,b="",q=/@(-(?:\w+-)+)?keyframes/g,S=function(i){var t=e.substring(0,d).split("\n"),s=t.length,a=t.pop().length+1,u=Error(i+" (line "+s+", char "+a+")");throw u.line=s,u.char=a,u.styleSheet=h,u};m=e.charAt(d);d++)switch(m){case" ":case"	":case"\r":case"\n":case"\f":g[p]&&(v+=m);break;case'"':i=d+1;do i=e.indexOf('"',i)+1,i||S('Unmatched "');while("\\"===e[i-2]);switch(v+=e.slice(d,i),d=i-1,p){case"before-value":p="value";break;case"importRule-begin":p="importRule"}break;case"'":i=d+1;do i=e.indexOf("'",i)+1,i||S("Unmatched '");while("\\"===e[i-2]);switch(v+=e.slice(d,i),d=i-1,p){case"before-value":p="value";break;case"importRule-begin":p="importRule"}break;case"/":"*"===e.charAt(d+1)?(d+=2,i=e.indexOf("*/",d),-1===i?S("Missing */"):d=i+1):v+=m,"importRule-begin"===p&&(v+=" ",p="importRule");break;case"@":if(e.indexOf("@-moz-document",d)===d){p="documentRule-begin",c=new t.CSSDocumentRule,c.__starts=d,d+="-moz-document".length,v="";break}if(e.indexOf("@media",d)===d){p="atBlock",n=new t.CSSMediaRule,n.__starts=d,d+="media".length,v="";break}if(e.indexOf("@import",d)===d){p="importRule-begin",d+="import".length,v+="@import";break}if(e.indexOf("@font-face",d)===d){p="fontFaceRule-begin",d+="font-face".length,l=new t.CSSFontFaceRule,l.__starts=d,v="";break}q.lastIndex=d;var y=q.exec(e);if(y&&y.index===d){p="keyframesRule-begin",o=new t.CSSKeyframesRule,o.__starts=d,o._vendorPrefix=y[1],d+=y[0].length-1,v="";break}"selector"==p&&(p="atRule"),v+=m;break;case"{":"selector"===p||"atRule"===p?(u.selectorText=v.trim(),u.style.__starts=d,v="",p="before-name"):"atBlock"===p?(n.media.mediaText=v.trim(),f=s=n,n.parentStyleSheet=h,v="",p="before-selector"):"fontFaceRule-begin"===p?(s&&(l.parentRule=s),l.parentStyleSheet=h,u=l,v="",p="before-name"):"keyframesRule-begin"===p?(o.name=v.trim(),s&&(o.parentRule=s),o.parentStyleSheet=h,f=s=o,v="",p="keyframeRule-begin"):"keyframeRule-begin"===p?(u=new t.CSSKeyframeRule,u.keyText=v.trim(),u.__starts=d,v="",p="before-name"):"documentRule-begin"===p&&(c.matcher.matcherText=v.trim(),s&&(c.parentRule=s),f=s=c,c.parentStyleSheet=h,v="",p="before-selector");break;case":":"name"===p?(a=v.trim(),v="",p="before-value"):v+=m;break;case"(":if("value"===p)if("expression"==v.trim()){var _=new t.CSSValueExpression(e,d).parse();_.error?S(_.error):(v+=_.expression,d=_.idx)}else i=e.indexOf(")",d+1),-1===i&&S('Unmatched "("'),v+=e.slice(d,i+1),d=i;else v+=m;break;case"!":"value"===p&&e.indexOf("!important",d)===d?(b="important",d+="important".length):v+=m;break;case";":switch(p){case"value":u.style.setProperty(a,v.trim(),b),b="",v="",p="before-name";break;case"atRule":v="",p="before-selector";break;case"importRule":r=new t.CSSImportRule,r.parentStyleSheet=r.styleSheet.parentStyleSheet=h,r.cssText=v+m,h.cssRules.push(r),v="",p="before-selector";break;default:v+=m}break;case"}":switch(p){case"value":u.style.setProperty(a,v.trim(),b),b="";case"before-name":case"name":u.__ends=d+1,s&&(u.parentRule=s),u.parentStyleSheet=h,f.cssRules.push(u),v="",p=f.constructor===t.CSSKeyframesRule?"keyframeRule-begin":"before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":s||S("Unexpected }"),f.__ends=d+1,h.cssRules.push(f),f=h,s=null,v="",p="before-selector"}break;default:switch(p){case"before-selector":p="selector",u=new t.CSSStyleRule,u.__starts=d;break;case"before-name":p="name";break;case"before-value":p="value";break;case"importRule-begin":p="importRule"}v+=m}return h},i.parse=t.parse,t.CSSStyleSheet=e("./CSSStyleSheet").CSSStyleSheet,t.CSSStyleRule=e("./CSSStyleRule").CSSStyleRule,t.CSSImportRule=e("./CSSImportRule").CSSImportRule,t.CSSMediaRule=e("./CSSMediaRule").CSSMediaRule,t.CSSFontFaceRule=e("./CSSFontFaceRule").CSSFontFaceRule,t.CSSStyleDeclaration=e("./CSSStyleDeclaration").CSSStyleDeclaration,t.CSSKeyframeRule=e("./CSSKeyframeRule").CSSKeyframeRule,t.CSSKeyframesRule=e("./CSSKeyframesRule").CSSKeyframesRule,t.CSSValueExpression=e("./CSSValueExpression").CSSValueExpression,t.CSSDocumentRule=e("./CSSDocumentRule").CSSDocumentRule}}),montageDefine("83b66f4","runtime/scene-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/technique","runtime/pass","runtime/builtin-assets","runtime/dependencies/o3dgc"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/technique").Technique,s=e("runtime/pass").ScenePass,a=e("runtime/builtin-assets").BuiltInAssets,u=e("runtime/dependencies/o3dgc").o3dgc;i.SceneRenderer=Object.create(Object.prototype,{loadPickingTechnique:{value:function(){var e=this,i=a.assetWithName("pickingTechnique");i.then(function(i){e.technique.rootPass.scenePassRenderer.pickingTechnique=i},function(){},function(){})}},createTechniqueIfNeeded:{value:function(){if(!this._technique){this._technique=Object.create(t).init();var e=Object.create(s).init();this._technique.passes={defaultPass:e}}}},_webGLRenderer:{value:null,writable:!0},_technique:{value:null,writable:!0},technique:{get:function(){return this._technique},set:function(e){this._technique=e}},compressedMeshDelegate:{value:{str2ab:function(e){for(var i=new ArrayBuffer(e.length),t=new Uint8Array(i),s=0,a=e.length;a>s;s++)t[s]=e.charCodeAt(s);return i},decode:function(e,i){if(e){if(i)var t=new u.BinaryStream(this.str2ab(e));else var t=new u.BinaryStream(e);var s=new u.SC3DMCDecoder,a=new u.Timer,n=new u.IndexedFaceSet;a.Tic(),s.DecodeHeader(n,t),a.Toc(),console.log("DecodeHeader time (ms) "+a.GetElapsedTime());var r=12*n.GetNCoord()+12*n.GetNNormal(),l=new ArrayBuffer(r),o=new ArrayBuffer(6*n.GetNCoordIndex()),c=0;n.GetNCoordIndex()>0&&n.SetCoordIndex(new Uint16Array(o,0,3*n.GetNCoordIndex())),n.GetNCoord()>0&&(n.SetCoord(new Float32Array(l,c,3*n.GetNCoord())),c+=12*n.GetNCoord()),n.GetNNormal()>0&&(n.SetNormal(new Float32Array(l,c,3*n.GetNNormal())),c+=12*n.GetNNormal());for(var m=n.GetNumFloatAttributes(),d=0;m>d;++d)n.GetNFloatAttribute(d)>0&&n.SetFloatAttribute(d,new Float32Array(n.GetFloatAttributeDim(d)*n.GetNFloatAttribute(d)));return a.Tic(),s.DecodePlayload(n,t),a.Toc(),n}},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},decompressAttribsInner_:function(e,i,t,s,a,u,n,r){for(var l=0,o=i;t>o;o++){var c=e.charCodeAt(o);l+=c>>1^-(1&c),s[a]=r*(l+n),a+=u}},decompressIndices_:function(e,i,t,s,a){for(var u=0,n=0;t>n;n++){var r=e.charCodeAt(i++);s[a++]=u-r,0==r&&u++}},decompressMesh:function(e,i,t,s){for(var a=t.decodeScales.length,u=t.decodeOffsets,n=t.decodeScales,r=i.attribRange[0],l=i.attribRange[1],o=r,c=new Float32Array(a*l),m=0;a>m;m++){var d=o+l,p=n[m];p&&this.decompressAttribsInner_(e,o,d,c,m,a,u[m],p),o=d}i.indexRange[0];var v=3*i.indexRange[1],g=new Uint16Array(v);this.decompressIndices_(e,o,v,g,0),s(c,g,null,i)},convert:function(e,i,t){var s=t.mesh.compression;if("won-compression"==s.type){var a=s.indexRange;a&&(a[0]+3*a[1],this.decompressMesh(i,s,s,function(e,i){t.renderer.setupCompressedMesh(t.mesh,e,i)}))}else{var u=0;if(t.mesh,s.compressedData){var n=s.compressedData;u=n.verticesCount;var r=this.decode(i,"ascii"===n.mode),l=r.GetCoordIndex(),o=r.GetCoord(),c=r.GetNNormal()>0?r.GetNormal():null;t.renderer.setupCompressedMesh2(t.mesh,u,o,c,r,n.floatAttributesIndexes,l)}}return i},resourceAvailable:function(){}}},scene:{get:function(){return this.technique.rootPass.scene},set:function(e){var i=this,t=this.technique.rootPass.scene;t!=e&&(this.technique.rootPass.scene=e,this.scene.rootNode.apply(function(e){e.meshes&&e.meshes.forEach(function(e){if(e.compression){var t="text";e.compression.compressedData.mode&&"binary"==e.compression.compressedData.mode&&(t="arraybuffer"),e.compression.compressedData.requestType=t,i.webGLRenderer.resourceManager.getResource(e.compression.compressedData,i.compressedMeshDelegate,{mesh:e,renderer:i.webGLRenderer})}},this)},!0,null))}},webGLRenderer:{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e}},init:{value:function(e){return this.webGLRenderer=e,this.createTechniqueIfNeeded(),this.loadPickingTechnique(),this}},render:{value:function(e,i){this.technique&&this.technique.execute(this.webGLRenderer,e,i)}}})}}),montageDefine("83b66f4","runtime/material",{dependencies:["montage","runtime/component-3d","runtime/animation"],factory:function(e,i){e("montage").Montage;var t=e("runtime/component-3d").Component3D,s=e("runtime/animation").BasicAnimation;i.Material=t.specialize({constructor:{value:function(){this.super(),this.addRangeAtPathChangeListener("filterColor",this,"handleFilterColorChange"),this.addRangeAtPathChangeListener("emission",this,"handleEmissionChange"),this.addOwnPropertyChangeListener("glTFElement",this),this.addOwnPropertyChangeListener("image",this),this.addOwnPropertyChangeListener("opacity",this)}},filterColor:{value:[1,1,1,1]},emission:{value:[0,0,0,0]},_originalOpacity:{value:1,writable:!0},handleGlTFElementChange:{value:function(){this.handleFilterColorChange(),this.handleEmissionChange(),this.handleImageChange(),this._originalOpacity=this._opacity,null==this._opacity?null!=this.glTFElement.parameters.transparency&&(this._originalOpacity=this._opacity=this.glTFElement.parameters.transparency.value):this.handleOpacityChange()}},initialValueForStyleableProperty:{value:function(e){return"opacity"==e?this._originalOpacity:void 0}},handleFilterColorChange:{value:function(){null!=this.glTFElement&&this.glTFElement.parameters.filterColor&&(this.glTFElement.parameters.filterColor.value=this.filterColor,this.scene&&this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleEmissionChange:{value:function(){null!=this.glTFElement&&this.glTFElement.parameters.emission&&(this.glTFElement.parameters.emission.value=this.emission,this.scene&&this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleOpacityChange:{value:function(){null!=this.glTFElement&&this.glTFElement.parameters.transparency&&(this.glTFElement.parameters.transparency.value=this._opacity,this.scene&&this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleImageChange:{value:function(){if(null!=this.glTFElement&&this.glTFElement.parameters.diffuse&&this._image){var e=this.resolvePathIfNeeded(this._image),i=this.parameterForImagePath(e);this.glTFElement.parameters.diffuse=i,this.scene&&this.scene.dispatchEventNamed("textureUpdate",!0,!1,i)}}},parameterForImagePath:{value:function(e){var i={magFilter:WebGLRenderingContext.LINEAR,minFilter:WebGLRenderingContext.LINEAR,type:"sampler",wrapS:WebGLRenderingContext.REPEAT,wrapT:WebGLRenderingContext.REPEAT},t={id:"source-"+e,type:"image",baseId:"source-"+e,description:{path:e}},s={baseId:"texture-"+e,id:"texture-"+e,format:WebGLRenderingContext.RGBA,internalFormat:WebGLRenderingContext.RGBA,sampler:i,source:t,type:"texture",target:WebGLRenderingContext.TEXTURE_2D},a={parameter:"diffuse",value:s};return a}},_image:{value:null,writable:!0},image:{set:function(e){if(e&&0!=e.length){var i=e.toLowerCase();(-1!=i.indexOf(".jpg")||-1!=i.indexOf(".jpeg")||-1!=i.indexOf(".png"))&&this._image!=e&&(this._image=e)}},get:function(){return this._image}},_opacity:{value:null,writable:!0},animationDidStart:{value:function(){}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(){}},opacity_animationSetter:{set:function(e){this._opacity!=e&&(this._opacity=e,this.handleOpacityChange())}},opacity:{set:function(e){if(this._opacity!=e){if(this.glTFElement){var i=this.scene.glTFElement.animationManager;if(i.removeAnimationWithTargetAndPath(this,"opacity_animationSetter"),this._style&&this._style.transitions){var t=this._style.transitions.opacity;if(null!=t&&t.duration>0){var a=Object.create(s).init();return a.path="opacity_animationSetter",a.target=this,a.delegate=this,a.from=Number(this._opacity),a.to=Number(e),a.duration=1e3*t.duration,i.playAnimation(a),a.animationWasAddedToTarget(),i.evaluateAtTime(Date.now()),void 0}}}this._opacity=e}},get:function(){return this._opacity}},_stylableProperties:{value:["opacity"]},styleableProperties:{get:function(){return this._stylableProperties}}})}}),montageDefine("83b66f4","controllers/camera-controller",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities","runtime/transform","montage"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities;var t=e("runtime/transform").Transform,s=e("montage").Montage;i.CameraController=s.specialize({constructor:{value:function(){this.super(),this._lastPosition=[0,0]}},_deltaForEvent:{value:function(e){return null!=e.wheelDeltaY?e.wheelDeltaY:-e.deltaY}},_minimalDistance:{value:0,writable:!0},_computeInitialDistance:{value:function(){if(this.sceneBBox){var e=this.sceneBBox,i=vec3.createFrom((e[1][0]-e[0][0])/2,(e[1][1]-e[0][1])/2,(e[1][2]-e[0][2])/2),t=vec3.length(i),s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2,(e[0][2]+e[1][2])/2],a=vec3.create(this.viewPoint.glTFElement.transform.translation),u=vec3.create();u[0]=s[0]-a[0],u[1]=s[1]-a[1],u[2]=s[2]-a[2];var n=vec3.length(u);this._minimalDistance=t>n?n:t,this.zoomStep=1e-4*t}}},viewPointDidChange:{value:function(){this._computeInitialDistance()}},_viewPoint:{value:null,writable:!0},viewPoint:{get:function(){return this._viewPoint},set:function(e){this._viewPoint!=e&&(this._viewPoint=e,this.viewPointDidChange())}},_node:{value:null,writable:!0},zoomStep:{value:0,writable:!0},sceneBBox:{value:null,writable:!0},nodeDidChange:{value:function(){var e=this.node.glTFElement;this.sceneBBox=e.getBoundingBox(!0),this._computeInitialDistance()}},node:{get:function(){return this._node},set:function(e){this._node!=e&&(this._node=e,this.nodeDidChange())}},_lastPosition:{value:null,writable:!0},_transform:{value:null,writable:!0},_axisUp:{value:null,writable:!0},zoom:{value:function(e){if(!this.moving){var i,t=vec3.create(),s=vec3.create(this.viewPoint.glTFElement.transform.translation);this.node.glTFElement;var a=this.sceneBBox;i=[(a[0][0]+a[1][0])/2,(a[0][1]+a[1][1])/2,(a[0][2]+a[1][2])/2],t[0]=i[0]-s[0],t[1]=i[1]-s[1],t[2]=i[2]-s[2],vec3.normalize(t);var u=this._deltaForEvent(e),n=this.zoomStep*u;s[0]+=n*t[0],s[1]+=n*t[1],s[2]+=n*t[2];var r=vec3.create();r[0]=i[0]-s[0],r[1]=i[1]-s[1],r[2]=i[2]-s[2];var l=vec3.length(r);if(l>this._minimalDistance)this.viewPoint.glTFElement.transform.translation=s;else{var o=u>0?-this._minimalDistance:this._minimalDistance;s[0]=i[0]+t[0]*o,s[1]=i[1]+t[1]*o,s[2]=i[2]+t[2]*o,this.viewPoint.glTFElement.transform.translation=s}}}},translate:{value:function(e){if(this._transform.matrix=this.viewPoint.glTFElement.worldMatrix,0!=this.moving){var i=e.translateX-this._lastPosition[0],t=e.translateY-this._lastPosition[1];this._lastPosition[0]=e.translateX,this._lastPosition[1]=e.translateY,i*=.05,t*=-.05,this._axisUp=vec3.createFrom(0,1,0),mat4.rotateVec3(this._transform.matrix,this._axisUp);var s,a=!1;if(0==a){this.node.glTFElement;var u=this.sceneBBox;s=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2,(u[0][2]+u[1][2])/2]}var n=vec3.create(),r=vec3.create(this._transform.translation);n[0]=s[0]-r[0],n[1]=s[1]-r[1],n[2]=s[2]-r[2];var l=vec3.create(this._axisUp),o=vec3.create();vec3.normalize(n),vec3.cross(n,this._axisUp,o),vec3.normalize(o),vec3.cross(n,o,l),vec3.normalize(l);var c=mat4.identity(),m=0;m=Math.abs(t)>Math.abs(i)?Math.abs(t)/Math.abs(i):Math.abs(i)/Math.abs(t),m>.5?(mat4.rotate(c,i,l),mat4.rotate(c,t,o)):Math.abs(t)>Math.abs(i)?mat4.rotate(c,t,o):mat4.rotate(c,i,l),r[0]-=s[0],r[1]-=s[1],r[2]-=s[2],mat4.rotateVec3(c,r),r[0]+=s[0],r[1]+=s[1],r[2]+=s[2];var d=mat4.identity();mat4.multiply3(c,this._transform.matrix,d);var p=mat4.identity();mat4.translate(p,r);var v=mat4.identity();mat4.multiply(p,d,v),this.viewPoint.glTFElement.transform.matrix=v}}},beginTranslate:{value:function(){this.moving=!0,null==this._transform&&(this._transform=Object.create(t).init()),this._transform.matrix=this.viewPoint.glTFElement.worldMatrix}},endTranslate:{value:function(){this.moving=!1,this._axisUp=null}}})}}),montageDefine("83b66f4","runtime/scene",{dependencies:["montage","runtime/node","montage/core/uuid","runtime/runtime-tf-loader","url","runtime/scene-resource-loader","q","montage/core/target","cssom"],factory:function(e,i){var t=e("montage").Montage,s=e("runtime/node").Node,a=e("montage/core/uuid"),u=e("runtime/runtime-tf-loader").RuntimeTFLoader,n=e("url"),r=e("runtime/scene-resource-loader").SceneResourceLoader,l=e("q"),o=e("montage/core/target").Target,c=e("cssom");i.Scene=o.specialize({constructor:{value:function(){this.super()}},_resourcesLoaded:{value:!1,writable:!0},_glTFElement:{value:null,writable:!0},shouldBeHitTested:{value:!1,writable:!0},glTFElement:{get:function(){return this._glTFElement},set:function(e){this._glTFElement=e}},_rootNode:{value:null,writable:!0},rootNode:{get:function(){return"loaded"===this.status&&null==this._rootNode&&(this._rootNode=t.create(s),this._rootNode.scene=this,this._rootNode.id=this.glTFElement.rootNode.id),this._rootNode}},sceneResourcesDidPrepare:{value:function(){this._resourcesLoaded||(this._prepareToRenderDefer&&this._prepareToRenderDefer.resolve(),this._resourcesLoaded=!0,this.dispatchEventNamed("resourcesDidLoad",!0,!1,this),this.status="loaded")}},isLoaded:{value:function(){return"loaded"==this.status}},status:{value:0,writable:!0},styleSheetsLoaded:{value:!1,writable:!0},styleSheets:{value:null,writable:!0},loadCSSStyles:{value:function(){if(null!=document.styleSheets){var i,t,s=Object.keys(e.packages),a=0,u=document.styleSheets.length,n=[];for(this.styleSheets={},i=0;u>i;i++)t=document.styleSheets[i],null!=t.href?-1!=t.href.indexOf(s[0])&&-1==t.href.indexOf(s[0]+"node_modules")&&n.push(t):t.ownerNode&&t.ownerNode.innerText&&this._addStyleSheets(t.ownerNode.innerText);return u=n.length,0===u?(this.styleSheetsLoaded=!0,void 0):(n.forEach(function(e){var i=this,t=e.href,s=new XMLHttpRequest;s.open("GET",t,!0),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&(i._addStyleSheets(s.responseText,e.href),a++,a===u&&i.dispatchEventNamed("styleSheetsDidLoad",!0,!1,i))},s.send(null)},this),!1)}}},_addStyleSheets:{value:function(e,i){i||(i=a.generate()),this.styleSheets[i]=c.parse(e)}},deserializedFromTemplate:{value:function(e,i,t){this._ownerDocumentPart=t}},_pendingLoading:{value:!1},_loadScene:{value:function(){var i={};if(i.loadCompleted=function(e){this.totalBufferSize=r.totalBufferSize,this.glTFElement=e,this.status="loaded",console.log("scene loaded:"+this._path)}.bind(this),null!=this._path){var t=this._path,s=n.parse(t);if("/"===t[0])t=t.substr(1),t=n.resolve(e.packages[0],t);else if(!s.scheme){if(null==this._ownerDocumentPart)return;var a=this._ownerDocumentPart.template.getBaseUrl();t=n.resolve(a,t)}var r=Object.create(u);this.status="loading",r.initWithPath(t),r.delegate=i,r.load(null,null)}1==this._pendingLoading&&(this.removePathChangeListener("_ownerDocumentPart",this),this._pendingLoading=!1)}},path:{set:function(e){if((!e||-1!==e.indexOf(".json"))&&e!==this._path)if(this._path=e,null==e)this.scene=null;else{var i=e.length>0&&"/"===e[0];0==i&&null==this._ownerDocumentPart?0==this._pendingLoading&&(this.addPathChangeListener("_ownerDocumentPart",this,"_loadScene"),this._pendingLoading=!0):this._loadScene()}},get:function(){return this._path}},_prepareToRenderDefer:{value:null,writable:!0},prepareToRender:{value:function(e){if(null==this._prepareToRenderDefer){this._prepareToRenderDefer=l.defer();var i=Object.create(r).init(this.glTFElement,e,this);i.loadScene()}return this._prepareToRenderDefer.promise}},init:{value:function(e){return e&&(this.glTFElement=e,this.status="loaded"),this}},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("83b66f4","runtime/animation-manager",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/animation"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base;e("runtime/animation").KeyframeAnimation,e("runtime/animation").BasicAnimation;var s=e("runtime/animation").Animation;i.AnimationManager=Object.create(t,{startTime:{get:function(){if(this.animations){if(this.animations.length>0){for(var e=this.animations[0].startTime,i=1;this.animations.length>i;i++)e>this.animations[i].startTime&&(e=this.animations[i].startTime);return e}return 0}}},endTime:{get:function(){if(this.animations){if(this.animations.length>0){for(var e=this.animations[0].endTime,i=1;this.animations.length>i;i++)this.animations[i].endTime>e&&(e=this.animations[i].endTime);return e}return-1}}},_animations:{value:null,writable:!0},animations:{get:function(){return this._animations},set:function(e){this._animations!=e&&(this._animations=e)}},_sceneTime:{value:0,writable:!0},sceneTime:{get:function(){return this._sceneTime},set:function(e){this._delegate&&this._delegate.sceneTimeWillChange&&this._delegate.sceneTimeWillChange(this,e),this._sceneTime=e,this._delegate&&this._delegate.sceneTimeDidChange&&this._delegate.sceneTimeDidChange(this)}},_delegate:{value:0,writable:!0},delegate:{get:function(){return this._delegate},set:function(e){this._delegate=e}},targets:{get:function(){var e=[];return null!=this._animations&&this._animations.forEach(function(i){i.type==s.KEYFRAME?i.channels.forEach(function(i){e.push(i.target.id)},this):i.type==s.BASIC},this),e}},hasAnimation:{value:function(e,i){return null==this._animations?!1:(null==i&&(i=this.targets),-1!==i.indexOf(e))}},nodeHasAnimatedAncestor:{value:function(e){do{if(this.hasAnimation(e.id))return!0;e=e.parent}while(null!=e);return!1}},updateTargetsAtTime:{value:function(e,i){this.animations&&this.animations.forEach(function(t){t.type==s.KEYFRAME?t.updateTargetsAtTime(e,i):t.type==s.BASIC},this)}},evaluateAtTime:{value:function(e){this._activeAnimations&&this._activeAnimations.forEach(function(i){i.type==s.KEYFRAME||i.type==s.BASIC&&i._evaluateAtTime(e)},this)}},hasActiveAnimations:{value:function(){return this._activeAnimations.length>0}},_activeAnimations:{value:0,writable:!0},_removeAnimationAtIndex:{value:function(e){var i=this._activeAnimations[e];i.delegate&&i.delegate.animationDidStop(i),this._activeAnimations.splice(e,1)}},playAnimation:{value:function(e){var i=this;this._activeAnimations.push(e),e.delegate&&e.delegate.animationDidStart(e),setTimeout(function(){var t=i._activeAnimations.indexOf(e);-1!==t&&i._removeAnimationAtIndex(t)},e.duration)}},init:{value:function(){return this.__Base_init(),this.animations=[],this._activeAnimations=[],this}},removeAnimationWithTargetAndPath:{value:function(e,i){if(this._activeAnimations)for(var t=0;this._activeAnimations.length>t;t++){var s=this._activeAnimations[t];if(s.target===e&&s.path==i)return this._removeAnimationAtIndex(t),void 0}}}})}}),montageDefine("83b66f4","runtime/projection",{dependencies:["runtime/dependencies/gl-matrix","runtime/base"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base;i.Projection=Object.create(t,{_matrix:{value:null,writable:!0},_type:{value:null,writable:!0},_xfov:{value:0,writable:!0},_yfov:{value:0,writable:!0},_xmag:{value:0,writable:!0},_ymag:{value:0,writable:!0},_znear:{value:0,writable:!0},_zfar:{value:0,writable:!0},_aspectRatio:{value:0,writable:!0},_dirtyFlag:{value:!1,writable:!0},projection:{get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this._dirtyFlag=!0)}},xfov:{get:function(){return this._xfov},set:function(e){this._xfov!==e&&(this._xfov=e,this._dirtyFlag=!0)}},yfov:{get:function(){return this._yfov},set:function(e){this._yfov!==e&&(this._yfov=e,this._dirtyFlag=!0)}},xmag:{get:function(){return this._xmag},set:function(e){this._xmag!==e&&(this._xmag=e,this._dirtyFlag=!0)}},ymag:{get:function(){return this._ymag},set:function(e){this._ymag!==e&&(this._ymag=e,this._dirtyFlag=!0)}},znear:{get:function(){return this._znear},set:function(e){this._znear!==e&&(this._znear=e,this._dirtyFlag=!0)}},zfar:{get:function(){return this._zfar},set:function(e){this._zfar!==e&&(this._zfar=e,this._dirtyFlag=!0)}},aspectRatio:{get:function(){return this._aspectRatio},set:function(e){var i=this.matrix;i&&(this.yfov?i[0]=this._scaleX/e:this.xfov&&(i[5]=this._scaleY*e)),this._aspectRatio=e}},_scaleX:{value:0,writable:!0},_scaleY:{value:0,writable:!0},matrix:{get:function(){if(this._dirtyFlag){if("perspective"===this.projection){var e=3.14159265359/360,i=0,t=0;this.yfov&&(t=1/Math.tan(this.yfov*e)),i=this.xfov?1/Math.tan(this.xfov*e):t,0==t&&(t=i),this._scaleX=i,this._scaleY=t,this._matrix=mat4.create(),this._matrix[0]=i,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=t,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=(this.zfar+this.znear)/(this.znear-this.zfar),this._matrix[11]=-1,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=2*this.zfar*this.znear/(this.znear-this.zfar),this._matrix[15]=0}else"orthographic"===this.projection?this._matrix=mat4.ortho(-this.xmag,this.xmag,-this.ymag,this.ymag,this.znear,this.zfar):console.log("WARNING: unhandled camera type:"+type);this._dirtyFlag=!1}return this._matrix},set:function(e){this._matrix=e}},initWithDescription:{value:function(e){this.__Base_init(),this.projection=e.type,e=e[this.projection],this.xfov=e.xfov?e.xfov:0,this.yfov=e.yfov?e.yfov:0,this.xmag=e.xmag?e.xmag:1,this.ymag=e.ymag?e.ymag:1,this.znear=null!=e.znear?e.znear:1,this.zfar=null!=e.zfar?e.zfar:100,this.aspectRatio=e.aspect_ratio?e.aspect_ratio:0,this.aspectRatio||(this.aspectRatio=e.aspectRatio?e.aspectRatio:0),this._dirtyFlag=!0}},init:{value:function(){this.__Base_init(),this.projection=null,this.xfov=0,this.yfov=0,this.xmag=1,this.ymag=1,this.znear=1,this.zfar=100,this.aspectRatio=4/3,this._dirtyFlag=!0}}})}}),montageDefine("3c07db4","composer/key-composer",{dependencies:["../core/core","./composer"],factory:function(e,i){var t=e("../core/core").Montage,s=e("./composer").Composer,a="keyPress",u="longKeyPress",n="keyRelease",r=i.KeyComposer=s.specialize({_isLoaded:{value:!1},_shouldDispatchEvent:{value:!1},shouldDispatchLongPress:{value:!1},_longPressTimeout:{value:null},_keyRegistered:{value:!1},_keys:{value:null},keys:{get:function(){return this._keys},set:function(e){this._keyRegistered?(o.defaultKeyManager.unregisterKey(this),this._keys=e,o.defaultKeyManager.registerKey(this)):this._keys=e}},load:{value:function(){this._isLoaded=!0,this._shouldDispatchEvent&&!this._keyRegistered&&(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0)}},unload:{value:function(){this._isLoaded=!1,o.defaultKeyManager.unregisterKey(this),this._keyRegistered=!1
}},addEventListener:{value:function(e,i,t){var r=this.component;s.addEventListener.call(this,e,i,t),(e==a||e==u||e==n)&&(this._shouldDispatchEvent=!0,e==u&&(this._shouldDispatchLongPress=!0),this._isLoaded?this._keyRegistered||(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0):r&&"function"!=typeof r.addComposer&&(this.element||(this.element=window),this.load()))}},constructor:{value:function(){s.constructor.call(this)}},deserializedFromTemplate:{value:function(){var e=this.component;null===this.identifier&&(this.identifier=t.getInfoForObject(this).label),e&&("function"==typeof e.addComposer?e.addComposer(this):this._isLoaded||(this.element||(this.element=window),this.load()))}}},{createKey:{value:function(e,i,t){var s=this;return this===r&&(s=new r),t||(t=e.identifier?e.identifier+i.toLowerCase().replace(/[ +]/g).toCapitalized():i.toLowerCase().replace(/[ +]/g)),s.keys=i,s.identifier=t,e.addComposer(s),s}},createGlobalKey:{value:function(e,i,t){var s=this;return this===r&&(s=new r),s.keys=i,s.identifier=t,e.addComposerForElement(s,window),s}}}),l=null,o=t.specialize({_defaultKeyManager:{value:null},_loadingDefaultKeyManager:{value:!1},_keysToRegister:{value:[]},constructor:{value:function(){}},registerKey:{value:function(i){var t=this;this._defaultKeyManager?this._defaultKeyManager.registerKey(i):(this._keysToRegister.push(i),this._loadingDefaultKeyManager||(this._loadingDefaultKeyManager=!0,e.async("core/event/key-manager").then(function(e){var i=t._defaultKeyManager=e.defaultKeyManager;t._keysToRegister.forEach(function(e){i.registerKey(e)}),t._keysToRegister.length=0}).done()))}},unregisterKey:{value:function(e){this._defaultKeyManager&&this._defaultKeyManager.unregisterKey(e)}}},{defaultKeyManager:{get:function(){return l||(l=new o),this._defaultKeyManager?this._defaultKeyManager:l}}})}}),montageDefine("9276fa5","punycode",{dependencies:[],factory:function(e,i,t){(function(e){function s(e){throw RangeError(w[e])}function a(e,i){for(var t=e.length;t--;)e[t]=i(e[t]);return e}function u(e,i){var t=".";return a(e.split(t),i).join(t)}function n(e){for(var i,t,a=[],u=0,n=e.length;n>u;)i=e.charCodeAt(u++),55296==(63488&i)&&(t=e.charCodeAt(u++),(55296!=(64512&i)||56320!=(64512&t))&&s("ucs2decode"),i=((1023&i)<<10)+(1023&t)+65536),a.push(i);return a}function r(e){return a(e,function(e){var i="";return 55296==(63488&e)&&s("ucs2encode"),e>65535&&(e-=65536,i+=L(55296|1023&e>>>10),e=56320|1023&e),i+=L(e)}).join("")}function l(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:y}function o(e,i){return e+22+75*(26>e)-((0!=i)<<5)}function c(e,i,t){var s=0;for(e=t?T(e/N):e>>1,e+=T(e/i);e>x*P>>1;s+=y)e=T(e/x);return T(s+(x+1)*e/(e+C))}function m(e){var i,t,a,u,n,o,m,d,p,v,g=[],h=e.length,f=0,b=M,q=D;for(t=e.lastIndexOf(A),0>t&&(t=0),a=0;t>a;++a)e.charCodeAt(a)>=128&&s("not-basic"),g.push(e.charCodeAt(a));for(u=t>0?t+1:0;h>u;){for(n=f,o=1,m=y;u>=h&&s("invalid-input"),d=l(e.charCodeAt(u++)),(d>=y||d>T((S-f)/o))&&s("overflow"),f+=d*o,p=q>=m?_:m>=q+P?P:m-q,!(p>d);m+=y)v=y-p,o>T(S/v)&&s("overflow"),o*=v;i=g.length+1,q=c(f-n,i,0==n),T(f/i)>S-b&&s("overflow"),b+=T(f/i),f%=i,g.splice(f++,0,b)}return r(g)}function d(e){var i,t,a,u,r,l,m,d,p,v,g,h,f,b,q,C=[];for(e=n(e),h=e.length,i=M,t=0,r=D,l=0;h>l;++l)g=e[l],128>g&&C.push(L(g));for(a=u=C.length,u&&C.push(A);h>a;){for(m=S,l=0;h>l;++l)g=e[l],g>=i&&m>g&&(m=g);for(f=a+1,m-i>T((S-t)/f)&&s("overflow"),t+=(m-i)*f,i=m,l=0;h>l;++l)if(g=e[l],i>g&&++t>S&&s("overflow"),g==i){for(d=t,p=y;v=r>=p?_:p>=r+P?P:p-r,!(v>d);p+=y)q=d-v,b=y-v,C.push(L(o(v+q%b,0))),d=T(q/b);C.push(L(o(d,0))),r=c(t,f,a==u),t=0,++a}++t,++i}return C.join("")}function p(e){return u(e,function(e){return I.test(e)?m(e.slice(4).toLowerCase()):e})}function v(e){return u(e,function(e){return E.test(e)?"xn--"+d(e):e})}var g,h,f="function"==typeof define&&"object"==typeof define.amd&&define.amd&&define,b="object"==typeof i&&i,q="object"==typeof t&&t,S=2147483647,y=36,_=1,P=26,C=38,N=700,D=72,M=128,A="-",E=/[^ -~]/,I=/^xn--/,w={overflow:"Overflow: input needs wider integers to process.",ucs2decode:"UCS-2(decode): illegal sequence",ucs2encode:"UCS-2(encode): illegal value","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=y-_,T=Math.floor,L=String.fromCharCode;if(g={version:"1.0.0",ucs2:{decode:n,encode:r},decode:m,encode:d,toASCII:v,toUnicode:p},b)if(q&&q.exports==b)q.exports=g;else for(h in g)g.hasOwnProperty(h)&&(b[h]=g[h]);else f?define("punycode",g):e.punycode=g})(this)}}),montageDefine("83b66f4","runtime/scene-helper",{dependencies:["runtime/dependencies/gl-matrix","montage","montage/core/uuid","runtime/glTF-scene","runtime/glTF-node","runtime/scene","runtime/node","runtime/scene-renderer","runtime/glTF-material","runtime/utilities","runtime/projection","runtime/camera","collections/set","runtime/material"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage,s=e("montage/core/uuid").Uuid;e("runtime/glTF-scene").glTFScene;var a=e("runtime/glTF-node").glTFNode;e("runtime/scene").Scene;var u=e("runtime/node").Node;e("runtime/scene-renderer").SceneRenderer,e("runtime/glTF-material").glTFMaterial,e("runtime/utilities").Utilities;var n=e("runtime/projection").Projection,r=e("runtime/camera").Camera;e("runtime/utilities").BBox;var l=e("collections/set"),o=e("runtime/material").Material,c=i.SceneHelper=Object.create(Object.prototype,{getGLTFViewPoints:{value:function(e){var i=[],t=e.glTFElement.rootNode;return t.apply(function(e){return e.cameras&&e.cameras.length&&(i=i.concat(e)),null},!0,null),i}},getViewPoints:{value:function(e){var i=this.getGLTFViewPoints(e),s=[];return i.forEach(function(i){var a=t.create(u);a.scene=e,a.id=i.baseId,s.push(a)},this),s}},createGLTFNodeIncludingCamera:{value:function(e){var i=Object.create(n);i.initWithDescription({type:"perspective",perspective:{yfov:45,aspectRatio:1,znear:.1,zfar:100}});var t=Object.create(r).init();t.projection=i;var u=Object.create(a).init();return t.name=u.name=e,u.id=s.generate(),u.baseId=u.id,u.cameras.push(t),u}},createNodeIncludingCamera:{value:function(e,i){var s=c.createGLTFNodeIncludingCamera(e),a=i.glTFElement;a.ids[s.baseId]=s;var n=t.create(u);return n.scene=i,n.id=s.baseId,n}},getMaterialsFromNode:{value:function(e){var i=e.glTFElement,s=new l,a=e.scene;return null!=i.meshes&&i.meshes.forEach(function(e){e.primitives&&e.primitives.forEach(function(e){var i,u=e.material;null==u.component3D?(i=t.create(o),i.scene=a,i.id=u.baseId,a.glTFElement.ids[u.baseId]=u,u.component3D=i):i=u.component3D,s.add(i)},this)},this),s}},createNodeFromGlTFElementIfNeeded:{value:function(e,i){if(null!=e.component3D)return e.component3D;var t=new u;return i.glTFElement.ids[e.baseId]=e,t.scene=i,t.id=e.baseId,e.component3D=t,t}},createMaterialFromGlTFElementIfNeeded:{value:function(e,i){if(null!=e.component3D)return e.component3D;var t=new o;return i.glTFElement.ids[e.baseId]=e,t.scene=i,t.id=e.baseId,e.component3D=t,t}},getGLTFCamera:{value:function(e){var i=null;if(e.glTFElement){var t=e.glTFElement;null!=t.cameras&&t.cameras.length>0&&(i=t.cameras[0])}return i}}})}}),montageDefine("3c07db4","ui/base/abstract-radio-button",{dependencies:["../../core/core","./abstract-control","../../composer/press-composer","../../composer/key-composer","collections/dict"],factory:function(e,i){var t=(e("../../core/core").Montage,e("./abstract-control").AbstractControl),s=e("../../composer/press-composer").PressComposer,a=e("../../composer/key-composer").KeyComposer;e("collections/dict");var u=i.AbstractRadioButton=t.specialize({constructor:{value:function u(){if(this.constructor===u)throw Error("AbstractRadioButton cannot be instantiated.");t.constructor.call(this),this._pressComposer=new s,this.addComposer(this._pressComposer),this._keyComposer=new a,this._keyComposer.component=this,this._keyComposer.keys="space",this.addComposer(this._keyComposer),this.defineBindings({"classList.has('montage--disabled')":{"<-":"!enabled"},"classList.has('montage--active')":{"<-":"active"},"classList.has('montage-RadioButton--checked')":{"<-":"checked"}})}},active:{value:!1},_checked:{value:null},checked:{set:function(e){this._checked=e},get:function(){return this._checked}},enabled:{value:!0},_keyComposer:{value:null},_radioButtonController:{value:null},radioButtonController:{set:function(e){this._radioButtonController&&this._radioButtonController.unregisterRadioButton(this),this._radioButtonController=e,e.registerRadioButton(this)},get:function(){return this._radioButtonController}},_pressComposer:{value:null},enterDocument:{value:function(e){e&&(this.element.setAttribute("role","radio"),this._keyComposer.addEventListener("keyPress",this,!1),this._keyComposer.addEventListener("keyRelease",this,!1))}},draw:{value:function(){this.checked?this.element.setAttribute("aria-checked","true"):this.element.setAttribute("aria-checked","false")}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1)}},check:{value:function(){this.enabled&&!this.checked&&(this.dispatchActionEvent(),this.checked=!0)}},handlePress:{value:function(){this.active=!1,this.check()}},handlePressCancel:{value:function(){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleKeyPress:{value:function(){this.active=!0}},handleKeyRelease:{value:function(){this.active=!1,this.check()}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},activate:{value:function(){this.check()}}})}}),montageDefine("83b66f4","runtime/mesh-resource-loader",{dependencies:["runtime/resource-loader"],factory:function(e,i){var t=e("runtime/resource-loader").ResourceLoader;i.MeshResourceLoader=Object.create(t,{meshes:{value:null,writable:!0},fireMeshesDidLoadIfNeeded:{value:function(){var e=Object.keys(this._trackedIds);e&&0==e.length&&this.delegate&&this.delegate.meshesDidLoad&&this.delegate.meshesDidLoad(this.meshes)}},resourceAvailable:{value:function(e){this._removeTrackedId(e),this.fireMeshesDidLoadIfNeeded()}},_fetchResources:{value:function(e,i){var t=this.webGLRenderer.webGLContext,s=Object.keys(i);s.forEach(function(s){var a=this.webGLRenderer.resourceManager.getResource(i[s],e,t);null==a&&this._addTrackedId(s)},this)}},_fetchAllResources:{value:function(e){this.webGLRenderer.webGLContext,this._fetchResources(this.webGLRenderer.vertexAttributeBufferDelegate,e.vertexBuffers,!0),this._fetchResources(this.webGLRenderer.indicesDelegate,e.allIndices),this._fetchResources(this.webGLRenderer.textureDelegate,e.textures),this._fetchResources(this.webGLRenderer.programDelegate,e.programs),this.fireMeshesDidLoadIfNeeded()}},_trackProgramsFromMaterial:{value:function(e,i){var t=e.technique;if(t)for(var s in t.passes){var a=t.passes[s],u=a.instanceProgram;u&&(i[u.program.id]=u.program,this._addTrackedId(u.program.id))}}},_trackTexturesFromMaterial:{value:function(e,i){var t=e.parameters;if(t){var s=Object.keys(t);s.length>0&&s.forEach(function(e){var s=t[e];if(s&&s.value){var a=s.value;"texture"===a.type&&(i[a.id]=a,this._addTrackedId(a.id))}},this)}}},_trackIndicesFromPrimitive:{value:function(e,i){var t=e.indices;i[t.id]=t,this._addTrackedId(t.id)}},_trackVertexBuffersFromPrimitive:{value:function(e,i){for(var t in e.semantics){var s=e.semantics[t];i[s.id]=s,this._addTrackedId(s.id)}}},_trackMesh:{value:function(e,i){e.primitives.forEach(function(e){this._trackTexturesFromMaterial(e.material,i.textures),this._trackIndicesFromPrimitive(e,i.allIndices),this._trackVertexBuffersFromPrimitive(e,i.vertexBuffers),this._trackProgramsFromMaterial(e.material,i.programs)},this)}},_trackMeshes:{value:function(e){this.meshes.forEach(function(i){this._trackMesh(i,e,this.webGLRenderer)},this)}},loadMeshes:{value:function(){var e={};e.textures={},e.allIndices={},e.vertexBuffers={},e.programs={},this._trackMeshes(e),this._fetchAllResources(e,this.webGLRenderer)}},init:{value:function(e,i,t){return this.delegate=t,this.webGLRenderer=i,this.meshes=e,i.resourceManager.observers.push(this),this}}})}}),montageDefine("83b66f4","runtime/transform-helper",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/base").Base,e("runtime/utilities").Utilities,i.TransformHelper=Object.create(Object.prototype,{_viewMatrix:{value:null,writable:!0},_worldViewMatrix:{value:null,writable:!0},_worldViewInverseTransposeMatrix:{value:null,writable:!0},_worldViewInverseMatrix:{value:null,writable:!0},_dirty:{value:!0,writable:!0},_id:{value:0,writable:!0},transformWillChange:{value:function(){this._dirty=!0}},transformDidChange:{value:function(){}},_node:{value:null,writable:!0},node:{set:function(e){this._node!=e&&(this._node&&this._node.transform.removeObserver(this),this._node=e,this._node&&this._node.transform.addObserver(this),this._dirty=!0)},get:function(){return this._node}},_viewMatrix:{value:null,writable:!0},viewMatrix:{set:function(e){this._viewMatrix=e,this._dirty=!0},get:function(){return this._viewMatrix}},transformDidUpdate:{value:function(){this._dirty=!0}},updateMatricesIfNeeded:{value:function(){this._dirty&&(mat4.multiply(this._viewMatrix,this._node.worldMatrix,this._worldViewMatrix),mat4.toInverseMat3(this._worldViewMatrix,this._worldViewInverseTransposeMatrix),mat3.transpose(this._worldViewInverseTransposeMatrix),mat4.inverse(this._worldViewMatrix,this._worldViewInverseMatrix),this._dirty=!1)}},worldViewMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewMatrix}},worldViewInverseTransposeMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewInverseTransposeMatrix}},worldViewInverseMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewInverseMatrix}},init:{value:function(){return this._viewMatrix=mat4.identity(),this._worldViewMatrix=mat4.identity(),this._worldViewInverseTransposeMatrix=mat3.identity(),this._worldViewInverseMatrix=mat4.identity(),this}}})}}),montageDefine("83b66f4","runtime/skin",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/base").Base,e("runtime/transform").Transform,e("runtime/utilities").Utilities,i.Skin=Object.create(Object.prototype,{jointsIds:{value:null,writable:!0},nodesForSkeleton:{value:null,writable:!0},bindShapeMatrix:{value:null,writable:!0},inverseBindMatricesDescription:{value:null,writable:!0},matricesForSkeleton:{value:null,writable:!0},sources:{value:null,writable:!0},init:{value:function(){return this.jointsIds=[],this.nodesForSkeleton={},this.matricesForSkeleton={},this.sources=[],this}},inverseBindMatricesDelegate:{value:{handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i){return new Float32Array(i)},resourceAvailable:function(){}}},process:{value:function(e,i){var t=e.instanceSkin.skeletons,s=mat4.create();mat4.inverse(e.worldMatrix,s),t.forEach(function(e){var t=this.nodesForSkeleton[e],a=this.matricesForSkeleton[e];if(!a){var u=16*this.jointsIds.length;a=new Float32Array(u),this.matricesForSkeleton[e]=a;for(var n=mat4.identity(),r=0;u>r;r++)a[r]=n[r%16]}var l=i.getResource(this.inverseBindMatricesDescription,this.inverseBindMatricesDelegate);l&&this.sources.forEach(function(e){for(var i=e,u=this.bindShapeMatrix,n=this.jointsIds.length,r=mat4.create(),o=0;n>o;o++){for(var c=0;16>c;c++)r[c]=l[16*o+c];var m=t[o].worldMatrix,d=mat4.identity();mat4.multiply(d,s),mat4.multiply(d,m),mat4.multiply(d,r),mat4.multiply(d,u);for(var c=0;16>c;c++)a[16*o+c]=d[c]}i.primitives.forEach(function(e){e.material.parameters&&(e.material.parameters.jointMat.value=a)},this)},this)},this)}}})}}),montageDefine("3c07db4","core/radio-button-controller",{dependencies:["./core","./range-controller"],factory:function(e,i){var t=e("./core").Montage,s=e("./range-controller").RangeController;i.RadioButtonController=t.specialize({_radioButtons:{value:null},_content:{value:null},content:{get:function(){return this.getPath("contentController.content")},set:function(e){this.contentController=(new s).initWithContent(e)}},contentController:{value:null},selectedRadioButton:{value:null},_value:{value:null},value:{set:function(e){this._value!==e&&(this._value=e,this._updateRadioButtons())},get:function(){return this._value}},constructor:{value:function(){this._radioButtons=[],this.addRangeAtPathChangeListener("_radioButtons.map{checked}",this,"handleRadioButtonChange"),this.defineBinding("value ",{"<->":"contentController.selection.0"})}},_updateRadioButtons:{value:function(){for(var e=this._value,i=0,t=this._radioButtons.length;t>i;i++)if(e===this._radioButtons[i].value){this._radioButtons[i].checked=!0;break}}},registerRadioButton:{value:function(e){-1===this._radioButtons.indexOf(e)&&(this._radioButtons.push(e),this._updateRadioButtons())}},unregisterRadioButton:{value:function(e){var i=this._radioButtons.indexOf(e);i>=0&&(this._radioButtons.splice(i,1),e===this.selectedRadioButton&&(this.selectedRadioButton=null))}},handleRadioButtonChange:{value:function(e,i,t){if(e[0]===!0)for(var s=0,a=this._radioButtons.length;a>s;s++)s===t?(this.selectedRadioButton=this._radioButtons[s],this.value=this.selectedRadioButton.value):this._radioButtons[s].checked=!1}}},{blueprintModuleId:e("./core")._blueprintModuleIdDescriptor,blueprint:e("./core")._blueprintDescriptor})}}),montageDefine("83b66f4","runtime/node-wrapper",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities","runtime/transform-helper"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities;var t=e("runtime/transform-helper").TransformHelper;i.NodeWrapper=Object.create(Object.prototype,{_transformHelper:{value:null,writable:!0},node:{get:function(){return this._transformHelper.node}},init:{value:function(e){return this._transformHelper=Object.create(t).init(),this._transformHelper.node=e,this}},viewPointWillChange:{value:function(){}},viewPointDidChange:{value:function(){this._transformHelper.viewPoint=this._scenePassRenderer.viewPoint}},viewPointMatrixDidUpdate:{value:function(){this._transformHelper.transformDidUpdate()}},scenePassRenderer:{get:function(){return this._scenePassRenderer},set:function(e){this._scenePassRenderer!=e&&(this._scenePassRenderer&&this._scenePassRenderer.removeObserver(this),this._scenePassRenderer=e,this._transformHelper.viewMatrix=e._viewPointMatrix,this._scenePassRenderer&&this._scenePassRenderer.addObserver(this))}},worldMatrix:{get:function(){return this.node.worldMatrix}},worldViewMatrix:{get:function(){return this._transformHelper.worldViewMatrix}},viewMatrix:{get:function(){return this._transformHelper.viewMatrix}},worldViewInverseMatrix:{get:function(){return this._transformHelper.worldViewInverseMatrix}},worldViewInverseTransposeMatrix:{get:function(){return this._transformHelper.worldViewInverseTransposeMatrix}}})}}),montageDefine("83b66f4","runtime/mesh",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base,s=e("runtime/utilities").Utilities;i.Mesh=Object.create(t,{PRIMITIVES:{value:"primitives"},_primitives:{value:null,writable:!0},primitives:{enumerable:!0,get:function(){return this._primitives},set:function(e){this._primitives=e}},step:{value:0,writable:!0},loadedPrimitivesCount:{value:0,writable:!0},loaded:{get:function(){return this.loadedPrimitivesCount===this.primitives.length}},_id:{value:null,writable:!0},id:{enumerable:!0,get:function(){return this._id},set:function(e){this._id=e}},_name:{value:null,writable:!0},name:{enumerable:!0,get:function(){return this._name},set:function(e){this._name=e}},_computeBBOXIfNeeded:{enumerable:!1,value:function(){if(!this._boundingBox&&this.primitives){var e=this.primitives.length;if(e>0){var i=this.primitives[0].boundingBox;if(i){var t;for(t=1;e>t;t++)this.primitives[t].boundingBox&&(i=s.mergeBBox(i,this.primitives[t].boundingBox));this._boundingBox=i}}}}},_boundingBox:{value:null,writable:!0},boundingBox:{enumerable:!0,get:function(){return this._computeBBOXIfNeeded(),this._boundingBox},set:function(e){this._boundingBox=e}},init:{value:function(){return this.__Base_init(),this._primitives=[],this}}})}}),montageDefine("83b66f4","runtime/primitive",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities,i.Primitive=Object.create(Object.prototype,{_attributesCount:{enumerable:!1,value:0,writable:!0},attributesCount:{enumerable:!1,get:function(){return this._attributesCount}},init:{value:function(){return this.step=0,this.semantics={},this}},_semantics:{enumerable:!1,value:null,writable:!0},semantics:{enumerable:!0,get:function(){return this._semantics},set:function(e){this._semantics=e}},addVertexAttribute:{enumerable:!1,value:function(e){if("POSITION"===e.semantic){var i=null,t=e.attribute;t.min&&t.max&&(i=[t.min,t.max]),this.boundingBox=i}this.semantics[e.semantics]||(this.semantics[e.semantic]=e.attribute,this._attributesCount++)}},_computeBBOXIfNeeded:{enumerable:!1,value:function(){}},_boundingBox:{value:null,writable:!0},boundingBox:{enumerable:!0,get:function(){return this._computeBBOXIfNeeded(),this._boundingBox},set:function(e){this._boundingBox=e}},_indices:{enumerable:!1,value:null,writable:!0},indices:{get:function(){return this._indices},set:function(e){this._indices=e}},_material:{enumerable:!1,value:null,writable:!0},material:{get:function(){return this._material},set:function(e){this._material=e}}})}}),montageDefine("9276fa5","package.json",{exports:{name:"punycode",version:"1.0.0",description:"A robust Punycode converter that fully complies to RFC 3492 and RFC 5891, and works on nearly all JavaScript platforms.",homepage:"http://mths.be/punycode",main:"punycode.js",keywords:["punycode","unicode","idn","url","domain"],licenses:[{type:"MIT",url:"http://mths.be/mit"},{type:"GPL",url:"http://mths.be/gpl"}],author:{name:"Mathias Bynens",email:"mathias@qiwi.be",url:"http://mathiasbynens.be/"},maintainers:[{name:"wizard",email:"wizard@roborooter.com"},{name:"mathias",email:"mathias@qiwi.be"}],bugs:{url:"https://github.com/bestiejs/punycode.js/issues"},repository:{type:"git",url:"git://github.com/bestiejs/punycode.js.git"},engines:["node","rhino"],directories:{doc:"docs",test:"tests"},_npmUser:{name:"mathias",email:"mathias@qiwi.be"},_id:"punycode@1.0.0",dependencies:{},devDependencies:{},_engineSupported:!0,_npmVersion:"1.0.106",_nodeVersion:"v0.6.8",_defaultsLoaded:!0,dist:{shasum:"ce9e6c6e9c1db5827174fceb12ff4938700a1bd3",tarball:"http://registry.npmjs.org/punycode/-/punycode-1.0.0.tgz"},_shasum:"ce9e6c6e9c1db5827174fceb12ff4938700a1bd3",_from:"punycode@>=1.0.0 <1.1.0",_resolved:"https://registry.npmjs.org/punycode/-/punycode-1.0.0.tgz",hash:"9276fa5",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("83b66f4","package.json",{exports:{name:"mjs-volume",version:"0.1.0",dependencies:{montage:"~0.14.0",digit:"~0.5.0",matte:"~0.2.0",q:"0.9.6","native":"~0.2.0",collections:"~0.2.1",cssom:"0.3.0",url:"0.7.9"},repository:{type:"git",url:"https://github.com/fabrobinet/mjs-volume.git"},readmeFilename:"README.md",description:"mjs-volume ==========",bugs:{url:"https://github.com/fabrobinet/mjs-volume/issues"},homepage:"https://github.com/fabrobinet/mjs-volume",_id:"mjs-volume@0.1.0",_shasum:"30d810e111a448d3b4c62a624510d7b0564af32a",_resolved:"git://github.com/fabrobinet/mjs-volume.git#da0c2ef99e56596c1aee0a8b361df25bd28a9e14",_from:"mjs-volume@git://github.com/fabrobinet/mjs-volume.git",hash:"83b66f4",mappings:{montage:{name:"montage",hash:"3c07db4",location:"../montage@3c07db4/"},digit:{name:"digit",hash:"d418305",location:"../digit@d418305/"},matte:{name:"matte",hash:"72fdf72",location:"../matte@72fdf72/"},q:{name:"q",hash:"318ab79",location:"../q@318ab79/"},"native":{name:"native",hash:"192b8e1",location:"../native@192b8e1/"},collections:{name:"collections",hash:"45fb404",location:"../collections@45fb404/"},cssom:{name:"cssom",hash:"4927fd7",location:"../cssom@4927fd7/"},url:{name:"url",hash:"4db6a52",location:"../url@4db6a52/"}},production:!0,useScriptInjection:!0}}),montageDefine("83b66f4","runtime/action-dispatcher",{dependencies:["montage/core/event/event-manager","montage"],factory:function(e,i){var t=e("montage/core/event/event-manager").defaultEventManager,s=e("montage").Montage,a={COMPONENT_ENTER:"hover",_TOUCH_DOWN:"action"};i.ActionDispatcher=s.specialize({constructor:{value:function(){this.super()}},_scene:{value:null},initWithScene:{value:function(e){return this._scene=e,this}},_findPathToParentsForGlTFElement:{value:function(e,i){if(Array.isArray(i)||(i=[e]),e&&e.parent){var t=e.parent;return i.push(t),this._findPathToParentsForGlTFElement(t,i)}return i}},_isRegisteredListenersForEventTypeOnComponent:{value:function(e,i){var s=a[e];if(t&&s&&i.uuid){var u=t.registeredEventListeners[s];if(u)return!!u[i.uuid]}return!1}},_isComponentStyleRespondToAction:{value:function(e,i){var t=a[e],s=i._style;return t&&t!==a._TOUCH_DOWN&&s&&"object"==typeof s&&s.hasOwnProperty(t)}},dispatchActionOnGlTFElement:{value:function(e,i){if("string"==typeof e&&i&&"object"==typeof i){var t=this._findPathToParentsForGlTFElement(i),s=this;t.some(function(t){var a=t.component3D;return a&&(s._isRegisteredListenersForEventTypeOnComponent(e,a)||s._isComponentStyleRespondToAction(e,a))?(a.handleActionOnGlTFElement(i,e),!0):!1})}}}})}}),montageDefine("6054fd6","package.json",{exports:{name:"querystring",id:"querystring",version:"0.1.0",description:"Node's querystring module for all engines.",keywords:["commonjs","query","querystring"],author:{name:"Irakli Gozalishvili",email:"rfobic@gmail.com"},repository:{type:"git",url:"git://github.com/Gozala/querystring.git",web:"https://github.com/Gozala/querystring"},bugs:{url:"http://github.com/Gozala/querystring/issues/"},devDependencies:{test:">=0.4.3"},main:"./querystring.js",engines:{node:">=0.4.x"},scripts:{test:"node tests/test-querystring.js"},_npmUser:{name:"gozala",email:"rfobic@gmail.com"},_id:"querystring@0.1.0",dependencies:{},_engineSupported:!0,_npmVersion:"1.0.101",_nodeVersion:"v0.5.9",_defaultsLoaded:!0,dist:{shasum:"cb76a26cda0a10a94163fcdb3e132827f04b7b10",tarball:"http://registry.npmjs.org/querystring/-/querystring-0.1.0.tgz"},maintainers:[{name:"gozala",email:"rfobic@gmail.com"}],directories:{},_shasum:"cb76a26cda0a10a94163fcdb3e132827f04b7b10",_from:"querystring@>=0.1.0 <0.2.0",_resolved:"https://registry.npmjs.org/querystring/-/querystring-0.1.0.tgz",homepage:"https://github.com/Gozala/querystring",hash:"6054fd6",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("4927fd7","lib/index",{dependencies:["./CSSStyleDeclaration","./CSSRule","./CSSStyleRule","./MediaList","./CSSMediaRule","./CSSImportRule","./CSSFontFaceRule","./StyleSheet","./CSSStyleSheet","./CSSKeyframesRule","./CSSKeyframeRule","./MatcherList","./CSSDocumentRule","./CSSValue","./CSSValueExpression","./parse","./clone"],factory:function(e,i){"use strict";i.CSSStyleDeclaration=e("./CSSStyleDeclaration").CSSStyleDeclaration,i.CSSRule=e("./CSSRule").CSSRule,i.CSSStyleRule=e("./CSSStyleRule").CSSStyleRule,i.MediaList=e("./MediaList").MediaList,i.CSSMediaRule=e("./CSSMediaRule").CSSMediaRule,i.CSSImportRule=e("./CSSImportRule").CSSImportRule,i.CSSFontFaceRule=e("./CSSFontFaceRule").CSSFontFaceRule,i.StyleSheet=e("./StyleSheet").StyleSheet,i.CSSStyleSheet=e("./CSSStyleSheet").CSSStyleSheet,i.CSSKeyframesRule=e("./CSSKeyframesRule").CSSKeyframesRule,i.CSSKeyframeRule=e("./CSSKeyframeRule").CSSKeyframeRule,i.MatcherList=e("./MatcherList").MatcherList,i.CSSDocumentRule=e("./CSSDocumentRule").CSSDocumentRule,i.CSSValue=e("./CSSValue").CSSValue,i.CSSValueExpression=e("./CSSValueExpression").CSSValueExpression,i.parse=e("./parse").parse,i.clone=e("./clone").clone}}),montageDefine("4927fd7","lib/clone",{dependencies:["./CSSStyleSheet","./CSSStyleRule","./CSSMediaRule","./CSSStyleDeclaration","./CSSKeyframeRule","./CSSKeyframesRule"],factory:function(e,i){var t={CSSStyleSheet:e("./CSSStyleSheet").CSSStyleSheet,CSSStyleRule:e("./CSSStyleRule").CSSStyleRule,CSSMediaRule:e("./CSSMediaRule").CSSMediaRule,CSSStyleDeclaration:e("./CSSStyleDeclaration").CSSStyleDeclaration,CSSKeyframeRule:e("./CSSKeyframeRule").CSSKeyframeRule,CSSKeyframesRule:e("./CSSKeyframesRule").CSSKeyframesRule};t.clone=function s(e){var i=new t.CSSStyleSheet,a=e.cssRules;if(!a)return i;for(var u={1:t.CSSStyleRule,4:t.CSSMediaRule,8:t.CSSKeyframesRule,9:t.CSSKeyframeRule},n=0,r=a.length;r>n;n++){var l=a[n],o=i.cssRules[n]=new u[l.type],c=l.style;if(c){for(var m=o.style=new t.CSSStyleDeclaration,d=0,p=c.length;p>d;d++){var v=m[d]=c[d];m[v]=c[v],m._importants[v]=c.getPropertyPriority(v)}m.length=c.length}l.hasOwnProperty("keyText")&&(o.keyText=l.keyText),l.hasOwnProperty("selectorText")&&(o.selectorText=l.selectorText),l.hasOwnProperty("mediaText")&&(o.mediaText=l.mediaText),l.hasOwnProperty("cssRules")&&(o.cssRules=s(l).cssRules)}return i},i.clone=t.clone}}),montageDefine("4db6a52","package.json",{exports:{author:{name:"Joyent",url:"http://www.joyent.com"},name:"url",description:"Node.JS url module",keywords:["ender","pakmanager","url"],publishConfig:{registry:"http://registry.npmjs.org"},version:"0.7.9",homepage:"http://nodejs.org/api/url.html",repository:{type:"git",url:"git://github.com/coolaj86/node.git"},main:"./url.js",directories:{lib:"."},engines:{node:">= 0.2.0",ender:">= 0.5.0"},dependencies:{querystring:">=0.1.0 <0.2.0",punycode:">=1.0.0 <1.1.0"},devDependencies:{},_id:"url@0.7.9",dist:{shasum:"1959b1a8b361fc017b59513a7c7fa9827f5e4ed0",tarball:"http://registry.npmjs.org/url/-/url-0.7.9.tgz"},maintainers:[{name:"coolaj86",email:"coolaj86@gmail.com"}],_shasum:"1959b1a8b361fc017b59513a7c7fa9827f5e4ed0",_from:"url@0.7.9",_resolved:"https://registry.npmjs.org/url/-/url-0.7.9.tgz",bugs:{url:"https://github.com/coolaj86/node/issues"},hash:"4db6a52",mappings:{querystring:{name:"querystring",hash:"6054fd6",location:"../querystring@6054fd6/"},punycode:{name:"punycode",hash:"9276fa5",location:"../punycode@9276fa5/"}},production:!0,useScriptInjection:!0}}),montageDefine("4927fd7","package.json",{exports:{name:"cssom",description:"CSS Object Model implementation and CSS parser",keywords:["CSS","CSSOM","parser","styleSheet"],version:"0.3.0",homepage:"https://github.com/NV/CSSOM",author:{name:"Nikita Vasilyev",email:"me@elv1s.ru"},repository:{type:"git",url:"git://github.com/NV/CSSOM.git"},bugs:{url:"https://github.com/NV/CSSOM/issues"},main:"./lib/index.js",devDependencies:{jake:"~0.7.3"},license:{type:"MIT",url:"http://creativecommons.org/licenses/MIT/"},scripts:{prepublish:"jake lib/index.js"},readmeFilename:"README.mdown",_id:"cssom@0.3.0",dist:{shasum:"386d5135528fe65c1ee1bc7c4e55a38854dbcf7a",tarball:"http://registry.npmjs.org/cssom/-/cssom-0.3.0.tgz"},_resolved:"https://registry.npmjs.org/cssom/-/cssom-0.3.0.tgz",_from:"cssom@0.3.0",_npmVersion:"1.3.8",_npmUser:{name:"domenic",email:"domenic@domenicdenicola.com"},maintainers:[{name:"nv",email:"me@elv1s.ru"},{name:"domenic",email:"domenic@domenicdenicola.com"}],directories:{},_shasum:"386d5135528fe65c1ee1bc7c4e55a38854dbcf7a",hash:"4927fd7",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("83b66f4","runtime/builtin-assets",{dependencies:["q","runtime/runtime-tf-loader"],factory:function(e,i){var t=e("q"),s=e("runtime/runtime-tf-loader").RuntimeTFLoader;i.BuiltInAssets=Object.create(Object.prototype,{_deferredForName:{value:{},writable:!0},_assetInfos:{value:{},writable:!0},registerBuiltinAssetsIfNeeded:{value:function(){var i=e.location+"assets/picking/picking.json",t=e.location+"assets/gradient/gradient.json";this._assetInfos.pickingTechnique={location:i,options:{ids:["pickingTechnique"]}},this._assetInfos.gradient={location:t}
}},assetInfosForName:{value:function(e){return this.registerBuiltinAssetsIfNeeded(),this._assetInfos[e]}},assetWithName:{value:function(e){var i=this._deferredForName[e];if(!i){i=t.defer(),this._deferredForName[e]=i;var a={};a.loadCompleted=function(e){i.resolve(e)}.bind(this);var u=Object.create(s),n=this.assetInfosForName(e);n?(u.initWithPath(n.location),u.delegate=a,u.load(null,n.options)):i.reject("ERROR:"+e+" isn't registered as a built-in asset")}return i.promise}}})}}),montageDefine("6054fd6","querystring",{dependencies:[],factory:function(e,i,t){("undefined"==typeof define?function(s){s(e,i,t)}:define)(function(e,i,t,s){"use strict";var a=i;a.unescape=decodeURIComponent,a.escape=encodeURIComponent;var u=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};a.stringify=a.encode=function(e,i,t,n){switch(i=i||"&",t=t||"=",e=null===e?s:e,typeof e){case"object":return Object.keys(e).map(function(s){return Array.isArray(e[s])?e[s].map(function(e){return a.escape(u(s))+t+a.escape(u(e))}).join(i):a.escape(u(s))+t+a.escape(u(e[s]))}).join(i);default:return n?a.escape(u(n))+t+a.escape(u(e)):""}},a.parse=a.decode=function(e,i,t){i=i||"&",t=t||"=";var s={};return"string"!=typeof e||0===e.length?s:(e.split(i).forEach(function(e){var i=e.split(t),u=a.unescape(i[0],!0),n=a.unescape(i.slice(1).join(t),!0);u in s?Array.isArray(s[u])?s[u].push(n):s[u]=[s[u],n]:s[u]=n}),s)}})}}),montageDefine("3c07db4","composer/composer",{dependencies:["../core/core","../core/target"],factory:function(e,i){var t=(e("../core/core").Montage,e("../core/target").Target);i.Composer=t.specialize({_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},lazyLoad:{value:!1},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:function(){}},_resolveDefaults:{value:function(){null==this.element&&null!=this.component&&(this.element=this.component.element)}},_load:{value:function(){this.element||this._resolveDefaults(),this.load()}},load:{value:function(){}},unload:{value:function(){}},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}})}}),montageDefine("83b66f4","runtime/scene-resource-loader",{dependencies:["runtime/resource-loader","runtime/mesh-resource-loader"],factory:function(e,i){var t=e("runtime/resource-loader").ResourceLoader,s=e("runtime/mesh-resource-loader").MeshResourceLoader;i.SceneResourceLoader=Object.create(t,{_scene:{value:null,writable:!0},scene:{get:function(){return this._scene},set:function(e){this._scene=e}},meshesDidLoad:{value:function(){this.delegate&&this.delegate.sceneResourcesDidPrepare(this.scene)}},loadScene:{value:function(){var e=this;if(this.scene){var i=this.scene.rootNode,t={},a=[];i.apply(function(e){return e.meshes&&e.meshes.length&&e.meshes.forEach(function(e){null==t[e.id]&&(a.push(e),t[e.id]=e)},this),null},!0,null);var u=Object.create(s).init(a,e.webGLRenderer,this);u.loadMeshes()}}},init:{value:function(e,i,t){return t&&(this.delegate=t),this.webGLRenderer=i,this.scene=e,i.resourceManager.observers.push(this),this}}})}}),montageDefine("83b66f4","runtime/technique",{dependencies:["runtime/base"],factory:function(e,i){var t=e("runtime/base").Base;i.Technique=Object.create(t,{_parameters:{value:null,writable:!0},_passName:{value:null,writable:!0},_passes:{value:null,writable:!0},init:{value:function(){return this.__Base_init(),this.passes={},this}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},passName:{get:function(){return this._passName},set:function(e){this._passName!=e&&(this._passName=e)}},rootPass:{get:function(){return this._passes[this.passName]}},passesDidChange:{value:function(){var e=Object.keys(this.passes);this.passName=1==e.length?e[0]:null}},passes:{get:function(){return this._passes},set:function(e){this._passes!=e&&(this._passes=e,this.passesDidChange())}},execute:{value:function(e,i,t){e.resetStates(),this.rootPass.execute(e,i,t)}}})}}),montageDefine("83b66f4","runtime/resource-description",{dependencies:[],factory:function(e,i,t){(function(e,s){"object"==typeof i?s(t.exports):"function"==typeof define&&define.amd?define([],function(){return s(e)}):s(e)})(this,function(e){var i=Object.create(Object.prototype,{_description:{value:null,writable:!0},_id:{value:null,writable:!0},_type:{value:null,writable:!0},init:{enumerable:!0,value:function(e,i){return this._id=e,this._description=i,this}},description:{enumerable:!0,get:function(){return this._description}},id:{enumerable:!0,get:function(){return this._id},set:function(e){this._id=e}},type:{enumerable:!0,get:function(){return this._type},set:function(e){this._type=e}}});return e&&(e.ResourceDescription=i),i})}}),montageDefine("d418305","package.json",{exports:{name:"digit",version:"0.5.1",repository:{type:"git",url:"https://github.com/montagejs/digit.git"},dependencies:{montage:"~0.14.0",matte:"~0.2.0"},devDependencies:{"montage-testing":"~0.4.0"},exclude:["overview.html","overview","run-tests.html","test"],readmeFilename:"README.md",description:"![digit](overview/assets/images/icon.png)",bugs:{url:"https://github.com/montagejs/digit/issues"},homepage:"https://github.com/montagejs/digit",_id:"digit@0.5.1",_from:"digit@~0.5.0",hash:"d418305",mappings:{montage:{name:"montage",hash:"3c07db4",location:"../montage@3c07db4/"},matte:{name:"matte",hash:"72fdf72",location:"../matte@72fdf72/"}},production:!0,useScriptInjection:!0}}),montageDefine("d418305","ui/radio-button.reel/radio-button.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=radio-button.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"radioButton"}}}}</script>\n</head>\n<body>\n    <span data-montage-id=radioButton class=digit-RadioButton>\n        <svg viewbox="0 0 22 22">\n            <path class=digit-RadioButton-icon d="M11,16 C13.7614239,16 16,13.7614239 16,11 C16,8.23857611 13.7614239,6 11,6 C8.23857611,6 6,8.23857611 6,11 C6,13.7614239 8.23857611,16 11,16 L11,16 Z"></path>\n        </svg>\n    </span>\n\n\n</body></html>'}),montageDefine("3c07db4","ui/base/abstract-control",{dependencies:["../../core/core","../component","collections/dict"],factory:function(e,i){var t=(e("../../core/core").Montage,e("../component").Component),s=e("collections/dict");i.AbstractControl=t.specialize({dispatchActionEvent:{value:function(){return this.dispatchEvent(this.createActionEvent())}},_detail:{value:null},detail:{get:function(){return null==this._detail&&(this._detail=new s),this._detail}},createActionEvent:{value:function(){var e,i=document.createEvent("CustomEvent");return e=this._detail,i.initCustomEvent("action",!0,!0,e),i}}})}}),montageDefine("83b66f4","ui/scene-view.reel/scene-view.html",{text:'<!DOCTYPE html><html><head>\n    <title></title>\n    <link rel=stylesheet type=text/css href=scene-view.css>\n\n    <script type=text/montage-serialization>{"owner":{"prototype":"ui/scene-view.reel","properties":{"element":{"#":"component"}}},"canvas":{"value":{"#":"canvas"}}}</script>\n\n</head>\n<body>\n    <div data-montage-id=component class=View>\n        <canvas data-montage-id=canvas class=View-canvas></canvas>\n    </div>\n\n\n</body></html>'}),montageDefine("83b66f4","runtime/resource-loader",{dependencies:[],factory:function(e,i){i.ResourceLoader=Object.create(Object.prototype,{webGLRenderer:{value:null,writable:!0},delegate:{value:null,writable:!0},_trackedIds:{value:null,writable:!0},_addTrackedId:{value:function(e){null==this._trackedIds&&(this._trackedIds={}),this._trackedIds[e]=!0}},_removeTrackedId:{value:function(e){null==this._trackedIds[e]||delete this._trackedIds[e]}}})}}),montageDefine("83b66f4","runtime/camera",{dependencies:["runtime/base"],factory:function(e,i){var t=e("runtime/base").Base;i.Camera=Object.create(t,{_projection:{value:null,writable:!0},projection:{get:function(){return this._projection},set:function(e){this._projection=e}},init:{value:function(){return this.__Base_init(),this}}})}}),montageDefine("d418305","ui/radio-button.reel/radio-button",{dependencies:["montage/ui/base/abstract-radio-button"],factory:function(e,i){var t=e("montage/ui/base/abstract-radio-button").AbstractRadioButton;CLASS_PREFIX="digit-RadioButton",i.RadioButton=t.specialize({constructor:{value:function(){this.super()}}})}}),montageDefine("83b66f4","runtime/base",{dependencies:[],factory:function(e,i){i.Base=Object.create(Object.prototype,{_properties:{value:null,writable:!0},properties:{get:function(){return this._properties},set:function(e){this._properties=e}},__Base_init:{value:function(){this._properties={}}}})}}),montageDefine("9804a56","ui/main.reel/main",{dependencies:["montage/ui/component"],factory:function(e,i){var t=e("montage/ui/component").Component;i.Main=t.specialize({constructor:{value:function(){this.super()}}})}});
bundleLoaded("index.html.bundle-1-0.js")