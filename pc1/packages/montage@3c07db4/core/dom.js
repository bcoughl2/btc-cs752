var Point=require("./geometry/point").Point,NodePrototype=Node.prototype,ElementPrototype=Element.prototype;Object.defineProperty(ElementPrototype,"set",{value:function(e,t,r){var i,n,s,a,o,u=e.indexOf(".",r);r=r||0,n=e.substring(r,-1===u?e.length:u),-1===u?this.setAttribute(n,t):(s=e.lastIndexOf("."),"style"===n?(a=e.substring(u+1,e.length),this.style[a]=t):"classList"===n?(o=e.substring(u+1,e.length),t?this.classList.add(o):this.classList.remove(o)):(i=this.get(e.substring(0,s)))&&(i[e.substring(s+1,e.length)]=t))},enumerable:!1}),NodePrototype.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var r,i;if(null==(r=document.styleSheets[0])){var n=document.createElement("style");n.type="text/css",document.head.appendChild(n),r=document.styleSheets[0]}else i=document.getRule(e,r);i||r.insertRule(e+" "+t,r.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var r;if(t.cssRules)for(var i=0;r=t.cssRules[i];i++){if(r.name&&r.name===e)return r;if(r.selectorText===e)return r}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,r=function(e,t){e.setAttribute("class",t.join(" "))},i=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},n=function(){var e=this,n=e.getAttribute("class")||"";return n=n.replace(t,"").split(/\s+/),{length:n.length,item:function(e){return n[e]||null},contains:function(e){return-1!==i(n,e)},add:function(t){-1===i(n,t)&&(n.push(t),this.length=n.length,r(e,n))},remove:function(t){var s=i(n,t);-1!==s&&(n.splice(s,1),this.length=n.length,r(e,n))},toggle:function(e){-1===i(n,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:n,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,n)}}(),NodePrototype.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var _offsetForElement=function(e){var t,r,i,n,s=e.ownerDocument;if(e&&s){if(r=s.documentElement,i=s.body,n=s.defaultView,e!==i){if(t=e.getBoundingClientRect(),r.parentOf(e)){var a=r.clientTop||i.clientTop||0,o=r.clientLeft||i.clientLeft||0,u=n.pageYOffset||r.scrollTop||i.scrollTop,c=n.pageXOffset||r.scrollLeft||i.scrollLeft,f=t.top+u-a,l=t.left+c-o;return{top:f,left:l}}return{top:t.top,left:t.left}}return{top:i.offsetTop,left:i.offsetLeft}}return null},_webKitPoint=null;try{_webKitPoint=new WebKitPoint(0,0)}catch(e){}var webkitImplementation=function(){exports.convertPointFromNodeToPage=function(e,t){return t?(_webKitPoint.x=t.x,_webKitPoint.y=t.y):(_webKitPoint.x=0,_webKitPoint.y=0),t=webkitConvertPointFromNodeToPage(e,_webKitPoint),t?(new Point).init(t.x,t.y):null},exports.convertPointFromPageToNode=function(e,t){return t?(_webKitPoint.x=t.x,_webKitPoint.y=t.y):(_webKitPoint.x=0,_webKitPoint.y=0),t=webkitConvertPointFromPageToNode(e,_webKitPoint),t?(new Point).init(t.x,t.y):null}},shimImplementation=function(){exports.convertPointFromNodeToPage=function(e,t){if(!e||e.x!==void 0)return null;var r;return(r=_offsetForElement(e))?(new Point).init((t?t.x:0)+r.left,(t?t.y:0)+r.top):(new Point).init(t?t.x:0,t?t.y:0)},exports.convertPointFromPageToNode=function(e,t){if(!e||e.x!==void 0)return null;var r;return(r=_offsetForElement(e))?(new Point).init((t?t.x:0)-r.left,(t?t.y:0)-r.top):(new Point).init(t?t.x:0,t?t.y:0)}};_webKitPoint?webkitImplementation():shimImplementation();