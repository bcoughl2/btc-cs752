var Montage=require("../../core").Montage,Interpreter=require("mousse/deserialization/interpreter").Interpreter,Context=require("mousse/deserialization/context").Context,MontageReviver=require("./montage-reviver").MontageReviver,Promise=require("../../promise").Promise,MontageInterpreter=Montage.specialize.call(Interpreter,{_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new MontageReviver).init(e,t),this._require=e,this}},instantiate:{value:function(e,t,r){var n;return n=(new MontageContext).init(e,this._reviver,t,r,this._require),n.getObjects()}},preloadModules:{value:function(e){var t,r,n,i,a=this._reviver,s=a.moduleLoader,o=[];for(var u in e)t=e[u],r=t.prototype||t.object,r&&(n=MontageReviver.parseObjectLocationId(r),i=s.getModule(n.moduleId,u),Promise.isPromise(i)&&o.push(i));return o.length>0?Promise.all(o):void 0}}}),MontageContext=Montage.specialize.call(Context,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,r,n,i){return Context.call(this,e,t,r),this._element=n,this._require=i,this}},hasObject:{value:function(e){return e in this._serialization}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,r){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:r})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});exports.MontageInterpreter=MontageInterpreter,exports.MontageContext=MontageContext;