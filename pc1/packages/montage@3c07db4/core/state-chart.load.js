montageDefine("3c07db4","core/state-chart",{dependencies:["./core"],factory:function(e,t){var r=e("./core").Montage,i=t.State=r.specialize({_stateChart:{enumerable:!1,value:null},constructor:{value:function i(){this.super()}},init:{value:function(e){this.substates={},this.enterState=null,this.exitState=null;for(var t,r,n=Object.keys(e),a=0;t=n[a];a++)r=e[t],"object"==typeof r&&i.prototype.isPrototypeOf(r)&&(r.name=t,r.parentState=this,this.substates[t]=r),this[t]="string"==typeof r&&"initialSubstate"!==t?this._encloseGotoState(r):r;return this}},name:{enumerable:!1,value:null},_initialSubstate:{enumerable:!1,value:null},initialSubstate:{get:function(){return"string"==typeof this._initialSubstate&&(this._initialSubstate=this[this._initialSubstate]),this._initialSubstate},set:function(e){this._initialSubstate=e}},substates:{enumerable:!1,value:null},parentState:{enumerable:!1,value:null},_path:{enumerable:!1,value:null},path:{enumerable:!1,get:function(){return this._path||(this._path=this.parentState&&this.parentState.path?this.parentState.path+"."+this.name:this.name),this._path}},enterState:{enumerable:!1,value:null},exitState:{enumerable:!1,value:null},isInState:{enumerable:!1,value:function(e){return"string"!=typeof e&&(e=e.name),!!this.path.match(RegExp(".?"+e+".?"))}},_encloseGotoState:{value:function(e){return function(t,r){return this._stateChart._gotoState(e,r)}}},gotoState:{value:function(e,t){return this._stateChart._gotoState(e,t)}},_performAction:{enumerable:null,value:function(e,t,r){if(this[e])this[e](t,r);else{if(!this.parentState)throw"Action '"+e+"' not available";this.parentState._performAction(e,t,r)}}},toString:{enumerable:!1,value:function(){return"[State "+this.path+" ]"}}});t.StateChart=r.specialize({delegate:{enumerable:!1,value:null},ownerStateProperty:{enumerable:!1,value:null},rootState:{enumerable:!1,value:null},_currentState:{enumerable:!1,value:null},currentState:{get:function(){return this.ownerStateProperty?null:this._currentState}},initWithState:{value:function(e){return this._states={},this.rootState=e,this.rootState._stateChart=this,this._prepareState(this.rootState),this.enterDefaultState(),this}},_defaultState:{enumerable:!1,value:null},defaultState:{enumerable:!1,get:function(){if(!this._defaultState){var e,t;for(e=t=this.rootState;t=t.initialSubstate;)e=t;this._defaultState=e}return this._defaultState}},enterDefaultState:{enumerable:!1,value:function(){if(this.ownerStateProperty&&!this.owner)throw"This stateChart has been configured to require an owner to execute this function";var e=this.ownerStateProperty?this.owner:this,t=this.ownerStateProperty?e["_"+this.ownerStateProperty]:e.currentState;if(t)throw"Cannot enter default state from '"+t.name+"'";var r,i;for(r=i=this.rootState;i=i.initialSubstate;)r.enterState&&r.enterState(this,e),r=i,i.initialSubstate&&r.exitState&&r.exitState(this,e);return this.ownerStateProperty?e["_"+this.ownerStateProperty]=this.defaultState:this._currentState=this.defaultState,this.defaultState}},_prepareState:{enumerable:!1,value:function(e){e._stateChart=this,e.name&&(this._states[e.name]=e);var t;for(t in e.substates)this._prepareState(e.substates[t])}},_states:{enumerable:!1,value:null},stateWithName:{enumerable:!1,value:function(e){return this._states[e]}},performAction:{value:function(e,t){if(this.ownerStateProperty&&!t)throw"This stateChart has been configured to require an owner to execute this function";t=this.ownerStateProperty?t:this;var r=this.ownerStateProperty?t[this.ownerStateProperty]:t.currentState;if(!r)throw"Cannot perform action '"+e+"' without a currentState";r._performAction(e,this,t),this.owner=null}},_gotoState:{value:function(e,t){if(this.ownerStateProperty&&!t)throw"This stateChart has been configured to require an owner to execute this function";t=this.ownerStateProperty?t:this;var r,i,n,a,s,o,l,u,c,f,d,h=this.ownerStateProperty?t[this.ownerStateProperty]:t.currentState,p=h.name,m=e,v=!1,b=!1,g=!1,y=!1;if("string"==typeof m?e=this._states[e]:m=e.name,m!==p&&(this.delegate&&(v="function"==typeof this.delegate.stateChartWillExitState,b="function"==typeof this.delegate.stateChartWillEnterState,g="function"==typeof this.delegate.stateChartDidExitState,y="function"==typeof this.delegate.stateChartDidEnterState),!this.delegate||"function"!=typeof this.delegate.stateChartShouldGoFromStateToState||this.delegate.stateChartShouldGoFromStateToState(this,h,e))){if(this.delegate&&"function"==typeof this.delegate.stateChartWillGoFromStateToState&&this.delegate.stateChartWillGoFromStateToState(this,h,e),r=h.path,i=e.path,RegExp(r).test(i))for(a=i.replace(RegExp(r+".?"),"").split("."),s=a.length,n=0;s>n;n++)f=this._states[a[n]],b&&this.delegate.stateChartWillEnterState(this,f),"function"==typeof f.enterState&&f.enterState(this,t),y&&this.delegate.stateChartDidEnterState(this,f);else{for(r=r.split("."),i=i.split("."),o=-1,u=i.length,c=Math.min(r.length,u);c>o&&(l=o+1,r[l]===i[l]);)o++;for(n=r.length-1;n>o;n--)f=this._states[r[n]],v&&this.delegate.stateChartWillExitState(this,f),"function"==typeof f.exitState&&f.exitState(this,t),g&&this.delegate.stateChartDidExitState(this,f);for(o=0>o?0:o,n=o;u>n;n++)f=this._states[i[n]],b&&this.delegate.stateChartWillEnterState(this,f),this.ownerStateProperty?t["_"+this.ownerStateProperty]=f:this._currentState=f,"function"==typeof f.enterState&&f.enterState(this,t),y&&this.delegate.stateChartDidEnterState(this,f)}d=h,this.delegate&&"function"==typeof this.delegate.stateChartDidGoFromStateToState&&this.delegate.stateChartDidGoFromStateToState(this,d,e),"function"==typeof t.transitionedFromStateToState&&t.transitionedFromStateToState(this,d,e)}}}})}});