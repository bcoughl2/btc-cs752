"use strict";var Montage=require("../core").Montage,Promise=require("../promise").Promise,RemoteReference=require("./remote-reference").RemoteReference,BinderModule=require("./binder"),logger=require("../logger").logger("blueprint");exports.BinderReference=RemoteReference.create(RemoteReference,{constructor:{value:function(){this.superForValue("constructor")()}},identifier:{get:function(){return this._reference||(this._reference=this.referenceFromValue(this._value)),["binder",this._reference.binderName.toLowerCase(),"reference"].join("_")}},valueFromReference:{value:function(e,t){var r=e.binderName,n=e.binderModuleId,i=Promise.defer(),a=BinderModule.Binder.manager.binderForName(r);if(a)i.resolve(a);else try{var s=t,o=n.indexOf("/");if(o>0){var u=n.substring(0,o),l=t.mappings;u in l&&(n=n.substring(o+1),s=s.getPackage(l[u].location))}i=BinderModule.Binder.getBinderWithModuleId(n,s)}catch(c){i.reject(Error("Error cannot find Blueprint Binder "+n))}return i.promise}},referenceFromValue:{value:function(e){var t={};return t.binderName=e.name,t.binderModuleId=e.binderModuleId,t}}});