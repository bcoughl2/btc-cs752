var CSSOM={CSSValue:require("./CSSValue").CSSValue};CSSOM.CSSValueExpression=function(e,t){this._token=e,this._idx=t},CSSOM.CSSValueExpression.prototype=new CSSOM.CSSValue,CSSOM.CSSValueExpression.prototype.constructor=CSSOM.CSSValueExpression,CSSOM.CSSValueExpression.prototype.parse=function(){for(var e,t=this._token,n=this._idx,i="",r="",a="",s=[];;++n){if(i=t.charAt(n),""==i){a="css expression error: unfinished expression!";break}switch(i){case"(":s.push(i),r+=i;break;case")":s.pop(i),r+=i;break;case"/":(e=this._parseJSComment(t,n))?e.error?a="css expression error: unfinished comment in expression!":n=e.idx:(e=this._parseJSRexExp(t,n))?(n=e.idx,r+=e.text):r+=i;break;case"'":case'"':e=this._parseJSString(t,n,i),e?(n=e.idx,r+=e.text):r+=i;break;default:r+=i}if(a)break;if(0==s.length)break}var o;return o=a?{error:a}:{idx:n,expression:r}},CSSOM.CSSValueExpression.prototype._parseJSComment=function(e,t){var n,i=e.charAt(t+1);if("/"==i||"*"==i){var r,a,s=t;return"/"==i?a="\n":"*"==i&&(a="*/"),r=e.indexOf(a,s+1+1),-1!==r?(r=r+a.length-1,n=e.substring(t,r+1),{idx:r,text:n}):(error="css expression error: unfinished comment in expression!",{error:error})}return!1},CSSOM.CSSValueExpression.prototype._parseJSString=function(e,t,n){var i,r=this._findMatchedIdx(e,t,n);return-1===r?!1:(i=e.substring(t,r+n.length),{idx:r,text:i})},CSSOM.CSSValueExpression.prototype._parseJSRexExp=function(e,t){var n=e.substring(0,t).replace(/\s+$/,""),i=[/^$/,/\($/,/\[$/,/\!$/,/\+$/,/\-$/,/\*$/,/\/\s+/,/\%$/,/\=$/,/\>$/,/\<$/,/\&$/,/\|$/,/\^$/,/\~$/,/\?$/,/\,$/,/delete$/,/in$/,/instanceof$/,/new$/,/typeof$/,/void$/],r=i.some(function(e){return e.test(n)});if(r){var a="/";return this._parseJSString(e,t,a)}return!1},CSSOM.CSSValueExpression.prototype._findMatchedIdx=function(e,t,n){for(var i,r=t,a=-1;;){if(i=e.indexOf(n,r+1),-1===i){i=a;break}var s=e.substring(t+1,i),o=s.match(/\\+$/);if(!o||0==o[0]%2)break;r=i}var l=e.indexOf("\n",t+1);return i>l&&(i=a),i},exports.CSSValueExpression=CSSOM.CSSValueExpression;