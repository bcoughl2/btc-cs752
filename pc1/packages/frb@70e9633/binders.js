function getStackTrace(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function bindProperty(e,t,n,i,r,a){return n(autoCancelPrevious(function(n){if(!r.isActive)try{r.isActive=!0,a&&console.log("SET",a.targetPath,"TO",n,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),Array.isArray(e)&&t>>>0===t?e.set(t,n):e[t]=n}finally{r.isActive=!1}}),i)}function makePropertyBinder(e,t){return function(n,i,r,a,s){return t(autoCancelPrevious(function(t){return null!=t?e(autoCancelPrevious(function(e){return null!=e?e.bindProperty?e.bindProperty(t,n,i,a,s):_bindProperty(e,t,n,i,a,s):void 0}),r):void 0}),r)}}function bindGet(e,t,n,i,r,a){return n(autoCancelPrevious(function(n){if(!r.isActive)try{r.isActive=!0,a&&console.log("SET FOR KEY",t,"TO",n,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),e.set(t,n)}finally{r.isActive=!1}}),i)}function makeGetBinder(e,t){return function(n,i,r,a,s){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){return null!=t?_bindGet(e,t,n,i,a,s):void 0}),r):void 0}),r)}}function makeHasBinder(e,t){return function(n,i,r,a,s){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){return null!=t?n(autoCancelPrevious(function(n){if(n)(e.has||e.contains).call(e,t)||(s&&console.log("ADD",t,"TO",s.targetPath,"BECAUSE",s.sourcePath,getStackTrace()),e.add(t));else for(;(e.has||e.contains).call(e,t);)s&&console.log("REMOVE",t,"FROM",s.targetPath,"BECAUSE",s.sourcePath,getStackTrace()),(e.remove||e["delete"]).call(e,t)}),i):void 0}),r):void 0}),r)}}function makeEqualityBinder(e,t){return function(n,i,r,a,s){return n(autoCancelPrevious(function(n){return n?(s&&console.log("BIND",s.targetPath,"TO",s.sourcePath,getStackTrace()),e(t,i,i,a,s),function(){s&&console.log("UNBIND",s.targetPath,"FROM",s.sourcePath,getStackTrace())}):void 0}),r)}}function makeEveryBlockBinder(e,t,n){return function(i,r,a,s,o){return i(autoCancelPrevious(function(i){return i?e(autoCancelPrevious(function(e){function i(e,i,l){cancelEach(r.slice(l,l+i.length)),r.swap(l,i.length,e.map(function(e){var i=a.nest(e);return t(n,i,i,s,o)}))}if(e){var r=[],l=observeRangeChange(e,i,a);return function(){cancelEach(r),l()}}}),a):void 0}),r)}}function makeAndBinder(e,t,n,i,r,a){var s=makeNotObserver(i),o=makeAndObserver(n,s);return function(n,i,s,l,c){return n(autoCancelPrevious(function(n){if(null!=n){if(n){var i=e(r,trueScope,s,l,c),u=t(a,trueScope,s,l,c);return function(){i(),u()}}return e(o,s,s,l,c)}}),i)}}function makeOrBinder(e,t,n,i,r,a){var s=makeNotObserver(i),o=makeOrObserver(n,s);return function(n,i,s,l,c){return n(autoCancelPrevious(function(n){if(null!=n){if(n)return e(o,s,s,l,c);var i=e(r,falseScope,s,l,c),u=t(a,falseScope,s,l,c);return function(){i(),u()}}}),i)}}function makeConditionalBinder(e,t,n){return function(i,r,a,s,o){return e(autoCancelPrevious(function(e){return null!=e?e?t(i,r,a,s,o):n(i,r,a,s,o):void 0}),r)}}function makeOnlyBinder(e){return function(t,n,i){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){null!=t&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),n):void 0}),i)}}function makeOneBinder(e){return function(t,n,i){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){null!=t&&t!==e.one()&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),n):void 0}),i)}}function makeRangeContentBinder(e,t){return function(n,i,r,a,s){return e(autoCancelPrevious(function(e){return e?n(autoCancelPrevious(function(t){function n(t,n,i){isActive(e)||(s&&console.log("SWAPPING",n,"FOR",t,"AT",i,"ON",s.targetPath,getStackTrace()),e.swap?e.swap(i,n.length,t):e.add&&(e.remove||e["delete"])&&(t.forEach(e.add,e),n.forEach(e.remove||e["delete"],e)))}if(t!==e){if(!t)return e.clear(),void 0;if(t.addRangeChangeListener)return t.addRangeChangeListener(n),n(Array.from(t),Array.from(e),0),function(){t.removeRangeChangeListener(n)}}}),i):t(Observers.makeLiteralObserver([]),i,r,a,s)}),r)}}function makeMapContentBinder(e){return function(t,n,i,r,a){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){function n(t,n){if(!r.isActive)try{r.isActive=!0,void 0===t?(a&&a&&console.log("DELETED",a.targetPath,"FOR KEY",n,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),Array.isArray(e)?e.splice(n,1):e["delete"](n)):(a&&a&&console.log("SET",a.targetPath,"FOR KEY",n,"TO",t,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),e.set(n,t))}finally{r.isActive=!1}}return t?(e.clear(),t.forEach(n),t.addMapChangeListener(n)):(e.clear(),void 0)}),n):void 0}),i)}}function makeReversedBinder(e){return function(t,n,i){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){function n(t,n,i){if(!isActive(e)){var r=e.length-i-n.length;e.swap(r,n.length,t.reversed())}}return t?(t.addRangeChangeListener(n),n(t,e,0),function(){t.removeRangeChangeListener(n)}):(e.clear(),void 0)}),n):void 0}),i)}}function makeDefinedBinder(e){return function(t,n,i,r,a){return t(autoCancelPrevious(function(t){return t?Function.noop:e(observeUndefined,n,i,r,a)}),i)}}function makeParentBinder(e){return function(t,n,i,r,a){return i.parent?e(t,n,i.parent,r,a):void 0}}function makeWithBinder(e,t){return function(n,i,r,a,s){return e(autoCancelPrevious(function(e){return null!=e?t(n,i,r.nest(e),a,s):void 0}),r)}}function isActive(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var Scope=require("./scope"),Observers=require("./observers"),autoCancelPrevious=Observers.autoCancelPrevious,observeRangeChange=Observers.observeRangeChange,cancelEach=Observers.cancelEach,makeNotObserver=Observers.makeNotObserver,makeOrObserver=Observers.makeOrObserver,makeAndObserver=Observers.makeAndObserver,observeValue=Observers.observeValue,observeUndefined=Observers.makeLiteralObserver(),trueScope=new Scope(!0),falseScope=new Scope(!1);exports.bindProperty=bindProperty;var _bindProperty=bindProperty;exports.makePropertyBinder=makePropertyBinder,exports.bindGet=bindGet;var _bindGet=bindGet;exports.makeGetBinder=makeGetBinder,exports.makeHasBinder=makeHasBinder,exports.makeEqualityBinder=makeEqualityBinder,exports.makeEveryBlockBinder=makeEveryBlockBinder,exports.makeAndBinder=makeAndBinder,exports.makeOrBinder=makeOrBinder,exports.makeConditionalBinder=makeConditionalBinder,exports.makeOnlyBinder=makeOnlyBinder,exports.makeOneBinder=makeOneBinder,exports.makeRangeContentBinder=makeRangeContentBinder,exports.makeMapContentBinder=makeMapContentBinder,exports.makeReversedBinder=makeReversedBinder,exports.makeDefinedBinder=makeDefinedBinder,exports.makeParentBinder=makeParentBinder,exports.makeWithBinder=makeWithBinder;