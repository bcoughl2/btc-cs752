var Component=require("montage/ui/component").Component,dom=require("montage/core/dom");exports.InputRange=Component.specialize({_min:{value:null},min:{get:function(){return this._min},set:function(e){this._min="string"==typeof e?parseFloat(e):e,this.needsDraw=!0}},_max:{value:null},max:{get:function(){return this._max},set:function(e){this._max="string"==typeof e?parseFloat(e):e,this.needsDraw=!0}},_step:{value:null},step:{get:function(){return this._step},set:function(e){this._step="string"==typeof e?parseFloat(e):e,this.needsDraw=!0}},_width:{value:null},width:{get:function(){return this._width},set:function(e){this._width="string"==typeof e?parseFloat(e):e,this.needsDraw=!0}},percent:{value:null},_valueSyncedWithPosition:{value:null},_value:{value:null},value:{get:function(){return this._value},set:function(e,t){this._value="string"==typeof e?parseFloat(e):e,t?this._valueSyncedWithPosition=!0:(this._valueSyncedWithPosition=!1,this.needsDraw=!0)}},_handleEl:{value:null},_translateComposer:{value:null},_sliderWidth:{value:null},__positionX:{value:null},_positionX:{get:function(){return this.__positionX},set:function(e,t){null===e||isNaN(e)||(this.__positionX=e,t||this._calculateValueFromPosition(),this.needsDraw=!0)}},_touchOnHandle:{value:null},__clickTarget:{value:null},_clickTarget:{get:function(){return this.__clickTarget},set:function(e){this.__clickTarget=e,this.needsDraw=!0}},_handleWidth:{value:null},_calculateValueFromPosition:{value:function(){if(this._sliderWidth>0){var e=this.percent=100*(this._positionX/this._sliderWidth),t=this.min+e/100*(this.max-this.min);Object.getPropertyDescriptor(this,"value").set.call(this,t,!0),this._valueSyncedWithPosition=!0}}},_calculatePositionFromValue:{value:function(){if(this._sliderWidth){var e;this.value;var t=this.max-this.min;e=100*((this.value-this.min)/t);var n=e/100*this._sliderWidth;Object.getPropertyDescriptor(this,"_positionX").set.call(this,n,!0),this.percent=e,this._valueSyncedWithPosition=!0}else this._valueSyncedWithPosition=!1}},enterDocument:{value:function(e){e&&(this.min=this.min||this.element.getAttribute("min")||0,this.max=this.max||this.element.getAttribute("max")||100,this.step=this.step||this.element.getAttribute("step")||1,this.value=this.value||this.element.getAttribute("value")||0)}},prepareForActivationEvents:{value:function(){this._translateComposer.addEventListener("translateStart",this,!1),this._translateComposer.addEventListener("translate",this,!1),this._translateComposer.addEventListener("translateEnd",this,!1),this._addEventListeners()}},_addEventListeners:{value:function(){window.Touch?this.element.addEventListener("touchstart",this,!1):this.element.addEventListener("mousedown",this,!1),this._touchOnHandle=!1}},_removeEventListeners:{value:function(){window.Touch?this.element.removeEventListener("touchstart",this,!1):this.element.removeEventListener("mousedown",this,!1)}},_startTranslateX:{enumerable:!1,value:null},_startPositionX:{enumerable:!1,value:null},handleTranslateStart:{value:function(e){this._startTranslateX=e.translateX,this._startPositionX=this.__positionX,this._removeEventListeners(),this._valueSyncedWithPosition=!1}},handleTranslate:{value:function(e){if(!window.Touch||window.Touch&&this._touchOnHandle){var t=this._startPositionX+e.translateX-this._startTranslateX;0>t?t=0:t>this._sliderWidth&&(t=this._sliderWidth),this._positionX=t}}},handleTranslateEnd:{value:function(){this._addEventListeners()}},handleMousedown:{value:function(e){this._clickTarget={x:e.pageX,y:e.pageY}}},handleTouchstart:{value:function(e){var t=e.targetTouches[0];this._touchOnHandle=t.target===this._handleEl}},surrenderPointer:{value:function(){return!1}},willDraw:{value:function(){if(this._handleWidth=this._handleEl.offsetWidth,this._sliderWidth=this.element.offsetWidth-this._handleWidth,this._clickTarget){var e=dom.convertPointFromNodeToPage(this.element).x,t=this._clickTarget.x-(e+this._handleWidth/2);0>t&&(t=0),this._positionX=t,this._clickTarget=null}this._valueSyncedWithPosition||this._calculatePositionFromValue()}},draw:{value:function(){var e=this._handleEl;null!=e.style.webkitTransform?e.style.webkitTransform="translate3d("+this._positionX+"px,0,0)":null!=e.style.MozTransform?e.style.MozTransform="translate3d("+this._positionX+"px,0,0)":null!=e.style.transform?e.style.transform="translate3d("+this._positionX+"px,0,0)":e.style.left=this._positionX+"px"}}});