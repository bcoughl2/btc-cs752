montageDefine("83b66f4","runtime/utilities",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,t){e("runtime/dependencies/gl-matrix"),t.BBox=Object.create(Object.prototype,{_dirty:{value:!0,writable:!0},_size:{value:null,writable:!0},_min:{value:null,writable:!0},_max:{value:null,writable:!0},min:{get:function(){return this._min},set:function(e){this._min=e,this._dirty=!0}},max:{get:function(){return this._max},set:function(e){this._max=e,this._dirty=!0}},init:{value:function(e,t){return this.min=e,this.max=t,this}},size:{get:function(){if(this._dirty){var e=this.min,t=this.max;this._size=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],this._dirty=!1}return this._size}},computeScaleFactor:{value:function(){var e=this.size,t=e[0]>e[1]?e[0]:e[1];return t=e[2]>t?e[2]:t,t=1/t}},computeUnitMatrix:{value:function(e){var t=this.size,i=this.min;null==e&&(e=[0,0,0]);var n=this.computeScaleFactor(),r=mat4.scale(mat4.identity(),[n,n,n]),a=vec3.createFrom(e[0]-(t[0]/2+i[0]),e[1]-(t[1]/2+i[1]),e[2]-(t[2]/2+i[2])),s=mat4.translate(r,[a[0],a[1],a[2]]);return s}}}),t.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[2]<e[2]&&(e[2]=t[2])}},vec3Max:{value:function(e,t){t[0]>e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),t[2]>e[2]&&(e[2]=t[2])}},mergeBBox:{value:function(e,t){var i=e[0],n=e[1],r=t[0],a=t[1],s=[i[0]<r[0]?i[0]:r[0],i[1]<r[1]?i[1]:r[1],i[2]<r[2]?i[2]:r[2]],o=[n[0]>a[0]?n[0]:a[0],n[1]>a[1]?n[1]:a[1],n[2]>a[2]?n[2]:a[2]];return[s,o]}},computeBBOXFromVec3Array:{value:function(e){if(0===e.length)return null;for(var t=[e[0][0],e[0][1],e[0][2]],i=[e[0][0],e[0][1],e[0][2]],n=0;8>n;n++)e[n][0]<t[0]&&(t[0]=e[n][0]),e[n][1]<t[1]&&(t[1]=e[n][1]),e[n][2]<t[2]&&(t[2]=e[n][2]),e[n][0]>i[0]&&(i[0]=e[n][0]),e[n][1]>i[1]&&(i[1]=e[n][1]),e[n][2]>i[2]&&(i[2]=e[n][2]);return[t,i]}},transformBBox:{value:function(e,t){var i=e[0],n=e[1],r=0,a=1,s=2,o=mat4.multiplyVec3(t,vec3.createFrom(i[r],i[a],i[s])),l=mat4.multiplyVec3(t,vec3.createFrom(n[r],i[a],i[s])),u=mat4.multiplyVec3(t,vec3.createFrom(i[r],n[a],i[s])),c=mat4.multiplyVec3(t,vec3.createFrom(n[r],n[a],i[s])),h=mat4.multiplyVec3(t,vec3.createFrom(i[r],i[a],n[s])),d=mat4.multiplyVec3(t,vec3.createFrom(n[r],i[a],n[s])),m=mat4.multiplyVec3(t,vec3.createFrom(i[r],n[a],n[s])),f=mat4.multiplyVec3(t,vec3.createFrom(n[r],n[a],n[s]));return this.computeBBOXFromVec3Array([o,l,u,c,h,d,m,f])}},rayIntersectsMesh:{value:function(e,t,i,n,r){var a=t.verticesBuffer;if(null===a)return!1;var s=!1,o=t.primitives.length;vec3.create(),vec3.create(),vec3.create();for(var l=0;o>l;l++){var u=t.primitives[l];if(r){var c=r.materials;if(c&&-1==c.indexOf(u.material.name))continue}if(!(null!==u.material.inputs.transparency&&u.material.inputs.transparency!==void 0&&1>u.material.inputs.transparency)){var h=u.boundingBox;if(this.intersectsBBOX(h,e))return!0}}return s}},intersectsBBOX:{value:function(e,t){var i,n,r,a,s,o,l=0,u=1,c=2,h=t[1],d=t[0],m=e[0],f=e[1];return h[l]>=0?(i=(m[l]-d[l])/h[l],n=(f[l]-d[l])/h[l]):(i=(f[l]-d[l])/h[l],n=(m[l]-d[l])/h[l]),h[u]>=0?(r=(m[u]-d[u])/h[u],a=(f[u]-d[u])/h[u]):(r=(f[u]-d[u])/h[u],a=(m[u]-d[u])/h[u]),i>a||r>n?!1:(r>i&&(i=r),n>a&&(n=a),h[c]>=0?(s=(m[c]-d[c])/h[c],o=(f[c]-d[c])/h[c]):(s=(f[c]-d[c])/h[c],o=(m[c]-d[c])/h[c]),i>o||s>n?!1:(s>i&&(i=s),n>o&&(n=o),!0))}},inverpolateAxisAngle:{value:function(e,t,n,r){var a=0,s=1,o=2,l=s,u=e,c=t;if(l==a){vec3.normalize(u),vec3.normalize(c);var h=vec3.create();vec3.cross(u,c,h),Math.sqrt(vec3.dot(u,u)),Math.sqrt(vec3.dot(c,c));var d=Math.acos(vec3.dot(u,c)),m=mat4.identity();mat4.rotate(m,d*n,h),mat4.multiplyVec3(m,u,h),vec3.normalize(h);var f=u[3]+(c[3]-u[3])*n;quat4.fromAngleAxis(f,h,r)}else if(l==s){for(i=0;r.length>i;i++){var p=u[i],_=c[i];c[i]=p+(_-p)*n}quat4.fromAngleAxis(c[3],c,r)}else l==o&&quat4.slerp(e,t,n,r)}},interpolateVec:{value:function(e,t,n,r){for(i=0;r.length>i;i++){var a=e[i],s=t[i];r[i]=a+(s-a)*n}}},idx:{value:function(e,t){return 4*e+t}},decomposeMat4:{value:function(e,t,i,n){var r,a,s=mat4.create(),o=mat4.create();mat4.create(),mat4.create();var l=[vec3.create(),vec3.create(),vec3.create()];mat4.set(e,s);var u,c;for(r=0;4>r;r++)for(a=0;4>a;a++)u=this.idx(r,a),c=this.idx(3,3),s[u]/=s[c];for(mat4.set(s,o),r=0;3>r;r++)u=this.idx(r,3),o[u]=0;for(u=this.idx(3,3),o[u]=1,(0!=s[this.idx(0,3)]||0!=s[this.idx(1,3)]||0!=s[this.idx(2,3)])&&(s[this.idx(0,3)]=0,s[this.idx(1,3)]=0,s[this.idx(2,3)]=0,s[this.idx(3,3)]=1),t&&(t[0]=s[this.idx(3,0)],t[1]=s[this.idx(3,1)],t[2]=s[this.idx(3,2)]),s[this.idx(3,0)]=0,s[this.idx(3,1)]=0,s[this.idx(3,2)]=0,r=0;3>r;r++)l[r][0]=s[this.idx(r,0)],l[r][1]=s[this.idx(r,1)],l[r][2]=s[this.idx(r,2)];null!=n&&(n[0]=vec3.length(l[0]),n[1]=vec3.length(l[1]),n[2]=vec3.length(l[2])),vec3.normalize(l[0]),vec3.normalize(l[1]),vec3.normalize(l[2]);var h=vec3.create();if(vec3.cross(l[1],l[2],h),0>vec3.dot(l[0],h))for(r=0;3>r;r++)null!=n&&(n[r]*=-1),l[r][0]*=-1,l[r][1]*=-1,l[r][2]*=-1;null!=i&&(i[0]=.5*Math.sqrt(Math.max(1+l[0][0]-l[1][1]-l[2][2],0)),i[1]=.5*Math.sqrt(Math.max(1-l[0][0]+l[1][1]-l[2][2],0)),i[2]=.5*Math.sqrt(Math.max(1-l[0][0]-l[1][1]+l[2][2],0)),i[3]=.5*Math.sqrt(Math.max(1+l[0][0]+l[1][1]+l[2][2],0)),l[2][1]>l[1][2]&&(i[0]=-i[0]),l[0][2]>l[2][0]&&(i[1]=-i[1]),l[1][0]>l[0][1]&&(i[2]=-i[2]))}}})}});