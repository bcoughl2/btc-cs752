montageDefine("45fb404","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(e,t,n){function i(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var r=e("weak-map"),a=Object.prototype.hasOwnProperty,s=new r,o=new r;n.exports=i,i.debug=!0,i.prototype.getOwnPropertyChangeDescriptor=function(e){s.has(this)||s.set(this,{});var t=s.get(this);return a.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},i.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!s.has(this))return!1;if(!e)return!0;var t=s.get(this);return a.call(t,e)?!0:!1},i.prototype.addOwnPropertyChangeListener=function(e,t,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var r,a=i.getOwnPropertyChangeDescriptor(this,e);r=n?a.willChangeListeners:a.changeListeners,i.makePropertyObservable(this,e),r.push(t);var s=this;return function(){i.removeOwnPropertyChangeListener(s,e,r,n),s=null}},i.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return i.addOwnPropertyChangeListener(this,e,t,!0)},i.prototype.removeOwnPropertyChangeListener=function(e,t,n){var r,a=i.getOwnPropertyChangeDescriptor(this,e);r=n?a.willChangeListeners:a.changeListeners;var s=r.lastIndexOf(t);if(-1===s)throw Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));r.splice(s,1)},i.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return i.removeOwnPropertyChangeListener(this,e,t,!0)},i.prototype.dispatchOwnPropertyChange=function(e,t,n){var r=i.getOwnPropertyChangeDescriptor(this,e);if(!r.isActive){r.isActive=!0;var a;a=n?r.willChangeListeners:r.changeListeners;var s=(n?"Will":"")+"Change",o="handleProperty"+s,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+s;try{a.slice().forEach(function(n){if(!(0>a.indexOf(n))){var i=n;if(n=n[c]||n[o]||n,!n.call)throw Error("No event listener for "+c+" or "+o+" or call on "+n);n.call(i,t,e,this)}},this)}finally{r.isActive=!1}}},i.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return i.dispatchOwnPropertyChange(this,e,t,!0)},i.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],o.has(this)||(n={},o.set(this,n));var n=o.get(this);if(!a.call(n,e)){var r,s=this;Object.getOwnPropertyDescriptor(s,e);do{if(r=Object.getOwnPropertyDescriptor(s,e))break;s=Object.getPrototypeOf(s)}while(s);if(r=r||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!r.configurable)throw Error("Can't observe non-configurable properties");if(n[e]=r,r.writable||r.set){var l;l="value"in r?{get:function(){return r.value},set:function(n){return n===r.value?n:(i.dispatchBeforeOwnPropertyChange(this,e,r.value),r.value=n,t[e]=n,i.dispatchOwnPropertyChange(this,e,n),n)},enumerable:r.enumerable,configurable:!0}:{get:function(){return r.get?r.get.apply(this,arguments):void 0},set:function(n){var a;return r.get&&(a=r.get.apply(this,arguments)),r.set&&r.set.apply(this,arguments),r.get&&(n=r.get.apply(this,arguments),t[e]=n),n===a?n:(i.dispatchBeforeOwnPropertyChange(this,e,a),i.dispatchOwnPropertyChange(this,e,n),n)},enumerable:r.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},i.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!o.has(this))throw Error("Can't uninstall observer on property");var t=o.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var n=t[e];delete t[e];var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),delete i[e],Object.defineProperty(this,e,n)}},i.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):i.prototype.getOwnPropertyChangeDescriptor.call(e,t)},i.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):i.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},i.addOwnPropertyChangeListener=function(e,t,n,r){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,n,r):i.prototype.addOwnPropertyChangeListener.call(e,t,n,r):void 0},i.removeOwnPropertyChangeListener=function(e,t,n,r){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,n,r):i.prototype.removeOwnPropertyChangeListener.call(e,t,n,r):void 0},i.dispatchOwnPropertyChange=function(e,t,n,r){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,n,r):i.prototype.dispatchOwnPropertyChange.call(e,t,n,r):void 0},i.addBeforeOwnPropertyChangeListener=function(e,t,n){return i.addOwnPropertyChangeListener(e,t,n,!0)},i.removeBeforeOwnPropertyChangeListener=function(e,t,n){return i.removeOwnPropertyChangeListener(e,t,n,!0)},i.dispatchBeforeOwnPropertyChange=function(e,t,n){return i.dispatchOwnPropertyChange(e,t,n,!0)},i.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):i.prototype.makePropertyObservable.call(e,t)},i.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):i.prototype.makePropertyUnobservable.call(e,t)}}});