function ReadableState(e){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||0===i?i:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){return this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,Stream.call(this),void 0):new Readable(e)}function readableAddChunk(e,i,t,s,a){var u=chunkInvalid(i,t);if(u)e.emit("error",u);else if(null===t||void 0===t)i.reading=!1,i.ended||onEofChunk(e,i);else if(i.objectMode||t&&t.length>0)if(i.ended&&!a){var n=Error("stream.push() after EOF");e.emit("error",n)}else if(i.endEmitted&&a){var n=Error("stream.unshift() after end event");e.emit("error",n)}else!i.decoder||a||s||(t=i.decoder.write(t)),i.length+=i.objectMode?1:t.length,a?i.buffer.unshift(t):(i.reading=!1,i.buffer.push(t)),i.needReadable&&emitReadable(e),maybeReadMore(e,i);else a||(i.reading=!1);return needMoreData(i)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function roundUpToNextPowerOf2(e){if(e>=MAX_HWM)e=MAX_HWM;else{e--;for(var i=1;32>i;i<<=1)e|=e>>i;e++}return e}function howMuchToRead(e,i){return 0===i.length&&i.ended?0:i.objectMode?0===e?0:1:isNaN(e)||null===e?i.flowing&&i.buffer.length?i.buffer[0].length:i.length:0>=e?0:(e>i.highWaterMark&&(i.highWaterMark=roundUpToNextPowerOf2(e)),e>i.length?i.ended?i.length:(i.needReadable=!0,0):e)}function chunkInvalid(e,i){var t=null;return Buffer.isBuffer(i)||"string"==typeof i||null===i||void 0===i||e.objectMode||t||(t=new TypeError("Invalid non-string/buffer chunk")),t}function onEofChunk(e,i){if(i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&(i.buffer.push(t),i.length+=i.objectMode?1:t.length)}i.ended=!0,i.length>0?emitReadable(e):endReadable(e)}function emitReadable(e){var i=e._readableState;i.needReadable=!1,i.emittedReadable||(i.emittedReadable=!0,i.sync?process.nextTick(function(){emitReadable_(e)}):emitReadable_(e))}function emitReadable_(e){e.emit("readable")}function maybeReadMore(e,i){i.readingMore||(i.readingMore=!0,process.nextTick(function(){maybeReadMore_(e,i)}))}function maybeReadMore_(e,i){for(var t=i.length;!i.reading&&!i.flowing&&!i.ended&&i.length<i.highWaterMark&&(e.read(0),t!==i.length);)t=i.length;i.readingMore=!1}function pipeOnDrain(e){return function(){var i=e._readableState;i.awaitDrain--,0===i.awaitDrain&&flow(e)}}function flow(e){function i(e){var i=e.write(t);!1===i&&s.awaitDrain++}var t,s=e._readableState;for(s.awaitDrain=0;s.pipesCount&&null!==(t=e.read());)if(1===s.pipesCount?i(s.pipes,0,null):forEach(s.pipes,i),e.emit("data",t),s.awaitDrain>0)return;return 0===s.pipesCount?(s.flowing=!1,EE.listenerCount(e,"data")>0&&emitDataEvents(e),void 0):(s.ranOut=!0,void 0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(e,i){var t=e._readableState;if(t.flowing)throw Error("Cannot switch to old mode now.");var s=i||!1,a=!1;e.readable=!0,e.pipe=Stream.prototype.pipe,e.on=e.addListener=Stream.prototype.on,e.on("readable",function(){a=!0;for(var i;!s&&null!==(i=e.read());)e.emit("data",i);null===i&&(a=!1,e._readableState.needReadable=!0)}),e.pause=function(){s=!0,this.emit("pause")},e.resume=function(){s=!1,a?process.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function fromList(e,i){var t,s=i.buffer,a=i.length,u=!!i.decoder,n=!!i.objectMode;if(0===s.length)return null;if(0===a)t=null;else if(n)t=s.shift();else if(!e||e>=a)t=u?s.join(""):Buffer.concat(s,a),s.length=0;else if(s[0].length>e){var l=s[0];t=l.slice(0,e),s[0]=l.slice(e)}else if(e===s[0].length)t=s.shift();else{t=u?"":new Buffer(e);for(var r=0,o=0,c=s.length;c>o&&e>r;o++){var l=s[0],m=Math.min(e-r,l.length);u?t+=l.slice(0,m):l.copy(t,r,0,m),l.length>m?s[0]=l.slice(m):s.shift(),r+=m}}return t}function endReadable(e){var i=e._readableState;if(i.length>0)throw Error("endReadable called on non-empty stream");!i.endEmitted&&i.calledRead&&(i.ended=!0,process.nextTick(function(){i.endEmitted||0!==i.length||(i.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function forEach(e,i){for(var t=0,s=e.length;s>t;t++)i(e[t],t)}function indexOf(e,i){for(var t=0,s=e.length;s>t;t++)if(e[t]===i)return t;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(e,i){return e.listeners(i).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(e,i){var t=this._readableState;return"string"!=typeof e||t.objectMode||(i=i||t.defaultEncoding,i!==t.encoding&&(e=new Buffer(e,i),i="")),readableAddChunk(this,t,e,i,!1)},Readable.prototype.unshift=function(e){var i=this._readableState;return readableAddChunk(this,i,e,"",!0)},Readable.prototype.setEncoding=function(e){StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e};var MAX_HWM=8388608;Readable.prototype.read=function(e){var i=this._readableState;i.calledRead=!0;var t=e;if(("number"!=typeof e||e>0)&&(i.emittedReadable=!1),0===e&&i.needReadable&&(i.length>=i.highWaterMark||i.ended))return emitReadable(this),null;if(e=howMuchToRead(e,i),0===e&&i.ended)return 0===i.length&&endReadable(this),null;var s=i.needReadable;i.length-e<=i.highWaterMark&&(s=!0),(i.ended||i.reading)&&(s=!1),s&&(i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1),s&&!i.reading&&(e=howMuchToRead(t,i));var a;return a=e>0?fromList(e,i):null,null===a&&(i.needReadable=!0,e=0),i.length-=e,0!==i.length||i.ended||(i.needReadable=!0),i.ended&&!i.endEmitted&&0===i.length&&endReadable(this),a},Readable.prototype._read=function(){this.emit("error",Error("not implemented"))},Readable.prototype.pipe=function(e,i){function t(e){e===o&&a()}function s(){e.end()}function a(){e.removeListener("close",n),e.removeListener("finish",l),e.removeListener("drain",p),e.removeListener("error",u),e.removeListener("unpipe",t),o.removeListener("end",s),o.removeListener("end",a),(!e._writableState||e._writableState.needDrain)&&p()}function u(i){r(),e.removeListener("error",u),0===EE.listenerCount(e,"error")&&e.emit("error",i)}function n(){e.removeListener("finish",l),r()}function l(){e.removeListener("close",n),r()}function r(){o.unpipe(e)}var o=this,c=this._readableState;switch(c.pipesCount){case 0:c.pipes=e;break;case 1:c.pipes=[c.pipes,e];break;default:c.pipes.push(e)}c.pipesCount+=1;var m=(!i||i.end!==!1)&&e!==process.stdout&&e!==process.stderr,d=m?s:a;c.endEmitted?process.nextTick(d):o.once("end",d),e.on("unpipe",t);var p=pipeOnDrain(o);return e.on("drain",p),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(u):e._events.error=[u,e._events.error]:e.on("error",u),e.once("close",n),e.once("finish",l),e.emit("pipe",o),c.flowing||(this.on("readable",pipeOnReadable),c.flowing=!0,process.nextTick(function(){flow(o)})),e},Readable.prototype.unpipe=function(e){var i=this._readableState;if(0===i.pipesCount)return this;if(1===i.pipesCount)return e&&e!==i.pipes?this:(e||(e=i.pipes),i.pipes=null,i.pipesCount=0,this.removeListener("readable",pipeOnReadable),i.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var t=i.pipes,s=i.pipesCount;i.pipes=null,i.pipesCount=0,this.removeListener("readable",pipeOnReadable),i.flowing=!1;for(var a=0;s>a;a++)t[a].emit("unpipe",this);return this}var a=indexOf(i.pipes,e);return-1===a?this:(i.pipes.splice(a,1),i.pipesCount-=1,1===i.pipesCount&&(i.pipes=i.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,i){var t=Stream.prototype.on.call(this,e,i);if("data"!==e||this._readableState.flowing||emitDataEvents(this),"readable"===e&&this.readable){var s=this._readableState;s.readableListening||(s.readableListening=!0,s.emittedReadable=!1,s.needReadable=!0,s.reading?s.length&&emitReadable(this,s):this.read(0))}return t},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(e){var i=this._readableState,t=!1,s=this;e.on("end",function(){if(i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&s.push(e)}s.push(null)}),e.on("data",function(a){if(i.decoder&&(a=i.decoder.write(a)),a&&(i.objectMode||a.length)){var u=s.push(a);u||(t=!0,e.pause())}});for(var a in e)"function"==typeof e[a]&&this[a]===void 0&&(this[a]=function(i){return function(){return e[i].apply(e,arguments)}}(a));var u=["error","close","destroy","pause","resume"];return forEach(u,function(i){e.on(i,s.emit.bind(s,i))}),s._read=function(){t&&(t=!1,e.resume())},s},Readable._fromList=fromList;