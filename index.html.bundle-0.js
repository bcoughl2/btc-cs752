BUNDLE=[["index.html.bundle-1-0.js"]],"undefined"!=typeof window&&("ontouchstart"in window||(window.Touch=null),document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(e){"undefined"!=typeof require?e.call("undefined"!=typeof global?global:this,require,exports,module):e({},{},{})}(function(e,i){global=this,i.initMontage=function(){var e=i.getPlatform();e.bootstrap(function(t,s,a){var u=e.getParams(),r={location:t.getLocation()},l=a.resolve(r.location,u.montageLocation);r.moduleTypes=["html","meta"],r.makeLoader=function(e){return i.ReelLoader(e,t.makeLoader(e))},r.makeCompiler=function(e){return i.MetaCompiler(e,i.SerializationCompiler(e,i.TemplateCompiler(e,t.makeCompiler(e))))};var o=a.resolve(r.location,u["package"]||"."),c=u.applicationHash;if("object"==typeof BUNDLE){var m={},d=function(e){return m[e]=m[e]||s.defer()};global.bundleLoaded=function(e){d(e).resolve()};var p=s.defer();r.preloaded=p.promise;var v=s.resolve();BUNDLE.forEach(function(e){v=v.then(function(){return s.all(e.map(function(e){return n.load(e),d(e).promise}))})}),p.resolve(v.then(function(){delete BUNDLE,delete bundleLoaded}))}var h;if("remoteTrigger"in u){var g=s.defer();window.postMessage({type:"montageReady"},"*");var f=function(e){if(u.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",f),g.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",f),h=g.promise.spread(function(e,i){var s=t.loadPackage({location:e,hash:c},r);return i&&(s=s.then(function(t){e=a.resolve(e,".");var s,u,n=i.packageDescriptions,r=i.packageDescriptionLocations,l=i.mappings,o=i.dependencies;if(n)for(u=n.length,s=0;u>s;s++)t.injectPackageDescription(n[s].location,n[s].description);if(r)for(u=r.length,s=0;u>s;s++)t.injectPackageDescriptionLocation(r[s].location,r[s].descriptionLocation);if(l)for(u=l.length,s=0;u>s;s++)t.injectMapping(l[s].dependency,l[s].name);if(o)for(u=o.length,s=0;u>s;s++)t.injectDependency(o[s].name,o[s].version);return t})),s})}else{if("autoPackage"in u)t.injectPackageDescription(o,{dependencies:{montage:"*"}},r);else if(".json"===o.slice(o.length-5)){var b=o;o=a.resolve(o,"."),t.injectPackageDescriptionLocation(o,b,r)}h=t.loadPackage({location:o,hash:c},r)}h.then(function(i){i.loadPackage({location:l,hash:u.montageHash}).then(function(e){var i;return i=u.promiseLocation?a.resolve(t.getLocation(),u.promiseLocation):a.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:i,hash:u.promiseHash})]}).spread(function(t,n){t.inject("core/mini-url",a),t.inject("core/promise",{Promise:s}),n.inject("q",s),r.lint=function(e){t.async("core/jshint").then(function(i){i.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),i.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},global.require=i,global.montageRequire=t,e.initMontage(t,i,u)})}).done()})};var t=/((.*)\.reel)\/\2$/,s=function(e,i){return i};i.SerializationCompiler=function(e,i){return function(e){if(i(e),e.factory){var a=e.factory;return e.factory=function(e,i,u){a.call(this,e,i,u);for(var n in i){var r=i[n];if(r instanceof Object)if(r.hasOwnProperty("_montage_metadata")&&!r._montage_metadata.isInstance)r._montage_metadata.aliases.push(n),r._montage_metadata.objectName=n;else if(!Object.isSealed(r)){var l=u.id.replace(t,s);Object.defineProperty(r,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:n,objectName:n,aliases:[n],isInstance:!1}})}}},e}}};var a=/([^\/]+)\.reel$/;i.ReelLoader=function(e,i){return function(e,t){var s=a.exec(e);return s?(t.redirect=e+"/"+s[1],t):i(e,t)}};var u=/\.meta/;i.MetaCompiler=function(e,i){return function(e){var t=(e.location||"").match(u);return t?(e.exports=JSON.parse(e.text),e):i(e)}},i.TemplateCompiler=function(e,i){return function(e){if(e.location){var t=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return t?(e.dependencies=e.dependencies||[],e.exports={directory:t[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),t}}),e):(i(e),void 0)}}},i.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return n;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var n={makeResolve:function(){var e=document.querySelector("head"),i=document.createElement("base"),t=document.createElement("a");return i.href="",function(s,a){var u=e.querySelector("base");if(u||(e.appendChild(i),u=i),s+="",!/^[\w\-]+:/.test(s))throw Error("Can't resolve from a relative location: "+JSON.stringify(s)+" "+JSON.stringify(a));var n=u.href;u.href=s,t.href=a;var r=t.href;return u.href=n,u===i&&e.removeChild(u),r}},load:function(e){var i=document.createElement("script");i.src=e,i.onload=function(){i.parentNode.removeChild(i)},document.getElementsByTagName("head")[0].appendChild(i)},getParams:function(){var e,i,t,s,a,u,n;if(!this._params){this._params={};var r=document.getElementsByTagName("script");for(e=0;r.length>e;e++)if(s=r[e],a=!1,s.src&&(t=s.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=t[1],a=!0),s.hasAttribute("data-montage-location")&&(this._params.montageLocation=s.getAttribute("data-montage-location"),a=!0),a){if(s.dataset)for(n in s.dataset)this._params[n]=s.dataset[n];else if(s.attributes){var l=/-([a-z])/g,o=function(e,i){return i.toUpperCase()};for(i=0;s.attributes.length>i;i++)u=s.attributes[i],t=u.name.match(/^data-(.*)$/),t&&(this._params[t[1].replace(l,o)]=u.value)}s.parentNode.removeChild(s);break}}return this._params},bootstrap:function(e){function i(){document.removeEventListener("DOMContentLoaded",i,!0),r=!0,a()}function t(e){if(!g[e]&&h[e]){var i=g[e]={};g[e]=h[e](t,i)||i}return g[e]}function s(){o=t("mini-url"),l=t("promise"),u=t("require"),delete global.bootstrap,a()}function a(){r&&u&&e(u,l,o)}var u,r,l,o,c=this.getParams(),m=this.makeResolve();/interactive|complete/.test(document.readyState)?i():document.addEventListener("DOMContentLoaded",i,!0);var d={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var p=m(window.location,c.montageLocation);for(var v in d)n.load(m(p,d[v]))}var h={};global.bootstrap=function(e,i){h[e]=i,delete d[e];for(var e in d)return;delete global.bootstrap,s()},global.bootstrap("mini-url",function(e,i){i.resolve=m});var g={}},initMontage:function(e,i,t){var s=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger","core/deprecate"],a=e("core/promise").Promise;return a.all(s.map(e.deepLoad)).then(function(){s.forEach(e),e("core/core").Montage;var u,n,r=e("core/event/event-manager").EventManager,l=e("core/serialization/deserializer/montage-reviver").MontageReviver,o=e("core/logger").logger,c=e("core/deprecate");o("Promise stacktrace support",function(e){a.longStackSupport=!!e}),u=(new r).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var m,d,p=i.packageDescription.applicationPrototype;return p?(m=l.parseObjectLocationId(p),d=i.async(m.moduleId)):d=e.async("core/application"),d.then(function(e){var s=e[m?m.objectName:"Application"];n=new s,Object.defineProperty(window.document,"application",{get:c.deprecateMethod(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),u.application=n,n.eventManager=u,n._load(i,function(){t.module&&i.async(t.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,i.initMontage()):i.getPlatform()}),function(e){if("undefined"!=typeof bootstrap)"undefined"!=typeof window?bootstrap("require",function(i,t){var s=i("promise"),a=i("mini-url");e(t,s,a),i("require/browser")}):bootstrap("require",function(i,t){var s=i("promise").Promise,a=i("mini-url");e(t,s,a)});else{if("undefined"==typeof process)throw Error("Can't support require on this platform");var i=require("q"),t=require("url");e(exports,i,t),require("./node")}}(function(e,i,t){function s(i,s){if(s=s||{},"string"==typeof i&&(i={location:i}),i.main&&(i.location=s.mainPackageLocation),i.name&&s.registry&&s.registry[i.name]&&(i.location=s.registry[i.name]),!i.location&&s.packagesDirectory&&i.name&&(i.location=t.resolve(s.packagesDirectory,i.name+"/")),!i.location)return i;if(/\/$/.test(i.location)||(i.location+="/"),!e.isAbsolute(i.location)){if(!s.location)throw Error("Dependency locations must be fully qualified: "+JSON.stringify(i));i.location=t.resolve(s.location,i.location)}return i.name&&(s.registry[i.name]=i.location),i}function a(i,a,u){/\/$/.test(i)||(i+="/");var r=Object.create(u);r.name=a.name,r.location=i||e.getLocation(),r.packageDescription=a,r.useScriptInjection=a.useScriptInjection,void 0!==a.production&&(r.production=a.production);var o=r.modules=r.modules||{},c=r.registry;void 0===r.name||c[r.name]||(c[r.name]=r.location);var m=a.overlay||{};"string"==typeof a.browser?m.browser={redirects:{"":a.browser}}:"object"==typeof a.browser&&(m.browser={redirects:a.browser}),r.overlays=r.overlays||e.overlays,r.overlays.forEach(function(e){if(m[e]){var i=m[e];for(var t in i)a[t]=i[t]}}),delete a.overlay,r.packagesDirectory=t.resolve(i,"node_modules/"),void 0!==a.main&&(o[""]={id:"",redirect:l(n(a.main,"")),location:r.location});var d=a.redirects;void 0!==d&&Object.keys(d).forEach(function(e){o[e]={id:e,redirect:l(n(d[e],e)),location:t.resolve(i,e)}});var p=a.mappings||{};return[a.dependencies,r.production?null:a.devDependencies].forEach(function(e){e&&Object.keys(e).forEach(function(i){p[i]||(p[i]={name:i,version:e[i]})})}),Object.keys(p).forEach(function(e){p[e]=s(p[e],r,e)}),r.mappings=p,r}function u(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function n(e,i){e+="";var t=e.split("/"),s=[];if(t.length&&"."===t[0]||".."===t[0]){var a=i.split("/");a.pop(),t.unshift.apply(t,a)}for(var u=0,n=t.length;n>u;u++){var r=t[u];""===r||"."===r||(".."===r?s.length&&s.pop():s.push(r))}return s.join("/")}if(!this)throw Error("Require does not work in strict mode.");e.makeRequire=function(a){function r(e){var i=e.toLowerCase();return u(g,i)||(g[i]={id:e,display:(a.name||a.location)+"#"+e,require:h}),g[i]}function c(e,i){var s=r(e);s.exports=i,s.location=t.resolve(a.location,e),s.directory=t.resolve(s.location,"./"),s.injected=!0,delete s.redirect,delete s.mappingRedirect}function m(e,t,s){var a=r(e);return s=s||{},u(s,e)?void 0:(s[e]=!0,f(e,t).then(function(){return i.all(a.dependencies.map(function(i){i=n(i,e);var t=r(i),a=t.dependees=t.dependees||{};return a[e]=!0,m(i,e,s)}))},function(e){a.error=e}))}function d(e,i){var s=r(e);if(s.id!==e)throw Error("Can't require module "+JSON.stringify(s.id)+" by alternate spelling "+JSON.stringify(e));if(s.error){var a=Error("Can't require module "+JSON.stringify(s.id)+" via "+JSON.stringify(i)+" because "+s.error.message);throw a.cause=s.error,a}if(void 0!==s.redirect)return d(s.redirect,i);if(void 0!==s.mappingRedirect)return s.mappingRequire(s.mappingRedirect,i);if(void 0!==s.exports)return s.exports;if(void 0===s.factory)throw Error("Can't require module "+JSON.stringify(e)+" via "+JSON.stringify(i));s.directory=t.resolve(s.location,"./"),s.exports={};var u;try{u=s.factory.call(void 0,v(e),s.exports,s)}catch(n){throw delete s.exports,n}return void 0!==u&&(s.exports=u),s.exports}function p(e,i,t){var s=a.location;if(i.location===s)return e;var n=!!t;if(t=t||{},u(t,s))return null;t[s]=!0;for(var r in a.mappings){var l=a.mappings[r];if(s=l.location,a.hasPackage(s)){var o=a.getPackage(s),c=o.identify(e,i,t);if(null!==c)return""===c?r:r+"/"+c}}if(n)return null;throw Error("Can't identify "+e+" from "+i.location)}function v(i){var t=function(e){var t=n(e,i);return d(t,i)};return t.async=function(e){var s=n(e,i);return r(e),m(s,i).then(function(){return t(s)})},t.resolve=function(e){return l(n(e,i))},t.getModule=r,t.getModuleDescriptor=r,t.load=f,t.deepLoad=m,t.loadPackage=function(i,t){return t?e.loadPackage(i,t):a.loadPackage(i,a)},t.hasPackage=function(e){return a.hasPackage(e)},t.getPackage=function(e){return a.getPackage(e)},t.isMainPackage=function(){return t.location===a.mainPackageLocation},t.injectPackageDescription=function(i,t){e.injectPackageDescription(i,t,a)},t.injectPackageDescriptionLocation=function(i,t){e.injectPackageDescriptionLocation(i,t,a)},t.injectMapping=function(e,i){e=s(e,a,i),i=i||e.name,a.mappings[i]=e},t.injectDependency=function(e){t.injectMapping({name:e},e)},t.identify=p,t.inject=c,a.exposedConfigs.forEach(function(e){t[e]=a[e]}),t.config=a,t.read=a.read,t}var h;a=a||{},a.location=t.resolve(a.location||e.getLocation(),"./"),a.paths=a.paths||[a.location],a.mappings=a.mappings||{},a.exposedConfigs=a.exposedConfigs||e.exposedConfigs,a.moduleTypes=a.moduleTypes||[],a.makeLoader=a.makeLoader||e.makeLoader,a.load=a.load||a.makeLoader(a),a.makeCompiler=a.makeCompiler||e.makeCompiler,a.compile=a.compile||a.makeCompiler(a),a.parseDependencies=a.parseDependencies||e.parseDependencies,a.read=a.read||e.read;var g=a.modules=a.modules||{},f=o(function(e){var t=r(e);return i.fcall(function(){return void 0===t.factory&&void 0===t.exports&&void 0===t.redirect?i.fcall(a.load,e,t):void 0}).then(function(){a.compile(t);var e=t.dependencies=t.dependencies||[];void 0!==t.redirect&&e.push(t.redirect),void 0!==t.extraDependencies&&Array.prototype.push.apply(t.dependencies,t.extraDependencies)})});return h=v("")},e.injectPackageDescription=function(e,t,s){var a=s.descriptions=s.descriptions||{};a[e]=i.resolve(t)},e.injectPackageDescriptionLocation=function(e,i,t){var s=t.descriptionLocations=t.descriptionLocations||{};s[e]=i},e.loadPackageDescription=function(i,s){var a=i.location,u=s.descriptions=s.descriptions||{};if(void 0===u[a]){var n,r=s.descriptionLocations=s.descriptionLocations||{};n=r[a]?r[a]:t.resolve(a,"package.json"),u[a]=(s.read||e.read)(n).then(function(e){try{return JSON.parse(e)}catch(i){throw i.message=i.message+" in "+JSON.stringify(n),i}})}return u[a]},e.loadPackage=function(i,t){if(i=s(i,t),!i.location)throw Error("Can't find dependency: "+JSON.stringify(i));var u=i.location;t=Object.create(t||null);var n=t.loadingPackages=t.loadingPackages||{},r=t.packages={};t.registry=t.registry||Object.create(null),t.mainPackageLocation=u,t.hasPackage=function(e){if(e=s(e,t),!e.location)return!1;var i=e.location;return!!r[i]},t.getPackage=function(e){if(e=s(e,t),!e.location)throw Error("Can't find dependency: "+JSON.stringify(e)+" from "+t.location);var i=e.location;if(!r[i])throw n[i]?Error("Dependency has not finished loading: "+JSON.stringify(e)):Error("Dependency was not loaded: "+JSON.stringify(e));return r[i]},t.loadPackage=function(i,u){if(i=s(i,u),!i.location)throw Error("Can't find dependency: "+JSON.stringify(i)+" from "+t.location);var l=i.location;return n[l]||(n[l]=e.loadPackageDescription(i,t).then(function(i){var s=a(l,i,t),u=e.makeRequire(s);return r[l]=u,u})),n[l]};var l=t.loadPackage(i);return l.location=u,l.async=function(e,i){return l.then(function(t){return t.async(e,i)})},l},e.resolve=n;var r=/\.([^\/\.]+)$/;e.extension=function(e){var i=r.exec(e);return i?i[1]:void 0},e.isAbsolute=function(e){return/^[\w\-]+:/.test(e)},e.parseDependencies=function(e){var i={};return(e+"").replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,t){i[t]=!0}),Object.keys(i)},e.DependenciesCompiler=function(i,t){return function(s){return s.dependencies||void 0===s.text||(s.dependencies=i.parseDependencies(s.text)),t(s),s&&!s.dependencies&&(s.dependencies=s.text||s.factory?e.parseDependencies(s.text||s.factory):[]),s}},e.ShebangCompiler=function(e,i){return function(e){e.text&&(e.text=e.text.replace(/^#!/,"//#!")),i(e)}},e.LintCompiler=function(e,t){return function(s){try{t(s)}catch(a){throw e.lint&&i.nextTick(function(){e.lint(s)}),a}}},e.exposedConfigs=["paths","mappings","location","packageDescription","packages","modules"],e.makeCompiler=function(i){return e.JsonCompiler(i,e.ShebangCompiler(i,e.DependenciesCompiler(i,e.LintCompiler(i,e.Compiler(i)))))},e.JsonCompiler=function(e,i){return function(e){var t=(e.location||"").match(/\.json$/);return t?(e.exports=JSON.parse(e.text),e):i(e)}},e.MappingsLoader=function(i,t){return i.mappings=i.mappings||{},i.name=i.name,function(s,a){var u=i.mappings,n=Object.keys(u),r=n.length;if(e.isAbsolute(s))return t(s,a);void 0!==i.name&&0===s.indexOf(i.name)&&"/"===s.charAt(i.name.length)&&console.warn("Package reflexive module ignored:",s);var l,o;for(l=0;r>l;l++)if(o=n[l],s===o||0===s.indexOf(o)&&"/"===s.charAt(o.length)){var c=u[o],m=s.slice(o.length+1);return i.loadPackage(c,i).then(function(e){return a.mappingRedirect=m,a.mappingRequire=e,e.deepLoad(m,i.location)})}return t(s,a)}},e.LocationLoader=function(i,s){return function(a,u){var n=a,r=e.extension(a);(!r||"js"!==r&&"json"!==r&&-1===i.moduleTypes.indexOf(r))&&(n+=".js");var l=t.resolve(i.location,n);return s(l,u)}},e.MemoizedLoader=function(e,i){var t=e.cache=e.cache||{};return o(i,t)};var l=function(e){var i=/^(.*)\.js$/.exec(e);return i&&(e=i[1]),e},o=function(e,t){return t=t||{},function(s,a){return u(t,s)||(t[s]=i.fcall(e,s,a)),t[s]}}}),bootstrap("require/browser",function(e){function i(e){return 200===e.status||0===e.status&&e.responseText}var t,s=e("require"),a=e("promise"),u=e("mini-url"),n="GET",r="application/javascript";s.getLocation=function(){if(!t){var e=document.querySelector("head > base");t=e?e.href:window.location,t=u.resolve(t,".")}return t},s.overlays=["window","browser","montage"],s.read=function(e){function t(){i(u)?l.resolve(u.responseText):s()}function s(){l.reject(Error("Can't XHR "+JSON.stringify(e)))}var u=new XMLHttpRequest,l=a.defer();try{u.open(n,e,!0),u.overrideMimeType&&u.overrideMimeType(r),u.onreadystatechange=function(){4===u.readyState&&t()},u.onload=u.load=t,u.onerror=u.error=s}catch(o){l.reject(o)}return u.send(),l.promise};var l=eval,o="__",c="_",m="(function ",d="(require, exports, module) {",p="//*/\n})\n//# sourceURL=";s.Compiler=function(e){return function(i){if(i.factory||void 0===i.text)return i;if(e.useScriptInjection)throw Error("Can't use eval.");var t=(i.require.config.name+o+i.id).replace(/[^\w\d]|^\d/g,c);try{i.factory=l(m+t+d+i.text+p+i.location)}catch(s){throw s.message=s.message+" in "+i.location,s}i.factory.displayName=t}},s.XhrLoader=function(e){return function(i,t){return e.read(i).then(function(e){t.type="javascript",t.text=e,t.location=i})}};var v={},h=function(e,i){return v[e]=v[e]||{},v[e][i]=v[e][i]||a.defer(),v[e][i]},g=function(e,i,t){t&&t.isPending()?t.then(function(){i.isPending()&&s.loadScript(e)}).done():i.isPending()&&s.loadScript(e)};montageDefine=function(e,i,t){h(e,i).resolve(t)},s.loadScript=function(e){var i=document.createElement("script");i.onload=function(){i.parentNode.removeChild(i)},i.onerror=function(){i.parentNode.removeChild(i)},i.src=e,i.defer=!0,document.getElementsByTagName("head")[0].appendChild(i)},s.ScriptLoader=function(e){var i=e.packageDescription.hash;return function(t,s){return a.fcall(function(){if(v[i]&&v[i][s.id])return v[i][s.id].promise;/\.js$/.test(t)?t=t.replace(/\.js$/,".load.js"):t+=".load.js";var a=h(i,s.id).promise;return g(t,a,e.preloaded),a}).then(function(e){delete v[i][s.id];for(var a in e)s[a]=e[a];s.location=t,s.directory=u.resolve(t,".")})}};var f=s.loadPackageDescription;s.loadPackageDescription=function(e,i){if(e.hash){var t=h(e.hash,"package.json").promise,s=u.resolve(e.location,"package.json.load.js");return g(s,t,i.preloaded),t.get("exports")}return f(e,i)},s.makeLoader=function(e){var i;return i=e.useScriptInjection?s.ScriptLoader:s.XhrLoader,s.MappingsLoader(e,s.LocationLoader(e,s.MemoizedLoader(e,i(e))))}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return H.apply(e,arguments)}}function i(e){return e===Object(e)}function t(e){return"[object StopIteration]"===ii(e)||e instanceof B}function s(e,i){if(k&&i.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(ti)){for(var t=[],s=i;s;s=s.source)s.stack&&t.unshift(s.stack);t.unshift(e.stack);var u=t.join("\n"+ti+"\n");e.stack=a(u)}}function a(e){for(var i=e.split("\n"),t=[],s=0;i.length>s;++s){var a=i[s];r(a)||u(a)||!a||t.push(a)}return t.join("\n")}function u(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function n(e){var i=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(i)return[i[1],Number(i[2])];var t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(t)return[t[1],Number(t[2])];var s=/.*@(.+):(\d+)$/.exec(e);return s?[s[1],Number(s[2])]:void 0}function r(e){var i=n(e);if(!i)return!1;var t=i[0],s=i[1];return t===z&&s>=Q&&ni>=s}function l(){if(k)try{throw Error()}catch(e){var i=e.stack.split("\n"),t=i[0].indexOf("@")>0?i[1]:i[2],s=n(t);if(!s)return;return z=s[0],s[1]}}function o(e,i,t){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(i+" is deprecated, use "+t+" instead.",Error("").stack),e.apply(e,arguments)}}function c(e){return f(e)?e:b(e)?M(e):D(e)}function m(){function e(e){i=e,u.source=e,Y(t,function(i,t){W(function(){e.promiseDispatch.apply(e,t)})},void 0),t=void 0,s=void 0}var i,t=[],s=[],a=$(m.prototype),u=$(v.prototype);if(u.promiseDispatch=function(e,a,u){var n=X(arguments);t?(t.push(n),"when"===a&&u[1]&&s.push(u[1])):W(function(){i.promiseDispatch.apply(i,n)})},u.valueOf=function(){if(t)return u;var e=g(i);return f(e)&&(i=e),e},u.inspect=function(){return i?i.inspect():{state:"pending"}},c.longStackSupport&&k)try{throw Error()}catch(n){u.stack=n.stack.substring(n.stack.indexOf("\n")+1)}return a.promise=u,a.resolve=function(t){i||e(c(t))},a.fulfill=function(t){i||e(D(t))},a.reject=function(t){i||e(N(t))},a.notify=function(e){i||Y(s,function(i,t){W(function(){t(e)})},void 0)},a}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var i=m();try{e(i.resolve,i.reject,i.notify)}catch(t){i.reject(t)}return i.promise}function p(e){return d(function(i,t){for(var s=0,a=e.length;a>s;s++)c(e[s]).then(i,t)})}function v(e,i,t){void 0===i&&(i=function(e){return N(Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var s=$(v.prototype);if(s.promiseDispatch=function(t,a,u){var n;try{n=e[a]?e[a].apply(s,u):i.call(s,a,u)}catch(r){n=N(r)}t&&t(n)},s.inspect=t,t){var a=t();"rejected"===a.state&&(s.exception=a.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}}return s}function h(e,i,t,s){return c(e).then(i,t,s)}function g(e){if(f(e)){var i=e.inspect();if("fulfilled"===i.state)return i.value}return e}function f(e){return i(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function b(e){return i(e)&&"function"==typeof e.then}function q(e){return f(e)&&"pending"===e.inspect().state}function y(e){return!f(e)||"fulfilled"===e.inspect().state}function S(e){return f(e)&&"rejected"===e.inspect().state}function _(){si.length=0,ai.length=0,ui||(ui=!0)}function P(e,i){ui&&(ai.push(e),i&&void 0!==i.stack?si.push(i.stack):si.push("(no stack) "+i))}function C(e){if(ui){var i=K(ai,e);-1!==i&&(ai.splice(i,1),si.splice(i,1))}}function N(e){var i=v({when:function(i){return i&&C(this),i?i(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return P(i,e),i}function D(e){return v({when:function(){return e},get:function(i){return e[i]},set:function(i,t){e[i]=t},"delete":function(i){delete e[i]},post:function(i,t){return null===i||void 0===i?e.apply(void 0,t):e[i].apply(e,t)},apply:function(i,t){return e.apply(i,t)},keys:function(){return ei(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function M(e){var i=m();return W(function(){try{e.then(i.resolve,i.reject,i.notify)}catch(t){i.reject(t)}}),i.promise}function A(e){return v({isDef:function(){}},function(i,t){return T(e,i,t)},function(){return c(e).inspect()})}function E(e,i,t){return c(e).spread(i,t)}function w(e){return function(){function i(e,i){var n;if("undefined"==typeof StopIteration){try{n=s[e](i)}catch(r){return N(r)}return n.done?n.value:h(n.value,a,u)}try{n=s[e](i)}catch(r){return t(r)?r.value:N(r)}return h(n,a,u)}var s=e.apply(this,arguments),a=i.bind(i,"next"),u=i.bind(i,"throw");return a()}}function I(e){c.done(c.async(e)())}function x(e){throw new B(e)}function L(e){return function(){return E([this,V(arguments)],function(i,t){return e.apply(i,t)})}}function T(e,i,t){return c(e).dispatch(i,t)}function V(e){return h(e,function(e){var i=0,t=m();return Y(e,function(s,a,u){var n;f(a)&&"fulfilled"===(n=a.inspect()).state?e[u]=n.value:(++i,h(a,function(s){e[u]=s,0===--i&&t.resolve(e)},t.reject,function(e){t.notify({index:u,value:e})}))},void 0),0===i&&t.resolve(e),t.promise})}function j(e){return h(e,function(e){return e=J(e,c),h(V(J(e,function(e){return h(e,G,G)})),function(){return e})})}function O(e){return c(e).allSettled()}function F(e,i){return c(e).then(void 0,void 0,i)}function R(e,i){return c(e).nodeify(i)}var k=!1;try{throw Error()}catch(U){k=!!U.stack}var z,B,Q=l(),G=function(){},W=function(){function e(){for(;i.next;){i=i.next;var t=i.task;i.task=void 0;var a=i.domain;a&&(i.domain=void 0,a.enter());try{t()}catch(n){if(u)throw a&&a.exit(),setTimeout(e,0),a&&a.enter(),n;setTimeout(function(){throw n},0)}a&&a.exit()}s=!1}var i={task:void 0,next:null},t=i,s=!1,a=void 0,u=!1;if(W=function(e){t=t.next={task:e,domain:u&&process.domain,next:null},s||(s=!0,a())},"undefined"!=typeof process&&process.nextTick)u=!0,a=function(){process.nextTick(e)};else if("function"==typeof setImmediate)a="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var n=new MessageChannel;n.port1.onmessage=function(){a=r,n.port1.onmessage=e,e()};var r=function(){n.port2.postMessage(0)};a=function(){setTimeout(e,0),r()}}else a=function(){setTimeout(e,0)};return W}(),H=Function.call,X=e(Array.prototype.slice),Y=e(Array.prototype.reduce||function(e,i){var t=0,s=this.length;if(1===arguments.length)for(;;){if(t in this){i=this[t++];break}if(++t>=s)throw new TypeError}for(;s>t;t++)t in this&&(i=e(i,this[t],t));return i}),K=e(Array.prototype.indexOf||function(e){for(var i=0;this.length>i;i++)if(this[i]===e)return i;return-1}),J=e(Array.prototype.map||function(e,i){var t=this,s=[];return Y(t,function(a,u,n){s.push(e.call(i,u,n,t))},void 0),s}),$=Object.create||function(e){function i(){}return i.prototype=e,new i},Z=e(Object.prototype.hasOwnProperty),ei=Object.keys||function(e){var i=[];for(var t in e)Z(e,t)&&i.push(t);return i},ii=e(Object.prototype.toString);B="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var ti="From previous event:";c.resolve=c,c.nextTick=W,c.longStackSupport=!1,c.defer=m,m.prototype.makeNodeResolver=function(){var e=this;return function(i,t){i?e.reject(i):arguments.length>2?e.resolve(X(arguments,1)):e.resolve(t)}},c.Promise=d,c.promise=d,d.race=p,d.all=V,d.reject=N,d.resolve=c,c.passByCopy=function(e){return e},v.prototype.passByCopy=function(){return this},c.join=function(e,i){return c(e).join(i)},v.prototype.join=function(e){return c([this,e]).spread(function(e,i){if(e===i)return e;throw Error("Can't join: not the same: "+e+" "+i)})},c.race=p,v.prototype.race=function(){return this.then(c.race)},c.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(e,i,t){function a(i){try{return"function"==typeof e?e(i):i}catch(t){return N(t)}}function u(e){if("function"==typeof i){s(e,r);try{return i(e)}catch(t){return N(t)}}return N(e)}function n(e){return"function"==typeof t?t(e):e}var r=this,l=m(),o=!1;return W(function(){r.promiseDispatch(function(e){o||(o=!0,l.resolve(a(e)))},"when",[function(e){o||(o=!0,l.resolve(u(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var i,t=!1;try{i=n(e)}catch(s){if(t=!0,!c.onerror)throw s;c.onerror(s)}t||l.notify(i)}]),l.promise},c.when=h,v.prototype.thenResolve=function(e){return this.then(function(){return e})},c.thenResolve=function(e,i){return c(e).thenResolve(i)},v.prototype.thenReject=function(e){return this.then(function(){throw e})},c.thenReject=function(e,i){return c(e).thenReject(i)},c.nearer=g,c.isPromise=f,c.isPromiseAlike=b,c.isPending=q,v.prototype.isPending=function(){return"pending"===this.inspect().state},c.isFulfilled=y,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},c.isRejected=S,v.prototype.isRejected=function(){return"rejected"===this.inspect().state};var si=[],ai=[],ui=!0;c.resetUnhandledRejections=_,c.getUnhandledReasons=function(){return si.slice()},c.stopUnhandledRejectionTracking=function(){_(),ui=!1},_(),c.reject=N,c.fulfill=D,c.master=A,c.spread=E,v.prototype.spread=function(e,i){return this.all().then(function(i){return e.apply(void 0,i)},i)},c.async=w,c.spawn=I,c["return"]=x,c.promised=L,c.dispatch=T,v.prototype.dispatch=function(e,i){var t=this,s=m();return W(function(){t.promiseDispatch(s.resolve,e,i)}),s.promise},c.get=function(e,i){return c(e).dispatch("get",[i])},v.prototype.get=function(e){return this.dispatch("get",[e])},c.set=function(e,i,t){return c(e).dispatch("set",[i,t])},v.prototype.set=function(e,i){return this.dispatch("set",[e,i])},c.del=c["delete"]=function(e,i){return c(e).dispatch("delete",[i])},v.prototype.del=v.prototype["delete"]=function(e){return this.dispatch("delete",[e])},c.mapply=c.post=function(e,i,t){return c(e).dispatch("post",[i,t])},v.prototype.mapply=v.prototype.post=function(e,i){return this.dispatch("post",[e,i])},c.send=c.mcall=c.invoke=function(e,i){return c(e).dispatch("post",[i,X(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(e){return this.dispatch("post",[e,X(arguments,1)])},c.fapply=function(e,i){return c(e).dispatch("apply",[void 0,i])},v.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},c["try"]=c.fcall=function(e){return c(e).dispatch("apply",[void 0,X(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},c.fbind=function(e){var i=c(e),t=X(arguments,1);return function(){return i.dispatch("apply",[this,t.concat(X(arguments))])}},v.prototype.fbind=function(){var e=this,i=X(arguments);return function(){return e.dispatch("apply",[this,i.concat(X(arguments))])}},c.keys=function(e){return c(e).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},c.all=V,v.prototype.all=function(){return V(this)},c.allResolved=o(j,"allResolved","allSettled"),v.prototype.allResolved=function(){return j(this)},c.allSettled=O,v.prototype.allSettled=function(){return this.then(function(e){return V(J(e,function(e){function i(){return e.inspect()}return e=c(e),e.then(i,i)}))})},c.fail=c["catch"]=function(e,i){return c(e).then(void 0,i)},v.prototype.fail=v.prototype["catch"]=function(e){return this.then(void 0,e)},c.progress=F,v.prototype.progress=function(e){return this.then(void 0,void 0,e)
},c.fin=c["finally"]=function(e,i){return c(e)["finally"](i)},v.prototype.fin=v.prototype["finally"]=function(e){return e=c(e),this.then(function(i){return e.fcall().then(function(){return i})},function(i){return e.fcall().then(function(){throw i})})},c.done=function(e,i,t,s){return c(e).done(i,t,s)},v.prototype.done=function(e,i,t){var a=function(e){W(function(){if(s(e,u),!c.onerror)throw e;c.onerror(e)})},u=e||i||t?this.then(e,i,t):this;"object"==typeof process&&process&&process.domain&&(a=process.domain.bind(a)),u.then(void 0,a)},c.timeout=function(e,i,t){return c(e).timeout(i,t)},v.prototype.timeout=function(e,i){var t=m(),s=setTimeout(function(){t.reject(Error(i||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(s),t.resolve(e)},function(e){clearTimeout(s),t.reject(e)},t.notify),t.promise},c.delay=function(e,i){return void 0===i&&(i=e,e=void 0),c(e).delay(i)},v.prototype.delay=function(e){return this.then(function(i){var t=m();return setTimeout(function(){t.resolve(i)},e),t.promise})},c.nfapply=function(e,i){return c(e).nfapply(i)},v.prototype.nfapply=function(e){var i=m(),t=X(e);return t.push(i.makeNodeResolver()),this.fapply(t).fail(i.reject),i.promise},c.nfcall=function(e){var i=X(arguments,1);return c(e).nfapply(i)},v.prototype.nfcall=function(){var e=X(arguments),i=m();return e.push(i.makeNodeResolver()),this.fapply(e).fail(i.reject),i.promise},c.nfbind=c.denodeify=function(e){var i=X(arguments,1);return function(){var t=i.concat(X(arguments)),s=m();return t.push(s.makeNodeResolver()),c(e).fapply(t).fail(s.reject),s.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var e=X(arguments);return e.unshift(this),c.denodeify.apply(void 0,e)},c.nbind=function(e,i){var t=X(arguments,2);return function(){function s(){return e.apply(i,arguments)}var a=t.concat(X(arguments)),u=m();return a.push(u.makeNodeResolver()),c(s).fapply(a).fail(u.reject),u.promise}},v.prototype.nbind=function(){var e=X(arguments,0);return e.unshift(this),c.nbind.apply(void 0,e)},c.nmapply=c.npost=function(e,i,t){return c(e).npost(i,t)},v.prototype.nmapply=v.prototype.npost=function(e,i){var t=X(i||[]),s=m();return t.push(s.makeNodeResolver()),this.dispatch("post",[e,t]).fail(s.reject),s.promise},c.nsend=c.nmcall=c.ninvoke=function(e,i){var t=X(arguments,2),s=m();return t.push(s.makeNodeResolver()),c(e).dispatch("post",[i,t]).fail(s.reject),s.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(e){var i=X(arguments,1),t=m();return i.push(t.makeNodeResolver()),this.dispatch("post",[e,i]).fail(t.reject),t.promise},c.nodeify=R,v.prototype.nodeify=function(e){return e?(this.then(function(i){W(function(){e(null,i)})},function(i){W(function(){e(i)})}),void 0):this};var ni=l();return c}),montageDefine("9804a56","package.json",{exports:{name:"pc1",version:"0.1.0",dependencies:{montage:"~0.14.0","mjs-volume":"git://github.com/fabrobinet/mjs-volume.git",digit:"~0.5.0"},devDependencies:{"montage-testing":"~0.4.0"},exclude:["run-tests.html","test"],bundle:["ui/main.reel"],hash:"9804a56",mappings:{montage:{name:"montage",hash:"3c07db4",location:"packages/montage@3c07db4/"},"mjs-volume":{name:"mjs-volume",hash:"83b66f4",location:"packages/mjs-volume@83b66f4/"},digit:{name:"digit",hash:"d418305",location:"packages/digit@d418305/"}},production:!0,useScriptInjection:!0}}),montageDefine("3c07db4","package.json",{exports:{name:"montage",version:"0.14.11",description:"Build your next application with a browser based platform that really gets the web.",repository:{type:"git",url:"https://github.com/montagejs/montage.git"},main:"core/core",dependencies:{collections:"~1.0.0",frb:"~0.2.17",mousse:"~0.3.0",htmlparser2:"~3.0.5"},devDependencies:{"montage-testing":"~0.4.0",mr:"~0.15.3",q:"1.0.0","q-io":"~1.11.0",jshint:"~2.4.4"},scripts:{test:"node test/node/node-spec.js",jsdoc:"node ../montagejs.org/build/jsdoc/jsdoc.js -out $PWD/builds/jsdoc/ montage@npm-link"},exclude:["test","tools"],readmeFilename:"README.md",bugs:{url:"https://github.com/montagejs/montage/issues"},homepage:"https://github.com/montagejs/montage",_id:"montage@0.14.11",_from:"montage@~0.14.0",redirects:{montage:"core/core"},mappings:{mr:{name:"mr",hash:"7366ba0",location:"../mr@7366ba0/"},q:{name:"q",hash:"318ab79",location:"../q@318ab79/"},collections:{name:"collections",hash:"45fb404",location:"../collections@45fb404/"},frb:{name:"frb",hash:"70e9633",location:"../frb@70e9633/"},mousse:{name:"mousse",hash:"8cd1986",location:"../mousse@8cd1986/"},htmlparser2:{name:"htmlparser2",hash:"8309129",location:"../htmlparser2@8309129/"}},hash:"3c07db4",production:!0,useScriptInjection:!0}}),montageDefine("8cd1986","package.json",{exports:{name:"mousse",version:"0.3.0",description:"Deserialization of JavaScript objects",keywords:["deserialization","serialization"],author:{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"},contributors:[{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"}],bugs:{url:"http://github.com/montagejs/mousse/issues"},licenses:[{type:"BSD",url:"http://github.com/montagejs/mousse/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/mousse.git"},main:"mousse",dependencies:{q:"~0.9.6",collections:"~0.1.21"},devDependencies:{"jasmine-node":"~1.9.1"},scripts:{test:"jasmine-node spec"},readmeFilename:"README.md",homepage:"https://github.com/montagejs/mousse",_id:"mousse@0.3.0",_from:"mousse@~0.3.0",hash:"8cd1986",mappings:{q:{name:"q",hash:"318ab79",location:"../q@318ab79/"},collections:{name:"collections",hash:"45fb404",location:"../collections@45fb404/"}},production:!0,useScriptInjection:!0}}),montageDefine("45fb404","package.json",{exports:{name:"collections",version:"1.0.2",description:"data structures with idiomatic JavaScript collection interfaces",homepage:"http://github.com/montagejs/collections",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal"},keywords:["collections","data structures","observable","list","set","map","splay"],bugs:{url:"http://github.com/montagejs/collections/issues"},licenses:[{type:"MIT",url:"https://raw.github.com/montagejs/collections/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/collections.git"},dependencies:{"weak-map":"1.0.0"},devDependencies:{"jasmine-node":"*",istanbul:"*",opener:"*"},scripts:{test:"jasmine-node spec",cover:"istanbul cover node_modules/jasmine-node/bin/jasmine-node spec && istanbul report html && opener coverage/index.html"},readmeFilename:"README.md",_id:"collections@1.0.2",_from:"collections@~1.0.0",hash:"45fb404",mappings:{"weak-map":{name:"weak-map",hash:"80d73cb",location:"../weak-map@80d73cb/"}},production:!0,useScriptInjection:!0}}),montageDefine("70e9633","package.json",{exports:{name:"frb",version:"0.2.18",description:"Functional reactive bindings",keywords:["functional","reactive","bindings","observe","change"],author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"},contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"}],bugs:{url:"http://github.com/kriskowal/frb/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/frb/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/kriskowal/frb.git"},main:"bindings",dependencies:{collections:"^1.2.1"},devDependencies:{"jasmine-node":">=1.13.1 <1.14.0",pegjs:"git://github.com/dmajda/pegjs.git",memwatch:"*"},scripts:{test:"jasmine-node spec","build-parser":"pegjs --allowed-start-rules expression,sheet grammar.pegjs"},readmeFilename:"README.md",homepage:"https://github.com/kriskowal/frb",_id:"frb@0.2.18",_from:"frb@~0.2.17",hash:"70e9633",mappings:{collections:{name:"collections",hash:"45fb404",location:"../collections@45fb404/"}},production:!0,useScriptInjection:!0}}),montageDefine("318ab79","package.json",{exports:{name:"q",version:"1.0.1",description:"A library for promises (CommonJS/Promises/A,B,D)",homepage:"https://github.com/kriskowal/q",author:"Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)",keywords:["q","promise","promises","promises-a","promises-aplus","deferred","future","async","flow control","fluent","browser","node"],contributors:["Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)","Irakli Gozalishvili <rfobic@gmail.com> (http://jeditoolkit.com)","Domenic Denicola <domenic@domenicdenicola.com> (http://domenicdenicola.com)"],bugs:{mail:"kris@cixar.com",url:"http://github.com/kriskowal/q/issues"},license:{type:"MIT",url:"http://github.com/kriskowal/q/raw/master/LICENSE"},main:"q.js",repository:{type:"git",url:"git://github.com/kriskowal/q.git"},engines:{node:">=0.6.0",teleport:">=0.2.0"},dependencies:{},devDependencies:{jshint:"~2.1.9",cover:"*","jasmine-node":"1.11.0",opener:"*","promises-aplus-tests":"1.x",grunt:"~0.4.1","grunt-cli":"~0.1.9","grunt-contrib-uglify":"~0.2.2",matcha:"~0.2.0"},scripts:{test:"jasmine-node spec && promises-aplus-tests spec/aplus-adapter","test-browser":"opener spec/q-spec.html",benchmark:"matcha",lint:"jshint q.js",cover:"cover run node_modules/jasmine-node/bin/jasmine-node spec && cover report html && opener cover_html/index.html",minify:"grunt",prepublish:"grunt"},directories:{test:"./spec"},hash:"318ab79",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("80d73cb","package.json",{exports:{name:"weak-map",version:"1.0.0",main:"weak-map.js",_id:"weak-map@1.0.0",dist:{shasum:"b66e56a9df0bd25a76bbf1b514db129080614a37",tarball:"http://registry.npmjs.org/weak-map/-/weak-map-1.0.0.tgz"},_from:"weak-map@1.0.0",_npmVersion:"1.3.2",_npmUser:{name:"kriskowal",email:"kris.kowal@cixar.com"},maintainers:[{name:"kriskowal",email:"kris.kowal@cixar.com"}],directories:{},_shasum:"b66e56a9df0bd25a76bbf1b514db129080614a37",_resolved:"https://registry.npmjs.org/weak-map/-/weak-map-1.0.0.tgz",hash:"80d73cb",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("9804a56","index.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n	<meta name=viewport content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui">\n	<meta name=mobile-web-app-capable content=yes>\n	<meta name=apple-mobile-web-app-capable content=yes>\n	\n	<link rel=apple-touch-icon-precomposed sizes=152x152 href=assets/icons/apple-touch-icon-152x152-precomposed.png>\n	\n	<link rel=apple-touch-icon-precomposed sizes=120x120 href=assets/icons/apple-touch-icon-120x120-precomposed.png>\n	\n	<link rel=apple-touch-icon-precomposed sizes=76x76 href=assets/icons/apple-touch-icon-76x76-precomposed.png>\n	\n	<link rel=apple-touch-icon-precomposed href=assets/icons/apple-touch-icon-precomposed.png>\n	\n	<link rel=icon sizes=196x196 href=assets/icons/apple-touch-icon.png>\n\n    <title>GMU CS752 Project</title>\n\n    <link rel=stylesheet href=assets/style/style.css>\n\n    <script src=packages/montage@3c07db4/montage.js async=""></script>\n    <script type=text/montage-serialization>{"owner":{"prototype":"montage/ui/loader.reel"}}</script>\n</head>\n<body>\n    <span class=loading></span>\n\n\n</body></html>'}),montageDefine("3c07db4","core/core",{dependencies:["collections/shim","./shim/object","./shim/array","./shim/string","./extras/object","./extras/date","./extras/element","./extras/function","./extras/regexp","./extras/string","./deprecate","./uuid","collections/listen/property-changes","frb","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/observe","frb/bind","frb/compile-observer","frb/scope","frb/observers","./serialization/bindings","./promise"],factory:function(e,i){function t(e,i){var s=u+i+a;return e.hasOwnProperty(s)?e[s]:Object.defineProperty(e,s,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(t(Object.getPrototypeOf(e),i))})[s]}e("collections/shim"),e("./shim/object"),e("./shim/array"),e("./shim/string"),e("./extras/object"),e("./extras/date"),e("./extras/element"),e("./extras/function"),e("./extras/regexp"),e("./extras/string");var s=e("./deprecate"),a="AttributeProperties",u="_",n="__proto__",r="value",l="enumerable",o="distinct",c="serializable",m=Array.prototype,d=Object.prototype,p=!0,v=i.Montage=function v(){};v.deprecate=s.deprecateMethod(v,s.deprecateMethod,"Montage.deprecate","deprecate module's deprecateMethod"),v.callDeprecatedFunction=s.deprecateMethod(v,s.callDeprecatedFunction,"Montage.callDeprecatedFunction","deprecate module's callDeprecatedFunction");var h={}.__proto__===Object.prototype,g={_montage_metadata:1,__state__:1},f=Object.getOwnPropertyNames(Function);if(Object.defineProperty(v,"specialize",{value:function(e,i){var t,a,u,n,r,l,o,c=this,m=void 0===this.specialize;if(e=e||Object.empty,i=i||Object.empty,t=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?v.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return this.superForValue("constructor")()||this},h)t.__proto__=c;else{u=Object.getOwnPropertyNames(c);for(var l=0;u.length>l;l++)n=u[l],g.hasOwnProperty(n)||(r=Object.getOwnPropertyDescriptor(t,n),(!r||r.configurable)&&v.defineProperty(t,n,Object.getOwnPropertyDescriptor(c,n)));t.__constructorProto__=c,v.defineProperty(t,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(a=Object.create(this.prototype),m){for(u=Object.getOwnPropertyNames(v),l=0;u.length>l;l++)n=u[l],r=Object.getOwnPropertyDescriptor(t,n),(!r||r.configurable)&&v.defineProperty(t,n,Object.getOwnPropertyDescriptor(v,n));for(u=Object.getOwnPropertyNames(v.prototype),l=0;u.length>l;l++)n=u[l],r=Object.getOwnPropertyDescriptor(t,n),(!r||r.configurable)&&v.defineProperty(a,n,Object.getOwnPropertyDescriptor(v.prototype,n))}if(v.defineProperties(a,e),p){o=function(e,i,t){function a(){return this===i&&s.deprecationWarning(v.getInfoForObject(i).objectName+"."+t+" should be moved to constructorProperties",null,3),e.apply(this,arguments)}return a.deprecatedFunction=e,a};for(n in e)f.has(n)?delete e[n]:(r=e[n],r.value&&"function"==typeof r.value&&!r.value.__isConstructor__?r.value=o(r.value,t,n):(r.get&&(r.get=o(r.get,t,n)),r.set&&(r.set=o(r.set,t,n))));v.defineProperties(t,e),v.defineProperty(t,"create",{value:function(){return new t},enumerable:!1})}return v.defineProperties(t,i),v.defineProperty(t,"__isConstructor__",{value:!0,enumerable:!1}),v.defineProperty(t,"_superCache",{value:{},enumerable:!1}),t.prototype=a,v.defineProperty(a,"constructor",{value:t,enumerable:!1}),t},writable:!0,configurable:!0,enumerable:!1}),!h){var b=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:b.apply(Object,arguments)}}Object.defineProperty(v,"create",{configurable:!0,value:function(e,i){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=void 0===e?this:e,"function"==typeof e)return i?e.specialize(i):new e;var t=Object.create(e);return i&&v.defineProperties(t,i),t}});var q=[c];q.forEach(function(e){Object.defineProperty(Object.prototype,u+e+a,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(v,"defineProperty",{value:function(e,i,s){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var a=r in s;if(o in s&&!a)throw new TypeError("Cannot use distinct attribute on non-value property '"+i+"'");if(n in s)s.__proto__=a?"function"==typeof s.value?_:S:y;else{var p;p=a?"function"==typeof s.value?_:S:y;for(var v in p)v in s||(s[v]=p[v])}if(s.hasOwnProperty(l)||i.charAt(0)!==u||(s.enumerable=!1),s.hasOwnProperty(c)||(s.enumerable?s.get&&!s.set?s.serializable=!1:s.writable===!1&&(s.serializable=!1):s.serializable=!1),c in s&&(t(e,c)[i]=s.serializable),s.distinct!==!0||"object"!=typeof s.value){var h,g,f;if(e._superDependencies){if("function"==typeof s.value&&(h=e._superDependencies[i+".value"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[i+".value"];if("function"==typeof s.get&&(h=e._superDependencies[i+".get"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[i+".get"];if("function"==typeof s.set&&(h=e._superDependencies[i+".set"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[i+".set"]}return Object.defineProperty(e,i,s)}(function(e,i,t,s){var a=function(e,i,t){Object.defineProperty(e,i,{enumerable:!1,configurable:!0,writable:!0,value:t})};t.constructor===Object&&Object.getPrototypeOf(t)===d?0!==Object.keys(t).length?Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];if(!e){var s;e={};for(s in t)e[s]=t[s];this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}return e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}}):Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];return e||(e={},this.hasOwnProperty(i)?this[i]=e:a(this,i,e)),e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}}):(t.__proto__||Object.getPrototypeOf(t))===m?0!==t.length?Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];if(!e){var s,u;for(e=[],s=0;void 0!==(u=t[s]);s++)e[s]=u;this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}return e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}}):Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];return e||(e=[],this.hasOwnProperty(i)?this[i]=e:a(this,i,e)),e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}}):t.constructor.prototype===Object.getPrototypeOf(t)?Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];if(!e){var s;e=new t.constructor;for(s in t)e[s]=t[s];this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}return e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}}):Object.defineProperty(s,e,{configurable:!0,get:function(){var e=this[i];return e||(e=Object.create(t.__proto__||Object.getPrototypeOf(t)),this.hasOwnProperty(i)?this[i]=e:a(this,i,e)),e},set:function(e){this.hasOwnProperty(i)?this[i]=e:a(this,i,e)}})})(i,u+i,s.value,e)}}),Object.defineProperty(v,"defineProperties",{value:function(e,i){if("object"!=typeof i||null===i)throw new TypeError("Properties must be an object, not '"+i+"'");for(var t in i)"_bindingDescriptors"!==t&&this.defineProperty(e,t,i[t]);return e}});var y={enumerable:!0,configurable:!0,serializable:!0},S={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},_={writable:!0,enumerable:!1,configurable:!0,serializable:!1};v.defineProperty(v,"didCreate",{value:Function.noop});var P=function(e,i){var t,s,a,u,n,r,l,o,c;if(!i._superPropertyName||!i._superPropertyType)for(v.defineProperty(i,"_superPropertyType",{value:null}),v.defineProperty(i,"_superPropertyName",{value:null}),l=e;!o&&null!==l;){for(t=Object.getOwnPropertyNames(l),s=Object.getPrototypeOf(l),a=0,u=t.length,a;u>a;a++){if(n=t[a],c=Object.getOwnPropertyDescriptor(l,n),null!=(r=c.value)&&(r===i||r.deprecatedFunction===i)){i._superPropertyType="value",i._superPropertyName=n,o=!0;break}if(null!=(r=c.get)&&(r===i||r.deprecatedFunction===i)){i._superPropertyType="get",i._superPropertyName=n,o=!0;break}if(null!=(r=c.set)&&(r===i||r.deprecatedFunction===i)){i._superPropertyType="set",i._superPropertyName=n,o=!0;break}}l=s}return N(e,i._superPropertyType,i._superPropertyName)},C=function(){if("function"!=typeof C.caller)throw new TypeError("Can't get super without caller. Use this.superForValue(methodName) if using strict mode.");var e=P(this,C.caller);return"function"==typeof e?e.bind(this):Function.noop},N=function(e,i,t){var s,a,u,n,r,l=e,o=t+"."+i;if(e._superContext||v.defineProperty(e,"_superContext",{value:{}}),e._superContext[o])l=e._superContext[o];else for(l=e;null!==l&&(!l.hasOwnProperty(t)||(u=Object.getOwnPropertyDescriptor(l,t),"function"!=typeof u[i]));)l=Object.getPrototypeOf(l);if(n=l.constructor,n._superCache&&n._superCache[o])return r=function(e,i,t,s){return function(){i._superContext[e]=t;var a=s.apply(i,arguments);return delete i._superContext[e],a}}(o,e,n._superCache[o].owner,n._superCache[o].func);for(a=l;void 0===s&&(a=Object.getPrototypeOf(a));)if(a._superDependencies||v.defineProperty(a,"_superDependencies",{value:{}}),a._superDependencies[o]||(a._superDependencies[o]=[]),a._superDependencies[o].push(n),u=Object.getOwnPropertyDescriptor(a,t)){if("function"==typeof u[i]){s=u[i];break}break}return"function"==typeof s?(r=function(e,i,t,s){return function(){i._superContext[e]=t;var a=s.apply(i,arguments);return delete i._superContext[e],a}}(o,e,a,s),n._superCache||v.defineProperty(n,"_superCache",{value:{}}),n._superCache[o]={func:s,owner:a},r):Function.noop},D=function(e){return N(this,"value",e)},M=function(e){return N(this,"get",e)},A=function(e){return N(this,"set",e)};v.defineProperty(v,"super",{get:C,enumerable:!1}),v.defineProperty(v.prototype,"super",{get:C,enumerable:!1}),v.defineProperty(v,"superForValue",{value:D,enumerable:!1}),v.defineProperty(v.prototype,"superForValue",{value:D,enumerable:!1}),v.defineProperty(v,"superForGet",{value:M,enumerable:!1}),v.defineProperty(v.prototype,"superForGet",{value:M,enumerable:!1}),v.defineProperty(v,"superForSet",{value:A,enumerable:!1}),v.defineProperty(v.prototype,"superForSet",{value:A,enumerable:!1}),v.defineProperty(v,"getSerializablePropertyNames",{value:function(e){var i=[],t=e._serializableAttributeProperties;if(t)for(var s in t)t[s]&&i.push(s);return i}}),v.defineProperty(v,"getPropertyAttribute",{value:function(e,i,t){var s=u+t+a,n=e[s];return n?n[i]:void 0}}),v.defineProperty(v,"getPropertyAttributes",{value:function(e,i){var t={},s=u+i+a,n=e[s];if(n){for(var r in n)t[r]=n[r];return t}}});var E={isInstance:{value:!0}},w={objectName:{value:"Function"},isInstance:{value:!0}};v.defineProperty(v,"getInfoForObject",{value:function(e){var i,t;if(x.call(e,"_montage_metadata"))return e._montage_metadata;if(i=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,t=e.constructor===Function?w:E,e===Object.prototype)return Object.create(i,t);try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(i,t)})._montage_metadata}catch(s){return e._montage_metadata=Object.create(i,t)}}});var I=e("./uuid");"undefined"!=typeof window&&(window.uuid=I.generate());var x=Object.prototype.hasOwnProperty,L=function(){var e=I.generate(),i=v.getInfoForObject(this);try{null!==i&&i.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:L.call(this)}})):(i.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&i.isInstance&&r in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&n in this||(this._uuid=e))}catch(t){}return this._uuid=e,e},T=function T(){return x.call(this,"_uuid")?this._uuid:L.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:T,set:function(){}}),v.defineProperty(v,"identifier",{value:null,serializable:!0}),v.defineProperty(v.prototype,"identifier",{value:null,serializable:!0}),v.defineProperty(v.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),v.defineProperty(v,"equals",{value:v.prototype.equals}),v.defineProperty(v.prototype,"callDelegateMethod",{value:function(e){var i,t,s=this.delegate;return"string"==typeof this.identifier&&(i=this.identifier+e.toCapitalized(),s&&"function"==typeof(t=s[i]))?(m.shift.call(arguments),t.apply(s,arguments)):s&&"function"==typeof(t=s[e])?(m.shift.call(arguments),t.apply(s,arguments)):void 0}});var V=e("collections/listen/property-changes");Object.addEach(v,V.prototype),Object.addEach(v.prototype,V.prototype);var j=i.Bindings=e("frb"),O={defineBinding:{value:function(e,i,t){return j.defineBinding(this,e,i,t)}},defineBindings:{value:function(e,i){return j.defineBindings(this,e,i)}},cancelBinding:{value:function(e){return j.cancelBinding(this,e)}},cancelBindings:{value:function(){return j.cancelBindings(this)}},getBinding:{value:function(e){return j.getBinding(this,e)}},getBindings:{value:function(){return j.getBindings(this)}}};v.defineProperties(v,O),v.defineProperties(v.prototype,O);var F=e("collections/weak-map"),R=e("collections/map"),k=e("frb/parse"),U=e("frb/evaluate"),z=e("frb/assign");e("frb/observe"),e("frb/bind");var B=e("frb/compile-observer"),Q=e("frb/scope"),G=e("frb/observers"),W=G.autoCancelPrevious,H=new F,X={getPath:{value:function(e,i,t,s){return U(e,this,i||this,t,s)}},setPath:{value:function(e,i,t,s,a){return z(this,e,i,t||this,s,a)}},observePath:{value:function(e,i){var t=k(e),s=B(t);return s(W(i),new Q(this))}},addRangeAtPathChangeListener:{value:function(e,i,t,s,a,u){function n(e,s,a){if(i[t])i[t](e,s,a);else{if(!i.call)throw Error("Can't dispatch range change to "+i);i.call(null,e,s,a)}}t=t||"handleRangeChange";var r=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(n(e.toArray(),r.toArray(),0),r=e,e.addRangeChangeListener(n)):(e=[],n(e,r,0),r=e,void 0)},void 0,void 0,s,a,u)}},getPathChangeDescriptors:{value:function(){return H.has(this)||H.set(this,{}),H.get(this)}},getPathChangeDescriptor:{value:function(e,i,t){var s=v.getPathChangeDescriptors.call(this);return Object.owns(s,e)||(s[e]={willChangeListeners:new R,changeListeners:new R}),s=s[e],s=t?s.willChangeListeners:s.changeListeners,s.has(i)||s.set(i,{path:e,handler:i,beforeChange:t,cancel:Function.noop}),s.get(i)}},addPathChangeListener:{value:function(e,i,t,s,a,u,n){var r=this;i=i||Function.noop;var l=v.getPathChangeDescriptor.call(this,e,i,s);l.cancel();var o,c,m,d=k(e);if(i===Function.noop)m=function(i){if(c)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));c=!0,o=i};else if(t)m=function(s){return i[t].call(i,s,e,r)};else if(i.handlePathChange)m=function(t){return i.handlePathChange.call(i,t,e,r)};else{if("function"!=typeof i)throw Error("Can't recognize handler type: "+i+". Must be function or delegate implementing handlePathChange.");m=function(t){return i.call(r,t,e,r)}}var p=B(d),h=new Q(this);h.beforeChange=s,h.parameters=a,h.document=u,h.components=n;var g=p(W(m),h);return l.cancel=g,c?o:g}},removePathChangeListener:{value:function(e,i,t){i=i||Function.noop;var s=v.getPathChangeDescriptors.call(this),a=t?"willChangeListeners":"changeListeners";if(!Object.owns(s,e))throw Error("Can't find "+a+" for "+JSON.stringify(e));var u=s[e],n=u[a];if(!n.has(i))throw Error("Can't find "+a+" for "+JSON.stringify(e));var r=n.get(i);r.cancel(),n["delete"](i),0===u.willChangeListeners.length&&0===u.changeListeners.length&&delete s[e];for(var l in s)return;H["delete"](this)}},addBeforePathChangeListener:{value:function(e,i,t,s,a,u){return v.addPathChangeListener.call(this,e,i,t,!0,s,a,u)}},removeBeforePathChangeListener:{value:function(e,i){return v.removePathChangeListener.call(this,e,i,!0)}}};v.defineProperties(v,X),v.defineProperties(v.prototype,X),e("./serialization/bindings"),i._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=v.getInfoForObject(this),i=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(i,"_blueprintModuleId")||!i._blueprintModuleId){e=v.getInfoForObject(i);var t=e.moduleId,s=t.lastIndexOf("/"),a=t.lastIndexOf(".");s=-1===s?0:s+1,a=-1===a?t.length:a,a=s>a?t.length:a,v.defineProperty(i,"_blueprintModuleId",{enumerable:!1,value:t.slice(0,a)+".meta"})}return i._blueprintModuleId}},i._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var t=v.getInfoForObject(this),s=t&&!t.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(s,"_blueprint")||!s._blueprint){var a=s.blueprintModuleId;if(""===a)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(s)+"'");i._blueprintDescriptor.BlueprintModulePromise||(i._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/module-blueprint").get("ModuleBlueprint")),v.defineProperty(s,"_blueprint",{enumerable:!1,value:i._blueprintDescriptor.BlueprintModulePromise.then(function(e){var i=v.getInfoForObject(s);return e.getBlueprintWithModuleId(a,i.require).fail(function(i){if(-1!==i.message.indexOf("Can't XHR"))return e.createDefaultBlueprintForObject(s).then(function(e){return e});throw i})})})}return s._blueprint},set:function(i){var t,s=v.getInfoForObject(this),a=s&&!s.isInstance?this:this.constructor;if(null===i)t=null;else{if("function"==typeof i.then)throw new TypeError("Object blueprint should not be a promise");i.blueprintInstanceModule=a.blueprintModule,t=e("./promise").Promise.resolve(i)}v.defineProperty(a,"_blueprint",{enumerable:!1,value:t})}}}}),montageDefine("3c07db4","core/event/event-manager",{dependencies:["../core","../uuid","./mutable-event","../serialization"],factory:function(e,i){var t,s=e("../core").Montage,a=e("../uuid"),u=e("./mutable-event").MutableEvent,n=e("../serialization").Serializer,r=e("../serialization").Deserializer;if("undefined"!=typeof window){void 0===window.Touch&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(i){window.Touch=i.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),t&&t.isStoringPointerEvents&&(t.isStoringPointerEvents=!1,t.isStoringPointerEvents=!0)},!0)}()),s.specialize({type:{value:null},listener:{value:null},capture:{value:null}}),n.defineSerializationUnit("listeners",function(e,i){var s,a,u,n=t,r=i.uuid,l=[];for(var o in n.registeredEventListeners)if(s=n.registeredEventListeners[o],a=s&&s[r])for(var c in a.listeners)u=a.listeners[c],l.push({type:o,listener:e.addObjectReference(u.listener),capture:u.capture});return l.length>0?l:void 0}),r.defineDeserializationUnit("listeners",function(e,i,t){for(var s,a=0;s=t[a];a++)i.addEventListener(s.type,s.listener,s.capture)});var l=Event.NONE,o=Event.CAPTURING_PHASE,c=Event.AT_TARGET,m=Event.BUBBLING_PHASE,d="function";i.EventManager=s.specialize({constructor:{value:function(){this.super()}},eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView
},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=a.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.MediaController&&(e.MediaController.prototype.nativeAddEventListener=e.MediaController.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),e.MediaController&&(e.MediaController.prototype.nativeRemoveEventListener=e.MediaController.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(i,t,s){return e.defaultEventManager.registerEventListener(this,i,t,!!s)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),e.MediaController&&(e.MediaController.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(i,t,s){return e.defaultEventManager.unregisterEventListener(this,i,t,!!s)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.MediaController&&(e.MediaController.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype){var u,n,r=Object.getOwnPropertyNames(e),l=0,o=r.length;for(l;o>l;l++)u=r[l],u.match(/^HTML\w*Element$/)&&"function"==typeof u&&(n=u.prototype,n.nativeAddEventListener=n.addEventListener,n.addEventListener=e.Element.prototype.addEventListener,n.nativeRemoveEventListener=n.removeEventListener,n.removeEventListener=e.Element.prototype.removeEventListener)}s.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),s.defineProperty(e.Element.prototype,"component",{get:function(){return t._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),t=e.defaultEventManager=i.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(i){return e!==i}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var i,t;for(i in Components.interfaces)i.match(/^nsIDOMHTML\w*Element$/)&&(i=i.replace(/^nsIDOM/,""),(i=window[i])&&(t=i.prototype,t.addEventListener=t.nativeAddEventListener,delete t.nativeAddEventListener,t.removeEventListener=t.nativeRemoveEventListener,delete t.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var i,t,s,a,u=this.registeredEventListeners[e];if(!u)return null;a={};for(i in u){t=u[i].listeners;for(s in t)a[s]=t[s]}return a}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,i,t){var s,a;return s=i===t?t.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],s?(a=s[i.uuid],a?a.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var i,t,s=[];for(i in this.registeredEventListeners)t=this.registeredEventListeners[i],e.uuid in t&&s.push(t);return s}},registerEventListener:{enumerable:!1,value:function(e,i,t,s){var a,u,n,r=this.registeredEventListeners[i],l=!1,o=!1;if(void 0===e.uuid)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return r?((a=r[e.uuid])||(a=r[e.uuid]={target:e,listeners:{}},l=!0),u=a.listeners[t.uuid],n=s?"capture":"bubble",u?(u[n]=!0,o=!0):(u={listener:t,capture:s,bubble:!s},a.listeners[t.uuid]=u,o=!0)):(r=this.registeredEventListeners[i]={},r[e.uuid]={target:e,listeners:{}},r[e.uuid].listeners[t.uuid]={listener:t,capture:s,bubble:!s},l=!0,o=!0),l&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,i),o}},unregisterEventListener:{enumerable:!1,value:function(e,i,t,s){var a,u,n,r,l,o=this.registeredEventListeners[i];if(o&&(a=o[e.uuid])){if(u=a.listeners[t.uuid],!u){for(r in a.listeners)if(l=a.listeners[r].listener,l.originalListener&&l.originalListener.uuid===t.uuid){u=a.listeners[r],t=l;break}if(!u)return}n=s?"capture":"bubble",u[n]=!1,u.bubble||u.capture||(delete a.listeners[t.uuid],0===Object.keys(a.listeners).length&&(delete o[e.uuid],0===Object.keys(o).length&&(delete this.registeredEventListeners[i],this._stopObservingTarget_forEventType_(e,i))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,i){if(i.nativeAddEventListener){if(i.defaultView)return i;var t,s=this.eventDefinitions[e];return s?(t=typeof s.bubbles===d?s.bubbles(i):s.bubbles,t?i.screen?i.document:i.ownerDocument:i):i}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,i){var t;!(t=this.actualDOMTargetForEventTypeOnTarget(i,e))||this._observedTarget_byEventType_[i]&&this._observedTarget_byEventType_[i][t.uuid]||(this._observedTarget_byEventType_[i]||(this._observedTarget_byEventType_[i]={}),this._observedTarget_byEventType_[i][t.uuid]=this,t.nativeAddEventListener(i,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,i){var t;t=this.actualDOMTargetForEventTypeOnTarget(i,e),t&&(delete this._observedTarget_byEventType_[i][t.uuid],t.nativeRemoveEventListener(i,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var i=this;this._activationHandler=function(e){var t,s=e.type;if("focus"===s||"mousedown"===s||"touchstart"===s)if(e.changedTouches){t=e.changedTouches.length;for(var a=0;t>a;a++)i._prepareComponentsForActivation(e.changedTouches[a].target)}else i._prepareComponentsForActivation(e.target)}}if(e.Touch?e.document.nativeAddEventListener("touchstart",this._activationHandler,!0):e.document.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var t,s=this.registeredEventListenersOnTarget_(this.application);for(t in s)this._observeTarget_forEventType_(e,t)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var i,t=this.registeredEventListenersOnTarget_(this.application),s=this.registeredEventListenersOnTarget_(e);for(i in t)this._stopObservingTarget_forEventType_(e,i);for(i in s)this._stopObservingTarget_forEventType_(e,i)}},reset:{enumerable:!1,value:function(){var e,i,t,s;for(e in this.registeredEventListeners){i=this.registeredEventListeners[e];for(t in i.targets)s=i.targets[t],this._stopObservingTarget_forEventType_(s.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e){return function(i,t){var s=t?i+"+"+t:i;return e[s]||(e[s]="handle"+(t?t.toCapitalized():"")+i.toCapitalized())}}({})},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e){return function(i,t){var s=t?i+"+"+t:i;return e[s]||(e[s]="capture"+(t?t.toCapitalized():"")+i.toCapitalized())}}({})},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,i){if(!i)throw"Must specify a valid component to see if it claims the specified pointer, '"+i+"' is not valid.";return this._claimedPointers[e]===i}},claimPointer:{value:function(e,i){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!i)throw"Must specify a valid component to claim a pointer, '"+i+"' is not valid.";var t=this._claimedPointers[e];return t===i?!0:t?t.surrenderPointer(e,i)?(this._claimedPointers[e]=i,!0):!1:(this._claimedPointers[e]=i,!0)}},forfeitPointer:{value:function(e,i){if(i!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var i,t;for(i in this._claimedPointers)t=this._claimedPointers[i],e===t&&delete this._claimedPointers[i]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return t.pointerMotion(this.identifier).velocity},set:function(){}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,i){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=i,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var i;switch(e.type){case"mousedown":t._isMouseDragging=!0;case"mousemove":t._isStoringMouseEventsWhileDraggingOnly?t._isMouseDragging&&(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return t.pointerMotion("mouse").velocity},set:function(){}})):(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return t.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return t.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(i=0;e.touches.length>i;i++)this.add(e.touches[i].identifier,{clientX:e.touches[i].clientX,clientY:e.touches[i].clientY,timeStamp:e.timeStamp});break;case"touchend":for(i=0;e.changedTouches.length>i;i++)this.add(e.changedTouches[i].identifier,{clientX:e.changedTouches[i].clientX,clientY:e.changedTouches[i].clientY,timeStamp:e.timeStamp})}},removeEvent:function(e){var i;switch(e.type){case"mouseup":t._isMouseDragging=!1,t._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(i=0;e.changedTouches.length>i;i++)this.remove(e.changedTouches[i].identifier)}}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var i,s,a,u,n,r,l,o,c,m=0,d=!0,p={x:[],y:[],time:[]};for(i=t._pointerStorage.getMemory(e),s=i.data.length,a=i.data[(i.pos-1+s)%s],u=n=r=a.timeStamp,l=a.clientX,o=a.clientY;d&&n>u-350&&i.size>m;)a=i.data[(i.pos-m-1+s)%s],n=a.timeStamp,c=l*l+o*o,c>2&&50>=r-n?(p.x.push(a.clientX),p.y.push(a.clientY),p.time.push(n),r=n,l=a.clientX,o=a.clientY,m++):d=!1;return p}},_fitPointerCurve:{enumerable:!1,value:function(e,i){var t,s,a,u,n,r,l,o,c,m,d,p,v,h,g,f,b,q,y,S,_,P,C,N,D,M,A,E,w,I,x,L,T,V,j,O,F,R,k=1e-4,U=i.length;do{for(d=0,p=0,v=0,h=0,g=0,f=0,q=0,y=0,S=0,_=0,P=0,C=0,D=0,M=0,A=0,E=0,w=0,I=0,L=0,T=0,V=0,j=0,O=0,F=0,m=0;U>m;m++)n=i[m],r=n.t,o=r*r,c=o*r,l=n.v,b=k*(6*(o-r)-c+2),N=6*k*(c-2*o+r),x=6*k*(o-c),R=2*k*c,f+=b*b,C+=N*N,I+=x*x,F+=R*R,d+=l*b,q+=l*N,D+=l*x,L+=l*R,v-=b,S-=N,A-=x,V-=R,p-=b*r,y-=N*r,M-=x*r,T-=R*r,h-=b*o,_-=N*o,E-=x*o,j-=R*o,g-=b*c,P-=N*c,w-=x*c,O-=R*c;k*=2}while(0===f||0===C||0===I||0===F);for(r=k/f,d*=r,p*=3*r,v*=r,h*=3*r,g*=r,r=k/C,q*=r,y*=3*r,S*=r,_*=3*r,P*=r,r=k/I,D*=r,M*=3*r,A*=r,E*=3*r,w*=r,r=k/F,L*=r,T*=3*r,V*=r,j*=3*r,O*=r,f=e[0],C=e[1],I=e[2],F=e[3],t=3*(C-I)+F-f,s=f+I-2*C,a=C-f,u=f,m=0;20>m;m++)r=d+u*v+a*p+s*h+t*g,f+=r,u+=r,t-=r,s+=r,a-=r,r=q+u*S+a*y+s*_+t*P,C+=r,t+=3*r,s-=r+r,a+=r,r=D+u*A+a*M+s*E+t*w,I+=r,t-=3*r,s+=r,r=L+u*V+a*T+s*j+t*O,F+=r,t+=r;e[0]=f,e[1]=C,e[2]=I,e[3]=F}},_pointerBezierValue:{enumerable:!1,value:function(e,i){var t=1-e;return t*t*t*i[0]+3*t*t*e*i[1]+3*t*e*e*i[2]+e*e*e*i[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,i){var t,s,a=e.length,u=e[0],n=e[0],r=0;for(s=1;a>s;s++)u>e[s]&&(u=e[s],r=s);if(t=n-u){if(a>5){var l,o,c,m=[];for(s=0;a>s;s++)m[s]={v:i[s],t:(e[s]-u)/t};return l=m[r].v,o=m[0].v,c=[l,(2*l+o)/3,(l+2*o)/3,o],this._fitPointerCurve(c,m),5e3*(this._pointerBezierValue(.8,c)-this._pointerBezierValue(.6,c))/t}return a>1?1e3*(i[0]-i[r])/t:0}return 0}},pointerMotion:{value:function(e){if(t._pointerStorage.isStored(e)){var i={};return Object.defineProperties(i,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=t._getPointerVelocityData(e)),this._x=t._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=t._getPointerVelocityData(e)),this._y=t._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:i}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:s.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},handleEvent:{enumerable:!1,value:function(e){this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var i,t,s,a,n,r,p,v,h,g,f,b,q,y,S=e.type,_=e.bubbles;for("DOMContentLoaded"===S&&(i=e.target.defaultView,i&&this._windowsAwaitingFinalRegistration[i.uuid]&&(this._finalizeWindowRegistration(i),e.target.removeEventListener("DOMContentLoaded",this,!0))),y="boolean"!=typeof e.propagationStopped?u.fromEvent(e):e,h=Element.isElement(y.target)||y.target instanceof Document||y.target===window?this._eventPathForDomTarget(y.target):this._eventPathForTarget(y.target),b=y.target.identifier?this.methodNameForCapturePhaseOfEventType(S,y.target.identifier):null,q=y.target.identifier?this.methodNameForBubblePhaseOfEventType(S,y.target.identifier):null,g=this.methodNameForCapturePhaseOfEventType(S),f=this.methodNameForBubblePhaseOfEventType(S),this.delegate&&typeof this.delegate.willDistributeEvent===d&&this.delegate.willDistributeEvent(y),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(y),y.eventPhase=o,t=h.length-1;!y.propagationStopped&&(s=h[t]);t--)if(y.currentTarget=s,a=this.registeredEventListenersForEventType_onTarget_(S,s))for(p=Object.keys(a),n=0;a&&!y.immediatePropagationStopped&&(r=a[p[n]]);n++)r.capture&&(v=r.listener,b&&typeof v[b]===d?v[b](y):typeof v[g]===d?v[g](y):typeof v.handleEvent===d?v.handleEvent(y):typeof v!==d||v.__isConstructor__||v.call(s,y));if(!y.propagationStopped&&(y.eventPhase=c,y.currentTarget=s=y.target,a=this.registeredEventListenersForEventType_onTarget_(S,s)))for(p=Object.keys(a),n=0;a&&!y.immediatePropagationStopped&&(r=a[p[n]]);n++)v=r.listener,r.capture&&(b&&typeof v[b]===d?v[b](y):typeof v[g]===d?v[g](y):typeof v.handleEvent===d?v.handleEvent(y):typeof v===d&&v.call(s,y)),r.bubble&&(q&&typeof v[q]===d?v[q](y):typeof v[f]===d?v[f](y):typeof v.handleEvent===d?v.handleEvent(y):typeof v===d&&v.call(s,y));for(y.eventPhase=m,t=0;_&&!y.propagationStopped&&(s=h[t]);t++)if(y.currentTarget=s,a=this.registeredEventListenersForEventType_onTarget_(S,s))for(p=Object.keys(a),n=0;a&&!y.immediatePropagationStopped&&(r=a[p[n]]);n++)r.bubble&&(v=r.listener,q&&typeof v[q]===d?v[q](y):typeof v[f]===d?v[f](y):typeof v.handleEvent===d?v.handleEvent(y):typeof v===d&&v.call(s,y));y.eventPhase=l,y.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_prepareComponentsForActivation:{value:function(e){var i,t,s=e,a=s&&s.defaultView?s.defaultView:window,u=a.document?a.document:document,n=!1,r=null;do switch(s&&(t=this.eventHandlerForElement(s),t&&(n||(n=!0,r=this._findActiveTarget(t)),t._preparedForActivationEvents||(t._prepareForActivationEvents(),t._preparedForActivationEvents=!0))),i=s,s){case a:s=null;break;case u:s=a;break;case u.documentElement:s=u;break;default:s=s.parentNode}while(s&&i!==s);this.activeTarget=r}},_findActiveTarget:{value:function(e){for(var i=null,t={};!i&&e&&!(e.uuid in t);)t[e.uuid]=e,e.acceptsActiveTarget?i=e:e=e.nextTarget;return i}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var i=e,t=this.application,s=[],a={};a[e.uuid]=e;do i.uuid in a||(s.push(i),a[i.uuid]=i),i=i.nextTarget,(!i||i.uuid in a)&&(i=t),i&&i.uuid in a&&(i=null);while(i);return s}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var i,t=e,s=t&&t.defaultView?t.defaultView:window,a=s.document?s.document:document,u=this.application,n=[];do switch(t!==e&&n.push(t),i=t,t){case u:t=t.parentApplication,t&&(u=t);break;case s:t=u;break;case a:t=s;break;case a.documentElement:t=a;break;default:t=t.parentNode,t||(t=u)}while(t&&i!==t);return n}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,i){var t=this.eventHandlerForElement(i);t&&this.unregisterEventHandlerForElement(i),this._elementEventHandlerByUUID[i.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e||(e=this.application),e===this._activeTarget||this.activeTarget&&!this.activeTarget.surrendersActiveTarget(e)||(e.willBecomeActiveTarget(this.activeTarget),this._activeTarget=e,e.didBecomeActiveTarget())}}})}}}),montageDefine("3c07db4","core/serialization/deserializer/montage-reviver",{dependencies:["../../core","mousse/deserialization/reviver","./properties-deserializer","./self-deserializer","./unit-deserializer","../../module-reference","../alias","../../promise"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/deserialization/reviver").Reviver,a=e("./properties-deserializer").PropertiesDeserializer,u=e("./self-deserializer").SelfDeserializer,n=e("./unit-deserializer").UnitDeserializer,r=e("../../module-reference").ModuleReference,l=e("../alias").Alias,o=e("../../promise").Promise,c=t.specialize({_require:{value:null},_objectRequires:{value:null},init:{value:function(e,i){if("function"!=typeof e)throw Error("Function 'require' missing.");if("string"!=typeof e.location)throw Error("Function 'require' location is missing");if("object"!=typeof i&&void 0!==i)throw Error("Parameter 'objectRequires' should be an object.");return this._require=e,this._objectRequires=i,this}},getExports:{value:function(e,i){var t;for(i=e.resolve(i),t=e.getModuleDescriptor(i);void 0!==t.redirect;)t=e.getModuleDescriptor(t.redirect);return void 0!==t.mappingRedirect?this.getExports(t.mappingRequire,t.mappingRedirect):t.exports}},getModule:{value:function(e,i){var t,s,a=this._objectRequires;return t=a&&i in a?a[i]:this._require,s=this.getExports(t,e),s||(s=t.async(e)),s}}}),m=i.MontageReviver=t.specialize.call(s,{moduleLoader:{value:null},init:{value:function(e,i){return this.moduleLoader=(new c).init(e,i),this}},getTypeOf:{value:function(e){if(null!==e&&"object"==typeof e&&1===Object.keys(e).length){if("#"in e)return"Element";if("%"in e)return"Module"}return s.prototype.getTypeOf.call(this,e)}},_checkLabel:{value:function(e,i){return i&&":"!==e[0]?Error('Aliases can only be defined in template properties (start with a colon (:)), "'+e+'".'):i||":"!==e[0]?void 0:Error('Only aliases are allowed as template properties (start with a colon (:), "'+e+'".')}},reviveRootObject:{value:function(e,i,t){var a,u="alias"in e;return a=this._checkLabel(t,u),a?o.reject(a):s.prototype.reviveRootObject.apply(this,arguments)}},reviveElement:{value:function(e,i,t){var s=e["#"],a=i.getElementById(s);return a?(t&&i.setObjectLabel(a,t),a):o.reject(Error("Element with id '"+s+"' was not found."))}},reviveModule:{value:function(e,i){var t=e["%"],s=i.getRequire();t=s.resolve(t);var a=s.getModuleDescriptor(t);return(new r).initWithIdAndRequire(a.id,a.require)}},reviveCustomObject:{value:function(e,i,t){return"alias"in e?this.reviveAlias(e,i,t):this.reviveMontageObject(e,i,t)}},reviveMontageObject:{value:function(e,i,t){var s,a,u,n=this,r=e.prototype||e.object;return r&&(a=m.parseObjectLocationId(r),s=this.moduleLoader.getModule(a.moduleId,t),u=a.objectName),o.isPromise(s)?s.then(function(s){return n.instantiateMontageObject(e,s,u,i,t)},function(i){throw i.stack&&console.error(i.stack),Error('Error deserializing "'+t+'" when loading module "'+a.moduleId+"' from '"+e.prototype+"'")}):this.instantiateMontageObject(e,s,u,i,t)}},instantiateMontageObject:{value:function(e,i,t,s,a){var u,n,r=this;return u=this.getMontageObject(e,i,t,s,a),s.setObjectLabel(u,a),u.isDeserializing=!0,n=this.reviveObjectLiteral(e,s),o.isPromise(n)?n.then(function(e){return r.deserializeMontageObject(e,u,s,a)}):this.deserializeMontageObject(n,u,s,a)}},deserializeMontageObject:{value:function(e,i,t,s){var a;return"function"==typeof i.deserializeSelf?this.deserializeCustomMontageObject(i,e,t,s):(t.setUnitsToDeserialize(i,e,m._unitNames),a=this.deserializeMontageObjectProperties(i,e.properties,t),o.isPromise(a)?a.then(function(){return i}):i)}},deserializeMontageObjectProperties:{value:function(e,i,t){var s;if("function"==typeof e.deserializeProperties){var u=(new a).initWithReviverAndObjects(this,t);s=e.deserializeProperties(u)}else for(var n in i)e[n]=i[n];return s}},deserializeCustomMontageObject:{value:function(e,i,t,s){var a,n=(new u).initWithObjectAndObjectDescriptorAndContextAndUnitNames(e,i,t,m._unitNames);return a=e.deserializeSelf(n),o.isPromise(a)?a.then(function(e){return t.setObjectLabel(e,s),e}):void 0!==a?(t.setObjectLabel(a,s),a):e}},getMontageObject:{value:function(e,i,t,s,a){var u;if(s.hasUserObject(a))return s.getUserObject(a);if("prototype"in e){if(!(t in i))throw Error('Error deserializing "'+a+'": object named "'+t+'"'+' was not found in "'+e.prototype+'".'+" Available objects are: "+Object.keys(i)+".");return u=Object.create(i[t].prototype),u.isDeserializing=!0,"function"==typeof u.didCreate?u.didCreate():"function"==typeof u.constructor&&u.constructor(),u}if("object"in e){if(!(t in i))throw Error('Error deserializing "'+a+'": object named "'+u+"' was not found given '"+e.object+"'");return i[t]}throw Error("Error deserializing "+JSON.stringify(e)+', might need "prototype" or "object" on label '+JSON.stringify(a))}},reviveAlias:{value:function(e,i,t){var s=new l;return s.value=e.alias,i.setObjectLabel(s,t),s}},didReviveObjects:{value:function(e,i){var t,s=this;return t=this._deserializeUnits(i),o.isPromise(t)?t.then(function(){s._invokeDeserializedFromSerialization(e,i)}):(this._invokeDeserializedFromSerialization(e,i),void 0)}},_invokeDeserializedFromSerialization:{value:function(e,i){var t;for(var s in e)t=e[s],null!=t&&delete t.isDeserializing,i.hasUserObject(s)||t&&"function"==typeof t.deserializedFromSerialization&&t.deserializedFromSerialization(s)}},_deserializeUnits:{value:function(e){var i,t,s=e.getUnitsToDeserialize(),a=m._unitRevivers;try{for(var u,r=0;u=s[r];r++){i=u.unitNames;for(var l,c=0;l=i[c];c++)l in u.objectDesc&&(t=(new n).initWithContext(e),a[l](t,u.object,u.objectDesc[l]))}}catch(d){return o.reject(d)}}}},{_unitRevivers:{value:Object.create(null)},_unitNames:{value:[]},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,i){return i.toUpperCase()}},_locationDescCache:{value:Object.create(null)},parseObjectLocationId:{value:function(e){var i,t,s,a,u=this._locationDescCache;return e in u?i=u[e]:(t=e.indexOf("["),t>0?(s=e.substr(0,t),a=e.slice(t+1,-1)):(s=e,this._findObjectNameRegExp.test(e),a=RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)),i={moduleId:s,objectName:a},u[e]=i),i}},defineUnitReviver:{value:function(e,i){this._unitRevivers[e]=i,this._unitNames.push(e)}},getTypeOf:{value:function(e){return this.prototype.getTypeOf.call(this,e)}}});void 0!==i&&(i.MontageReviver=m)}}),montageDefine("3c07db4","core/logger",{dependencies:["./core"],factory:function(e,i){function t(e){var i=function(e){return this._color=e,this};for(var t in d)i[t]=function(i){return function(){return e.color(d[i])}}(t);e.color=i}var s,a,u,n,r,l,o,c,m=e("./core").Montage;a=i.loggers={},r=function(){var e,i=r.caller.caller;return e=i.name,""===e&&(e="anonymous"),e},l=function(e){if(e.getHours){var i=e.getHours(),t=e.getMinutes(),s=e.getSeconds();return(1===i.length?"0"+i:i)+":"+(1===t.length?"0"+t:t)+":"+(1===s.length?"0"+s:s)+"."+e.getMilliseconds()}},n=function(){},u=function(){console.log(arguments)},s=i.Logger=m.specialize({constructor:{value:function s(){this.super(),t(this)}},init:{value:function(e,i,t){if(this.name=e,this._onStateChange=i,this._storeState=!t,this._storeState&&c){var s=c.getItem("_montage_logger_"+e);s&&(this.isDebug="true"===s)}return i&&this._onStateChange("true"===s),this.isError=!0,this}},name:{value:null},buffer:{value:[],distinct:!0},buffered:{value:!1},flush:{value:function(){var e,i,t=this.buffer;for(i=0;e=t[i];i++)this._formattedLog(e);this.buffer.length=0}},isDebug:{get:function(){return this.debug!==n},set:function(e){this.debug=e?this._consoleLogMontage:n}},isError:{get:function(){return this.error!==n},set:function(e){this.error=e?this._consoleLogMontage:n}},_consoleLogMontage:{value:function(){var e=arguments[0],i=e._montage_metadata;new Date,i?(Array.prototype.shift.call(arguments),Array.prototype.unshift.call(arguments,i.objectName+"."+r(e)+"()"),this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)):this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)}},_formattedLog:{value:function(e){var i=e[0];h.isDebug&&"string"==typeof i&&Array.prototype.splice.call(e,0,1,"%c"+i,this._logCss),console.log.apply(console,e)}},__logCss:{value:null},_logCss:{get:function(){return null===this.__logCss&&(this.__logCss="",this.__logCss+=this._color?"color:"+this._color+";":"color:black;"),this.__logCss
}},debug:{value:n},error:{value:n},toTimeString:{value:l},_storeState:{value:null},_onStateChange:{value:null}});var d={base03:"#002b36",base02:"#073642",base01:"#586e75",base00:"#657b83",base0:"#839496",base1:"#93a1a1",base2:"#eee8d5",base3:"#fdf6e3",yellow:"#b58900",orange:"#cb4b16",red:"#dc322f",magenta:"#d33682",violet:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"};i.logger=function(e,i,t){var u;return null==(u=a[e])&&(u=(new s).init(e,i,t),m.defineProperty(a,e,{value:u})),u},o=m.specialize({constructor:{value:function o(){this.super()}},init:{value:function(){return document.nativeAddEventListener?(document.nativeAddEventListener("keyup",this,!1),document.nativeAddEventListener("keydown",this,!1)):(document.addEventListener("keyup",this,!1),document.addEventListener("keydown",this,!1)),this}},inspectorElement:{value:null},m_dontRemove:{value:null},titleHeader:{value:null},shown:{value:!1},isCtrl:{value:!1},isAlt:{value:!1},keyup:{value:function(e){17==e.which&&(this.isCtrl=!1),18==e.which&&(this.isAlt=!1)}},keydown:{value:function(e){return 17==e.which&&(this.isCtrl=!0),18==e.which&&(this.isAlt=!0),76==e.which&&this.isCtrl===!0&&this.isAlt===!0?(this.shown?this.hideInspector():this.showInspector(),!1):void 0}},change:{value:function(e){var i=e.target.checked,t=e.target.value,s=a[t];s.isDebug=i,s._onStateChange&&s._onStateChange(i),s._storeState&&c&&c.setItem("_montage_logger_"+t,i)}},mouseup:{value:function(){this.hideInspector()}},showInspector:{value:function(){if(!this.inspectorElement){var e,i,t,s,u,n,r,l,o,m,d,p=0;for(this.m_dontRemove=document.getElementsByTagName("body")[0],this.inspectorElement=document.createElement("div"),this.inspectorElement.id="_montage_logger_inspector",i=document.createElement("div"),this.inspectorElement.appendChild(i),s=document.createElement("div"),i.appendChild(s),t=document.createElement("h1"),t.className="_montage_logger_inspector-title",t.textContent="Logger Inspector",this.titleHeader=t,s.appendChild(t),o=Object.keys(a),p=0;e=a[o[p]];p++)u=document.createElement("label"),n=document.createElement("input"),d=document.createElement("span"),u.className="_montage_logger_inspector-content",d.textContent=e.name,u.appendChild(n),u.appendChild(d),n.value=e.name,n.type="checkbox",n.checked=!!e.isDebug,l="_montage_logger_"+e.name,e._storeState&&c&&(r=c.getItem(l),null==r&&c.setItem(l,e.isDebug)),s.appendChild(u);m=document.createElement("style");var v="#_montage_logger_inspector {";v+="    border: 1px solid rgba(15,15,15,0.4);",v+="    position: fixed;",v+="    right: 25px;",v+="    top: 25px;",v+="    -webkit-border-radius: 5px;",v+="    color: #dddddd;",v+='    font: 10px "Lucida Grande","Lucida Sans", sans;',v+="    background:-webkit-gradient(linear, left top, left bottom, from(rgba(15,15,15,0.75)), to(rgba(15,15,15,0.95)) );",v+="    -webkit-box-shadow: 0 0 15px rgba(0,0,0,.3);",v+="    width: 250px;",v+="}",v+="#_montage_logger_inspector div {",v+="    -webkit-border-radius: 5px;",v+="    background: -webkit-gradient(radial, 100 -60, 0, 125 -50, 125, from(rgba(255,255,255,0.00)), to(rgba(0,0,0,.2)), color-stop(1, rgba(0,0,0,.2)));",v+="}",v+="#_montage_logger_inspector div div {",v+="    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.2)), to(rgba(0,0,0,.1)), color-stop(0.33, rgba(255,255,255,.01)), color-stop(0.33, rgba(50,50,50,1)) );",v+="    padding: 7px 10px;",v+="    -webkit-border-radius: 3px;",v+="    overflow-x: hidden;",v+="}",v+="._montage_logger_inspector-title {",v+="    color: rgba(255,255,255,0.9);",v+="    font-size: 13px;",v+="    margin: 0 0 11px 0;",v+="    padding: 0 0 0 5px;",v+="}",v+="._montage_logger_inspector-content {",v+="    padding: 0 0 0 20px;",v+="    margin: 0;",v+="    display: block;",v+="}",m.textContent=v,document.head.appendChild(m)}this.shown=!0,this.m_dontRemove.appendChild(this.inspectorElement),this.titleHeader.nativeAddEventListener("mouseup",this,!1),this.inspectorElement.nativeAddEventListener("change",this,!1)}},hideInspector:{value:function(){document.getElementById("_montage_logger_inspector")&&(this.shown=!1,this.m_dontRemove.removeChild(this.inspectorElement),this.titleHeader.nativeRemoveEventListener("mouseup",this,!1),this.inspectorElement.nativeRemoveEventListener("change",this,!1))}},handleEvent:{enumerable:!1,value:function(e){this[e.type]&&this[e.type](e)}}});var p=function(){(new o).init()};if("undefined"!=typeof window){try{c=window.localStorage}catch(v){console.log("Error accessing localStorage",v)}window.loggers=a,c&&p()}var h=i.logger("colors")}}),montageDefine("3c07db4","core/serialization/deserializer/properties-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,i){var t=e("../../core").Montage;e("../../promise").Promise;var s=t.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},initWithObjectAndObjectDescriptorAndContext:{value:function(e,i,t){return this._object=e,this._objectDescriptor=i,this._context=t,this}},get:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},deserializeProperties:{value:function(e){var i,s=this._object,a=this._objectDescriptor.properties;if(a){e||(e=t.getSerializablePropertyNames(s));for(var u=0,n=e.length;n>u;u++)i=e[u],s[i]=a[i]}}},getObjectByLabel:{value:function(e){this._context.getObject(e)}}});i.PropertiesDeserializer=s}}),montageDefine("3c07db4","core/serialization/deserializer/self-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,i){var t=e("../../core").Montage;e("../../promise").Promise;var s=t.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},_unitNames:{value:null},_objectUnitNames:{value:null},create:{value:function(){return new this}},initWithObjectAndObjectDescriptorAndContextAndUnitNames:{value:function(e,i,t,s){return this._object=e,this._objectDescriptor=i,this._context=t,this._unitNames=s,this}},getProperty:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},getType:{value:function(){return"prototype"in this._objectDescriptor?"prototype":"object"in this._objectDescriptor?"object":void 0}},getTypeValue:{value:function(){return this._objectDescriptor.prototype||this._objectDescriptor.object}},getObjectByLabel:{value:function(e){this._context.getObject(e)}},deserializeProperties:{value:function(e){var i,s=this._object,a=this._objectDescriptor.properties;if(a){e||(e=t.getSerializablePropertyNames(s));for(var u=0,n=e.length;n>u;u++)i=e[u],s[i]=a[i]}}},deserializeUnit:{value:function(e){var i=this._objectUnitNames;i?-1===i.indexOf(e)&&i.push(e):(i=this._objectUnitNames=[e],this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,i))}},deserializeUnits:{value:function(){var e=this._objectUnitNames;if(e)for(var i,t=0;i=e[t];t++)-1===e.indexOf(i)&&e.push(i);else e=this._objectUnitNames=this._unitNames,this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,e)}}});i.SelfDeserializer=s}}),montageDefine("3c07db4","core/serialization/deserializer/unit-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,i){var t=e("../../core").Montage;e("../../promise").Promise;var s=t.specialize({_context:{value:null},create:{value:function(){return new this}},initWithContext:{value:function(e){return this._context=e,this}},_templatePropertyRegExp:{value:/^([^:]+)(:.*)$/},isValidTemplatePropertyReference:{value:function(e){var i=this._templatePropertyRegExp.exec(e);if(i){var t=i[1];return this._context.hasObject(t)?!0:!1}return!1}},getObjectByLabel:{value:function(e){if(this._context.hasObject(e))return this._context.getObject(e);if(this.isValidTemplatePropertyReference(e))return null;throw Error("Object with label '"+e+"' was not found.")}}});i.UnitDeserializer=s}}),montageDefine("3c07db4","core/module-reference",{dependencies:["./core"],factory:function(e,i){var t=e("./core").Montage;i.ModuleReference=t.specialize({constructor:{value:function(){return this.super()}},initWithIdAndRequire:{value:function(e,i){if(!e||!i)throw Error("Module ID and require required");return this.id=e,this.require=i,this}},id:{value:null},require:{value:null},_exports:{value:null},exports:{get:function(){return this._exports?this._exports:this._exports=this.require.async(this.id)}},resolve:{value:function(e){return e.identify(this.id,this.require)}},isModuleReference:{writable:!1,configurable:!1,value:!0}})}}),montageDefine("3c07db4","core/serialization/alias",{dependencies:["../core"],factory:function(e,i){var t=e("../core").Montage;i.Alias=t.specialize({_value:{value:null},_aliasRegExp:{value:/@([_a-zA-Z$][0-9_a-zA-Z$]*):([_a-zA-Z$][0-9_a-zA-Z$]*)$/},value:{get:function(){return this._value},set:function(e){var i=this._aliasRegExp.exec(e);if(!i)throw Error("Invalid alias syntax: "+e);this._value=e,this._componentLabel=i[1],this._propertyName=i[2]}},_componentLabel:{value:null},componentLabel:{get:function(){return this._componentLabel}},_propertyName:{value:null},propertyName:{get:function(){return this._propertyName}},init:{value:function(e){return this.value=e,this}}})}}),montageDefine("3c07db4","core/shim/object",{dependencies:[],factory:function(){Object.create||(Object._creator=function e(){this.__proto__=e.prototype},Object.create=function(e){return this._creator.prototype=e||Object.prototype,new this._creator},Object.getPrototypeOf=function(e){return e.__proto__}),Object.isSealed||Object.defineProperty(Object,"isSealed",{value:function(){return!1},writable:!0,configurable:!0}),Object.seal||Object.defineProperty(Object,"seal",{value:function(e){return e},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/shim/array",{dependencies:[],factory:function(){Array.isArray||Object.defineProperty(Array,"isArray",{value:function(e){return"[object Array]"===Object.prototype.toString.call(e)},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/shim/string",{dependencies:[],factory:function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e){return this.length>=e.length&&this.slice(0,e.length)===e},writable:!0,configurable:!0}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e){return this.length>=e.length&&this.slice(this.length-e.length,this.length)===e},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/extras/object",{dependencies:["collections/weak-map","frb"],factory:function(e){e("collections/weak-map"),Object.defineProperty(Object,"getPropertyDescriptor",{value:function(e,i){var t,s=e;do t=Object.getOwnPropertyDescriptor(s,i);while(!t&&(s=s.__proto__||Object.getPrototypeOf(s)));return t},writable:!0,configurable:!0}),Object.defineProperty(Object,"getPrototypeAndDescriptorDefiningProperty",{value:function(e,i){var t,s=e;if(i){do t=Object.getOwnPropertyDescriptor(s,i);while(!t&&(s=s.__proto__||Object.getPrototypeOf(s)));return{prototype:s,propertyDescriptor:t}}},writable:!0,configurable:!0}),Object.defineProperty(Object.prototype,"clear",{value:function(){for(var e=Object.keys(this),i=e.length;i;)i--,delete this[e[i]];return this},writable:!0,configurable:!0}),Object.defineProperty(Object,"defineBinding",{value:function(i,t,s){var a=Error.stackTraceLimit;Error.stackTraceLimit=2,console.warn("Object.defineBinding deprecated.  See the comment below this warning for migration instructions.",Error("deprecated").stack),Error.stackTraceLimit=a;var u=e("frb");s.source=s.boundObject,s.oneway?s["<-"]=s.boundObjectPropertyPath:s["<->"]=s.boundObjectPropertyPath,s.boundValueMutator&&(s.convert=s.boundValueMutator),u.defineBinding(i,t,s)}}),Object.defineProperty(Object,"deleteBinding",{value:function(i,t){var s=e("frb");s.cancelBinding(i,t)}})}}),montageDefine("3c07db4","core/extras/date",{dependencies:[],factory:function(){Object.defineProperty(Date.prototype,"clone",{value:function(){return new Date(this)},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/extras/element",{dependencies:[],factory:function(){"undefined"==typeof Element||Element.isElement||Object.defineProperty(Element,"isElement",{value:function(e){return!(!e||1!==e.nodeType)},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/extras/function",{dependencies:["./object"],factory:function(e){e("./object"),Object.defineProperty(Function,"identity",{value:function(e){return e},writable:!0,configurable:!0}),Object.defineProperty(Function,"noop",{value:function(){},writable:!0,configurable:!0}),Object.defineProperty(Function,"by",{value:function(e,i){i=i||Object.compare,e=e||Function.identity;var t=function(t,s){return i(e(t),e(s))};return t.compare=i,t.by=e,t},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/extras/regexp",{dependencies:[],factory:function(){if(!RegExp.isRegExp){var e=Object.prototype.toString;Object.defineProperty(RegExp,"isRegExp",{value:function(i){return"[object RegExp]"===e.call(i)},writable:!0,configurable:!0})}}}),montageDefine("3c07db4","core/extras/string",{dependencies:[],factory:function(){Object.defineProperty(String.prototype,"equals",{value:function(e){return this.valueOf()===Object.getValueOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"contains",{value:function(e){return-1!==this.indexOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"toCapitalized",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},writable:!0,configurable:!0})}}),montageDefine("3c07db4","core/deprecate",{dependencies:[],factory:function(e,i){var t=i.deprecationWarning=function t(e,i,t){if(t=t===!0?2:t){var s=Error.stackTraceLimit;Error.stackTraceLimit=t}if("undefined"!=typeof console&&"function"==typeof console.warn){var a=t?Error("").stack:"";i?console.warn(e+" is deprecated, use "+i+" instead.",a):console.warn(e,a)}t&&(Error.stackTraceLimit=s)};i.deprecateMethod=function(e,i,s,a){var u=function(){return t(s,a,3),i.apply(e?e:this,arguments)};return u.deprecatedFunction=i,u},i.callDeprecatedFunction=function(e,i,t,s){var a,u,n=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(a=Montage.getInfoForObject(e).objectName,s?console.warn(t+" is deprecated, use "+s+" instead.",a):console.warn(t,a)),Error.stackTraceLimit=n,u=ARRAY_PROTOTYPE.slice.call(arguments,4),i.apply(e?e:this,u)}}}),montageDefine("3c07db4","core/uuid",{dependencies:[],factory:function(e,i){function t(){var e,i=s,t=a;return t[0]=i[15&(e=4294967296*Math.random())],t[1]=i[15&(e>>>=4)],t[2]=i[15&(e>>>=4)],t[3]=i[15&(e>>>=4)],t[4]=i[15&(e>>>=4)],t[5]=i[15&(e>>>=4)],t[6]=i[15&(e>>>=4)],t[7]=i[15&(e>>>=4)],t[9]=i[15&(e=4294967296*Math.random())],t[10]=i[15&(e>>>=4)],t[11]=i[15&(e>>>=4)],t[12]=i[15&(e>>>=4)],t[15]=i[15&(e>>>=4)],t[16]=i[15&(e>>>=4)],t[17]=i[15&(e>>>=4)],t[19]=i[8|3&(e=4294967296*Math.random())],t[20]=i[15&(e>>>=4)],t[21]=i[15&(e>>>=4)],t[22]=i[15&(e>>>=4)],t[24]=i[15&(e>>>=4)],t[25]=i[15&(e>>>=4)],t[26]=i[15&(e>>>=4)],t[27]=i[15&(e>>>=4)],t[28]=i[15&(e=4294967296*Math.random())],t[29]=i[15&(e>>>=4)],t[30]=i[15&(e>>>=4)],t[31]=i[15&(e>>>=4)],t[32]=i[15&(e>>>=4)],t[33]=i[15&(e>>>=4)],t[34]=i[15&(e>>>=4)],t[35]=i[15&(e>>>=4)],t.join("")}var s="0123456789ABCDEF".split(""),a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");i.Uuid=Object.create(Object.prototype,{generate:{enumerable:!1,value:t}}),i.generate=t}}),montageDefine("3c07db4","core/serialization/bindings",{dependencies:["frb","frb/parse","frb/stringify","frb/expand","frb/scope","../serialization"],factory:function(e){var i=e("frb"),t=(e("frb/parse"),e("frb/stringify")),s=e("frb/expand"),a=e("frb/scope"),u=e("../serialization").Serializer,n=e("../serialization").Deserializer;u.defineSerializationUnit("bindings",function(e,u){var n,r=i.getBindings(u),l={};for(var o in r){var c=r[o],m={};if(!("serializable"in c)||c.serializable){var d=c.sourcePath,p=c.sourceSyntax;if(c.source!==u){var v=e.getObjectLabel(c.source),h=new a({type:"component",label:v});h.components=e,p=s(p,h)}var h=new a;h.components=e,d=t(p,h),c.twoWay?m["<->"]=d:m["<-"]=d,c.converter?m.converter=c.converter:(m.convert=c.convert,m.revert=c.revert),c.trace&&(m.trace=!0),l[o]=m,n=!0}}return n?l:void 0}),n.defineDeserializationUnit("bindings",function(e,t,s){for(var a in s){var u=s[a];if("object"!=typeof u)throw Error("Binding descriptor must be an object, not "+typeof u);"boundObject"in u?(u.source=e.getObjectByLabel(u.boundObject),u.oneway?u["<-"]=u.boundPropertyPath:u["<->"]=u.boundPropertyPath,delete u.boundObject,delete u.boundObjectPropertyPath,delete u.oneway):u["<<->"]&&(console.warn("WARNING: <<-> in bindings is deprectated, use <-> only, please update now."),u["<->"]=u["<<->"],delete u["<<->"])}i.defineBindings(t,s,{components:e})})}}),montageDefine("3c07db4","core/event/mutable-event",{dependencies:["../core"],factory:function(e,i){var t=e("../core").Montage;if("undefined"!=typeof window){var s={},a=function(e,i){var s="_"+i;t.defineProperty(e,s,{value:void 0}),t.defineProperty(e,i,{get:function(e,i){return function(){return this.hasOwnProperty(i)?this[i]:this._event?this._event[e]:void 0}}(i,s),set:function(e){return function(i){this[e]=i}}(s)})};i.MutableEvent=t.specialize({_initPrototypeWithEvent:{value:function(e){var i;for(i in e)this[i]||a(this,i);return a(this,"replayed"),this}},_initWithEvent:{value:function(e){return this._event=e,this}},preventDefault:{value:function(){this._event.preventDefault()}},getPreventDefault:{value:function(){return this._event.getPreventDefault?this._event.getPreventDefault():this._event.defaultPrevented}},stopImmediatePropagation:{value:function(){this._event.stopImmediatePropagation(),this.propagationStopped=!0,this.immediatePropagationStopped=!0}},propagationStopped:{value:!1},immediatePropagationStopped:{value:!1},mutable:{value:!0},target:{value:null},stopPropagation:{value:function(){this._event.stopPropagation(),this.propagationStopped=!0}},stop:{value:function(){this.preventDefault(),this.stopPropagation()}}},{fromEvent:{value:function(e){var t,a=e.type,u=s[a];return u||(u=function(){},u.prototype=(new i.MutableEvent)._initPrototypeWithEvent(e),s[a]=u),t=new u,t._initWithEvent(e),t}},fromType:{value:function(e,i,t,s){var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,i,t,s),this.fromEvent(a)}}})}}}),montageDefine("3c07db4","core/serialization",{dependencies:["./serialization/serializer/montage-serializer","./serialization/deserializer/montage-deserializer"],factory:function(e,i){var t=e("./serialization/serializer/montage-serializer").MontageSerializer,s=e("./serialization/serializer/montage-serializer").serialize,a=e("./serialization/deserializer/montage-deserializer").MontageDeserializer,u=e("./serialization/deserializer/montage-deserializer").deserialize;i.Serializer=t,i.serialize=s,i.Deserializer=a,i.deserialize=u}}),montageDefine("3c07db4","core/serialization/serializer/montage-serializer",{dependencies:["../../core","mousse/serialization/malker","mousse/serialization/serializer","./montage-builder","./montage-labeler","./montage-visitor","../../logger"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/serialization/malker").Malker,a=e("mousse/serialization/serializer").Serializer,u=e("./montage-builder").MontageBuilder,n=e("./montage-labeler").MontageLabeler,r=e("./montage-visitor").MontageVisitor;e("../../logger").logger("montage-serializer");var l=t.specialize.call(a,{_require:{value:null},_visitor:{value:null},_units:{value:Object.create(null)},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,i){return i.toUpperCase()}},constructor:{value:function l(){}},initWithRequire:{value:function(e){return this._require=e,this._builder=new u,this._labeler=new n,this._visitor=(new r).initWithBuilderAndLabelerAndRequireAndUnits(this._builder,this._labeler,this._require,this._units),this._malker=new s(this._visitor),this}},getExternalObjects:{value:function(){return this._visitor.getExternalObjects()}},getExternalElements:{value:function(){return this._visitor.getExternalElements()}},defineSerializationUnit:{value:function(e,i){this.constructor.defineSerializationUnit.call(this,e,i)}}},{defineSerializationUnit:{value:function(e,i){this._units[e]=i}},getDefaultObjectNameForModuleId:{value:function(e){return this._findObjectNameRegExp.test(e),RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)}}});i.MontageSerializer=l,i.serialize=function(e,i){return(new l).initWithRequire(i).serializeObject(e)}}}),montageDefine("3c07db4","core/serialization/deserializer/montage-deserializer",{dependencies:["../../core","mousse/deserialization/interpreter","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","../../promise","../../jshint","../../logger"],factory:function(e,i){var t=e("../../core").Montage;e("mousse/deserialization/interpreter").Interpreter;var s=e("mousse/deserialization/deserializer").Deserializer,a=e("./montage-interpreter").MontageInterpreter,u=e("./montage-reviver").MontageReviver,n=e("../../promise").Promise,r=e("../../jshint").JSHINT;e("../../logger").logger("montage-deserializer");var l=t.specialize.call(s,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,i,t){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return s.call(this,e),this._origin,this._serialization=null,this._interpreter=(new a).init(i,t),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,i){var t;try{t=JSON.parse(this._serializationString)}catch(s){return n.reject(s)}return this._interpreter.instantiate(t,e,i)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,i=[];for(var t in e)0===Object.keys(e[t]).length&&i.push(t);return i}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(i){return!1}}},_formatSerializationSyntaxError:{value:function(e){var i,t,s,a,u,n="   ",l=this._origin;if(r(e))i="Syntax error in the serialization but not able to find it!\n"+e;else{t=r.errors[0],s=e.split("\n"),a=(n+s.length).length,u=t.line-1;for(var o=0,c=s.length;c>o;o++)s[o]=Array(a-(o+1+"").length+1).join(o===u?">":" ")+(o+1)+" "+s[o];i="Syntax error at line "+t.line+(l?" from "+l:"")+":\n"+t.evidence+"\n"+t.reason+"\n"+s.join("\n")}return i}}},{defineDeserializationUnit:{value:function(e,i){u.defineUnitReviver(e,i)}}});i.MontageDeserializer=l,i.deserialize=function(e,i){return(new l).init(e,i).deserializeObject()}}}),montageDefine("3c07db4","core/serialization/serializer/montage-builder",{dependencies:["../../core","mousse/serialization/builder","./montage-ast"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/serialization/builder").Builder,a=e("./montage-ast"),u=t.specialize.call(s,{constructor:{value:function u(){s.call(this)}},createElementReference:{value:function(e){return(new a.ElementReference).initWithRootAndId(this._root,e)}},createModuleReference:{value:function(e){return(new a.ModuleReference).initWithRootAndModuleId(this._root,e)}}});i.MontageBuilder=u}}),montageDefine("3c07db4","core/serialization/serializer/montage-labeler",{dependencies:["../../core","mousse/serialization/labeler"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/serialization/labeler").Labeler;i.MontageLabeler=t.specialize.call(s,{_labelRegexp:{value:/^[a-zA-Z_$][0-9a-zA-Z_$]*$/},constructor:{value:function(){s.call(this)}},getTemplatePropertyLabel:{value:function(e){var i=this.superForValue("getObjectLabel")(e);if(":"!==i[0])throw Error("Template property's labels need to start with a colon (:), (\""+i+'").');return i}},getObjectLabel:{value:function(e){var i=this.super(e);if(":"===i[0])throw Error('Labels starting with colon (:) can only be used for template properties, ("'+i+'").');return i}},getObjectName:{value:function(e){var i,a=e.identifier;return a&&this._labelRegexp.test(a)?i=e.identifier:"getInfoForObject"in e||"getInfoForObject"in e.constructor?(i=t.getInfoForObject(e).objectName,i=i.toLowerCase()):i=s.prototype.getObjectName.call(this,e),i}}})}}),montageDefine("3c07db4","core/serialization/serializer/montage-visitor",{dependencies:["../../core","./montage-serializer","./properties-serializer","./self-serializer","./unit-serializer","../alias","mousse/serialization/visitor"],factory:function(e,i){var t=e("../../core").Montage,s=e("./montage-serializer"),a=e("./properties-serializer").PropertiesSerializer,u=e("./self-serializer").SelfSerializer,n=e("./unit-serializer").UnitSerializer,r=e("../alias").Alias,l=e("mousse/serialization/visitor").Visitor,o=t.specialize.call(l,{_MONTAGE_ID_ATTRIBUTE:{value:"data-montage-id"},_require:{value:null},_units:{value:null},_elements:{value:null},constructor:{value:function o(){}},initWithBuilderAndLabelerAndRequireAndUnits:{value:function(e,i,t,s){return l.call(this,e,i),this._require=t,this._units=s,this._elements=[],this}},getTypeOf:{value:function(e){return e.isModuleReference?"Module":e instanceof r?"Alias":"getInfoForObject"in e||"getInfoForObject"in e.constructor?"MontageObject":e.thisIsAReferenceCreatedByMontageSerializer?"MontageReference":"undefined"!=typeof Element&&Element.isElement(e)?"Element":void 0}},visitMontageReference:{value:function(e,i,t){this.builder.top.setProperty(t,i.reference)}},visitElement:{value:function(e,i,t){var s,a;if(a=i.getAttribute(this._MONTAGE_ID_ATTRIBUTE),!a)throw Error("Not possible to serialize a DOM element with no "+this._MONTAGE_ID_ATTRIBUTE+" assigned: "+i.outerHTML);s=this.builder.createElementReference(a),this.storeValue(s,i,t),this._elements.push(i)}},visitModule:{value:function(e,i,t){var s,a;try{a=i.resolve(this._require)}catch(u){throw Error("Not possible to serialize module reference "+i.id+" from package "+i.require.location+" inside package "+this._require.location)}s=this.builder.createModuleReference(a),this.storeValue(s,i,t)}},visitAlias:{value:function(e,i){var t=this.labeler.getTemplatePropertyLabel(i),s=this.builder.createCustomObject();s.setProperty("alias",i.value),this.builder.top.setProperty(t,s)}},visitMontageObject:{value:function(e,i,t){this.isObjectSerialized(i)?this.serializeReferenceToMontageObject(e,i,t):this.handleMontageObject(e,i,t)}},handleMontageObject:{value:function(e,i,t){var s,a=this.builder.createCustomObject();this.setObjectSerialization(i,a),s=this.serializeMontageObject(e,i,a),s?this.serializeSubstituteObject(e,i,t,a,s):(a.setLabel(this.labeler.getObjectLabel(i)),this.builder.top.setProperty(t,a))}},serializeReferenceToMontageObject:{value:function(e,i,t){var s=this.labeler.getObjectLabel(i),a=this.builder.createObjectReference(s);this.builder.top.setProperty(t,a)}},serializeSubstituteObject:{value:function(e,i,t,s,a){var u,n,r,l;u=this.labeler.getObjectLabel(i),this.labeler.isUserDefinedLabel(u)?(n=this.labeler.getObjectLabel(a),this.labeler.setObjectLabel(a,u),this.builder.relabelReferences(n,u),l=this.getObjectSerialization(a),l&&(l.setLabel(u),this.labeler.isUserDefinedLabel(n)&&this.builder.createObjectReference(u).setLabel(n)),e.visit(a,t)):(e.visit(a,t),r=this.labeler.getObjectLabel(a),this.labeler.setObjectLabel(i,r),this.builder.relabelReferences(u,r))}},serializeMontageObject:{value:function(e,i,t){var s,a,n=this.builder.createObjectLiteral();return this.setObjectType(i,t),t.setProperty("properties",n),this.builder.push(t),"function"==typeof i.serializeSelf?(s=(new u).initWithMalkerAndVisitorAndObject(e,this,i,t),a=i.serializeSelf(s)):(this.setObjectProperties(e,i),this.setObjectCustomUnits(e,i)),this.builder.pop(),0===n.getPropertyNames().length&&t.clearProperty("properties"),a}},setObjectType:{value:function(e,i){var s=t.getInfoForObject(e).isInstance,a=this.getObjectLocationId(e),u=this.builder.createString(a);s?i.setProperty("prototype",u):i.setProperty("object",u)}},getObjectModuleId:{value:function(e){var i=t.getInfoForObject(e);return this._require.identify(i.moduleId,i.require)}},getObjectLocationId:{value:function(e){var i,a=this.getObjectModuleId(e),u=t.getInfoForObject(e),n=u.objectName;return i=s.MontageSerializer.getDefaultObjectNameForModuleId(a),i===n?a:a+"["+n+"]"}},setObjectProperties:{value:function(e,i){var t,s;s=this.builder.top.getProperty("properties"),this.builder.push(s),"function"==typeof i.serializeProperties?(t=(new a).initWithMalkerAndVisitorAndObject(e,this,i),i.serializeProperties(t)):this.setSerializableObjectProperties(e,i),this.builder.pop()}},setSerializableObjectProperties:{value:function(e,i){for(var s,a,u=t.getSerializablePropertyNames(i),n=u.length,r=0;n>r;r++)a=u[r],s=t.getPropertyAttribute(i,a,"serializable"),this.setProperty(e,a,i[a],s)}},hackIsReferenceAllowedForValue:{value:function(e){return"object"==typeof e&&null!=e&&!("undefined"!=typeof Element&&Element.isElement(e))}},setProperty:{value:function(e,i,t,s){var a;if("reference"===s&&this.hackIsReferenceAllowedForValue(t)){a=this.labeler.getObjectLabel(t);var u=this.builder.createObjectReference(a);this.builder.top.setProperty(i,u)}else e.visit(t,i)}},setObjectCustomUnits:{value:function(e,i){for(var t in this._units)this.setObjectCustomUnit(e,i,t)}},setObjectCustomUnit:{value:function(e,i,t){var s,a,u=this._units[t];u&&(a=(new n).initWithMalkerAndVisitorAndObject(e,this,i),s=u(a,i),null!=s&&e.visit(s,t))}},getExternalObjects:{value:function(){for(var e,i={},t=this.builder.getExternalReferences(),s=0;e=t[s];s++)i[e]=this.labeler.getObjectByLabel(e);return i}},getExternalElements:{value:function(){return this._elements}}});i.MontageVisitor=o}}),montageDefine("3c07db4","core/serialization/deserializer/montage-interpreter",{dependencies:["../../core","mousse/deserialization/interpreter","mousse/deserialization/context","./montage-reviver","../../promise"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/deserialization/interpreter").Interpreter,a=e("mousse/deserialization/context").Context,u=e("./montage-reviver").MontageReviver,n=e("../../promise").Promise,r=t.specialize.call(s,{_require:{value:null},_reviver:{value:null},init:{value:function(e,i){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new u).init(e,i),this._require=e,this}},instantiate:{value:function(e,i,t){var s;return s=(new l).init(e,this._reviver,i,t,this._require),s.getObjects()}},preloadModules:{value:function(e){var i,t,s,a,r=this._reviver,l=r.moduleLoader,o=[];for(var c in e)i=e[c],t=i.prototype||i.object,t&&(s=u.parseObjectLocationId(t),a=l.getModule(s.moduleId,c),n.isPromise(a)&&o.push(a));return o.length>0?n.all(o):void 0}}}),l=t.specialize.call(a,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,i,t,s,u){return a.call(this,e,i,t),this._element=s,this._require=u,this}},hasObject:{value:function(e){return e in this._serialization}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var i="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(i)}},setUnitsToDeserialize:{value:function(e,i,t){this._unitsToDeserialize.push({object:e,objectDesc:i,unitNames:t})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});i.MontageInterpreter=r,i.MontageContext=l}}),montageDefine("3c07db4","core/jshint",{dependencies:[],factory:function(e,i){var t=function(e){var i,t=function(){return i||(i=e(t)),i.apply(this,arguments)};return t}(function(e){"use strict";function i(){}function t(e,i){return Object.prototype.hasOwnProperty.call(e,i)
}function s(e,i){var s;for(s in i)t(i,s)&&(e[s]=i[s])}function a(){di.couch&&s(pi,Mi),di.rhino&&s(pi,ji),di.prototypejs&&s(pi,Vi),di.node&&s(pi,Ti),di.devel&&s(pi,Ai),di.dojo&&s(pi,Ei),di.browser&&s(pi,Di),di.jquery&&s(pi,xi),di.mootools&&s(pi,Li),di.wsh&&s(pi,Ri),di.globalstrict&&di.strict!==!1&&(di.strict=!0)}function u(e,i,t){var s=Math.floor(100*(i/ni.length));throw{name:"JSHintError",line:i,character:t,message:e+" ("+s+"% scanned)."}}function n(i,t,s,a,n,r){var l,o,c;return t=t||ci,"(end)"===t.id&&(t=Si),o=t.line||0,l=t.from||0,c={id:"(error)",raw:i,evidence:ni[o-1]||"",line:o,character:l,a:s,b:a,c:n,d:r},c.reason=i.supplant(c),e.errors.push(c),di.passfail&&u("Stopping. ",o,l),Pi+=1,Pi>=di.maxerr&&u("Too many errors.",o,l),c}function r(e,i,t,s,a,u,r){return n(e,{line:i,from:t},s,a,u,r)}function l(e,i,t,s,a,r){var l=n(e,i,t,s,a,r);u("Stopping, unable to continue.",l.line,l.character)}function o(e,i,t,s,a,u,n){return l(e,{line:i,from:t},s,a,u,n)}function c(e,i){"hasOwnProperty"===e&&n("'hasOwnProperty' is a really bad name."),t(Z,e)&&!Z["(global)"]&&(Z[e]===!0?di.latedef&&n("'{a}' was used before it was defined.",ci,e):di.shadow||n("'{a}' is already defined.",ci,e)),Z[e]=i,Z["(global)"]?(ii[e]=Z,t(ti,e)&&(di.latedef&&n("'{a}' was used before it was defined.",ci,e),delete ti[e])):gi[e]=Z}function m(){var e,i,t,s,u,n=ci.value;switch(n){case"*/":l("Unbegun comment.");break;case"/*members":case"/*member":n="/*members",oi||(oi={}),i=oi;break;case"/*jshint":case"/*jslint":i=di,t=Ni;break;case"/*global":i=pi;break;default:l("What?")}s=Xi.token();e:for(;;){for(;;){if("special"===s.type&&"*/"===s.value)break e;if("(endline)"!==s.id&&","!==s.id)break;s=Xi.token()}"(string)"!==s.type&&"(identifier)"!==s.type&&"/*members"!==n&&l("Bad option.",s),u=Xi.token(),":"===u.id?(u=Xi.token(),i===oi&&l("Expected '{a}' and instead saw '{b}'.",s,"*/",":"),"indent"!==s.value||"/*jshint"!==n&&"/*jslint"!==n?"maxerr"!==s.value||"/*jshint"!==n&&"/*jslint"!==n?"maxlen"!==s.value||"/*jshint"!==n&&"/*jslint"!==n?"true"===u.value?i[s.value]=!0:"false"===u.value?i[s.value]=!1:l("Bad option value.",u):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),i.maxlen=e):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),i.maxerr=e):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),i.white=!0,i.indent=e),s=Xi.token()):(("/*jshint"===n||"/*jslint"===n)&&l("Missing option value.",s),i[s.value]=!1,s=u)}t&&a()}function d(e){for(var i,t=e||0,s=0;t>=s;)i=ri[s],i||(i=ri[s]=Xi.token()),s+=1;return i}function p(e,i){switch(Si.id){case"(number)":"."===ci.id&&n("A dot following a number can be confused with a decimal point.",Si);break;case"-":("-"===ci.id||"--"===ci.id)&&n("Confusing minusses.");break;case"+":("+"===ci.id||"++"===ci.id)&&n("Confusing plusses.")}for(("(string)"===Si.type||Si.identifier)&&($=Si.value),e&&ci.id!==e&&(i?"(end)"===ci.id?n("Unmatched '{a}'.",i,i.id):n("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",ci,e,i.id,i.line,ci.value):("(identifier)"!==ci.type||ci.value!==e)&&n("Expected '{a}' and instead saw '{b}'.",ci,e,ci.value)),hi=Si,Si=ci;;){if(ci=ri.shift()||Xi.token(),"(end)"===ci.id||"(error)"===ci.id)return;if("special"===ci.type)m();else if("(endline)"!==ci.id)break}}function v(e,i){var t,s=!1;if("(end)"===ci.id&&l("Unexpected early end of program.",Si),p(),i&&($="anonymous",Z["(verb)"]=Si.value),i===!0&&Si.fud)t=Si.fud();else{if(Si.nud)t=Si.nud();else{if("(number)"===ci.type&&"."===Si.id)return n("A leading decimal point can be confused with a dot: '.{a}'.",Si,ci.value),p(),Si;l("Expected an identifier and instead saw '{a}'.",Si,Si.id)}for(;ci.lbp>e;)s="Array"==Si.value,p(),s&&"("==Si.id&&")"==ci.id&&n("Use the array literal notation [].",Si),Si.led?t=Si.led(t):l("Expected an operator and instead saw '{a}'.",Si,Si.id)}return t}function h(e,i){e=e||Si,i=i||ci,di.white&&e.character!==i.from&&e.line===i.line&&n("Unexpected space after '{a}'.",i,e.value)}function g(e,i){e=e||Si,i=i||ci,!di.white||e.character===i.from&&e.line===i.line||n("Unexpected space before '{a}'.",i,i.value)}function f(e,i){e=e||Si,i=i||ci,di.white&&!e.comment&&e.line===i.line&&h(e,i)}function b(e,i){di.white&&(e=e||Si,i=i||ci,e.line===i.line&&e.character===i.from&&n("Missing space after '{a}'.",ci,e.value))}function q(e,i){e=e||Si,i=i||ci,di.laxbreak||e.line===i.line?di.white&&(e=e||Si,i=i||ci,e.character===i.from&&n("Missing space after '{a}'.",ci,e.value)):n("Bad line breaking before '{a}'.",i,i.id)}function y(e){var i;di.white&&"(end)"!==ci.id&&(i=ai+(e||0),ci.from!==i&&n("Expected '{a}' to have an indentation at {b} instead at {c}.",ci,ci.value,i,ci.from))}function S(e){e=e||Si,e.line!==ci.line&&n("Line breaking error '{a}'.",e,e.value)}function _(){Si.line!==ci.line?di.laxbreak||n("Bad line breaking before '{a}'.",Si,ci.id):Si.character!==ci.from&&di.white&&n("Unexpected space after '{a}'.",ci,Si.value),p(","),b(Si,ci)}function P(e,i){var t=Fi[e];return t&&"object"==typeof t||(Fi[e]=t={id:e,lbp:i,value:e}),t}function C(e){return P(e,0)}function N(e,i){var t=C(e);return t.identifier=t.reserved=!0,t.fud=i,t}function D(e,i){var t=N(e,i);return t.block=!0,t}function M(e){var i=e.id.charAt(0);return(i>="a"&&"z">=i||i>="A"&&"Z">=i)&&(e.identifier=e.reserved=!0),e}function A(e,i){var t=P(e,150);return M(t),t.nud="function"==typeof i?i:function(){return this.right=v(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(di.plusplus?n("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||n("Bad operand.",this)),this},t}function E(e,i){var t=C(e);return t.type=e,t.nud=i,t}function w(e,i){var t=E(e,i);return t.identifier=t.reserved=!0,t}function I(e,i){return w(e,function(){return"function"==typeof i&&i(this),this})}function x(e,i,t,s){var a=P(e,t);return M(a),a.led=function(e){return s||(q(hi,Si),b(Si,ci)),"function"==typeof i?i(e,this):(this.left=e,this.right=v(t),this)},a}function L(e,i){var t=P(e,100);return t.led=function(e){q(hi,Si),b(Si,ci);var t=v(100);return e&&"NaN"===e.id||t&&"NaN"===t.id?n("Use the isNaN function to compare with NaN.",this):i&&i.apply(this,[e,t]),"!"===e.id&&n("Confusing use of '{a}'.",e,"!"),"!"===t.id&&n("Confusing use of '{a}'.",e,"!"),this.left=e,this.right=t,this},t}function T(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!di.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function V(e){return P(e,20).exps=!0,x(e,function(e,i){if(i.left=e,pi[e.value]===!1&&gi[e.value]["(global)"]===!0?n("Read only.",e):e["function"]&&n("'{a}' is a function.",e,e.value),e){if("."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||n("Bad assignment.",i),i.right=v(19),i;if(e.identifier&&!e.reserved)return"exception"===Z[e.value]&&n("Do not assign to the exception parameter.",e),i.right=v(19),i;e===Fi["function"]&&n("Expected an identifier in an assignment and instead saw a function invocation.",Si)}l("Bad assignment.",i)},20)}function j(e,i,t){var s=P(e,t);return M(s),s.led="function"==typeof i?i:function(e){return di.bitwise&&n("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=v(t),this},s}function O(e){return P(e,20).exps=!0,x(e,function(e,i){return di.bitwise&&n("Unexpected use of '{a}'.",i,i.id),b(hi,Si),b(Si,ci),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(v(19),i):(e===Fi["function"]&&n("Expected an identifier in an assignment, and instead saw a function invocation.",Si),i):(l("Bad assignment.",i),void 0)},20)}function F(e){var i=P(e,150);return i.led=function(e){return di.plusplus?n("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||n("Bad operand.",this),this.left=e,this},i}function R(e){return ci.identifier?(p(),Si.reserved&&!di.es5&&(e&&"undefined"==Si.value||n("Expected an identifier and instead saw '{a}' (a reserved word).",Si,Si.id)),Si.value):void 0}function k(e){var i=R(e);return i?i:("function"===Si.id&&"("===ci.id?n("Missing name in function declaration."):l("Expected an identifier and instead saw '{a}'.",ci,ci.value),void 0)}function U(e){var i,t=0;if(";"===ci.id&&!mi)for(;;){if(i=d(t),i.reach)return;if("(endline)"!==i.id){if("function"===i.id){n("Inner functions should be listed at the top of the outer function.",i);break}n("Unreachable '{a}' after '{b}'.",i,i.value,e);break}t+=1}}function z(e){var i,t=ai,s=gi,a=ci;return";"===a.id?(n("Unnecessary semicolon.",a),p(";"),void 0):(a.identifier&&!a.reserved&&":"===d().id&&(p(),p(":"),gi=Object.create(s),c(a.value,"label"),ci.labelled||n("Label '{a}' on {b} statement.",ci,a.value,ci.value),Wi.test(a.value+":")&&n("Label '{a}' looks like a javascript url.",a,a.value),ci.label=a.value,a=ci),e||y(),i=v(0,!0),a.block||(di.expr||i&&i.exps?di.nonew&&"("===i.id&&"new"===i.left.id&&n("Do not use 'new' for side effects."):n("Expected an assignment or function call and instead saw an expression.",Si),";"!==ci.id?di.asi||di.lastsemic&&"}"==ci.id&&ci.line==Si.line||r("Missing semicolon.",Si.line,Si.from+Si.value.length):(h(Si,ci),p(";"),b(Si,ci))),ai=t,gi=s,i)}function B(){return"use strict"===ci.value?(qi&&n('Unnecessary "use strict".'),p(),p(";"),qi=!0,di.newcap=!0,di.undef=!0,!0):!1}function Q(){for(var e=[];!ci.reach&&"(end)"!==ci.id;)";"===ci.id?(n("Unnecessary semicolon."),p(";")):e.push(z());return e}function G(e,i){var t,s,a=si,u=ai,r=qi,o=gi;if(si=e,gi=Object.create(gi),b(Si,ci),s=ci,"{"===ci.id){if(p("{"),"}"!==ci.id||Si.line!==ci.line){for(ai+=di.indent;!e&&ci.from>ai;)ai+=di.indent;e||B()||r||!di.strict||!Z["(context)"]["(global)"]||n('Missing "use strict" statement.'),t=Q(),qi=r,ai-=di.indent,y()}p("}",s),ai=u}else e?((!i||di.curly)&&n("Expected '{a}' and instead saw '{b}'.",ci,"{",ci.value),mi=!0,t=[z()],mi=!1):l("Expected '{a}' and instead saw '{b}'.",ci,"{",ci.value);return Z["(verb)"]=null,gi=o,si=a,!e||!di.noempty||t&&0!==t.length||n("Empty block."),t}function W(e){oi&&"boolean"!=typeof oi[e]&&n("Unexpected /*member '{a}'.",Si,e),"number"==typeof li[e]?li[e]+=1:li[e]=1}function H(e){var i=e.value,t=e.line,s=ti[i];"function"==typeof s&&(s=!1),s?s[s.length-1]!==t&&s.push(t):(s=[t],ti[i]=s)}function X(){var e=R(!0);return e||("(string)"===ci.id?(e=ci.value,p()):"(number)"===ci.id&&(e=""+ci.value,p())),e}function Y(){var e,i=ci,t=[];if(p("("),f(),")"===ci.id)return p(")"),f(hi,Si),void 0;for(;;){if(e=k(!0),t.push(e),c(e,"parameter"),","!==ci.id)return p(")",i),f(hi,Si),t;_()}}function K(e,i){var t,s=di,a=gi;return di=Object.create(di),gi=Object.create(gi),Z={"(name)":e||'"'+$+'"',"(line)":ci.line,"(context)":Z,"(breakage)":0,"(loopage)":0,"(scope)":gi,"(statement)":i},t=Z,Si.funct=Z,ei.push(Z),e&&c(e,"function"),Z["(params)"]=Y(),G(!1),gi=a,di=s,Z["(last)"]=Si.line,Z=Z["(context)"],t}function J(){function e(){var e={},i=ci;if(p("{"),"}"!==ci.id)for(;;){if("(end)"===ci.id)l("Missing '}' to match '{' from line {a}.",ci,i.line);else{if("}"===ci.id){n("Unexpected comma.",Si);break}","===ci.id?l("Unexpected comma.",ci):"(string)"!==ci.id&&n("Expected a string and instead saw {a}.",ci,ci.value)}if(e[ci.value]===!0?n("Duplicate key '{a}'.",ci,ci.value):"__proto__"===ci.value?n("Stupid key '{a}'.",ci,ci.value):e[ci.value]=!0,p(),p(":"),J(),","!==ci.id)break;p(",")}p("}")}function i(){var e=ci;if(p("["),"]"!==ci.id)for(;;){if("(end)"===ci.id)l("Missing ']' to match '[' from line {a}.",ci,e.line);else{if("]"===ci.id){n("Unexpected comma.",Si);break}","===ci.id&&l("Unexpected comma.",ci)}if(J(),","!==ci.id)break;p(",")}p("]")}switch(ci.id){case"{":e();break;case"[":i();break;case"true":case"false":case"null":case"(number)":case"(string)":p();break;case"-":p("-"),Si.character!==ci.from&&n("Unexpected space after '-'.",Si),h(Si,ci),p("(number)");break;default:l("Expected a JSON value.",ci)}}var $,Z,ei,ii,ti,si,ai,ui,ni,ri,li,oi,ci,mi,di,pi,vi,hi,gi,fi,bi,qi,yi,Si,_i,Pi,Ci={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Ni={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,evil:!0,expr:!0,forin:!0,globalstrict:!0,immed:!0,jquery:!0,latedef:!0,laxbreak:!0,loopfunc:!0,mootools:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!0,passfail:!0,plusplus:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,white:!0,wsh:!0},Di={ArrayBuffer:!1,ArrayBufferView:!1,addEventListener:!1,applicationCache:!1,blur:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,setInterval:!1,setTimeout:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},Mi={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1},Ai={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},Ei={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},wi={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},Ii=["closure","exception","global","label","outer","unused","var"],xi={$:!1,jQuery:!1},Li={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},Ti={__filename:!1,__dirname:!1,exports:!1,Buffer:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1},Vi={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},ji={defineClass:!1,deserialize:!1,gc:!1,help:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},Oi={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},Fi={},Ri={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0},ki=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Ui=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,zi=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Bi=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Qi=/\*\/|\/\*/,Gi=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Wi=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Hi=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(e){return i.prototype=e,new i}),"function"!=typeof Object.keys&&(Object.keys=function(e){var i,s=[];for(i in e)t(e,i)&&s.push(i);return s}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z￿">=this||this>="A"&&"Z￿">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(i,t){var s=e[t];return"string"==typeof s||"number"==typeof s?s:i})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return Gi.test(this)?this:zi.test(this)?'"'+this.replace(Bi,function(e){var i=wi[e];return i?i:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var Xi=function Xi(){function e(){var e,i;return u>=ni.length?!1:(s=1,n=ni[u],u+=1,e=n.search(/ \t/),e>=0&&r("Mixed spaces and tabs.",u,e+1),n=n.replace(/\t/g,yi),e=n.search(ki),e>=0&&r("Unsafe character.",u,e),di.maxlen&&di.maxlen<n.length&&r("Line too long.",u,n.length),i=n.search(/\s+$/),di.trailing&&~i&&!~n.search(/^\s+$/)&&r("Trailing whitespace.",u,i),!0)}function i(e,i){var n,l;return l="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&t(Fi,i)?Fi[i]||Fi["(error)"]:Fi[e],l=Object.create(l),("(string)"===e||"(range)"===e)&&!di.scripturl&&Wi.test(i)&&r("Script URL.",u,a),"(identifier)"===e&&(l.identifier=!0,"__iterator__"===i||"__proto__"===i?o("Reserved name '{a}'.",u,a,i):!di.nomen||"_"!==i.charAt(0)&&"_"!==i.charAt(i.length-1)||r("Unexpected {a} in '{b}'.",u,a,"dangling '_'",i)),l.value=i,l.line=u,l.character=s,l.from=a,n=l.id,"(endline)"!==n&&(vi=n&&("(,=:[!&|?{};".indexOf(n.charAt(n.length-1))>=0||"return"===n)),l}var s,a,u,n;return{init:function(i){ni="string"==typeof i?i.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):i,ni[0]&&"#!"==ni[0].substr(0,2)&&(ni[0]=""),u=0,e(),a=1},range:function(e,t){var l,c="";for(a=s,n.charAt(0)!==e&&o("Expected '{a}' and instead saw '{b}'.",u,s,e,n.charAt(0));;){switch(n=n.slice(1),s+=1,l=n.charAt(0)){case"":o("Missing '{a}'.",u,s,l);break;case t:return n=n.slice(1),s+=1,i("(range)",c);case"\\":r("Unexpected '{a}'.",u,s,l)}c+=l}},token:function(){function t(e){var i,t=e.exec(n);return t?(f=t[0].length,i=t[1],m=i.charAt(0),n=n.substr(f),a=s+f-i.length,s+=f,i):void 0}function l(t){function l(e){var i=parseInt(n.substr(m+1,e),16);m+=e,i>=32&&126>=i&&34!==i&&92!==i&&39!==i&&r("Unnecessary escapement.",u,s),s+=e,c=String.fromCharCode(i)}var c,m,d="";for(ui&&'"'!==t&&r("Strings must use doublequote.",u,s),m=0;;){for(;m>=n.length;)m=0,e()||o("Unclosed string.",u,a);if(c=n.charAt(m),c===t)return s+=1,n=n.substr(m+1),i("(string)",d,t);if(" ">c){if("\n"===c||"\r"===c)break;r("Control character in string: {a}.",u,s+m,n.slice(0,m))}else if("\\"===c)switch(m+=1,s+=1,c=n.charAt(m)){case"\\":case'"':case"/":break;case"'":ui&&r("Avoid \\'.",u,s);break;case"b":c="\b";break;case"f":c="\f";break;case"n":c="\n";break;case"r":c="\r";break;case"t":c="	";break;case"u":l(4);break;case"v":ui&&r("Avoid \\v.",u,s),c="";break;case"x":ui&&r("Avoid \\x-.",u,s),l(2);break;default:r("Bad escapement.",u,s)}d+=c,s+=1,m+=1}}for(var c,m,d,p,v,h,g,f,b,q,y;;){if(!n)return i(e()?"(endline)":"(end)","");if(y=t(Ui)){if(m.isAlpha()||"_"===m||"$"===m)return i("(identifier)",y);if(m.isDigit())return isFinite(Number(y))||r("Bad number '{a}'.",u,s,y),n.substr(0,1).isAlpha()&&r("Missing space after '{a}'.",u,s,y),"0"===m&&(p=y.substr(1,1),p.isDigit()?"."!==Si.id&&r("Don't use extra leading zeros '{a}'.",u,s,y):!ui||"x"!==p&&"X"!==p||r("Avoid 0x-. '{a}'.",u,s,y)),"."===y.substr(y.length-1)&&r("A trailing decimal point can be confused with a dot '{a}'.",u,s,y),i("(number)",y);switch(y){case'"':case"'":return l(y);case"//":fi&&r("Unexpected comment.",u,s),n="",Si.comment=!0;break;case"/*":for(fi&&r("Unexpected comment.",u,s);g=n.search(Qi),!(g>=0);)e()||o("Unclosed comment.",u,s);s+=g+2,"/"===n.substr(g,1)&&o("Nested comment.",u,s),n=n.substr(g+2),Si.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:y,type:"special",line:u,character:s,from:a};case"":break;case"/":if("/="===Si.id&&o("A regular expression literal can be confused with '/='.",u,a),vi){for(v=0,d=0,f=0;;){switch(c=!0,m=n.charAt(f),f+=1,m){case"":return o("Unclosed regular expression.",u,a),void 0;case"/":for(v>0&&r("Unescaped '{a}'.",u,a+f,"/"),m=n.substr(0,f-1),q={g:!0,i:!0,m:!0};q[n.charAt(f)]===!0;)q[n.charAt(f)]=!1,f+=1;return s+=f,n=n.substr(f),q=n.charAt(0),("/"===q||"*"===q)&&o("Confusing regular expression.",u,a),i("(regexp)",m);case"\\":m=n.charAt(f)," ">m?r("Unexpected control character in regular expression.",u,a+f):"<"===m&&r("Unexpected escaped character '{a}' in regular expression.",u,a+f,m),f+=1;break;case"(":if(v+=1,c=!1,"?"===n.charAt(f))switch(f+=1,n.charAt(f)){case":":case"=":case"!":f+=1;break;default:r("Expected '{a}' and instead saw '{b}'.",u,a+f,":",n.charAt(f))}else d+=1;break;case"|":c=!1;break;case")":0===v?r("Unescaped '{a}'.",u,a+f,")"):v-=1;break;case" ":for(q=1;" "===n.charAt(f);)f+=1,q+=1;q>1&&r("Spaces are hard to count. Use {{a}}.",u,a+f,q);break;case"[":m=n.charAt(f),"^"===m&&(f+=1,di.regexp?r("Insecure '{a}'.",u,a+f,m):"]"===n.charAt(f)&&o("Unescaped '{a}'.",u,a+f,"^")),q=!1,"]"===m&&(r("Empty class.",u,a+f-1),q=!0);e:do switch(m=n.charAt(f),f+=1,m){case"[":case"^":r("Unescaped '{a}'.",u,a+f,m),q=!0;break;case"-":q?q=!1:(r("Unescaped '{a}'.",u,a+f,"-"),q=!0);break;case"]":q||di.regexdash||r("Unescaped '{a}'.",u,a+f-1,"-");break e;case"\\":m=n.charAt(f)," ">m?r("Unexpected control character in regular expression.",u,a+f):"<"===m&&r("Unexpected escaped character '{a}' in regular expression.",u,a+f,m),f+=1,q=!0;break;case"/":r("Unescaped '{a}'.",u,a+f-1,"/"),q=!0;break;case"<":q=!0;break;default:q=!0}while(m);break;case".":di.regexp&&r("Insecure '{a}'.",u,a+f,m);break;case"]":case"?":case"{":case"}":case"+":case"*":r("Unescaped '{a}'.",u,a+f,m)}if(c)switch(n.charAt(f)){case"?":case"+":case"*":f+=1,"?"===n.charAt(f)&&(f+=1);break;case"{":for(f+=1,m=n.charAt(f),("0">m||m>"9")&&r("Expected a number and instead saw '{a}'.",u,a+f,m),f+=1,b=+m;m=n.charAt(f),!("0">m||m>"9");)f+=1,b=+m+10*b;if(h=b,","===m&&(f+=1,h=1/0,m=n.charAt(f),m>="0"&&"9">=m))for(f+=1,h=+m;m=n.charAt(f),!("0">m||m>"9");)f+=1,h=+m+10*h;"}"!==n.charAt(f)?r("Expected '{a}' and instead saw '{b}'.",u,a+f,"}",m):f+=1,"?"===n.charAt(f)&&(f+=1),b>h&&r("'{a}' should not be greater than '{b}'.",u,a+f,b,h)}}return m=n.substr(0,f-1),s+=f,n=n.substr(f),i("(regexp)",m)}return i("(punctuator)",y);case"#":return i("(punctuator)",y);default:return i("(punctuator)",y)}}else{for(y="",m="";n&&"!">n;)n=n.substr(1);n&&o("Unexpected '{a}'.",u,s,n.substr(0,1))}}}}}();E("(number)",function(){return this}),E("(string)",function(){return this}),Fi["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,i=this.value,t=gi[i];if("function"==typeof t?t=void 0:"boolean"==typeof t&&(e=Z,Z=ei[0],c(i,"var"),t=Z,Z=e),Z===t)switch(Z[i]){case"unused":Z[i]="var";break;case"unction":Z[i]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":n("'{a}' is a statement label.",Si,i)}else if(Z["(global)"])"typeof"!=$&&"delete"!=$&&di.undef&&"boolean"!=typeof pi[i]&&n("'{a}' is not defined.",Si,i),H(Si);else switch(Z[i]){case"closure":case"function":case"var":case"unused":n("'{a}' used out of scope.",Si,i);break;case"label":n("'{a}' is a statement label.",Si,i);break;case"outer":case"global":break;default:if(t===!0)Z[i]=!0;else if(null===t)n("'{a}' is not allowed.",Si,i),H(Si);else if("object"!=typeof t)"typeof"!=$&&"delete"!=$&&di.undef?n("'{a}' is not defined.",Si,i):Z[i]=!0,H(Si);else switch(t[i]){case"function":case"unction":this["function"]=!0,t[i]="closure",Z[i]=t["(global)"]?"global":"outer";break;case"var":case"unused":t[i]="closure",Z[i]=t["(global)"]?"global":"outer";break;case"closure":case"parameter":Z[i]=t["(global)"]?"global":"outer";break;case"label":n("'{a}' is a statement label.",Si,i)}}return this},led:function(){l("Expected an operator and instead saw '{a}'.",ci,ci.value)}},E("(regexp)",function(){return this}),C("(endline)"),C("(begin)"),C("(end)").reach=!0,C("</").reach=!0,C("<!"),C("<!--"),C("-->"),C("(error)").reach=!0,C("}").reach=!0,C(")"),C("]"),C('"').reach=!0,C("'").reach=!0,C(";"),C(":").reach=!0,C(","),C("#"),C("@"),w("else"),w("case").reach=!0,w("catch"),w("default").reach=!0,w("finally"),I("arguments",function(e){qi&&Z["(global)"]&&n("Strict violation.",e)}),I("eval"),I("false"),I("Infinity"),I("NaN"),I("null"),I("this",function(e){qi&&(Z["(statement)"]&&Z["(name)"].charAt(0)>"Z"||Z["(global)"])&&n("Strict violation.",e)}),I("true"),I("undefined"),V("=","assign",20),V("+=","assignadd",20),V("-=","assignsub",20),V("*=","assignmult",20),V("/=","assigndiv",20).nud=function(){l("A regular expression literal can be confused with '/='.")},V("%=","assignmod",20),O("&=","assignbitand",20),O("|=","assignbitor",20),O("^=","assignbitxor",20),O("<<=","assignshiftleft",20),O(">>=","assignshiftright",20),O(">>>=","assignshiftrightunsigned",20),x("?",function(e,i){return i.left=e,i.right=v(10),p(":"),i["else"]=v(10),i},30),x("||","or",40),x("&&","and",50),j("|","bitor",70),j("^","bitxor",80),j("&","bitand",90),L("==",function(e,i){var t=di.eqnull&&("null"==e.value||"null"==i.value);return!t&&di.eqeqeq?n("Expected '{a}' and instead saw '{b}'.",this,"===","=="):T(e)?n("Use '{a}' to compare with '{b}'.",this,"===",e.value):T(i)&&n("Use '{a}' to compare with '{b}'.",this,"===",i.value),this}),L("==="),L("!=",function(e,i){return di.eqeqeq?n("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):T(e)?n("Use '{a}' to compare with '{b}'.",this,"!==",e.value):T(i)&&n("Use '{a}' to compare with '{b}'.",this,"!==",i.value),this}),L("!=="),L("<"),L(">"),L("<="),L(">="),j("<<","shiftleft",120),j(">>","shiftright",120),j(">>>","shiftrightunsigned",120),x("in","in",120),x("instanceof","instanceof",120),x("+",function(e,i){var t=v(130);return e&&t&&"(string)"===e.id&&"(string)"===t.id?(e.value+=t.value,e.character=t.character,!di.scripturl&&Wi.test(e.value)&&n("JavaScript URL.",e),e):(i.left=e,i.right=t,i)},130),A("+","num"),A("+++",function(){return n("Confusing pluses."),this.right=v(150),this.arity="unary",this}),x("+++",function(e){return n("Confusing pluses."),this.left=e,this.right=v(130),this},130),x("-","sub",130),A("-","neg"),A("---",function(){return n("Confusing minuses."),this.right=v(150),this.arity="unary",this}),x("---",function(e){return n("Confusing minuses."),this.left=e,this.right=v(130),this},130),x("*","mult",140),x("/","div",140),x("%","mod",140),F("++","postinc"),A("++","preinc"),Fi["++"].exps=!0,F("--","postdec"),A("--","predec"),Fi["--"].exps=!0,A("delete",function(){var e=v(0);return(!e||"."!==e.id&&"["!==e.id)&&n("Variables should not be deleted."),this.first=e,this}).exps=!0,A("~",function(){return di.bitwise&&n("Unexpected '{a}'.",this,"~"),v(150),this}),A("!",function(){return this.right=v(150),this.arity="unary",Ci[this.right.id]===!0&&n("Confusing use of '{a}'.",this,"!"),this}),A("typeof","typeof"),A("new",function(){var e,i=v(155);if(i&&"function"!==i.id)if(i.identifier)switch(i["new"]=!0,i.value){case"Object":n("Use the object literal notation {}.",Si);break;case"Number":case"String":case"Boolean":case"Math":case"JSON":n("Do not use {a} as a constructor.",Si,i.value);break;case"Function":di.evil||n("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==i.id&&(e=i.value.substr(0,1),di.newcap&&("A">e||e>"Z")&&n("A constructor name should start with an uppercase letter.",Si))}else"."!==i.id&&"["!==i.id&&"("!==i.id&&n("Bad constructor.",Si);else di.supernew||n("Weird construction. Delete 'new'.",this);return h(Si,ci),"("===ci.id||di.supernew||n("Missing '()' invoking a constructor."),this.first=i,this}),Fi["new"].exps=!0,A("void").exps=!0,x(".",function(e,i){h(hi,Si),g();var t=k();return"string"==typeof t&&W(t),i.left=e,i.right=t,di.noarg&&e&&"arguments"===e.value&&("callee"===t||"caller"===t)?n("Avoid arguments.{a}.",e,t):di.evil||!e||"document"!==e.value||"write"!==t&&"writeln"!==t||n("document.write can be a form of eval.",e),di.evil||"eval"!==t&&"execScript"!==t||n("eval is evil."),i},160,!0),x("(",function(e,i){"}"!==hi.id&&")"!==hi.id&&g(hi,Si),f(),di.immed&&!e.immed&&"function"===e.id&&n("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var t=0,s=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?n("Math is not a function.",e):di.newcap&&n("Missing 'new' prefix when invoking a constructor.",e)),")"!==ci.id)for(;s[s.length]=v(10),t+=1,","===ci.id;)_();return p(")"),f(hi,Si),"object"==typeof e&&("parseInt"===e.value&&1===t&&n("Missing radix parameter.",e),di.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?n("eval is evil.",e):!s[0]||"(string)"!==s[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||n("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||n("Bad invocation.",e)),i.left=e,i},155,!0).exps=!0,A("(",function(){f(),"function"===ci.id&&(ci.immed=!0);var e=v(0);return p(")",this),f(hi,Si),di.immed&&"function"===e.id&&("("===ci.id?n("Move the invocation into the parens that contain the function.",ci):n("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),x("[",function(e,i){g(hi,Si),f();var t,s=v(0);return s&&"(string)"===s.type&&(di.evil||"eval"!==s.value&&"execScript"!==s.value||n("eval is evil.",i),W(s.value),!di.sub&&Gi.test(s.value)&&(t=Fi[s.value],t&&t.reserved||n("['{a}'] is better written in dot notation.",s,s.value))),p("]",i),f(hi,Si),i.left=e,i.right=s,i},160,!0),A("[",function(){var e=Si.line!==ci.line;for(this.first=[],e&&(ai+=di.indent,ci.from===ai+di.indent&&(ai+=di.indent));"(end)"!==ci.id;){for(;","===ci.id;)n("Extra comma."),p(",");if("]"===ci.id)break;if(e&&Si.line!==ci.line&&y(),this.first.push(v(10)),","!==ci.id)break;if(_(),"]"===ci.id&&!di.es5){n("Extra comma.",Si);break}}return e&&(ai-=di.indent,y()),p("]",this),this},160),function(e){e.nud=function(){var e,i,t,s,a,u,r={};for(e=Si.line!==ci.line,e&&(ai+=di.indent,ci.from===ai+di.indent&&(ai+=di.indent));"}"!==ci.id;){if(e&&y(),"get"===ci.value&&":"!==d().id)p("get"),di.es5||l("get/set are ES5 features."),t=X(),t||l("Missing property name."),u=ci,h(Si,ci),i=K(),!di.loopfunc&&Z["(loopage)"]&&n("Don't make functions within a loop.",u),a=i["(params)"],a&&n("Unexpected parameter '{a}' in get {b} function.",u,a[0],t),h(Si,ci),p(","),y(),p("set"),s=X(),t!==s&&l("Expected {a} and instead saw {b}.",Si,t,s),u=ci,h(Si,ci),i=K(),a=i["(params)"],a&&1===a.length&&"value"===a[0]||n("Expected (value) in set {a} function.",u,t);else{if(t=X(),"string"!=typeof t)break;
p(":"),b(Si,ci),v(10)}if(r[t]===!0&&n("Duplicate member '{a}'.",ci,t),r[t]=!0,W(t),","!==ci.id)break;_(),","===ci.id?n("Extra comma.",Si):"}"!==ci.id||di.es5||n("Extra comma.",Si)}return e&&(ai-=di.indent,y()),p("}",this),this},e.fud=function(){l("Expected to see a statement and instead saw a block.",Si)}}(C("{"));var Yi=N("var",function(e){var i,t,s;for(Z["(onevar)"]&&di.onevar?n("Too many var statements."):Z["(global)"]||(Z["(onevar)"]=!0),this.first=[];b(Si,ci),i=k(),Z["(global)"]&&pi[i]===!1&&n("Redefinition of '{a}'.",Si,i),c(i,"unused"),!e&&(t=Si,this.first.push(Si),"="===ci.id&&(b(Si,ci),p("="),b(Si,ci),"undefined"===ci.id&&n("It is not necessary to initialize '{a}' to 'undefined'.",Si,i),"="===d(0).id&&ci.identifier&&l("Variable {a} was not declared correctly.",ci,ci.value),s=v(0),t.first=s),","===ci.id);)_();return this});Yi.exps=!0,D("function",function(){si&&n("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",Si);var e=k();return h(Si,ci),c(e,"unction"),K(e,!0),"("===ci.id&&ci.line===Si.line&&l("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),A("function",function(){var e=R();return e?h(Si,ci):b(Si,ci),K(e),!di.loopfunc&&Z["(loopage)"]&&n("Don't make functions within a loop."),this}),D("if",function(){var e=ci;return p("("),b(this,e),f(),v(20),"="===ci.id&&(di.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(hi,Si),G(!0,!0),"else"===ci.id&&(b(Si,ci),p("else"),"if"===ci.id||"switch"===ci.id?z(!0):G(!0,!0)),this}),D("try",function(){var e,i,t;return G(!1),"catch"===ci.id&&(p("catch"),b(Si,ci),p("("),t=gi,gi=Object.create(t),i=ci.value,"(identifier)"!==ci.type?n("Expected an identifier and instead saw '{a}'.",ci,i):c(i,"exception"),p(),p(")"),G(!1),e=!0,gi=t),"finally"===ci.id?(p("finally"),G(!1),void 0):(e||l("Expected '{a}' and instead saw '{b}'.",ci,"catch",ci.value),this)}),D("while",function(){var e=ci;return Z["(breakage)"]+=1,Z["(loopage)"]+=1,p("("),b(this,e),f(),v(20),"="===ci.id&&(di.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(hi,Si),G(!0,!0),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}).labelled=!0,w("with"),D("switch",function(){var e=ci,i=!1;for(Z["(breakage)"]+=1,p("("),b(this,e),f(),this.condition=v(20),p(")",e),f(hi,Si),b(Si,ci),e=ci,p("{"),b(Si,ci),ai+=di.indent,this.cases=[];;)switch(ci.id){case"case":switch(Z["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Hi.test(ni[ci.line-2])||n("Expected a 'break' statement before 'case'.",Si)}y(-di.indent),p("case"),this.cases.push(v(20)),i=!0,p(":"),Z["(verb)"]="case";break;case"default":switch(Z["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Hi.test(ni[ci.line-2])||n("Expected a 'break' statement before 'default'.",Si)}y(-di.indent),p("default"),i=!0,p(":");break;case"}":return ai-=di.indent,y(),p("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&n("This 'switch' should be an 'if'.",this),Z["(breakage)"]-=1,Z["(verb)"]=void 0,void 0;case"(end)":return l("Missing '{a}'.",ci,"}"),void 0;default:if(i)switch(Si.id){case",":return l("Each value should have its own case label."),void 0;case":":Q();break;default:l("Missing ':' on a case clause.",Si)}else l("Expected '{a}' and instead saw '{b}'.",ci,"case",ci.value)}}).labelled=!0,N("debugger",function(){return di.debug||n("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=N("do",function(){Z["(breakage)"]+=1,Z["(loopage)"]+=1,this.first=G(!0),p("while");var e=ci;return b(Si,e),p("("),f(),v(20),"="===ci.id&&(di.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(hi,Si),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),D("for",function(){var e,i=ci;if(Z["(breakage)"]+=1,Z["(loopage)"]+=1,p("("),b(this,i),f(),"in"===d("var"===ci.id?1:0).id){if("var"===ci.id)p("var"),Yi.fud.call(Yi,!0);else{switch(Z[ci.value]){case"unused":Z[ci.value]="var";break;case"var":break;default:n("Bad for in variable '{a}'.",ci,ci.value)}p()}return p("in"),v(20),p(")",i),e=G(!0,!0),di.forin&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&n("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}if(";"!==ci.id)if("var"===ci.id)p("var"),Yi.fud.call(Yi);else for(;v(0,"for"),","===ci.id;)_();if(S(Si),p(";"),";"!==ci.id&&(v(20),"="===ci.id&&(di.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20))),S(Si),p(";"),";"===ci.id&&l("Expected '{a}' and instead saw '{b}'.",ci,")",";"),")"!==ci.id)for(;v(0,"for"),","===ci.id;)_();return p(")",i),f(hi,Si),G(!0,!0),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}).labelled=!0,N("break",function(){var e=ci.value;return 0===Z["(breakage)"]&&n("Unexpected '{a}'.",ci,this.value),S(this),";"!==ci.id&&Si.line===ci.line&&("label"!==Z[e]?n("'{a}' is not a statement label.",ci,e):gi[e]!==Z&&n("'{a}' is out of scope.",ci,e),this.first=ci,p()),U("break"),this}).exps=!0,N("continue",function(){var e=ci.value;return 0===Z["(breakage)"]&&n("Unexpected '{a}'.",ci,this.value),S(this),";"!==ci.id?Si.line===ci.line&&("label"!==Z[e]?n("'{a}' is not a statement label.",ci,e):gi[e]!==Z&&n("'{a}' is out of scope.",ci,e),this.first=ci,p()):Z["(loopage)"]||n("Unexpected '{a}'.",ci,this.value),U("continue"),this}).exps=!0,N("return",function(){return S(this),"(regexp)"===ci.id&&n("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===ci.id||ci.reach||(b(Si,ci),this.first=v(20)),U("return"),this}).exps=!0,N("throw",function(){return S(this),b(Si,ci),this.first=v(20),U("throw"),this}).exps=!0,w("class"),w("const"),w("enum"),w("export"),w("extends"),w("import"),w("super"),w("let"),w("yield"),w("implements"),w("interface"),w("package"),w("private"),w("protected"),w("public"),w("static");var Ki=function(i,t,u){var r,l,o;if(e.errors=[],pi=Object.create(Oi),s(pi,u||{}),t){if(r=t.predef)if(Array.isArray(r))for(l=0;r.length>l;l+=1)pi[r[l]]=!0;else if("object"==typeof r)for(o=Object.keys(r),l=0;o.length>l;l+=1)pi[o[l]]=!!r[o];di=t}else di={};for(di.indent=di.indent||4,di.maxerr=di.maxerr||50,yi="",l=0;di.indent>l;l+=1)yi+=" ";ai=1,ii=Object.create(pi),gi=ii,Z={"(global)":!0,"(name)":"(global)","(scope)":gi,"(breakage)":0,"(loopage)":0},ei=[Z],_i=[],fi=!1,bi=null,li={},oi=null,ti={},si=!1,ri=[],ui=!1,Pi=0,Xi.init(i),vi=!0,qi=!1,hi=Si=ci=Fi["(begin)"],a();try{switch(p(),ci.id){case"{":case"[":di.laxbreak=!0,ui=!0,J();break;default:"use strict"===ci.value&&(di.globalstrict||n('Use the function form of "use strict".'),B()),Q("lib")}p("(end)")}catch(c){c&&e.errors.push({reason:c.message,line:c.line||ci.line,character:c.character||ci.from},null)}return 0===e.errors.length};return e.data=function(){var i,s,a,u,n,r,l,o={functions:[]},c=[],m=[],d=[];e.errors.length&&(o.errors=e.errors),ui&&(o.json=!0);for(r in ti)t(ti,r)&&c.push({name:r,line:ti[r]});for(c.length>0&&(o.implieds=c),_i.length>0&&(o.urls=_i),s=Object.keys(gi),s.length>0&&(o.globals=s),u=1;ei.length>u;u+=1){for(a=ei[u],i={},n=0;Ii.length>n;n+=1)i[Ii[n]]=[];for(r in a)t(a,r)&&"("!==r.charAt(0)&&(l=a[r],"unction"===l&&(l="unused"),Array.isArray(i[l])&&(i[l].push(r),"unused"===l&&d.push({name:r,line:a["(line)"],"function":a["(name)"]})));for(n=0;Ii.length>n;n+=1)0===i[Ii[n]].length&&delete i[Ii[n]];i.name=a["(name)"],i.param=a["(params)"],i.line=a["(line)"],i.last=a["(last)"],o.functions.push(i)}d.length>0&&(o.unused=d),m=[];for(r in li)if("number"==typeof li[r]){o.member=li;break}return o},e.report=function(i){function t(e,i){var t,s,a;if(i){for(h.push("<div><i>"+e+"</i> "),i=i.sort(),s=0;i.length>s;s+=1)i[s]!==a&&(a=i[s],h.push((t?", ":"")+a),t=!0);h.push("</div>")}}var s,a,u,n,r,l,o,c,m,d=e.data(),p=[],v="",h=[];if(d.errors||d.implieds||d.unused){if(u=!0,h.push("<div id=errors><i>Error:</i>"),d.errors)for(r=0;d.errors.length>r;r+=1)s=d.errors[r],s&&(a=s.evidence||"",h.push("<p>Problem"+(isFinite(s.line)?" at line "+s.line+" character "+s.character:"")+": "+s.reason.entityify()+"</p><p class=evidence>"+(a&&(a.length>80?a.slice(0,77)+"...":a).entityify())+"</p>"));if(d.implieds){for(m=[],r=0;d.implieds.length>r;r+=1)m[r]="<code>"+d.implieds[r].name+"</code>&nbsp;<i>"+d.implieds[r].line+"</i>";h.push("<p><i>Implied global:</i> "+m.join(", ")+"</p>")}if(d.unused){for(m=[],r=0;d.unused.length>r;r+=1)m[r]="<code><u>"+d.unused[r].name+"</u></code>&nbsp;<i>"+d.unused[r].line+"</i> <code>"+d.unused[r]["function"]+"</code>";h.push("<p><i>Unused variable:</i> "+m.join(", ")+"</p>")}d.json&&h.push("<p>JSON: bad.</p>"),h.push("</div>")}if(!i){for(h.push("<br><div id=functions>"),d.urls&&t("URLs<br>",d.urls,"<br>"),d.json&&!u?h.push("<p>JSON: good.</p>"):d.globals?h.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):h.push("<div><i>No new global variables introduced.</i></div>"),r=0;d.functions.length>r;r+=1)n=d.functions[r],h.push("<br><div class=function><i>"+n.line+"-"+n.last+"</i> "+(n.name||"")+"("+(n.param?n.param.join(", "):"")+")</div>"),t("<big><b>Unused</b></big>",n.unused),t("Closure",n.closure),t("Variable",n["var"]),t("Exception",n.exception),t("Outer",n.outer),t("Global",n.global),t("Label",n.label);if(d.member){if(p=Object.keys(d.member),p.length){for(p=p.sort(),v="<br><pre id=members>/*members ",o=10,r=0;p.length>r;r+=1)l=p[r],c=l.name(),o+c.length>72&&(h.push(v+"<br>"),v="    ",o=1),o+=c.length+2,1===d.member[l]&&(c="<i>"+c+"</i>"),p.length-1>r&&(c+=", "),v+=c;h.push(v+"<br>*/</pre>")}h.push("</div>")}}return h.join("")},e.jshint=Ki,e.edition="2011-04-16",Ki});"object"==typeof i&&(i.JSHINT=t),"undefined"!=typeof bootstrap&&bootstrap("core/jshint",function(e,i){"use strict";i.JSHINT=t})}}),montageDefine("3c07db4","core/serialization/serializer/montage-ast",{dependencies:["../../core","mousse/serialization/ast"],factory:function(e,i){var t=e("../../core").Montage,s=e("mousse/serialization/ast").Value,a=t.specialize.call(s,{constructor:{value:function a(){}},initWithRootAndId:{value:function(e,i){return s.call(this,e,i),this}},_getSerializationValue:{value:function(){return{"#":this.value}}}}),u=t.specialize.call(s,{constructor:{value:function u(){}},initWithRootAndModuleId:{value:function(e,i){return s.call(this,e,i),this}},_getSerializationValue:{value:function(){return{"%":this.value}}}});i.ElementReference=a,i.ModuleReference=u}}),montageDefine("3c07db4","core/serialization/serializer/properties-serializer",{dependencies:["../../core"],factory:function(e,i){var t=e("../../core").Montage,s=t.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function s(){}},initWithMalkerAndVisitorAndObject:{value:function(e,i,t){return this._malker=e,this._visitor=i,this._object=t,this}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var i=this._visitor.builder,t=this._visitor.labeler,s=t.getObjectLabel(e),u=Object.create(a);return u.reference=i.createReference(s),u}},set:{value:function(e,i,t){this._visitor.setProperty(this._malker,e,i,t)}},setAll:{value:function(){this._visitor.setSerializableObjectProperties(this._malker,this._object)}}}),a={thisIsAReferenceCreatedByMontageSerializer:!0,reference:null};i.PropertiesSerializer=s}}),montageDefine("3c07db4","core/serialization/serializer/self-serializer",{dependencies:["../../core"],factory:function(e,i){var t=e("../../core").Montage,s=t.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function s(){}},initWithMalkerAndVisitorAndObject:{value:function(e,i,t){return this._malker=e,this._visitor=i,this._object=t,this}},getObjectLabel:{value:function(e){return this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var i=this._visitor.builder,t=this._visitor.labeler,s=t.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:i.createObjectReference(s)}}},setProperty:{value:function(e,i,t){var s,a=this._visitor.builder;s=a.top.getProperty("properties"),a.push(s),this._visitor.setProperty(this._malker,e,i,t),a.pop()}},setAllProperties:{value:function(){var e,i=this._visitor.builder;e=i.top.getProperty("properties"),i.push(e),this._visitor.setSerializableObjectProperties(this._malker,this._object),i.pop()}},setUnit:{value:function(e){this._visitor.setObjectCustomUnit(this._malker,this._object,e)}},setAllUnits:{value:function(){this._visitor.setObjectCustomUnits(this._malker,this._object)}}});i.SelfSerializer=s}}),montageDefine("3c07db4","core/serialization/serializer/unit-serializer",{dependencies:["../../core"],factory:function(e,i){function t(e,i,t){this._visitor=e,this._malker=i,this._object=t}var s=e("../../core").Montage,t=s.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function t(){}},initWithMalkerAndVisitorAndObject:{value:function(e,i,t){return this._malker=e,this._visitor=i,this._object=t,this}},getObjectLabel:{value:function(e){return this.addObjectReference(e),this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var i=this._visitor.builder,t=this._visitor.labeler,s=t.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:i.createObjectReference(s)}}}});i.UnitSerializer=t}}),montageDefine("3c07db4","ui/loader.reel/loader",{dependencies:["../../core/core","../component","../../core/logger","../../core/event/event-manager"],factory:function(e,i){var t=(e("../../core/core").Montage,e("../component").Component),s=e("../../core/logger").logger("loader"),a=e("../../core/event/event-manager").defaultEventManager,u="_montageStartBootstrappingTimeout",n="montage-app-loader",r="montage-app-bootstrapping",l="montage-app-loading",o="montage-app-loaded",c=0,m=1,d=2,p=3;i.Loader=t.specialize({constructor:{value:function(){this.super()}},mainModule:{value:"ui/main.reel"},mainName:{value:"Main"},includeFrameworkModules:{value:!1},minimumBootstrappingDuration:{value:1500},minimumLoadingDuration:{value:2e3},_initializedModules:{value:null},initializedModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._initializedModules||this.includeFrameworkModules?this._initializedModules:this._initializedModules.slice(this._frameworkModuleCount-1)},set:function(e){this._initializedModules=e}},_requiredModules:{value:null},requiredModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._requiredModules||this.includeFrameworkModules?this._requiredModules:this._requiredModules.slice(this._frameworkModuleCount-1)},set:function(e){this._requiredModules=e}},_currentStage:{value:c},currentStage:{get:function(){return this._currentStage},set:function(e){e!==this._currentStage&&(s.isDebug&&s.debug(this,"CURRENT STAGE: "+e),this._currentStage=e,this.needsDraw=!0)}},_readyToShowLoader:{value:!1},isLoadingMainComponent:{value:null},readyToShowLoader:{get:function(){return this._readyToShowLoader},set:function(e){e===this._readyToShowLoader&&(this._readyToShowLoader=e,this.needsDraw=!0)}},readyToShowMainComponent:{get:function(){return!!this._mainComponent}},_frameworkModuleCount:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!1},_mainComponent:{value:null},_mainComponentEnterDocument:{value:null},_showLoadingTimeout:{enumerable:!1,value:null},_showMainComponentTimeout:{enumerable:!1,value:null},templateDidLoad:{value:function(){s.isDebug&&s.debug(this,"templateDidLoad"),this.element||(this.element=document.documentElement,this.attachToParentComponent()),this.readyToShowLoader=!0;var e,i=document._montageTiming,t=this;i.bootstrappingStartTime?(s.isDebug&&s.debug(this,"had already started bootstrapping"),this.currentStage=m,i.bootstrappingEndTime=Date.now(),e=this.minimumBootstrappingDuration-(i.bootstrappingEndTime-i.bootstrappingStartTime),e>0?(s.isDebug&&s.debug(this,"still need to show bootstrapper for another "+e+"ms"),this._showLoadingTimeout=setTimeout(function(){t._revealLoader()},e)):this._revealLoader()):(s.isDebug&&s.debug(this,"bootstrapping has not started yet…"),this._loadMainComponent())}},_revealLoader:{value:function(){s.isDebug&&s.debug(this,"_revealLoader"),this.currentStage=d,document._montageTiming.loadingStartTime=Date.now();var e,i,t,a,u=document.getElementById(n);if(u)for(i=u.children,e=0;t=i[e];e++)(a=t.component)&&(a.attachToParentComponent(),a.needsDraw=!0)}},_revealMainComponent:{value:function(){s.isDebug&&s.debug(this,"_revealMainComponent"),this.currentStage=p}},_loadMainComponent:{value:function(){s.isDebug&&s.debug(this,"_loadMainComponent"),this.isLoadingMainComponent=!0;var e=this;window.require.async(this.mainModule).then(function(i){if(!(e.mainName in i))throw Error(e.mainName+" was not found in "+e.mainModule);return e._mainLoadedCallback(i)}).done()}},_mainLoadedCallback:{value:function(e){s.isDebug&&s.debug(this,"_mainLoadedCallback"),this._mainComponent=e[this.mainName].create(),this._mainComponentEnterDocument=this._mainComponent.enterDocument,this._mainComponent.enterDocument=this.mainComponentEnterDocument.bind(this),this._mainComponent.setElementWithParentComponent(document.createElement("div"),this),this._mainComponent.attachToParentComponent(),this._mainComponent._canDrawOutsideDocument=!0,this._mainComponent.needsDraw=!0}},mainComponentEnterDocument:{value:function(){var e,i=this;s.isDebug&&s.debug(this,"main preparing to draw"),this.isLoadingMainComponent=!1,this._contentToRemove=document.createRange(),e=this.element===document.documentElement?document.body:this.element,this._contentToRemove.selectNodeContents(e),this.childComponents=[this._mainComponent],e.appendChild(this._mainComponent.element);var t,n,r=document[u],l=document._montageTiming;l.bootstrappingStartTime?l.bootstrappingStartTime&&!l.loadingStartTime?(clearTimeout(this._showLoadingTimeout),this._showLoadingTimeout=null,l.bootstrappingEndTime=Date.now(),(t=this.minimumBootstrappingDuration-(l.bootstrappingEndTime-l.bootstrappingStartTime))>0?(s.isDebug&&s.debug(this,"show bootstrapper for another "+t+"ms"),this._showMainComponentTimeout=setTimeout(function(){s.isDebug&&s.debug(this,"ok, shown bootstrapper long enough"),i._revealMainComponent()},t)):setTimeout(function(){s.isDebug&&s.debug(this,"ok, showing bootstrapper now"),i._revealMainComponent()},0)):l.loadingStartTime&&(l.loadingEndTime=Date.now(),(n=this.minimumLoadingDuration-(l.loadingEndTime-l.loadingStartTime))>0?(s.isDebug&&s.debug(this,"show loader for another "+n+"ms"),this._showMainComponentTimeout=setTimeout(function(){s.isDebug&&s.debug(this,"ok, shown loader long enough"),i._revealMainComponent()},n)):this._revealMainComponent()):(s.isDebug&&s.debug(this,"bootstrapper never shown"),clearTimeout(r),r=null,this._revealMainComponent());var o=this._mainComponent;return a.unregisterEventHandlerForElement(this.element),o.attachToParentComponent(),p>this.currentStage&&(this.currentStage=p),o.enterDocument=this._mainComponentEnterDocument,o.enterDocument?o.enterDocument.apply(o,arguments):void 0}},removeContentOnLoad:{value:!0},_forceContentRemoval:{enumerable:!1,value:!1},_contentToRemove:{enumerable:!1,value:null},removeContent:{value:function(){this._forceContentRemoval=!0,this.needsDraw=!0}},draw:{value:function(){if(this.readyToShowMainComponent||this.isLoadingMainComponent||(s.isDebug&&s.debug(this,"draw; start loading main component"),this._loadMainComponent()),d===this.currentStage)this.element.classList.remove(r),this.element.classList.add(l);else if(p===this.currentStage&&this._contentToRemove){this.element.classList.remove(r),this.element.classList.remove(l),(this.removeContentOnLoad||this._forceContentRemoval)&&(this._contentToRemove.extractContents(),this._contentToRemove.detach(),this._contentToRemove=null),this.element.classList.add(o);var e=document.createEvent("CustomEvent");e.initCustomEvent("componentLoaded",!0,!0,this._mainComponent),this.dispatchEvent(e,!0,!0),this.detachFromParentComponent()}}}})}}),montageDefine("3c07db4","ui/component",{dependencies:["../core/core","../core/target","../core/template","../core/document-resources","../core/gate","../core/promise","../core/logger","../core/event/event-manager","collections/set","../core/serialization/alias","../core/application"],factory:function(e,i){function t(e){return e?e._montage_metadata.objectName+":"+Object.hash(e)+" id: "+e.identifier:"NIL"}var s=e("../core/core").Montage,a=e("../core/target").Target,u=e("../core/template").Template,n=e("../core/document-resources").DocumentResources,r=e("../core/gate").Gate,l=e("../core/promise").Promise,o=e("../core/logger").logger("component"),c=e("../core/logger").logger("Drawing performance").color.green(),m=e("../core/logger").logger("drawing list").color.blue(),d=e("../core/logger").logger("drawing needsDraw").color.violet(),p=e("../core/logger").logger("drawing").color.blue(),v=e("../core/event/event-manager").defaultEventManager,h=e("collections/set"),g=e("../core/serialization/alias").Alias,f="data-montage-le-component",b="data-montage-le-arg",q="data-montage-le-arg-begin",y="data-montage-le-arg-end",S=i.Component=a.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function S(){this.super(),this._isComponentExpanded=!1,this._isTemplateLoaded=!1,this._isTemplateInstantiated=!1,this._isComponentTreeLoaded=!1}},delegate:{value:null},templateObjects:{serializable:!1,value:null},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_domArgumentNames:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new r).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new r).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(window._montage_le_flag&&e.setAttribute(f,s.getInfoForObject(this).moduleId),this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,i,t,s={},a=this.element;e=a.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");e:for(var u,n=0;u=e[n];n++){for(t=u;(t=t.parentNode)!==a;)if(t.component)continue e;this._findAndDetachComponents(u),u.parentNode.removeChild(u),i=u.getAttribute(this.DOM_ARG_ATTRIBUTE),u.removeAttribute(this.DOM_ARG_ATTRIBUTE),s[i]=u}this._domArguments=s}},getDomArgumentNames:{value:function(){return this._domArgumentNames||(this._domArgumentNames=Object.keys(this._domArguments)),this._domArgumentNames}},extractDomArgument:{value:function(e){var i;return i=this._domArguments[e],this._domArguments[e]=null,i}},_getTemplateDomArgument:{value:function(e){var i,t,s,a,u,n,r=this._ownerDocumentPart.template;s=r.getElementById(this.getElementId()),i=s.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,o=0;l=i[o];o++){for(t=l;(t=t.parentNode)!==s;)if(a=r.getElementId(t),a&&(u=r.getSerialization(),n=u.getSerializationLabelsWithElements(a),n.length>0))continue e;return l}}},getTemplateArgumentElement:{value:function(e){var i,t,s,a=this._ownerDocumentPart.template;if(window._montage_le_flag)var u=this.ownerComponent._montage_metadata.moduleId,n=this._montage_metadata.label;return"*"===e?(i=a.getElementById(this.getElementId()),t=a.document.createRange(),t.selectNodeContents(i),s=t.cloneContents(),window._montage_le_flag&&i.children.length>0&&this._leTagStarArgument(u,n,s)):(s=this._getTemplateDomArgument(e).cloneNode(!0),s.removeAttribute(this.DOM_ARG_ATTRIBUTE),window._montage_le_flag&&this._leTagNamedArgument(u,n,s,e)),s}},getTemplateArgumentSerialization:{value:function(e){var i=this._ownerDocumentPart.template;return i._createSerializationWithElementIds(e)}},resolveTemplateArgumentTemplateProperty:{value:function(e){var i,t,a,u,n=e.indexOf(":"),r=e.slice(0,n),l=e.slice(n),o=this._templateDocumentPart;return s.getInfoForObject(this).label===r?(o&&(a=o.objects[l]),a instanceof g&&(t=o.objects[a.componentLabel],i=a.value.slice(1),u=t.resolveTemplateArgumentTemplateProperty(i),u||(u=i)),u):void 0}},setElementWithParentComponent:{value:function(e,i){this._alternateParentComponent=i,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("../core/application").application}},eventManager:{enumerable:!1,get:function(){return v}},rootComponent:{enumerable:!1,get:function(){return P}},elementControllerFromEvent:{enumerable:!1,value:function(e,i){return i}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,i=this.element,t=this.eventManager;if(i){for(;null!=(e=i.parentNode)&&null==t.eventHandlerForElement(e);)i=e;return e?t.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var i=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!i)throw'querySelectorComponent: Syntax error "'+e+'"';var t,a,u,n=this.childComponents,r=i[1],l=(i[2]||" ",i[3]),o=i[4];if(r)for(o=l?"@"+l+o:"",a=0,u;u=n[a];a++){if(r===s.getInfoForObject(u).label)return o?u.querySelectorComponent(o):u;if(t=u.querySelectorComponent(e))return t}else for(a=0,u;u=n[a];a++)if(l===s.getInfoForObject(u).label)return o?u.querySelectorComponent(o):u;return null}},querySelectorAllComponent:{value:function(e,i){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var a,u,n=this.childComponents,r=t[1],l=(t[2]||" ",t[3]),o=t[4],c=[];if(r)for(o=l?"@"+l+o:"",a=0,u;u=n[a];a++)r!==s.getInfoForObject(u).label||i&&i!==u.ownerComponent?c=c.concat(u.querySelectorAllComponent(e,i)):o?c=c.concat(u.querySelectorAllComponent(o)):c.push(u);else for(a=0,u;u=n[a];a++)l!==s.getInfoForObject(u).label||i&&i!==u.ownerComponent||(o?c=c.concat(u.querySelectorAllComponent(o,i)):c.push(u));return c}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,i,t=this.findParentComponent();if(t){e=t.childComponents;for(var s=0;i=e[s];s++){var a=i.findParentComponent();a===this&&(t.removeChildComponent(i),a.addChildComponent(i))}t.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var i=this.childComponents,t=i.indexOf(e);t>-1&&(e._exitDocument(),i.splice(t,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,t=this._drawList.indexOf(e),this._drawList.splice(t,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(i){for(var t,s=i.childComponents,a=0;t=s[a];a++)t._isComponentExpanded&&e(t);i._inDocument&&i.__exitDocument()},e(this))}},exitDocument:{value:function(){this.isActiveTarget&&(v.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:null},_isTemplateLoaded:{enumerable:!1,value:null},_isTemplateInstantiated:{enumerable:!1,value:null},cleanupDeletedComponentTree:{value:function(e){e&&this.cancelBindings(),this.needsDraw=!1,this.traverseComponentTree(function(i){e&&i.cancelBindings(),i.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var i,t,s,a=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),i=this.childComponents,t=0,s;s=i[t];t++)s.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,a);else if(e&&e[0])for(t=0;e.length>t;t++)this._findAndDetachComponents(e[t],a);for(t=0,s;s=a[t];t++)this.addChildComponent(s)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,i){var t,s=e.component;if(i||(i=[]),s)s.detachFromParentComponent(),i.push(s);else{t=e.children||e.childNodes;for(var a,u=0;a=t[u];u++)this._findAndDetachComponents(a,i)}return i}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,i,t,s,a,u,n,r=this._innerTemplate;if(!r&&(e=this._ownerDocumentPart)){i=e.template,t=this.getElementId(),r=i.createTemplateFromElementContents(t),s=r.getSerialization(),a=s.getExternalObjectLabels(),u=e.objects,n=Object.create(null);for(var l,o=0;l=a[o];o++)n[l]=u[l];r.setInstances(n),this._innerTemplate=r}return r},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value
},set:function(e){P.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_blocksOwnerComponentDraw:{value:!1},_updateOwnerCanDrawGate:{value:function(){this._blocksOwnerComponentDraw&&this.ownerComponent&&this.ownerComponent.canDrawGate.setField(this.uuid,this.canDrawGate.value)}},_isComponentTreeLoaded:{value:null},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,i=this.canDrawGate,t=this._loadComponentTreeDeferred;return t||(t=l.defer(),this._loadComponentTreeDeferred=t,i.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var i,t=[],s=e.childComponents,a=0;i=s[a];a++)t.push(i.loadComponentTree());return l.all(t)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),i.setField("componentTreeLoaded",!0),t.resolve()},t.reject).done()),t.promise}},traverseComponentTree:{value:function(e,i){function t(){var t,a,u=s.childComponents;if(e&&e(s)===!1)return i&&i(),void 0;if(0===(a=u.length))return i&&i(),void 0;for(var n=function(){0===--a&&i&&i()},r=0;t=u[r];r++)t.traverseComponentTree(e,n)}var s=this;this._isComponentExpanded?t():i&&i()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,i=this._expandComponentDeferred;return i||(i=l.defer(),this._expandComponentDeferred=i,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,i.resolve()},i.reject):(this._isComponentExpanded=!0,i.resolve())),i.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){this.templateObjects=Object.create(null),this._addTemplateObjects(e)}},_addTemplateObjects:{value:function(e){var i=this._templateObjectDescriptor,t=this.templateObjects;for(var s in e){var a=e[s];"object"==typeof a&&null!=a&&(S.prototype.isPrototypeOf(a)&&a!==this&&a.parentComponent!==this?(i.get=this._makeTemplateObjectGetter(this,s,a),Object.defineProperty(t,s,i)):t[s]=a)}}},_makeTemplateObjectGetter:{value:function(e,i,t){var s,a,u,n="@"+i;return function(){if(s)return e.querySelectorAllComponent(n,e);if(a=e.querySelectorAllComponent(n,e),1===a.length)for(u=a[0];u=u.parentComponent;){if(u===e)return Object.defineProperty(this,i,{value:a[0]}),a[0];if(u.clonesChildComponents)break}else if(0===a.length)return t;return s=!0,a}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(i){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var t=e.templateObjects,s=e._element.ownerDocument;return t||(t=Object.create(null)),t.owner=e,e._isTemplateInstantiated=!0,i.instantiateWithInstances(t,s).then(function(i){i.parentDocumentPart=e._ownerDocumentPart,e._templateDocumentPart=i,i.fragment=null}).fail(function(e){var t=e.stack||e;throw console.error("Error in",i.getBaseUrl()+":",t),e})})}},_templateDidLoad:{value:function(e){this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,i=this,t=this._loadTemplatePromise;return t||(e=s.getInfoForObject(this),t=this._loadTemplatePromise=u.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return i._template=e,i._isTemplateLoaded=!0,e})),t}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,i,t,a;return a=s.getInfoForObject(this),t=a.moduleId,i=t.lastIndexOf("/"),e=t+"/"+t.slice(-1===i?0:i+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,i,t){s.getInfoForObject(this).label=i,this._ownerDocumentPart=t,this.hasOwnProperty("identifier")||(this.identifier=i),this.ownerComponent||(this.ownerComponent=S.prototype.isPrototypeOf(e)?e:this.rootComponent,this._updateOwnerCanDrawGate()),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=s.getInfoForObject(this),i=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(i,"_blueprintModuleId")||!i._blueprintModuleId){e=s.getInfoForObject(i);var t=e.moduleId,a=t.lastIndexOf("/"),u=t.lastIndexOf(".");a=-1===a?0:a+1,u=-1===u?t.length:u,u=a>u?t.length:u;var n;n=t.length>u&&".reel"===t.slice(u,t.length)?t+"/"+t.slice(a,u)+".meta":t.slice(0,u)+".meta",s.defineProperty(i,"_blueprintModuleId",{value:n})}return i._blueprintModuleId}},blueprint:e("../core/core")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?(this._canDraw=!0,this._updateOwnerCanDrawGate()):e===this._blockDrawGate&&(P.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},gateDidBecomeFalse:{value:function(e){e===this._canDrawGate&&this._updateOwnerCanDrawGate()},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},_preparedForActivationEvents:{enumerable:!1,value:!1},_arrayObjectPool:{value:{pool:null,size:200,ix:0}},_getArray:{value:function(){if(null==this._arrayObjectPool.pool){this._arrayObjectPool.pool=[];for(var e=0;this._arrayObjectPool.size>e;e++)this._arrayObjectPool.pool[e]=[]}return this._arrayObjectPool.ix<this._arrayObjectPool.size?this._arrayObjectPool.pool[this._arrayObjectPool.ix++]:[]}},_disposeArray:{value:function(e){this._arrayObjectPool.ix>0&&(e.length=0,this._arrayObjectPool.pool[--this._arrayObjectPool.ix]=e)}},_drawIfNeeded:{enumerable:!1,value:function(e){var i,a,u,n,r=this._firstDraw;if(this._treeLevel=e,r&&(this.originalElement=this.element),this.needsDraw&&P.addToDrawCycle(this),r&&this.prepareForDraw&&s.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(r),this._enterDocument(r)),r&&(this.originalElement=null),null!==this._drawList&&this._drawList.length>0){for(a=this._drawList,this._drawList=this._getArray(),n=a.length,u=0;n>u;u++)i=a[u],i._addedToDrawList=!1,i.canDraw()?i._drawIfNeeded(e+1):p.isDebug&&p.debug(t(i)+" can't draw.");this._disposeArray(a)}}},_updateComponentDom:{value:function(){var e,i,t;if(this._firstDraw){for(this._prepareForDraw(),i=this.composerList.length,t=0;i>t;t++)e=this.composerList[t],e.lazyLoad||e._load();this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(p.isDebug&&o.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,i,t,s,a,u=this.element,n=this._templateElement,r=this.element.attributes;for(t=0;s=r[t];t++)e=s.nodeName,window._montage_le_flag&&e===f?i=s.nodeValue:"id"===e||"data-montage-id"===e?i=s.nodeValue:(a=n.getAttribute(e)||"",i=a?a+("style"===e?"; ":" ")+s.nodeValue:s.nodeValue),n.setAttribute(e,i);this._initializeClassListFromElement(n),u.parentNode?u.parentNode.replaceChild(n,u):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",u," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(u),this.eventManager.registerEventHandlerForElement(this,n),this._element=n,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStyles:{value:function(){var e,i,t,s=this._templateDocumentPart;if(s){e=s.template.getResources(),t=this.element.ownerDocument,i=e.createStylesForDocument(t);for(var a,u=0;a=i[u];u++)this.rootComponent.addStylesheet(a)}}},_prepareForDraw:{value:function(){o.isDebug&&o.debug(this,"_templateElement: "+this._templateElement);var e;window._montage_le_flag&&(e=this.element.children.length>0),this._initDomArguments(),e&&this._leTagArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_leTagArguments:{value:function(){var e=this.ownerComponent._montage_metadata.moduleId,i=this._montage_metadata.label,t=this.getDomArgumentNames();if(0===t.length)this._leTagStarArgument(e,i,this.element);else for(var s,a=0;s=t[a];a++)this._leTagNamedArgument(e,i,this._domArguments[s],s)}},_getNodeFirstElement:{value:function(e){var i=e.firstElementChild;if(!i){i=e.firstChild;do if(i.nodeType===Node.ELEMENT_NODE)break;while(i=i.nextSibling)}return i}},_getNodeLastElement:{value:function(e){var i=e.lastElementChild;if(!i){i=e.lastChild;do if(i.nodeType===Node.ELEMENT_NODE)break;while(i=i.previousSibling)}return i}},_leTagStarArgument:{value:function(e,i,t){var s=this._getNodeFirstElement(t),a=this._getNodeLastElement(t);s.setAttribute(q,(s.getAttribute(q)||"")+" "+e+","+i),a.setAttribute(y,(a.getAttribute(y)||"")+" "+e+","+i)}},_leTagNamedArgument:{value:function(e,i,t,s){t.setAttribute(b,e+","+i+","+s)}},_bindTemplateParametersToArguments:{value:function(){var e,i,t,s,a,u,n,r,l=this._templateDocumentPart.parameters;if(i=this._domArguments,this._template.hasParameters()||1!==i.length){if(s=this._validateTemplateArguments(i,l))throw s;for(var o in l){e=l[o],t=i[o],"*"===o?(n=this._element.ownerDocument.createRange(),n.selectNodeContents(this._element),a=n.extractContents()):a=t,u=this._findAndDetachComponents(a),e.parentNode.replaceChild(a,e);for(var c=0;r=u[c];c++)r.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,i){var t,s,a=Object.keys(i);if(0!==a.length)if(null==e){if(a.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+a+".")}else if("*"in i){if(t=Object.keys(e),t.length>0)return Error('Arguments "'+t+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(s in i)if(!(s in e))return Error('"'+s+'" argument not '+"given in "+this.templateModuleId);for(s in e)if("*"!==s&&!(s in i))return Error('"'+s+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){var e,i=this.composerList.length;for(i=0;this.composerList.length>i;i++)e=this.composerList[i],e.lazyLoad&&e._load();"function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents()}},_performDomContentChanges:{value:function(){var e,i,t=this._newDomContent,s=this._element.childNodes[0];if(t||this._shouldClearDomContentOnNextDraw){i=this._element,e=this._element.childNodes.length;for(var a=0;e>a;a++)i.removeChild(i.firstChild);if(Element.isElement(t))i.appendChild(t);else if(null!=t)for(var u,a=0;u=t[a];a++)i.appendChild(u);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],s),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),m.isDebug&&m.debug(t(this)+" added to "+t(e)+"'s drawList")):m.isDebug&&m.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(d.isDebug&&d.debug("needsDraw toggled "+e+" for "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},composerList:{value:[],distinct:!0,serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,i){e.component=this,e.element=i,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this._preparedForActivationEvents&&e._load():e._load())}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){var i,t;for(t=this.composerList.length,i=0;t>i;i++)if(this.composerList[i].uuid===e.uuid){this.composerList[i].unload(),this.composerList.splice(i,1);break}}},clearAllComposers:{value:function(){var e,i,t=this.composerList;for(i=t.length,e=0;i>e;e++)t[e].unload();t.splice(0,i)}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var i=this;o.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){o.isDebug&&o.debug(i,"got messages from localizer"),i.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var i,t=this;t&&t._elementAttributeDescriptors&&!(i=t._elementAttributeDescriptors[e]);)t=Object.getPrototypeOf(t);return i}},defineAttribute:{value:function(e,i){i=i||{};var t="_"+e,a={configurable:void 0===i.configurable?!0:i.configurable,enumerable:void 0===i.enumerable?!0:i.enumerable,set:function(e,i){return function(t){var s=this._getElementAttributeDescriptor(e,this);s&&"boolean"===s.dataType&&(t=t||""===t?!0:!1),void 0!==t&&this[i]!==t&&(this[i]=t,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=t,this.needsDraw=!0)}}(e,t),get:function(e,i){return function(){return this[i]}}(e,t)};s.defineProperty(this.prototype,t,{value:null}),s.defineProperty(this.prototype,e,a)}},addAttributes:{value:function(e){var i,t,s;this.prototype._elementAttributeDescriptors=e;for(t in e)e.hasOwnProperty(t)&&(s=e[t],null===s||"string"==typeof s?(i={value:s,dataType:"string"},e[t]=i):i=s,void 0===this[t]&&this.defineAttribute(t,i))}},_enterDocument:{value:function(e){var i;if(e){i=this.originalElement;var t,s,a,u,n,r,l;if(t=i.attributes)for(a=t.length,s=0;a>s;s++)u=t[s].name,n=t[s].value,l=this._getElementAttributeDescriptor(u,this),(l||void 0!==this[u])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[u]&&(this._elementAttributeValues[u]=n,(void 0===this[u]||null==this[u])&&(this[u]=n)));if(l=this._getElementAttributeDescriptor("textContent",this)){var o=i.textContent;null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=o,null==this.textContent&&(this.textContent=o))}if(this._elementAttributeDescriptors)for(r in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[r];var c="_"+r;null===this[c]&&null!==l&&"value"in l&&(this[c]=this._elementAttributeDescriptors[r].value)}}}},_draw:{value:function(){var e,i=this.element;for(var t in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(t)){var s=this[t];e=this._getElementAttributeDescriptor(t,this),e&&("boolean"===e.dataType?s===!0?(i[t]=!0,i.setAttribute(t,t.toLowerCase())):(i[t]=!1,i.removeAttribute(t)):void 0!==s&&("textContent"===t?i.textContent=s:i.setAttribute(t,s))),delete this._elementAttributeValues[t]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new h,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){var i;if(e&&e.className&&(i=e.className.trim())&&0!==i.length){var t=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),t.addEach(i.split(/\s+/)),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,i=this.element.classList,t=this._classList,s=0,a=i.length;a>s;s++)e=i.item(s),t.has(e)||(i.remove(e),s--,a--);this._classList.forEach(function(e){i.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),v.unregisterEventHandlerForElement(this,this._element),this._element=null,this.childComponents.forEach(function(e){e.dispose()})}}}),_=S.specialize({constructor:{value:function _(){this.super(),this._drawTree=this._drawTree.bind(this),this._readyToDrawListIndex={}}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var i,t=this.childComponents,s=0;i=t[s];s++)d.isDebug&&d.debug(this,"needsDraw = true for: "+i._montage_metadata.exportedSymbol),i.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new r).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return e.uuid in this._cannotDrawList||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,i){if(i){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,i,t,s=this._needsDrawList;for(t=s.length,i=0;t>i;i++)e=s[i],(e.needsDraw||e._drawList&&e._drawList.length>0)&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,s.splice(0,t)}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var i=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){i._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,i=this.cancelAnimationFrame;null!==e&&(this._frameTime||(o.isDebug&&o.debug(this,"clearing draw"),i?i.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),m.isDebug&&m.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),p.isDebug&&p.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{value:[],distinct:!0},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,i){for(var t={},s={},a=0;i.length>a;a++)null==t[i[a]]&&(t[i[a]]={rows:[],o:null}),t[i[a]].rows.push(a);for(a=0;e.length>a;a++)null==s[e[a]]&&(s[e[a]]={rows:[],n:null}),s[e[a]].rows.push(a);for(a in t)1===t[a].rows.length&&void 0!==s[a]&&1===s[a].rows.length&&(i[t[a].rows[0]]={text:i[t[a].rows[0]],row:s[a].rows[0]},e[s[a].rows[0]]={text:e[s[a].rows[0]],row:t[a].rows[0]});for(a=0;i.length-1>a;a++)null!=i[a].text&&null==i[a+1].text&&i[a].row+1<e.length&&null==e[i[a].row+1].text&&i[a+1]==e[i[a].row+1]&&(i[a+1]={text:i[a+1],row:i[a].row+1},e[i[a].row+1]={text:e[i[a].row+1],row:a+1});for(a=i.length-1;a>0;a--)null!=i[a].text&&null==i[a-1].text&&i[a].row>0&&null==e[i[a].row-1].text&&i[a-1]==e[i[a].row-1]&&(i[a-1]={text:i[a-1],row:i[a].row-1},e[i[a].row-1]={text:e[i[a].row-1],row:a-1});return{o:e,n:i}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,i=this._documentResources,t=this._stylesheets;e=t.shift();)i.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){var e=this.requestAnimationFrame;if(e)this.requestedAnimationFrame=e.call(window,this._drawTree);else{var i=Date.now(),t=17-i+this._previousDrawDate;0>t&&(t=0),this.requestedAnimationFrame=setTimeout(this._drawTree,t),this._previousDrawDate=i+t}this._scheduleComposerRequest=!1}},enumerable:!1},_drawTree:{value:function(e){var i;if(this._needsStylesheetsDraw&&this.drawStylesheets(),!this._documentResources.areStylesLoaded)return c.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",this._documentResources._expectedStyles.length),this.requestedAnimationFrame=null,this.drawTree(),void 0;if(c.isDebug&&(i=window.performance?window.performance.now():Date.now()),this._frameTime=e?e:Date.now(),this._clearNeedsDrawTimeOut&&this._clearNeedsDrawList(),p.isDebug){var t=document.body.innerHTML;if(this._oldSource&&t!==this._oldSource){for(var s=["DOM modified outside of the draw loop"],a=this._diff(this._oldSource.split("\n"),t.split("\n")),u=0;a.n.length>u;u++)if(null==a.n[u].text)s.push("+ "+a.n[u]);else for(var n=a.n[u].row+1;a.o.length>n&&null==a.o[n].text;n++)s.push("- "+a.o[n]);console.warn(s.join("\n"))}console.group((e?p.toTimeString(new Date(e))+" ":"")+"Draw Fired")}if(this.drawIfNeeded(),c.isDebug){if(window.performance)var r=window.performance.now();else var r=Date.now();console.log("Draw Cycle Time: ",r-i,", Components: ",this._lastDrawComponentsCount)}p.isDebug&&(console.groupEnd(),this._oldSource=document.body.innerHTML),this._frameTime=null,this._scheduleComposerRequest&&this.drawTree()}},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var i=this._readyToDrawListIndex;return i.hasOwnProperty(e.uuid)?(p.isDebug&&this!==P&&p.debug(t(this)+" added to the draw cycle twice, this should not happen."),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},_sortByLevel:{value:function(e,i){return e._treeLevel-i._treeLevel}},drawIfNeeded:{value:function(){var e,i,s,a,u,n,r=this._readyToDrawList,l=0,o=this.composerList;if(r.length=0,n=o.length,this._readyToDrawListIndex.clear(),n>0){for(this.composerList=this.composerListSwap,i=0;n>i;i++)u=o[i],u.needsFrame=!1,u.frame(this._frameTime);o.splice(0,n),this.composerListSwap=o}for(this._drawIfNeeded(0),s=r.length,p.isDebug&&console.groupCollapsed("willDraw - "+r.length+(r.length>1?" components.":" component."));s>l;){for(i=l;s>i;i++)e=r[i],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),p.isDebug&&p.debug("Level "+e._treeLevel+" "+t(e));this._drawIfNeeded(0),l=s,s=r.length}for(p.isDebug&&(console.groupEnd(),console.group("draw - "+r.length+(r.length>1?" components.":" component."))),r.sort(this._sortByLevel),i=0;s>i;i++)e=r[i],e.needsDraw=!1;for(this.requestedAnimationFrame=null,i=s-1;i>=0;i--)e=r[i],e._draw(this._frameTime),e.draw(this._frameTime),p.isDebug&&p.debug("Level "+e._treeLevel+" "+t(e));for(p.isDebug&&(console.groupEnd(),console.groupCollapsed("didDraw - "+r.length+(r.length>1?" components.":" component."))),i=0;s>i;i++)e=r[i],e.didDraw(this._frameTime),"channelListItem"===e.identifier&&console.log("component %s completedFirstDraw %s",Object.hash(e),e._completedFirstDraw),e._completedFirstDraw||(a=document.createEvent("CustomEvent"),a.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(a),e._completedFirstDraw=!0),p.isDebug&&p.debug("Level "+e._treeLevel+" "+t(e));return p.isDebug&&console.groupEnd(),c.isDebug&&(this._lastDrawComponentsCount=r.length),!!r.length}},element:{get:function(){return this._element},set:function(e){v.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=n.getInstanceForDocument(e)}}}),P=(new _).init();i.__root__=P}}),montageDefine("3c07db4","core/target",{dependencies:["./core","./event/event-manager","./event/mutable-event"],factory:function(e,i){var t=e("./core").Montage,s=e("./event/event-manager").defaultEventManager,a=e("./event/mutable-event").MutableEvent;i.Target=t.specialize({constructor:{value:function(){this.super()}},acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===s.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var i=e;return e instanceof a||(i=a.fromEvent(i)),i.target=this,s.handleEvent(i),!e.defaultPrevented}},dispatchEventNamed:{value:function(e,i,t,u){var n=a.fromType(e,i,t,u);return n.target=this,s.handleEvent(n),!n.defaultPrevented}},addEventListener:{value:function(e,i,t){i&&s.registerEventListener(this,e,i,t)}},removeEventListener:{value:function(e,i,t){i&&s.unregisterEventListener(this,e,i,t)}}})}}),montageDefine("3c07db4","core/template",{dependencies:["./core","./serialization","./document-part","./document-resources","./serialization/serialization","./serialization/serializer/montage-labeler","./promise","./mini-url","./logger","./event/event-manager","./application"],factory:function(e,i){function t(e,i,t){var s,a,u=new d,r=e.documentElement.outerHTML,l=new n,o=e.documentElement;return s=u.createHtmlDocumentWithHtml(r,e.location.href),u.initWithDocument(s,i).then(function(){return u.setBaseUrl(e.location.href),a=u._createTemplateObjects(t),l.initWithTemplateAndFragment(u),u._instantiateObjects(a,o).then(function(e){return l.objects=e,u._invokeDelegates(l),l})})}var s,a=e("./core").Montage,u=e("./serialization").Deserializer,n=e("./document-part").DocumentPart,r=e("./document-resources").DocumentResources,l=e("./serialization/serialization").Serialization,o=e("./serialization/serializer/montage-labeler").MontageLabeler,c=e("./promise").Promise,m=e("./mini-url");e("./logger").logger("template"),e("./event/event-manager").defaultEventManager;var d=a.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,i,t=this.__deserializer;if(!t){if(e=this._metadata){i=Object.create(null);for(var s in e)i[s]=e[s].require}t=(new u).init(this.objectsString,this._require,i),this.__deserializer=t}return t}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},_isDirty:{value:!1},isDirty:{get:function(){return this._isDirty},set:function(e){this._isDirty!==e&&(this._isDirty=e,this.clearTemplateFromElementContentsCache())}},refresher:{value:null},_document:{value:null},document:{get:function(){return this._isDirty&&this.refresh(),this._document},set:function(e){this._document=e}},constructor:{value:function d(){this.super()}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,i){var t=this;return this._require=i,this.setDocument(e),this.getObjectsString(e).then(function(e){return t.objectsString=e,t})}},initWithHtml:{value:function(e,i){var t=this;return this._require=i,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return t.objectsString=e,t})}},initWithObjectsAndDocumentFragment:{value:function(e,i,t){return this._require=t,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(i,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,i){var t=this;return this._require=i,this.createHtmlDocumentWithModuleId(e,i).then(function(s){var a=i(e).directory;return t.document=s,t.setBaseUrl(a),t.getObjectsString(s).then(function(e){return t.objectsString=e,t})})}},clone:{value:function(){var e=new d;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,i){var t,s,a,u=this,r=new n;return e=e||this._instances,t=this._createMarkupDocumentFragment(i),a=this._getParameters(t),r.initWithTemplateAndFragment(this,t),r.startActingAsTopComponent(),r.parameters=a,s=this._createTemplateObjects(e),this._instantiateObjects(s,t).then(function(t){var s;return r.objects=t,u._invokeDelegates(r,e),r.stopActingAsTopComponent(),s=u.getResources(),!s.resourcesLoaded()&&s.hasResources()&&s.loadResources(i).done(),r})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,i=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){i._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new p,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(i){var t=Object.create(i||null);return void 0===s&&(s=e("./application").application),t.application=s,t.template=this,t}},_instantiateObjects:{value:function(e,i){var t,s=this._deserializer;return t=this._optimizeObjectsInstantiation(),t?t.then(function(){return s.deserialize(e,i)
}):s.deserialize(e,i)}},_createMarkupDocumentFragment:{value:function(e){for(var i=e.createDocumentFragment(),t=this.document.body.childNodes,s=0,a=t.length;a>s;s++)i.appendChild(e.importNode(t[s],!0));return i}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var i,t=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),s=t.length,a={},u=0;s>u;u++){i=t[u];var n=this.getParameterName(i);if(n in a)throw Error('The parameter "'+n+'" is'+" declared more than once in "+this.getBaseUrl()+".");a[n]=i}if("*"in a&&s>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(a)+".");return a}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,i){var t,s,a,u=e.objects,n=u.owner||i&&i.owner;for(var r in u)i&&r in i||(t=u[r],s=this._getObjectOwner(r,n),a=this._getObjectLabel(r),t&&("function"==typeof t._deserializedFromTemplate&&t._deserializedFromTemplate(s,a,e),"function"==typeof t.deserializedFromTemplate&&t.deserializedFromTemplate(s,a,e)));if(n){var l=this.getSerialization();l.isExternalObject("owner")||("function"==typeof n._templateDidLoad&&n._templateDidLoad(e),"function"==typeof n.templateDidLoad&&n.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,i,t,s){var a=this._metadata;a||(this._metadata=a=Object.create(null)),a[e]={require:i,label:t,owner:s},this.__deserializer=null}},getObjectMetadata:{value:function(e){var i=this._metadata;return i&&e in i?i[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,i){var t,s=this._metadata;return t=s&&e in s?s[e].owner:i}},_getObjectLabel:{value:function(e){var i,t=this._metadata;return i=t&&e in t?t[e].label:e}},setDocument:{value:function(e){var i=e.documentElement.innerHTML;this.document=this.createHtmlDocumentWithHtml(i,e.baseURI),this.clearTemplateFromElementContentsCache()}},getObjectsString:{value:function(e){var i;return i=this.getInlineObjectsString(e),null===i?this.getExternalObjectsString(e):c.resolve(i)}},getInlineObjectsString:{value:function(e){var i="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",t=e.querySelector(i);return t?t.textContent:null}},getExternalObjectsString:{value:function(e){var i,t,s,a=e.querySelector('link[rel="serialization"]');return a?(i=new XMLHttpRequest,t=a.getAttribute("href"),s=c.defer(),i.open("GET",t),i.addEventListener("load",function(){200==i.status?s.resolve(i.responseText):s.reject(Error("Unable to retrive '"+t+"', code status: "+i.status))},!1),i.addEventListener("error",function(e){s.reject(Error("Unable to retrive '"+t+"' with error: "+e.error+"."))},!1),i.send(),s.promise):c.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,i){var t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e,this.normalizeRelativeUrls(t,i),t}},createHtmlDocumentWithModuleId:{value:function(e,i){var t=this;return"function"!=typeof i?c.reject(Error("Missing 'require' function to load module '"+e+"'.")):i.async(e).then(function(e){return t.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var i="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(i),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,i){if(i){var t=e.createElement("script");t.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),t.textContent=JSON.stringify(JSON.parse(i),null,4),e.head.appendChild(t)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var i,t,s,a=this._templateFromElementContentsCache;return a||(a=Object.create(null),this._templateFromElementContentsCache=a),e in a?Object.create(a[e]):(i=this.getElementById(e),s=this.document.createRange(),s.selectNodeContents(i),t=this.createTemplateFromRange(s),a[e]=t,Object.create(t))}},createTemplateFromElement:{value:function(e){var i,t;return i=this.getElementById(e),t=this.document.createRange(),t.selectNode(i),this.createTemplateFromRange(t)}},createTemplateFromRange:{value:function(e){var i,t,s,a,u,n=new l;return i=e.cloneContents(),t=this._getChildrenElementIds(i),n.initWithString(this.objectsString),s=n.getSerializationLabelsWithElements(t),u=n.extractSerialization(s,["owner"]),a=new d,a.initWithObjectsAndDocumentFragment(null,i,this._require),a.objectsString=u.getSerializationString(),a._resources=this.getResources(),a}},_createSerializationWithElementIds:{value:function(e){var i,t,s=new l;return s.initWithString(this.objectsString),i=s.getSerializationLabelsWithElements(e),t=s.extractSerialization(i,["owner"])}},expandParameters:{value:function(e){var i,t,s,a,u,n,r,l=[],o={},c=this.getSerialization(),m={};i=this.getParameters();for(var d in i)if(a=i[d],u=e.getTemplateArgumentElement(d),l.push.apply(l,this._getElementIds(u)),t=this.replaceNode(u,a))for(var p in t)o[p]=t[p];return m.elementIds=l,m.elementIdsCollisions=o,n=e.getTemplateArgumentSerialization(l),n.renameElementReferences(o),r=function(i){return i.indexOf(":")>0?e.resolveTemplateArgumentTemplateProperty(i):void 0},s=c.mergeSerialization(n,{willMergeObjectWithLabel:r}),this.objectsString=c.getSerializationString(),m.labels=n.getSerializationLabels(),m.labelsCollisions=s,m}},_resolveElementIdCollisions:{value:function(e,i){var t,s,a,u,n;i=i||new o,a=this.getElementIds();for(var r,l=0;r=a[l];l++)i.addLabel(r);s=this._getElements(e);for(var r in s)this.getElementById(r)&&(u=s[r],n=i.generateLabel(i.getLabelBaseName(r)),this.setElementId(u,n),t||(t=Object.create(null)),t[r]=n);return t}},replaceNode:{value:function(e,i,t){var s;return s=this._resolveElementIdCollisions(e,t),this.normalizeRelativeUrls(e,this.getBaseUrl()),i.parentNode.replaceChild(e,i),s}},insertNodeBefore:{value:function(e,i,t){var s;return s=this._resolveElementIdCollisions(e,t),this.normalizeRelativeUrls(e,this.getBaseUrl()),i.parentNode.insertBefore(e,i),s}},appendNode:{value:function(e,i,t){var s;return s=this._resolveElementIdCollisions(e,t),this.normalizeRelativeUrls(e,this.getBaseUrl()),i.appendChild(e),s}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,i){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,i)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var i,t,s="*["+this._ELEMENT_ID_ATTRIBUTE+"]",a={};i=e.querySelectorAll(s);for(var u,n=0;u=i[n];n++)t=this.getElementId(u),a[t]=u;return t=this.getElementId(e),t&&(a[t]=e),a}},_getChildrenElementIds:{value:function(e){var i,t="*["+this._ELEMENT_ID_ATTRIBUTE+"]",s=[];i=e.querySelectorAll(t);for(var a,u=0;a=i[u];u++)s.push(this.getElementId(a));return s}},_getElementIds:{value:function(e){var i,t=this._getChildrenElementIds(e);return i=this.getElementId(e),i&&t.push(i),t}},getElementById:{value:function(e){var i="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(i)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,i){if("string"==typeof i&&""!==i&&"about:blank"!==i)for(var t="http://www.w3.org/1999/xlink",s=/^[\w\-]+:|^\//,a=-1!==d._NORMALIZED_TAG_NAMES.indexOf(e.tagName)?[e]:e.querySelectorAll(d._NORMALIZED_TAG_NAMES_SELECTOR),u=0,n=a.length;n>u;u++){var r,l=a[u];"image"===l.tagName?(r=l.getAttributeNS(t,"href"),s.test(r)||l.setAttributeNS(t,"href",m.resolve(i,r))):l.hasAttribute("src")?(r=l.getAttribute("src"),""===r||s.test(r)||l.setAttribute("src",m.resolve(i,r))):l.hasAttribute("href")&&(r=l.getAttribute("href"),""===r||s.test(r)||l.setAttribute("href",m.resolve(i,r)))}}},replaceContentsWithTemplate:{value:function(e){this._require=e._require,this._baseUrl=e._baseUrl,this._document=e._document,this.objectsString=e.objectsString,this._instances=e._instances,this._templateFromElementContentsCache=e._templateFromElementContentsCache,this._metadata=e._metadata}},refresh:{value:function(){this.isDirty&&(this.refresher&&"function"==typeof this.refresher.refreshTemplate?(this.refresher.refreshTemplate(this),this.isDirty=!1):console.warn("Not able to refresh without a refresher.refreshTemplate."))}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,i){return e=i.resolve(e),i.location+"#"+e}},getTemplateWithModuleId:{value:function(e,i){var t,s;return t=this._getTemplateCacheKey(e,i),s=this._templateCache.moduleId[t],s||(s=(new d).initWithModuleId(e,i),this._templateCache.moduleId[t]=s),s}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME","link"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}}),p=a.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function p(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,c.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,i,t,s=this._resources.scripts;if(!s){i=this.template,s=this._resources.scripts=[],t=i.document.querySelectorAll("script");for(var a=0,u=t.length;u>a;a++)e=t[a],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&s.push(e)}return s}},loadScripts:{value:function(e){var i,t=[];i=this.getScripts();for(var s=0,a=i.length;a>s;s++)t.push(this.loadScript(i[s],e));return c.all(t)}},loadScript:{value:function(e,i){var t,s;return t=r.getInstanceForDocument(i),s=this._cloneScriptElement(e,i),t.addScript(s)}},_cloneScriptElement:{value:function(e,i){for(var t,s=i.createElement("script"),a=e.attributes,u=0,n=a.length;n>u;u++)t=a[u],s.setAttribute(t.name,t.value);return s}},getStyles:{value:function(){var e,i,t,s=this._resources.styles;return s||(t='link[rel="stylesheet"], style',e=this.template,i=e.document.querySelectorAll(t),s=Array.prototype.slice.call(i,0),this._resources.styles=s),s}},loadStyles:{value:function(e){var i,t=[];i=this.getStyles();for(var s=0,a=i.length;a>s;s++)t.push(this.loadStyle(i[s],e));return c.all(t)}},loadStyle:{value:function(e,i){var t,s;return t=e.getAttribute("href"),t?(s=r.getInstanceForDocument(i),s.preloadResource(t)):c.resolve()}},createStylesForDocument:{value:function(e){for(var i,t,s=this.getStyles(),a=[],u=0;t=s[u];u++)i=e.importNode(t,!0),a.push(i);return a}}}),v=a.specialize({getTemplateArgumentElement:{value:function(){}},getTemplateArgumentSerialization:{value:function(){}},resolveTemplateArgumentTemplateProperty:{value:function(){}}});i.Template=d,i.TemplateArgumentProvider=v,i.TemplateResources=p,i.instantiateDocument=t}}),montageDefine("3c07db4","core/document-resources",{dependencies:["./core","./promise","./mini-url"],factory:function(e,i){var t=e("./core").Montage,s=e("./promise").Promise,a=e("./mini-url"),u=t.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function u(){this.super(),this._expectedStyles=[]}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this._populateWithDocument(e),this}},_populateWithDocument:{value:function(e){var i=e.querySelectorAll("script"),t=Array.prototype.forEach;t.call(i,function(e){e.src&&this._addResource(this.normalizeUrl(e.src))},this);var s=e.querySelectorAll("link");t.call(s,function(e){"stylesheet"===e.rel&&this._addResource(this.normalizeUrl(e.href))},this)}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return s.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,i){this._preloaded[e]=i}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var i=this.normalizeUrl(e.src);return i?this.isResourcePreloaded(i)?s.resolve():this.isResourcePreloading(i)?this.getResourcePreloadedPromise(i):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var i,t,a=this,u=this._document,n=u.head,r=s.defer(),l=e.src;return l?(a._addResource(l),i=function(){a.setResourcePreloaded(l),e.removeEventListener("load",i),e.removeEventListener("error",i),clearTimeout(t),r.resolve()},e.addEventListener("load",i,!1),e.addEventListener("error",i,!1),t=setTimeout(function(){a.setResourcePreloaded(l),r.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,r.promise)):r.resolve(),n.appendChild(u.createComment("Inserted from FIXME")),n.appendChild(e),r.promise}},addStyle:{value:function(e){var i,t=e.getAttribute("href");if(t){if(t=this.normalizeUrl(t),this.hasResource(t))return;this._addResource(t),this._expectedStyles.push(t)}i=this._document.head,i.insertBefore(e,i.firstChild)}},normalizeUrl:{value:function(e,i){return i||(i=this._document.location.href),a.resolve(i,e)}},domain:{value:window.location.protocol+"//"+window.location.host},isCrossDomain:{value:function(e){return 0!==e.indexOf(this.domain+"/")||0===e.indexOf("file://")}},preloadResource:{value:function(e,i){var t;return e=this.normalizeUrl(e),!i&&this.isCrossDomain(e)&&(t=!0),t||this.isResourcePreloaded(e)?s.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var i,t,a=this,u=new XMLHttpRequest,n=s.defer();return u.open("GET",e),i=function(){a.setResourcePreloaded(e),u.removeEventListener("load",i),u.removeEventListener("error",i),clearTimeout(t),n.resolve()},u.addEventListener("load",i,!1),u.addEventListener("error",i,!1),u.send(),t=setTimeout(function(){a.setResourcePreloaded(e),n.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,n.promise),n.promise}},areStylesLoaded:{get:function(){var e,i;if(this._expectedStyles.length>0){e=this._document.styleSheets;for(var t,s=0;t=e[s];s++)i=this._expectedStyles.indexOf(t.href),i>=0&&this._expectedStyles.splice(i,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var i=e.__montage_resources__;return i||(i=e.__montage_resources__=(new u).initWithDocument(e)),i}}});i.DocumentResources=u}}),montageDefine("3c07db4","core/gate",{dependencies:["./core","./logger"],factory:function(e,i){var t=e("./core").Montage,s=e("./logger").logger("gate");i.Gate=t.specialize({constructor:{value:function(){this.super()}},init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var i;this.reset();for(i in e)this.setField(i,e[i].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var i=this.table;return!i||i[e]}},setField:{enumerable:!1,value:function(e,i){var t,a=this.table,u=this.count;a=a?a:this.table={},t=a[e],void 0!==t||i?void 0!==t&&t!==i?i?this.count--:this.count++:i&&s.isDebug&&s.debug(this,e+" was not set before."):this.count++,a[e]=!!i,0===this.count&&u>0?this.callDelegateMethod(!0):0===u&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var i=this.table,t=i[e];void 0===t||t||this.count--,delete i[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var i;this.delegate&&"function"==typeof(i=this.delegate["gateDidBecome"+(e?"True":"False")])&&i.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,i,t=this._fields,s="";for(e=0;i=t[e];e++)s+=i+"["+(this._value&t[i])+"], ";return s}}})}}),montageDefine("3c07db4","core/application",{dependencies:["./core","./target","../window-loader/montage-window","./dom","./template"],factory:function(e,i){var t,s=(e("./core").Montage,e("./target").Target),a=e("../window-loader/montage-window").MontageWindow;e("./dom"),i.Application=s.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){var e;if(null==this.parentApplication){if(!this._windows){var e=new a;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new a;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,i=this.windowsSortOrder;if("z-order"==i)return e[0];if("reverse-z-order"==i)return e[e.length-1];for(var t in e)if(e[t].focused)return e[t]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,i,t){var s,u,n=this,r=new a,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},o={module:e,name:i,parent:window,callback:function(e,i){var t;s=e.document.application,r.window=e,r.application=s,r.component=i,s.window=r,n.attachedWindows.push(r),t=n.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?n.windows.unshift(r):n.windows.push(r),u=document.createEvent("CustomEvent"),u.initCustomEvent("load",!0,!0,null),r.dispatchEvent(u)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof t){var c,m,d="",p="";for(c in t)t.hasOwnProperty(c)&&(l[c]=t[c])}var v=["name"];for(c in l)-1==v.indexOf(c)&&(m=l[c],"boolean"==typeof m?m=m?"yes":"no":(m+="",m.match(/[ ,"]/)&&(m='"'+m.replace(/"/g,'\\"')+'"')),p+=d+c+"="+m,d=",");return window.require.loadPackage({name:"montage"}).then(function(e){var i=window.open(e.location+"window-loader/index.html","_blank",p);i.loadInfo=o}).done(),r}},attachWindow:{value:function(e){var i,t=e.application.parentApplication;return t!==this&&(t&&t.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),i=this.mainApplication.windowsSortOrder,"z-order"==i||"reverse-open-order"==i?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var i,t,s=this.windows;return void 0===e&&(e=this.window),t=e.application.parentApplication,t==this?(i=this.attachedWindows.indexOf(e),-1!==i&&this.attachedWindows.splice(i,1),i=s.indexOf(e),-1!==i&&s.splice(i,1),e.application.parentApplication=null):t&&t.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(t,s){var a,u=this;i.application=u,e.async("ui/component").then(function(i){return a=i.__root__,a.element=document,e("./template").instantiateDocument(window.document,t).then(function(){u.callDelegateMethod("willFinishLoading",u),a.needsDraw=!0,s&&s(u)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var i=document.createElement("div");document.body.appendChild(i),i.style.zIndex=e,i.style.position="absolute";var s=new t;return s.element=i,s.attachToParentComponent(),s}},getPopupSlot:{value:function(i,s,a){var u=this;e.async("ui/slot.reel/slot").then(function(e){t=t||e.Slot,i=i||"custom";var n,r,l=u._isSystemPopup(i);if(u.popupSlots=u.popupSlots||{},l)switch(i){case"alert":n=9004;break;case"confirm":n=9003;break;case"notify":n=9002}else u._zIndex=u._zIndex?u._zIndex+1:7e3,n=u._zIndex;r=u.popupSlots[i],r||(r=u.popupSlots[i]=u._createPopupSlot(n)),l||(r.element.style.zIndex=n),r.content=s,a.call(this,r)}).done()}},returnPopupSlot:{value:function(e){var i=this;if(i.popupSlots&&i.popupSlots[e]){var t=i.popupSlots[e];t.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var i=Object.keys(this.popupSlots);if(i&&i.length>0){var t,s=0,a=i.length;for(s=0;a>s;s++)t=this.popupSlots[i[s]],t&&null!==t.content&&e.push(t)}}return e}}})}}),montageDefine("3c07db4","core/document-part",{dependencies:["./core","./logger","./promise","./event/event-manager"],factory:function(e,i){var t=e("./core").Montage,s=(e("./logger").logger("document-part"),e("./promise").Promise),a=e("./event/event-manager").defaultEventManager,u=t.specialize({parentDocumentPart:{value:null},template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},constructor:{value:function u(){this.super()}},initWithTemplateAndFragment:{value:function(e,i){this.template=e,this.fragment=i,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&a.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&a.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var i=this.childComponents,t=i.indexOf(e);t>-1&&(i.splice(t,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:function(){}},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,i=this._componentTreeLoadedDeferred;return i||(i=s.defer(),this._componentTreeLoadedDeferred=i,e=[],this.childComponents.forEach(function(i){e.push(i.loadComponentTree())}),s.all(e).then(function(){i.resolve()},i.reject).done()),i.promise}}});i.DocumentPart=u}}),montageDefine("3c07db4","core/serialization/serialization",{dependencies:["../core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,i){var t=e("../core").Montage,s=e("./serializer/montage-labeler").MontageLabeler,a=e("./deserializer/montage-reviver").MontageReviver,u=e("frb/parse"),n=e("frb/stringify"),r=t.specialize({_serializationString:{value:null},_serializationObject:{value:null},_serializationLabels:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this._serializationLabels=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this._serializationLabels=null,this}},clone:{value:function(){var e=new r;return e.initWithString(this.getSerializationString()),e}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e;return this._serializationLabels||(e=this.getSerializationObject())&&(this._serializationLabels=Object.keys(e)),this._serializationLabels}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),i=[];for(var t in e)0===Object.keys(e[t]).length&&i.push(t);return i}},hasSerializationLabel:{value:function(e){return e in this.getSerializationObject()}},isExternalObject:{value:function(e){var i=this.getSerializationObject();return i&&e in i?0===Object.keys(i[e]).length:!1}},isAlias:{value:function(e){var i=this.getSerializationObject();return i&&e in i?"alias"in i[e]:!1}},getElementId:{value:function(e){var i=this.getSerializationObject(),s=t.getPath.call(i,e+".properties.element");return s?s["#"]:void 0}},getSerializationLabelsWithElements:{value:function(e){var i=new o,t=[];return i.initWithSerialization(this),i.visitSerialization(function(i){"Element"===i.type&&e.indexOf(i.data)>=0&&(i=i.parent,i&&"properties"===i.name&&(i=i.parent,i&&"montageObject"===i.type&&t.push(i.label)))}),t}},renameElementReferences:{value:function(e){var i=new o;i.initWithSerialization(this),i.visitSerialization(function(i){"Element"===i.type&&i.data in e&&(i.data=e[i.data])})}},renameSerializationLabels:{value:function(e){var i=new o;i.initWithSerialization(this),i.visitSerialization(function(i){if(i.label){var t=i.label;t in e&&(i.label=e[t])}if("reference"===i.type){var s=i.data;s in e&&(i.data=e[s])}})}},mergeSerialization:{value:function(e,i){return l.mergeSerializations(this,e,i)}},extractSerialization:{value:function(e,i){var t=new c;return t.initWithSerialization(this),t.extractSerialization(e,i)}}}),l=t.specialize(null,{mergeSerializations:{value:function(e,i,t){var s,a,u,n,r,l,o={};u=e.getSerializationLabels(),n=i.getSerializationLabels(),r=this._createCollisionTable(u,n,o,t&&t.labeler),t&&t.willMergeObjectWithLabel&&(l=this._willMergeObjectWithLabel(t,e,i,o),r=r||l),r&&(i=i.clone(),i.renameSerializationLabels(o),n=i.getSerializationLabels()),s=e.getSerializationObject(),a=i.getSerializationObject();for(var c,m=0;c=n[m];m++)-1===u.indexOf(c)&&(s[c]=a[c]);return e.initWithObject(s),o}},_willMergeObjectWithLabel:{value:function(e,i,t,s){var a,u,n,r,l,o=!1,c=t.getSerializationLabels();s&&(n=[],Object.keys(s).forEach(function(e){n.push(s[e])}));for(var m,d=0;m=c[d];d++)if(u=s&&s[m],a=e.willMergeObjectWithLabel(m,u),"string"==typeof a){if(r=this._isLabelValidInSerialization(a,i),r||(l=!this._isLabelValidInSerialization(a,t)&&-1===n.indexOf(a)),!r&&!l)throw Error("willMergeObjectWithLabel either needs to return a label that exists in the destination serialization to indicate it's the same object or return a completely new label to rename the object being merged. \""+a+'"  destination: '+i.getSerializationString()+"\n source: "+t.getSerializationString()+"\n collision table: "+JSON.stringify(s,null,4));o=!0,s[m]=a}return o}},_isLabelValidInSerialization:{value:function(e,i){var t,s;return i.hasSerializationLabel(e)?!0:(s=e.indexOf(":"),s>0&&(t=e.slice(0,s),i.hasSerializationLabel(t))?!0:!1)}},_createCollisionTable:{value:function(e,i,t,a){for(var u,n,r,l,a=a||new s,o=!1,c=Object.create(null),m=0;e.length>m;m++)r=e[m],l=r.indexOf(":"),l>0&&(u=r.slice(0,l),a.addLabel(u),c[u]=1),a.addLabel(r),c[r]=1;for(var m=0;r=i[m];m++)l=r.indexOf(":"),l>0?(u=r.slice(0,l),n=t[u],n?(t[r]=n+":"+r.slice(l+1),o=!0):u in c?(n=a.generateLabel(a.getLabelBaseName(u)),i.indexOf(u)>=0&&(t[u]=n),t[r]=n+r.slice(l),o=!0):a.addLabel(u)):r in c&&!(r in t)?(t[r]=a.generateLabel(a.getLabelBaseName(r)),o=!0):a.addLabel(r);return o}}}),o=t.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var i=this._serialization.getSerializationObject();this._walkRootObjects(e,i),this._serialization.initWithObject(i)}},visitSerializationObject:{value:function(e,i){var t=this._serialization.getSerializationObject();if(!(e in t))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(i,t,e),this._serialization.initWithObject(t)}},changeLabel:{value:function(e,i){var t,s=this._serialization.getSerializationObject();t=s[e],delete s[e],s[i]=t}},_walkRootObjects:{value:function(e,i){for(var t in i)this._walkRootObject(e,i,t)}},_walkRootObject:{value:function(e,i,t){var s=i[t];"value"in s?this._walkObject(e,s,"value",t):this._walkCustomObject(e,i,t)}},_walkObject:{value:function(e,i,t,s,u){var n,r=i[t],l=a.getTypeOf(r);if(n={type:l},s?n.label=s:n.name=t,u&&(n.parent=u),"number"===l||"string"===l||"null"===l)n.data=r,e(n),i[t]=n.data;else if("regexp"===l)n.data=r["/"],e(n),r["/"]=n.data;else if("reference"===l)n.data=r["@"],e(n),r["@"]=n.data;else if("Element"===l)n.data=r["#"],e(n),r["#"]=n.data;else if("array"===l){n.data=r,e(n),i[t]=r=n.data;for(var o=0,c=r.length;c>o;o++)this._walkObject(e,r,""+o,null,n)}else if("object"===l){n.data=r,e(n),i[t]=r=n.data;for(var t in r)this._walkObject(e,r,t,null,n)}n.label!=s&&this.changeLabel(s,n.label)}},_walkCustomObject:{value:function(e,i,t){var s,a=i[t];s={type:"montageObject",label:t,data:a},e(s),i[t]=a=s.data,s.label!=t&&this.changeLabel(t,s.label),a.properties&&this._walkObject(e,a,"properties",null,s),a.listeners&&this._walkObject(e,a,"listeners",null,s),a.bindings&&this._walkBindings(e,a,null,s),a.localizations&&this._walkLocalizations(e,a,null,s)}},_walkBindings:{value:function(e,i,t){var s,a=i.bindings;s={type:"bindings",data:a,parent:t},e(s),i.bindings=a=s.data;for(var u in a)this._walkBinding(e,a,u,s)}},_walkBinding:{value:function(e,i,t,s){var a,u=i[t];a={type:"binding",name:t,data:u,parent:s},e(a),i[t]=u=a.data,this._walkBindingData(e,u,a)}},_walkBindingData:{value:function(e,i,t){var s,a,r=!1;s=i["<-"]||i["<->"],a=u(s),this._walksBindingReferences(a,function(i){var t={type:"reference",data:i.label};e(t),i.label!==t.data&&(i.label=t.data,r=!0)}),r&&("<-"in i?i["<-"]=n(a):i["<->"]=n(a)),i.converter&&this._walkObject(e,i,"converter",null,t)}},_walkLocalizations:{value:function(e,i,t){var s,a=i.localizations;s={type:"localizations",data:a,parent:t},e(s),i.localizations=a=s.data;for(var u in a)this._walkLocalization(e,a,u,s)}},_walkLocalization:{value:function(e,i,t,s){var a,u,n=i[t];if(a={type:"localization",name:t,data:n,parent:s},e(a),i[t]=n=a.data,"object"==typeof n.key&&this._walkBindingData(e,n.key,a),"object"==typeof n.default&&this._walkBindingData(e,n.default,a),"object"==typeof n.data){u=n.data;for(var t in u)this._walkBindingData(e,u[t],a)}}},_walksBindingReferences:{value:function(e,i){var t=e.args;if("component"===e.type&&i(e),t)for(var s=0,a=t.length;a>s;s++)this._walksBindingReferences(t[s],i)}}}),c=t.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,i){var t,s=new o,a={},u=[];t=this._serialization.getSerializationObject(),s.initWithSerialization(this._serialization);for(var n,l=0;n=e[l];l++)a[n]=t[n],s.visitSerializationObject(n,function(i){var t;"reference"===i.type&&(t=i.data,-1===u.indexOf(t)&&-1===e.indexOf(t)&&u.push(t))});if(i)for(var n,l=0;n=i[l];l++)n in t&&!(n in a)&&(a[n]={});for(var n,l=0;n=u[l];l++)a[n]={};return(new r).initWithObject(a)}}});i.Serialization=r,i.SerializationMerger=l,i.SerializationInspector=o,i.SerializationExtractor=c
}}),montageDefine("3c07db4","window-loader/montage-window",{dependencies:["../core/core"],factory:function(e,i){var t=e("../core/core").Montage;i.MontageWindow=t.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var i=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===i.getAttribute("tabIndex")&&(i.setAttribute("tabIndex",-1),i.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var i,t,s,a=this.application;if(a._multipleWindow){i=a.windows;for(s in i)t=i[s],t.window===e?t.focused!==!0&&(t.focused=!0,"z-order"==a.windowsSortOrder?(i.splice(s,1),i.unshift(t)):"reverse-z-order"==a.windowsSortOrder&&(i.splice(s,1),i.push(t))):t.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,i){this._window&&this._window.resizeTo(e,i)}},moveTo:{value:function(e,i){this._window&&this._window.moveTo(e,i)}},captureFocus:{value:function(e){var i=this.application;if(!this.application)return this.focused=!0,void 0;if(i.parentApplication)i.mainApplication.window.captureFocus(e);else{var t=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(t)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,i=this.application,t=i.windows,s=i.attachedWindows;i.attachedWindows=[];for(var e in s)s[e].close();i.parentApplication&&(s=i.parentApplication.attachedWindows,e=s.indexOf(this),-1!==e&&s.splice(e,1),e=t.indexOf(this),-1!==e&&t.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("3c07db4","core/dom",{dependencies:["./geometry/point"],factory:function(e,i){var t=e("./geometry/point").Point,s=Node.prototype,a=Element.prototype;Object.defineProperty(a,"set",{value:function(e,i,t){var s,a,u,n,r,l=e.indexOf(".",t);t=t||0,a=e.substring(t,-1===l?e.length:l),-1===l?this.setAttribute(a,i):(u=e.lastIndexOf("."),"style"===a?(n=e.substring(l+1,e.length),this.style[n]=i):"classList"===a?(r=e.substring(l+1,e.length),i?this.classList.add(r):this.classList.remove(r)):(s=this.get(e.substring(0,u)))&&(s[e.substring(u+1,e.length)]=i))},enumerable:!1}),s.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,i){var t,s;if(null==(t=document.styleSheets[0])){var a=document.createElement("style");a.type="text/css",document.head.appendChild(a),t=document.styleSheets[0]}else s=document.getRule(e,t);s||t.insertRule(e+" "+i,t.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,i){var t;if(i.cssRules)for(var s=0;t=i.cssRules[s];s++){if(t.name&&t.name===e)return t;if(t.selectorText===e)return t}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var i=/^\s+|\s+$/g,t=function(e,i){e.setAttribute("class",i.join(" "))},s=function(e,i){if(""===i)throw"SYNTAX_ERR";if(/\s/.test(i))throw"INVALID_CHARACTER_ERR";return e.indexOf(i)},a=function(){var e=this,a=e.getAttribute("class")||"";return a=a.replace(i,"").split(/\s+/),{length:a.length,item:function(e){return a[e]||null},contains:function(e){return-1!==s(a,e)},add:function(i){-1===s(a,i)&&(a.push(i),this.length=a.length,t(e,a))},remove:function(i){var u=s(a,i);-1!==u&&(a.splice(u,1),this.length=a.length,t(e,a))},toggle:function(e){-1===s(a,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:a,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,a)}}(),s.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var u=function(e){var i,t,s,a,u=e.ownerDocument;if(e&&u){if(t=u.documentElement,s=u.body,a=u.defaultView,e!==s){if(i=e.getBoundingClientRect(),t.parentOf(e)){var n=t.clientTop||s.clientTop||0,r=t.clientLeft||s.clientLeft||0,l=a.pageYOffset||t.scrollTop||s.scrollTop,o=a.pageXOffset||t.scrollLeft||s.scrollLeft,c=i.top+l-n,m=i.left+o-r;return{top:c,left:m}}return{top:i.top,left:i.left}}return{top:s.offsetTop,left:s.offsetLeft}}return null},n=null;try{n=new WebKitPoint(0,0)}catch(r){}var l=function(){i.convertPointFromNodeToPage=function(e,i){return i?(n.x=i.x,n.y=i.y):(n.x=0,n.y=0),i=webkitConvertPointFromNodeToPage(e,n),i?(new t).init(i.x,i.y):null},i.convertPointFromPageToNode=function(e,i){return i?(n.x=i.x,n.y=i.y):(n.x=0,n.y=0),i=webkitConvertPointFromPageToNode(e,n),i?(new t).init(i.x,i.y):null}},o=function(){i.convertPointFromNodeToPage=function(e,i){if(!e||void 0!==e.x)return null;var s;return(s=u(e))?(new t).init((i?i.x:0)+s.left,(i?i.y:0)+s.top):(new t).init(i?i.x:0,i?i.y:0)},i.convertPointFromPageToNode=function(e,i){if(!e||void 0!==e.x)return null;var s;return(s=u(e))?(new t).init((i?i.x:0)-s.left,(i?i.y:0)-s.top):(new t).init(i?i.x:0,i?i.y:0)}};n?l():o()}}),montageDefine("3c07db4","core/geometry/point",{dependencies:["../core"],factory:function(e,i){var t=e("../core").Montage;i.Point=t.specialize({init:{enumerable:!1,value:function(e,i){return this.x=null===e?0:e,this.y=null===i?0:i,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,t,s,a){var u,n;return u=t.x+(s.x-t.x)*e,n=t.y+(s.y-t.y)*e,a>0&&(u=Math.round(u*a)/a,n=Math.round(n*a)/a),(new i.Point).init(u,n)}}})}}),montageDefine("8cd1986","deserialization/reviver",{dependencies:["q"],factory:function(e,i){(function(i){function t(){}function s(e){var i=t.prototype.getCustomObjectTypeOf;return function(t){return e(t)||i(t)}}var a=function(){return this}(),u=e("q");Object.defineProperties(t.prototype,{_createAssignValueFunction:{value:function(e,i){return function(t){e[i]=t}}},getTypeOf:{value:function(e){var i=typeof e;return null===e?"null":Array.isArray(e)?"array":"object"===i&&1===Object.keys(e).length?"@"in e?"reference":"/"in e?"regexp":"object":i}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(e,i,t){var s;return e.debugger,"value"in e?i.hasUserObject(t)?(s=i.getUserObject(t),i.setObjectLabel(s,t),s):this.reviveValue(e.value,i,t):0===Object.keys(e).length?i.hasUserObject(t)?(s=i.getUserObject(t),i.setObjectLabel(s,t),s):this.reviveExternalObject(e,i,t):this.reviveCustomObject(e,i,t)}},reviveValue:{value:function(e,i,t){var s=this.getTypeOf(e);return"string"===s||"number"===s||"boolean"===s||"null"===s||"undefined"===s?this.reviveNativeValue(e,i,t):"regexp"===s?this.reviveRegExp(e,i,t):"reference"===s?this.reviveObjectReference(e,i,t):"array"===s?this.reviveArray(e,i,t):"object"===s?this.reviveObjectLiteral(e,i,t):this._callReviveMethod("revive"+s,e,i,t)}},reviveNativeValue:{value:function(e,i,t){return t&&i.setObjectLabel(e,t),e}},reviveObjectLiteral:{value:function(e,i,t){var s,a=[];t&&i.setObjectLabel(e,t);for(var n in e)s=this.reviveValue(e[n],i),u.isPromise(s)?a.push(s.then(this._createAssignValueFunction(e,n))):e[n]=s;return 0===a.length?e:u.all(a).then(function(){return e})}},reviveRegExp:{value:function(e,i,t){var e=e["/"],s=RegExp(e.source,e.flags);return t&&i.setObjectLabel(s,t),s}},reviveObjectReference:{value:function(e,i){var e=e["@"],t=i.getObject(e);return t}},reviveArray:{value:function(e,i,t){var s,a=[];t&&i.setObjectLabel(e,t);for(var n=0,r=e.length;r>n;n++)s=this.reviveValue(e[n],i),u.isPromise(s)?a.push(s.then(this._createAssignValueFunction(e,n))):e[n]=s;return 0===a.length?e:u.all(a).then(function(){return e})}},reviveCustomObject:{value:function(e,i,t){var s=this.getCustomObjectTypeOf(e),r=n["revive"+s];return s?r.call(a,e,i,t):u.reject(Error("Object's type is unknown: "+JSON.stringify(e)))}},reviveExternalObject:{value:function(e,i,t){return u.reject(Error("External object '"+t+"' not found in user objects."))}},_callReviveMethod:{value:function(e,i,t,s){return this[e](i,t,s)}}});var n=Object.create(null);t.addCustomObjectReviver=function(e){for(var i in e)if("getTypeOf"!==i&&"function"==typeof e[i]&&/^revive/.test(i)){if(void 0!==n[i])return Error("Reviver '"+i+"' is already registered.");n[i]=e[i].bind(e)}this.prototype.getCustomObjectTypeOf=s(e.getTypeOf)},t.resetCustomObjectRevivers=function(){n=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},i.Reviver=t})(i),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}}),montageDefine("8cd1986","serialization/malker",{dependencies:[],factory:function(e,i){(function(e){function i(e){this._visitHandler=e,this._enteredObjects={}}Object.defineProperties(i.prototype,{_visitHandler:{value:null,writable:!0},_enteredObjects:{value:null,writable:!0},_isObjectEntered:{value:function(e){return Object.hash(e)in this._enteredObjects}},_markObjectAsEntered:{value:function(e){this._enteredObjects[Object.hash(e)]=!0}},visit:{value:function(e,i){this._visitValue(e,i)},enumerable:!0},_getTypeOf:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":null===e?"null":"object"==typeof e||"function"==typeof e?this._getObjectType(e):typeof e}},_getObjectType:{value:function(e){var i,t=this._visitHandler;return"function"==typeof t.getTypeOf&&(i=t.getTypeOf(e)),void 0===i?typeof e:i}},_visitValue:{value:function(e,i){var t=this._getTypeOf(e);"object"===t?this._visitObject(e,i):"array"===t?this._visitArray(e,i):"regexp"===t?this._visitRegExp(e,i):"number"===t?this._visitNumber(e,i):"string"===t?this._visitString(e,i):"boolean"===t?this._visitBoolean(e,i):"null"===t?this._visitNull(i):"undefined"===t?this._visitUndefined(i):this._visitCustomType(t,e,i)}},_visitCustomType:{value:function(e,i,t){this._callVisitorMethod("visit"+e,i,t)}},_enterCustomObject:{value:function(e,i,t){this._callVisitorMethod("enter"+e,i,t),this._callVisitorMethod("exit"+e,i,t)}},_visitObject:{value:function(e,i){var t;this._isObjectEntered(e)?this._callVisitorMethod("visitObject",e,i):(t=this._callVisitorMethod("willEnterObject",e,i),t!==!1&&(this._markObjectAsEntered(e),this._enterObject(e,i)))}},_enterObject:{value:function(e,i){var t,s=Object.keys(e);this._callVisitorMethod("enterObject",e,i);for(var a=0,u=s.length;u>a;a++)t=s[a],this._visitValue(e[t],t);this._callVisitorMethod("exitObject",e,i)}},_visitArray:{value:function(e,i){var t;this._isObjectEntered(e)?this._callVisitorMethod("visitArray",e,i):(t=this._callVisitorMethod("willEnterArray",e,i),t!==!1&&(this._markObjectAsEntered(e),this._enterArray(e,i)))}},_enterArray:{value:function(e,i){this._callVisitorMethod("enterArray",e,i);for(var t=0,s=e.length;s>t;t++)this._visitValue(e[t],""+t);this._callVisitorMethod("exitArray",e,i)}},_visitRegExp:{value:function(e,i){this._callVisitorMethod("visitRegExp",e,i)}},_visitString:{value:function(e,i){this._callVisitorMethod("visitString",e,i)}},_visitNumber:{value:function(e,i){this._callVisitorMethod("visitNumber",e,i)}},_visitBoolean:{value:function(e,i){this._callVisitorMethod("visitBoolean",e,i)}},_visitNull:{value:function(e){this._callVisitorMethod("visitNull",e)}},_visitUndefined:{value:function(e){this._callVisitorMethod("visitUndefined",e)}},_callVisitorMethod:{value:function(e){var i,t=this._visitHandler;return"function"==typeof t[e]?(i=Array.prototype.slice.call(arguments,1),i.unshift(this),t[e].apply(t,i)):void 0}}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),RegExp.isRegExp||(RegExp.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}),e.Malker=i,e.visit=function(e,t){var s=new i(t);s.visit(e)}})(i)}}),montageDefine("8cd1986","serialization/serializer",{dependencies:["./malker","./builder","./labeler","./visitor"],factory:function(e,i){(function(i){function t(){var e;this._builder=new a,this._labeler=new u,e=new n(this._builder,this._labeler),this._malker=new s(e)}var s=e("./malker").Malker,a=e("./builder").Builder,u=e("./labeler").Labeler,n=e("./visitor").Visitor;Object.defineProperties(t.prototype,{_labeler:{value:null,writable:!0},_builder:{value:null,writable:!0},_serializationIndentation:{value:2,writable:!0},_malker:{value:null,writable:!0},setSerializationIndentation:{value:function(e){this._serializationIndentation=e}},serialize:{value:function(e){var i;this._labeler.initWithObjects(e);for(var t in e)this._malker.visit(e[t]);return i=this._formatSerialization(this._builder.getSerialization(this._serializationIndentation))}},serializeObject:{value:function(e){return this.serialize({root:e})}},_formatSerializationBindingsRegExp:{value:/\{\s*("(?:<->?)")\s*:\s*("[^"]+"\s*(?:,\s*"converter"\s*:\s*\{\s*"@"\s*:\s*"[^"]+"\s*\}\s*|,\s*"deferred"\s*:\s*(true|false)\s*)*)\}/gi},_formatSerializationBindingsReplacer:{value:function(e,i,t){return"{"+i+": "+t.replace(/\n\s*/g,"").replace(/,\s*/g,", ")+"}"}},_formatSerializationBindings:{value:function(e){return e.replace(this._formatSerializationBindingsRegExp,this._formatSerializationBindingsReplacer)}},_formatSerializationReferencesRegExp:{value:/\{\s*("[#@]")\s*:\s*("[^"]+")\s*\}/gi},_formatSerializationReferences:{value:function(e){return e.replace(this._formatSerializationReferencesRegExp,"{$1: $2}")}},_formatSerialization:{value:function(e){return this._formatSerializationBindings(this._formatSerializationReferences(e))}}}),i.Serializer=t,i.serialize=function(e){return(new t).serializeObject(e)}})(i)}}),montageDefine("8cd1986","deserialization/interpreter",{dependencies:["./reviver","./context"],factory:function(e,i){(function(i){function t(){}var s=e("./reviver").Reviver,a=e("./context").Context;Object.defineProperties(t.prototype,{instantiate:{value:function(e,i){var t=new s,u=new a(e,t,i);return u.getObjects()}}}),i.Interpreter=t})(i)}}),montageDefine("8cd1986","deserialization/deserializer",{dependencies:["q","./interpreter"],factory:function(e,i){(function(i){function t(e){this._serializationString=e}function s(e){return new t(e).deserializeObject()}var a=e("q"),u=e("./interpreter").Interpreter;Object.defineProperties(t.prototype,{_interpreter:{value:new u},_serializationString:{value:null,writable:!0},deserialize:{value:function(e){var i;try{i=JSON.parse(this._serializationString)}catch(t){return a.reject(t)}return this._interpreter.instantiate(i,e)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}}}),i.Deserializer=t,i.deserialize=s})(i)}}),montageDefine("8cd1986","serialization/builder",{dependencies:["./ast"],factory:function(e,i){(function(i){function t(){this.init()}var s=e("./ast");Object.defineProperties(t.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new s.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var e=this._references,i=this._root,t=[];for(var s in e)i.hasProperty(s)&&i.getProperty(s)!==this._placeholderProperty||t.push(s);return t}},relabelReferences:{value:function(e,i){var t=this._references[e];if(t){t=t.slice(0);for(var s=0,a=t.length;a>s;s++)t[s].value=i}}},_registerReference:{value:function(e){var i=this._references,t=e.value;i[t]?i[t].push(e):i[t]=[e]}},_unregisterReference:{value:function(e){var i,t=e.label,s=this._references[t];1===s.length?delete this._references[t]:(i=s.indexOf(e),-1===i?console.log("BUG: reference '"+t+"' not found in registry."):s.splice(i,1))}},_createPlaceholdersForReferences:{value:function(){var e=this._references,i=this._root;for(var t in e)i.hasProperty(t)||i.setProperty(t,this._placeholderProperty)}},getSerialization:{value:function(e){return this._createPlaceholdersForReferences(),this._root.serialize(e)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(e){return this._stack.unshift(e)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new s.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new s.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(e){var i=new s.ObjectReference(this._root,e);return this._registerReference(i),i}},createRegExp:{value:function(e){return new s.RegExpObject(this._root,e)}},createString:{value:function(e){return new s.Value(this._root,e)}},createNumber:{value:function(e){return new s.Value(this._root,e)}},createBoolean:{value:function(e){return new s.Value(this._root,e)}},createNull:{value:function(){return new s.Value(this._root,null)}},createCustomObject:{value:function(){return new s.CustomObject(this._root)}}}),i.Builder=t})(i)}}),montageDefine("8cd1986","serialization/labeler",{dependencies:[],factory:function(e,i){(function(e){function i(){this._labels=Object.create(null),this._objectsLabels=Object.create(null),this._objects=Object.create(null),this._baseNamesIndex=Object.create(null),this._userDefinedLabels=Object.create(null)}Object.defineProperties(i.prototype,{_labels:{value:null,writable:!0},_objectsLabels:{value:null,writable:!0},_objects:{value:null,writable:!0},_INITIAL_LABEL_NUMBER:{value:2},_baseNamesIndex:{value:null,writable:!0},_userDefinedLabels:{value:null,writable:!0},initWithObjects:{value:function(e){for(var i in e)this.setObjectLabel(e[i],i),this._userDefinedLabels[i]=!0}},cleanup:{value:function(){this._labels=null,this._objectsLabels=null,this._objects=null,this._baseNamesIndex=null,this._userDefinedLabels=null}},generateLabel:{value:function(e){var i,t=this._baseNamesIndex[e];do t?(i=e+t,this._baseNamesIndex[e]=t+=1):(i=e,this._baseNamesIndex[e]=t=this._INITIAL_LABEL_NUMBER);while(i in this._labels);return i}},getLabelBaseName:{value:function(e){return e.replace(/\d*$/,"")}},addLabel:{value:function(e){this._labels[e]=!0}},addLabels:{value:function(e){for(var i=0,t=e.length;t>i;i++)this.addLabel(e[i])}},isLabelDefined:{value:function(e){return e in this._labels}},isUserDefinedLabel:{value:function(e){return e in this._userDefinedLabels}},getObjectName:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":typeof e}},generateObjectLabel:{value:function(e){var i=this.getObjectName(e);return this.generateLabel(i)}},getObjectLabel:{value:function(e){var i,t=Object.hash(e);return t in this._objectsLabels?i=this._objectsLabels[t]:(i=this.generateObjectLabel(e),this.setObjectLabel(e,i)),i}},setObjectLabel:{value:function(e,i){if(void 0!==e){var t=Object.hash(e);this.addLabel(i),this._objectsLabels[t]=i,this._objects[i]=e}}},getObjectByLabel:{value:function(e){return this._objects[e]}}}),e.Labeler=i})(i)}}),montageDefine("8cd1986","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(e,i){(function(i){function t(e,i){this.builder=e,this.labeler=i,this._objectsSerialization=Object.create(null)}function s(e){var i=t.prototype.getCustomObjectTypeOf;return function(t){return e(t)||i(t)}}e("collections/shim-object"),Object.defineProperties(t.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(e){return this.isCustomObject(e)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(e){var i=this.getCustomObjectTypeOf(e);return"string"==typeof i}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(e,i){this._objectsSerialization[Object.hash(e)]=i}},getObjectSerialization:{value:function(e){return this._objectsSerialization[Object.hash(e)]}},isObjectSerialized:{value:function(e){return Object.hash(e)in this._objectsSerialization}},enterObject:{value:function(e,i){var t=this.builder.createObjectLiteral();this.setObjectSerialization(i,t),this.builder.push(t)}},exitObject:{value:function(e,i,t){this.storeValue(this.builder.pop(),i,t)}},visitObject:{value:function(e,i,t){var s=this.labeler.getObjectLabel(i),a=this.builder.createObjectReference(s);this.getObjectSerialization(i).setLabel(s),this.builder.top.setProperty(t,a)}},enterArray:{value:function(e,i){var t=this.builder.createArray();this.setObjectSerialization(i,t),this.builder.push(t)}},exitArray:{value:function(e,i,t){this.storeValue(this.builder.pop(),i,t)}},visitArray:{value:function(e,i,t){var s=this.labeler.getObjectLabel(i),a=this.builder.createObjectReference(s);this.getObjectSerialization(i).setLabel(s),this.builder.top.setProperty(t,a)}},visitRegExp:{value:function(e,i,t){this.storeValue(this.builder.createRegExp(i),i,t)}},visitString:{value:function(e,i,t){this.storeValue(this.builder.createString(i),i,t)}},visitNumber:{value:function(e,i,t){this.storeValue(this.builder.createNumber(i),i,t)}},visitBoolean:{value:function(e,i,t){this.storeValue(this.builder.createBoolean(i),i,t)}},visitNull:{value:function(e,i){this.storeValue(this.builder.createNull(),null,i)}},visitCustomObject:{value:function(e,i,t){var s=this.getCustomObjectTypeOf(i),u=a["visit"+s];if(s)return u.call(global,e,this,i,t);throw Error("Object's type is unknown: "+i)}},storeValue:{value:function(e,i,t){void 0===t?e.setLabel(this.labeler.getObjectLabel(i)):this.builder.top.setProperty(t,e)}}});var a=Object.create(null);t.addCustomObjectVisitor=function(e){for(var i in e)if("getTypeOf"!==i&&"function"==typeof e[i]&&/^visit/.test(i)){if(void 0!==a[i])return Error("Visitor '"+i+"' is already registered.");a[i]=e[i].bind(e)}this.prototype.getCustomObjectTypeOf=s(e.getTypeOf)},t.resetCustomObjectVisitors=function(){a=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},i.Visitor=t})(i)}}),montageDefine("8cd1986","deserialization/context",{dependencies:["q"],factory:function(e,i){var t=e("q");(function(e){function i(e,i,t){if(this._reviver=i,this._serialization=e,this._objects=Object.create(null),t){this._userObjects=Object.create(null);for(var s in t)this._userObjects[s]=t[s]}}Object.defineProperties(i.prototype,{_objects:{value:null,writable:!0},_userObjects:{value:null,writable:!0},_serialization:{value:null,writable:!0},_reviver:{value:null,writable:!0},setObjectLabel:{value:function(e,i){this._objects[i]=e}},getObject:{value:function(e){var i,s=this._serialization,a=this._reviver,u=this._objects;return e in u?u[e]:e in s?(i=a.reviveRootObject(s[e],this,e),e in u||(u[e]=i),i):t.reject(Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,i=this,s=(this._reviver,this._serialization),a=[];for(var u in s)e=this.getObject(u),t.isPromise(e)&&a.push(e);return 0===a.length?t.resolve(this._invokeDidReviveObjects()):t.all(a).then(function(){return i._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var i=this._userObjects;return i?e in i:!1}},getUserObject:{value:function(e){var i=this._userObjects;return i?i[e]:void 0}},_invokeDidReviveObjects:{value:function(){var e,i=this,s=this._reviver;return"function"==typeof s.didReviveObjects&&(e=s.didReviveObjects(this._objects,this),t.isPromise(e))?e.then(function(){return i._objects}):this._objects}}}),e.Context=i})(i)}}),montageDefine("8cd1986","serialization/ast",{dependencies:[],factory:function(e,i){(function(e){function i(){this.object=Object.create(null)}function t(e,i){this.root=e,this.value=i}function s(e,i){t.call(this,e,i)}function a(e,i){t.call(this,e,i)}function u(e,i){t.call(this,e,i)}function n(e){t.call(this,e,Object.create(null))}function r(e,i){t.call(this,e,i)}Object.defineProperties(i.prototype,{object:{value:null,writable:!0},setProperty:{value:function(e,i){null!=e&&(this.object[e]=i)}},getProperty:{value:function(e){return this.object[e]}},clearProperty:{value:function(e){delete this.object[e]}},hasProperty:{value:function(e){return e in this.object}},serialize:{value:function(e){return JSON.stringify(this,null,e)}},toJSON:{value:function(){var e,i=Object.create(null);for(var t in this.object)e=this.object[t],i[t]=e.toJSON?e.toJSON(t,1):e;return i}}}),Object.defineProperties(t.prototype,{root:{value:null,writable:!0},label:{value:null,writable:!0},value:{value:null,writable:!0},setLabel:{value:function(e){this.label&&this.root.clearProperty(this.label),this.label=e,this.root.setProperty(e,this)}},getLabel:{value:function(){return this.label}},clearLabel:{value:function(){this.root.clearProperty(this.label),this.label=null}},_getSerializationValue:{value:function(){return this.value}},toJSON:{value:function(e,i){var t=this._getSerializationValue();return 1===i?{value:t}:t}}}),s.prototype=Object.create(t.prototype,{constructor:{value:s},toJSON:{value:function(e,i){var t,s=this._getSerializationValue();return 1===i?{value:s}:this.label?(t=new r(this.root,this.label),t.toJSON()):s}}}),a.prototype=Object.create(s.prototype,{constructor:{value:a},setProperty:{value:function(e,i){null!=e&&(this.value[e]=i)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},getPropertyNames:{value:function(){return Object.keys(this.value)}}}),u.prototype=Object.create(s.prototype,{constructor:{value:u},_getSerializationValue:{value:function(){var e=this.value;return{"/":{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")}}}}}),n.prototype=Object.create(t.prototype,{constructor:{value:n},setProperty:{value:function(e,i){null!=e&&(this.value[e]=i)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},toJSON:{value:function(e,i){var t,s=this._getSerializationValue();return 1===i?s:(t=new r(this.root,this.label),t.toJSON())}}}),r.prototype=Object.create(t.prototype,{constructor:{value:r},_getSerializationValue:{value:function(){return{"@":this.value}}}}),e.Root=i,e.Value=t,e.ReferenceableValue=s,e.ObjectLiteral=a,e.RegExpObject=u,e.CustomObject=n,e.ObjectReference=r})(i)}}),montageDefine("45fb404","shim",{dependencies:["./shim-array","./shim-object","./shim-function","./shim-regexp"],factory:function(e){e("./shim-array"),e("./shim-object"),e("./shim-function"),e("./shim-regexp")}}),montageDefine("45fb404","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(e,i,t){function s(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var a=e("weak-map"),u=Object.prototype.hasOwnProperty,n=new a,r=new a;t.exports=s,s.debug=!0,s.prototype.getOwnPropertyChangeDescriptor=function(e){n.has(this)||n.set(this,{});var i=n.get(this);return u.call(i,e)||(i[e]={willChangeListeners:[],changeListeners:[]}),i[e]},s.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!n.has(this))return!1;if(!e)return!0;var i=n.get(this);return u.call(i,e)?!0:!1},s.prototype.addOwnPropertyChangeListener=function(e,i,t){this.makeObservable&&!this.isObservable&&this.makeObservable();var a,u=s.getOwnPropertyChangeDescriptor(this,e);a=t?u.willChangeListeners:u.changeListeners,s.makePropertyObservable(this,e),a.push(i);var n=this;return function(){s.removeOwnPropertyChangeListener(n,e,a,t),n=null}},s.prototype.addBeforeOwnPropertyChangeListener=function(e,i){return s.addOwnPropertyChangeListener(this,e,i,!0)},s.prototype.removeOwnPropertyChangeListener=function(e,i,t){var a,u=s.getOwnPropertyChangeDescriptor(this,e);a=t?u.willChangeListeners:u.changeListeners;var n=a.lastIndexOf(i);if(-1===n)throw Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));a.splice(n,1)},s.prototype.removeBeforeOwnPropertyChangeListener=function(e,i){return s.removeOwnPropertyChangeListener(this,e,i,!0)},s.prototype.dispatchOwnPropertyChange=function(e,i,t){var a=s.getOwnPropertyChangeDescriptor(this,e);if(!a.isActive){a.isActive=!0;var u;u=t?a.willChangeListeners:a.changeListeners;var n=(t?"Will":"")+"Change",r="handleProperty"+n,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var o="handle"+l+n;try{u.slice().forEach(function(t){if(!(0>u.indexOf(t))){var s=t;if(t=t[o]||t[r]||t,!t.call)throw Error("No event listener for "+o+" or "+r+" or call on "+t);t.call(s,i,e,this)}},this)}finally{a.isActive=!1}}},s.prototype.dispatchBeforeOwnPropertyChange=function(e,i){return s.dispatchOwnPropertyChange(this,e,i,!0)},s.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),i[e]=this[e],r.has(this)||(t={},r.set(this,t));var t=r.get(this);if(!u.call(t,e)){var a,n=this;Object.getOwnPropertyDescriptor(n,e);do{if(a=Object.getOwnPropertyDescriptor(n,e))break;n=Object.getPrototypeOf(n)}while(n);if(a=a||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!a.configurable)throw Error("Can't observe non-configurable properties");if(t[e]=a,a.writable||a.set){var l;l="value"in a?{get:function(){return a.value},set:function(t){return t===a.value?t:(s.dispatchBeforeOwnPropertyChange(this,e,a.value),a.value=t,i[e]=t,s.dispatchOwnPropertyChange(this,e,t),t)},enumerable:a.enumerable,configurable:!0}:{get:function(){return a.get?a.get.apply(this,arguments):void 0},set:function(t){var u;return a.get&&(u=a.get.apply(this,arguments)),a.set&&a.set.apply(this,arguments),a.get&&(t=a.get.apply(this,arguments),i[e]=t),t===u?t:(s.dispatchBeforeOwnPropertyChange(this,e,u),s.dispatchOwnPropertyChange(this,e,t),t)},enumerable:a.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},s.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!r.has(this))throw Error("Can't uninstall observer on property");var i=r.get(this);if(!i[e])throw Error("Can't uninstall observer on property");var t=i[e];delete i[e];var s;"object"==typeof this.__state__?s=this.__state__:(s={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:s,writable:!0,enumerable:!1})),delete s[e],Object.defineProperty(this,e,t)}},s.getOwnPropertyChangeDescriptor=function(e,i){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(i):s.prototype.getOwnPropertyChangeDescriptor.call(e,i)},s.hasOwnPropertyChangeDescriptor=function(e,i){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(i):s.prototype.hasOwnPropertyChangeDescriptor.call(e,i)},s.addOwnPropertyChangeListener=function(e,i,t,a){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(i,t,a):s.prototype.addOwnPropertyChangeListener.call(e,i,t,a):void 0},s.removeOwnPropertyChangeListener=function(e,i,t,a){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(i,t,a):s.prototype.removeOwnPropertyChangeListener.call(e,i,t,a):void 0},s.dispatchOwnPropertyChange=function(e,i,t,a){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(i,t,a):s.prototype.dispatchOwnPropertyChange.call(e,i,t,a):void 0},s.addBeforeOwnPropertyChangeListener=function(e,i,t){return s.addOwnPropertyChangeListener(e,i,t,!0)},s.removeBeforeOwnPropertyChangeListener=function(e,i,t){return s.removeOwnPropertyChangeListener(e,i,t,!0)},s.dispatchBeforeOwnPropertyChange=function(e,i,t){return s.dispatchOwnPropertyChange(e,i,t,!0)},s.makePropertyObservable=function(e,i){return e.makePropertyObservable?e.makePropertyObservable(i):s.prototype.makePropertyObservable.call(e,i)
},s.makePropertyUnobservable=function(e,i){return e.makePropertyUnobservable?e.makePropertyUnobservable(i):s.prototype.makePropertyUnobservable.call(e,i)}}}),montageDefine("45fb404","map",{dependencies:["./shim","./set","./generic-collection","./generic-map","./listen/property-changes","map"],factory:function(e,i,t){"use strict";function s(e,i,t,u){return this instanceof s?(i=i||Object.equals,t=t||Object.hash,u=u||Function.noop,this.contentEquals=i,this.contentHash=t,this.getDefault=u,this.store=new a(void 0,function(e,t){return i(e.key,t.key)},function(e){return t(e.key)}),this.length=0,this.addEach(e),void 0):new s(e,i,t,u)}e("./shim");var a=e("./set"),u=e("./generic-collection"),n=e("./generic-map"),r=e("./listen/property-changes");t.exports=s,s.Map=s,Object.addEach(s.prototype,u.prototype),Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},s.prototype.log=function(e,i,t,s){i=i||this.logNode,this.store.log(e,function(e,t,s){i(e.value.value,t,s)},t,s)},s.prototype.logNode=function(e,i){i(" key: "+e.key),i(" value: "+e.value)}}}),montageDefine("45fb404","shim-array",{dependencies:["./shim-function","./generic-collection","./generic-order","weak-map"],factory:function(e,i,t){"use strict";function s(e,i){Object.defineProperty(Array.prototype,e,{value:i,writable:!0,configurable:!0,enumerable:!1})}function a(e,i,t){this.array=e,this.start=null==i?0:i,this.end=t}e("./shim-function");var u=e("./generic-collection"),n=e("./generic-order"),r=e("weak-map");t.exports=Array;var l=Array.prototype.splice,o=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.from=function(e){var i=[];return i.addEach(e),i},Array.unzip=function(e){for(var i=[],t=1/0,s=0;e.length>s;s++){var a=e[s];e[s]=a.toArray(),t>a.length&&(t=a.length)}for(var s=0;e.length>s;s++)for(var a=e[s],u=0;a.length>u;u++)t>u&&u in a&&(i[u]=i[u]||[],i[u][s]=a[u]);return i},s("addEach",u.prototype.addEach),s("deleteEach",u.prototype.deleteEach),s("toArray",u.prototype.toArray),s("toObject",u.prototype.toObject),s("all",u.prototype.all),s("any",u.prototype.any),s("min",u.prototype.min),s("max",u.prototype.max),s("sum",u.prototype.sum),s("average",u.prototype.average),s("only",u.prototype.only),s("flatten",u.prototype.flatten),s("zip",u.prototype.zip),s("enumerate",u.prototype.enumerate),s("group",u.prototype.group),s("sorted",u.prototype.sorted),s("reversed",u.prototype.reversed),s("constructClone",function(e){var i=new this.constructor;return i.addEach(e),i}),s("has",function(e,i){return-1!==this.find(e,i)}),s("get",function(e,i){if(+e!==e)throw Error("Indicies must be numbers");return!e in this?i:this[e]}),s("set",function(e,i){return this.splice(e,1,i),!0}),s("add",function(e){return this.push(e),!0}),s("delete",function(e,i){var t=this.find(e,i);return-1!==t?(this.splice(t,1),!0):!1}),s("find",function(e,i){i=i||this.contentEquals||Object.equals;for(var t=0;this.length>t;t++)if(t in this&&i(this[t],e))return t;return-1}),s("findLast",function(e,i){i=i||this.contentEquals||Object.equals;var t=this.length;do if(t--,t in this&&i(this[t],e))return t;while(t>0);return-1}),s("swap",function(e,i,t){var s,a,u,n,r;if(void 0!==t){if(s=[e,i],Array.isArray(t)||(t=o.call(t)),u=0,a=t.length,1e3>a){for(u;a>u;u++)s[u+2]=t[u];return l.apply(this,s)}for(r=l.apply(this,s),u;a>u;){for(s=[e+u,0],n=2;1002>n&&a>u;n++,u++)s[n]=t[u];l.apply(this,s)}return r}return void 0!==i?l.call(this,e,i):void 0!==e?l.call(this,e):[]}),s("peek",function(){return this[0]}),s("poke",function(e){this.length>0&&(this[0]=e)}),s("peekBack",function(){return this.length>0?this[this.length-1]:void 0}),s("pokeBack",function(e){this.length>0&&(this[this.length-1]=e)}),s("one",function(){for(var e in this)if(Object.owns(this,e))return this[e]}),s("clear",function(){return this.length=0,this}),s("compare",function(e,i){i=i||Object.compare;var t,s,a,u,r;if(this===e)return 0;if(!e||!Array.isArray(e))return n.prototype.compare.call(this,e,i);for(s=Math.min(this.length,e.length),t=0;s>t;t++)if(t in this){if(!(t in e))return-1;if(a=this[t],u=e[t],r=i(a,u))return r}else if(t in e)return 1;return this.length-e.length}),s("equals",function(e,i){i=i||Object.equals;var t,s,a=0,u=this.length;if(this===e)return!0;if(!e||!Array.isArray(e))return n.prototype.equals.call(this,e);if(u!==e.length)return!1;for(;u>a;++a)if(a in this){if(!(a in e))return!1;if(t=this[a],s=e[a],!i(t,s))return!1}else if(a in e)return!1;return!0}),s("clone",function(e,i){if(null==e)e=1/0;else if(0===e)return this;if(i=i||new r,i.has(this))return i.get(this);var t=Array(this.length);i.set(this,t);for(var s in this)t[s]=Object.clone(this[s],e-1,i);return t}),s("iterate",function(e,i){return new a(this,e,i)}),s("Iterator",a),a.prototype.next=function(){if(this.start===(null==this.end?this.array.length:this.end))throw StopIteration;return this.array[this.start++]}}}),montageDefine("45fb404","shim-object",{dependencies:["weak-map"],factory:function(e,i,t){"use strict";var s=e("weak-map");t.exports=Object,Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(e){return Object(e)===e},Object.getValueOf=function(e){return e&&"function"==typeof e.valueOf&&(e=e.valueOf()),e};var a=new s;Object.hash=function(e){return e&&"function"==typeof e.hash?""+e.hash():Object(e)===e?(a.has(e)||a.set(e,Math.random().toString(36).slice(2)),a.get(e)):""+e};var u=Object.prototype.hasOwnProperty;Object.owns=function(e,i){return u.call(e,i)},Object.has=function(e,i){if("object"!=typeof e)throw Error("Object.has can't accept non-object: "+typeof e);if(e&&"function"==typeof e.has)return e.has(i);if("string"==typeof i)return i in e&&e[i]!==Object.prototype[i];throw Error("Key must be a string for Object.has on plain objects")},Object.get=function(e,i,t){if("object"!=typeof e)throw Error("Object.get can't accept non-object: "+typeof e);return e&&"function"==typeof e.get?e.get(i,t):Object.has(e,i)?e[i]:t},Object.set=function(e,i,t){e&&"function"==typeof e.set?e.set(i,t):e[i]=t},Object.addEach=function(e,i){return i&&("function"!=typeof i.forEach||i.hasOwnProperty("forEach")?Object.keys(i).forEach(function(t){e[t]=i[t]}):"function"==typeof i.keys?i.forEach(function(i,t){e[t]=i}):i.forEach(function(i){e[i[0]]=i[1]})),e},Object.forEach=function(e,i,t){Object.keys(e).forEach(function(s){i.call(t,e[s],s,e)})},Object.map=function(e,i,t){return Object.keys(e).map(function(s){return i.call(t,e[s],s,e)})},Object.values=function(e){return Object.map(e,Function.identity)},Object.concat=function(){for(var e={},i=0;arguments.length>i;i++)Object.addEach(e,arguments[i]);return e},Object.from=Object.concat,Object.is=function(e,i){return e===i?0!==e||1/e===1/i:e!==e&&i!==i},Object.equals=function(e,i,t,a){if(t=t||Object.equals,e=Object.getValueOf(e),i=Object.getValueOf(i),e===i)return!0;if(Object.isObject(e)){if(a=a||new s,a.has(e))return!0;a.set(e,!0)}if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(i,t,a);if(Object.isObject(i)&&"function"==typeof i.equals)return i.equals(e,t,a);if(Object.isObject(e)&&Object.isObject(i)&&Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(i)===Object.prototype){for(var u in e)if(!t(e[u],i[u],t,a))return!1;for(var u in i)if(!(u in e&&t(i[u],e[u],t,a)))return!1;return!0}return e!==e&&i!==i?!0:e&&i?!1:e===i},Object.compare=function(e,i){if(e=Object.getValueOf(e),i=Object.getValueOf(i),e===i)return 0;var t=typeof e,s=typeof i;return"number"===t&&"number"===s?e-i:"string"===t&&"string"===s?i>e?-1/0:1/0:e&&"function"==typeof e.compare?e.compare(i):i&&"function"==typeof i.compare?-i.compare(e):0},Object.clone=function(e,i,t){if(e=Object.getValueOf(e),t=t||new s,void 0===i)i=1/0;else if(0===i)return e;if(Object.isObject(e)){if(!t.has(e))if(e&&"function"==typeof e.clone)t.set(e,e.clone(i,t));else{var a=Object.getPrototypeOf(e);if(null!==a&&a!==Object.prototype)throw Error("Can't clone "+e);var u=Object.create(a);t.set(e,u);for(var n in e)u[n]=Object.clone(e[n],i-1,t)}return t.get(e)}return e},Object.clear=function(e){if(e&&"function"==typeof e.clear)e.clear();else for(var i=Object.keys(e),t=i.length;t;)t--,delete e[i[t]];return e}}}),montageDefine("45fb404","shim-function",{dependencies:[],factory:function(e,i,t){t.exports=Function,Function.noop=function(){},Function.identity=function(e){return e},Function.by=function(e,i){i=i||Object.compare,e=e||Function.identity;var t=function(t,s){return i(e(t),e(s))};return t.compare=i,t.by=e,t},Function.get=function(e){return function(i){return Object.get(i,e)}}}}),montageDefine("45fb404","shim-regexp",{dependencies:[],factory:function(){if(!RegExp.escape){var e=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(i){return i.replace(e,"\\$&")}}}}),montageDefine("45fb404","set",{dependencies:["./shim","./list","./fast-set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","set"],factory:function(e,i,t){"use strict";function s(e,i,t,a){return this instanceof s?(i=i||Object.equals,t=t||Object.hash,a=a||Function.noop,this.contentEquals=i,this.contentHash=t,this.getDefault=a,this.order=new this.Order(void 0,i),this.store=new this.Store(void 0,function(e,t){return i(e.value,t.value)},function(e){return t(e.value)}),this.length=0,this.addEach(e),void 0):new s(e,i,t,a)}e("./shim");var a=e("./list"),u=e("./fast-set"),n=e("./generic-collection"),r=e("./generic-set"),l=e("./listen/property-changes"),o=e("./listen/range-changes");t.exports=s,s.Set=s,Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,l.prototype),Object.addEach(s.prototype,o.prototype),s.prototype.Order=a,s.prototype.Store=u,s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},s.prototype.has=function(e){var i=new this.order.Node(e);return this.store.has(i)},s.prototype.get=function(e,i){if(i)throw Error("Set#get does not support second argument: equals");var t=new this.order.Node(e);return t=this.store.get(t),t?t.value:this.getDefault(e)},s.prototype.add=function(e){var i=new this.order.Node(e);if(!this.store.has(i)){var t=this.length;return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],t),this.order.add(e),i=this.order.head.prev,this.store.add(i),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t),!0}return!1},s.prototype["delete"]=function(e,i){if(i)throw Error("Set#delete does not support second argument: equals");var t=new this.order.Node(e);if(this.store.has(t)){var t=this.store.get(t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t.index),this.store["delete"](t),this.order.splice(t,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t.index),!0}return!1},s.prototype.pop=function(){if(this.length){var e=this.order.head.prev.value;return this["delete"](e),e}},s.prototype.shift=function(){if(this.length){var e=this.order.head.next.value;return this["delete"](e),e}},s.prototype.one=function(){return this.length>0?this.store.one().value:void 0},s.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.store.clear(),this.order.clear(),this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},s.prototype.reduce=function(e,i){var t=arguments[2],s=this.order,a=0;return s.reduce(function(i,s){return e.call(t,i,s,a++,this)},i,this)},s.prototype.reduceRight=function(e,i){var t=arguments[2],s=this.order,a=this.length-1;return s.reduceRight(function(i,s){return e.call(t,i,s,a--,this)},i,this)},s.prototype.iterate=function(){return this.order.iterate()},s.prototype.log=function(){var e=this.store;return e.log.apply(e,arguments)},s.prototype.makeObservable=function(){this.order.makeObservable()}}}),montageDefine("45fb404","generic-collection",{dependencies:["./shim-array"],factory:function(e,i,t){"use strict";function s(){throw Error("Can't construct. GenericCollection is a mixin.")}t.exports=s,s.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.forEach(this.add,this);else if("number"==typeof e.length)for(var i=0;e.length>i;i++)this.add(e[i],i);else Object.keys(e).forEach(function(i){this.add(e[i],i)},this);return this},s.prototype.deleteEach=function(e,i){return e.forEach(function(e){this["delete"](e,i)},this),this},s.prototype.forEach=function(e){var i=arguments[1];return this.reduce(function(t,s,a,u,n){e.call(i,s,a,u,n)},void 0)},s.prototype.map=function(e){var i=arguments[1],t=[];return this.reduce(function(s,a,u,n,r){t.push(e.call(i,a,u,n,r))},void 0),t},s.prototype.enumerate=function(e){null==e&&(e=0);var i=[];return this.reduce(function(t,s){i.push([e++,s])},void 0),i},s.prototype.group=function(e,i,t){t=t||Object.equals;var s=[],a=[];return this.forEach(function(u,n,r){var l,n=e.call(i,u,n,r),o=a.indexOf(n,t);-1===o?(l=[],s.push([n,l]),a.push(n)):l=s[o][1],l.push(u)}),s},s.prototype.toArray=function(){return this.map(Function.identity)},s.prototype.toObject=function(){var e={};return this.reduce(function(i,t,s){e[s]=t},void 0),e},s.prototype.filter=function(e){var i=arguments[1],t=this.constructClone();return this.reduce(function(s,a,u,n,r){e.call(i,a,u,n,r)&&t.add(a,u)},void 0),t},s.prototype.every=function(e){var i=arguments[1];return this.reduce(function(t,s,a,u,n){return t&&e.call(i,s,a,u,n)},!0)},s.prototype.some=function(e){var i=arguments[1];return this.reduce(function(t,s,a,u,n){return t||e.call(i,s,a,u,n)},!1)},s.prototype.all=function(){return this.every(Boolean)},s.prototype.any=function(){return this.some(Boolean)},s.prototype.min=function(e){e=e||this.contentCompare||Object.compare;var i=!0;return this.reduce(function(t,s){return i?(i=!1,s):0>e(s,t)?s:t},void 0)},s.prototype.max=function(e){e=e||this.contentCompare||Object.compare;var i=!0;return this.reduce(function(t,s){return i?(i=!1,s):e(s,t)>0?s:t},void 0)},s.prototype.sum=function(e){return e=void 0===e?0:e,this.reduce(function(e,i){return e+i},e)},s.prototype.average=function(e){var i=void 0===e?0:e,t=void 0===e?0:e;return this.reduce(function(e,s){i+=s,t+=1},void 0),i/t},s.prototype.concat=function(){for(var e=this.constructClone(this),i=0;arguments.length>i;i++)e.addEach(arguments[i]);return e},s.prototype.flatten=function(){var e=this;return this.reduce(function(i,t){return t.forEach(function(e){this.push(e)},i,e),i},[])},s.prototype.zip=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),Array.unzip(e)},s.prototype.join=function(e){return this.reduce(function(i,t){return i+e+t})},s.prototype.sorted=function(e,i,t){return e=e||this.contentCompare||Object.compare,e.by?(i=e.by,e=e.compare||this.contentCompare||Object.compare):i=i||Function.identity,void 0===t&&(t=1),this.map(function(e){return{by:i(e),value:e}}).sort(function(i,s){return e(i.by,s.by)*t}).map(function(e){return e.value})},s.prototype.reversed=function(){return this.constructClone(this).reverse()},s.prototype.clone=function(e,i){if(void 0===e)e=1/0;else if(0===e)return this;var t=this.constructClone();return this.forEach(function(s,a){t.add(Object.clone(s,e-1,i),a)},this),t},s.prototype.only=function(){return 1===this.length?this.one():void 0},s.prototype.iterator=function(){return this.iterate.apply(this,arguments)},e("./shim-array")}}),montageDefine("45fb404","generic-map",{dependencies:["./shim-object","./listen/map-changes","./listen/property-changes"],factory:function(e,i,t){"use strict";function s(){throw Error("Can't construct. GenericMap is a mixin.")}function a(e,i){this.key=e,this.value=i}var u=e("./shim-object"),n=e("./listen/map-changes"),r=e("./listen/property-changes");t.exports=s,u.addEach(s.prototype,n.prototype),u.addEach(s.prototype,r.prototype),s.prototype.isMap=!0,s.prototype.addEach=function(e){return e&&u(e)===e&&("function"==typeof e.forEach?e.isMap===!0?e.forEach(function(e,i){this.set(i,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this):u.keys(e).forEach(function(i){this.set(i,e[i])},this)),this},s.prototype.get=function(e,i){var t=this.store.get(new this.Item(e));return t?t.value:arguments.length>1?i:this.getDefault(e)},s.prototype.set=function(e,i){var t=new this.Item(e,i),s=this.store.get(t),a=!1;return s?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,s.value),s.value=i,this.dispatchesMapChanges&&this.dispatchMapChange(e,i)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.store.add(t)&&(this.length++,a=!0),this.dispatchesMapChanges&&this.dispatchMapChange(e,i)),a},s.prototype.add=function(e,i){return this.set(i,e)},s.prototype.has=function(e){return this.store.has(new this.Item(e))},s.prototype["delete"]=function(e){var i=new this.Item(e);if(this.store.has(i)){var t=this.store.get(i).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,t),this.store["delete"](i),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0}return!1},s.prototype.clear=function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,i){this.dispatchBeforeMapChange(i,e)},this),e=this.keys()),this.store.clear(),this.length=0,this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},s.prototype.reduce=function(e,i,t){return this.store.reduce(function(i,s){return e.call(t,i,s.value,s.key,this)},i,this)},s.prototype.reduceRight=function(e,i,t){return this.store.reduceRight(function(i,s){return e.call(t,i,s.value,s.key,this)},i,this)},s.prototype.keys=function(){return this.map(function(e,i){return i})},s.prototype.values=function(){return this.map(Function.identity)},s.prototype.entries=function(){return this.map(function(e,i){return[i,e]})},s.prototype.items=function(){return this.entries()},s.prototype.equals=function(e,i){if(i=i||u.equals,this===e)return!0;if(e&&"function"==typeof e.every)return e.length===this.length&&e.every(function(e,t){return i(this.get(t),e)},this);var t=u.keys(e);return t.length===this.length&&u.keys(e).every(function(t){return i(this.get(t),e[t])},this)},s.prototype.Item=a,a.prototype.equals=function(e){return u.equals(this.key,e.key)&&u.equals(this.value,e.value)},a.prototype.compare=function(e){return u.compare(this.key,e.key)}}}),montageDefine("45fb404","listen/array-changes",{dependencies:["../shim","../list","weak-map","./property-changes","./range-changes","./map-changes"],factory:function(e){function i(e){for(var i in e)Object.defineProperty(Array.prototype,i,{value:e[i],writable:!0,configurable:!0,enumerable:!1})}e("../shim"),e("../list"),e("weak-map");var t=e("./property-changes"),s=e("./range-changes"),a=e("./map-changes");Array.prototype.splice;var u=Array.prototype.slice;Array.prototype.reverse;var n,r=Array.prototype.sort,l=Array.prototype.swap,o=[],c={}.__proto__===Object.prototype;n=c?function(){this.__proto__=d}:function(){Object.defineProperties(this,m)},Object.defineProperty(Array.prototype,"makeObservable",{value:n,writable:!0,configurable:!0,enumerable:!1}),i(t.prototype),i(s.prototype),i(a.prototype);var m={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){var e=this.constructClone(this);return e.reverse(),this.swap(0,this.length,e),this},writable:!0,configurable:!0},sort:{value:function(){this.dispatchBeforeRangeChange(this,this,0);for(var e=0;this.length>e;e++)t.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);r.apply(this,arguments);for(var e=0;this.length>e;e++)t.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},swap:{value:function(e,i,s){s?Array.isArray(s)||(s=u.call(s)):s=o,0>e&&(e=this.length+e);var a;if(0===i){if(0===s.length)return[];a=o}else a=u.call(this,e,e+i);var n=s.length-a.length,r=this.length,c=Math.max(this.length+n,e+s.length),m=Math.max(r,c);if(n&&t.dispatchBeforeOwnPropertyChange(this,"length",this.length),this.dispatchBeforeRangeChange(s,a,e),0===n)for(var d=e;e+s.length>d;d++)t.dispatchBeforeOwnPropertyChange(this,d,this[d]),this.dispatchBeforeMapChange(d,this[d]);else if(t.hasOwnPropertyChangeDescriptor(this))for(var d=e;m>d;d++)t.dispatchBeforeOwnPropertyChange(this,d,this[d]),this.dispatchBeforeMapChange(d,this[d]);e>r&&(this.length=e);var p=l.call(this,e,i,s);if(0===n)for(var d=e;e+s.length>d;d++)t.dispatchOwnPropertyChange(this,d,this[d]),this.dispatchMapChange(d,this[d]);else if(t.hasOwnPropertyChangeDescriptor(this))for(var d=e;m>d;d++)t.dispatchOwnPropertyChange(this,d,this[d]),this.dispatchMapChange(d,this[d]);return this.dispatchRangeChange(s,a,e),n&&t.dispatchOwnPropertyChange(this,"length",this.length),p},writable:!0,configurable:!0},splice:{value:function(e,i){return e>this.length&&(e=this.length),this.swap.call(this,e,i,u.call(arguments,2))},writable:!0,configurable:!0},set:{value:function(e,i){return this.splice(e,1,i),this},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){return this.length?this.splice(this.length-1,1)[0]:void 0},writable:!0,configurable:!0},push:{value:function(e){if(1===arguments.length)return this.splice(this.length,0,e);var i=u.call(arguments);return this.swap(this.length,0,i)},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var i=u.call(arguments);return this.swap(0,0,i)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},d=Object.create(Array.prototype,m)}}),montageDefine("45fb404","sorted-array",{dependencies:["./shim","./generic-collection","./listen/property-changes","./listen/range-changes","sorted-array"],factory:function(e,i,t){"use strict";function s(e,i,t,a){return this instanceof s?(Array.isArray(e)?(this.array=e,e=e.splice(0,e.length)):this.array=[],this.contentEquals=i||Object.equals,this.contentCompare=t||Object.compare,this.getDefault=a||Function.noop,this.length=0,this.addEach(e),void 0):new s(e,i,t,a)}function a(e,i,t){for(var s=0,a=e.length-1;a>=s;){var u=s+a>>1,n=t(i,e[u]);if(n>0)s=u+1;else{if(!(0>n))return u;a=u-1}}return-(s+1)}function u(e,i,t,s){var u=a(e,i,t);if(0>u)return-1;for(;u>0&&s(i,e[u-1]);)u--;return s(i,e[u])?u:-1}function n(e,i,t,s){var u=a(e,i,t);if(0>u)return-1;for(;e.length-1>u&&s(i,e[u+1]);)u++;return s(i,e[u])?u:-1}function r(e,i,t){var s=a(e,i,t);if(0>s)return-s-1;for(var u=e.length-1;u>s&&0===t(i,e[s+1]);)s++;return s}t.exports=s,e("./shim");var l=e("./generic-collection"),o=e("./listen/property-changes"),c=e("./listen/range-changes");s.SortedArray=s,Object.addEach(s.prototype,l.prototype),Object.addEach(s.prototype,o.prototype),Object.addEach(s.prototype,c.prototype),s.prototype.isSorted=!0,s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},s.prototype.has=function(e,i){if(i)throw Error("SortedSet#has does not support second argument: equals");var t=a(this.array,e,this.contentCompare);return t>=0&&this.contentEquals(this.array[t],e)},s.prototype.get=function(e,i){if(i)throw Error("SortedArray#get does not support second argument: equals");var t=u(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?this.array[t]:this.getDefault(e)},s.prototype.add=function(e){var i=r(this.array,e,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],i),this.array.splice(i,0,e),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],i),!0},s.prototype["delete"]=function(e,i){if(i)throw Error("SortedArray#delete does not support second argument: equals");var t=u(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t),this.array.splice(t,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t),!0):!1},s.prototype.indexOf=function(e){return u(this.array,e,this.contentCompare,this.contentEquals)},s.prototype.lastIndexOf=function(e){return n(this.array,e,this.contentCompare,this.contentEquals)},s.prototype.find=function(e,i,t){if(i)throw Error("SortedArray#find does not support second argument: equals");if(t)throw Error("SortedArray#find does not support third argument: index");return u(this.array,e,this.contentCompare,this.contentEquals)},s.prototype.findLast=function(e,i,t){if(i)throw Error("SortedArray#findLast does not support second argument: equals");if(t)throw Error("SortedArray#findLast does not support third argument: index");return n(this.array,e,this.contentCompare,this.contentEquals)},s.prototype.push=function(){this.addEach(arguments)},s.prototype.unshift=function(){this.addEach(arguments)},s.prototype.pop=function(){return this.array.pop()},s.prototype.shift=function(){return this.array.shift()},s.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},s.prototype.splice=function(e,i){return this.swap(e,i,Array.prototype.slice.call(arguments,2))},s.prototype.swap=function(e,i,t){if(void 0===e&&void 0===i)return[];e=e||0,0>e&&(e+=this.length),void 0===i&&(i=1/0);var s=this.slice(e,e+i);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(t,s,e),this.array.splice(e,i),this.addEach(t),this.dispatchesRangeChanges&&this.dispatchRangeChange(t,s,e),s},s.prototype.reduce=function(e,i){var t=arguments[2];return this.array.reduce(function(i,s,a){return e.call(t,i,s,a,this)},i,this)},s.prototype.reduceRight=function(){var e=arguments[2];return this.array.reduceRight(function(i,t,s){return callback.call(e,i,t,s,this)},basis,this)},s.prototype.min=function(){return this.length?this.array[0]:void 0},s.prototype.max=function(){return this.length?this.array[this.length-1]:void 0},s.prototype.one=function(){return this.array.one()},s.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.array.slice(),this.dispatchBeforeRangeChange([],e,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},s.prototype.equals=function(e,i){return this.array.equals(e,i)},s.prototype.compare=function(e,i){return this.array.compare(e,i)},s.prototype.iterate=function(e,i){return new this.Iterator(this.array,e,i)},s.prototype.Iterator=Array.prototype.Iterator}}),montageDefine("45fb404","sorted-set",{dependencies:["./shim","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","./tree-log","sorted-set"],factory:function(e,i,t){"use strict";function s(e,i,t,a){return this instanceof s?(this.contentEquals=i||Object.equals,this.contentCompare=t||Object.compare,this.getDefault=a||Function.noop,this.root=null,this.length=0,this.addEach(e),void 0):new s(e,i,t,a)}function a(e){this.value=e,this.left=null,this.right=null,this.length=1}function u(e,i,t){if(this.set=e,this.prev=null,this.end=t,i){var s=this.set.findLeastGreaterThanOrEqual(i);s&&(this.set.splay(s.value),this.prev=s.getPrevious())}}t.exports=s,e("./shim");var n=e("./generic-collection"),r=e("./generic-set"),l=e("./listen/property-changes"),o=e("./listen/range-changes"),c=e("./tree-log");s.SortedSet=s,Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,l.prototype),Object.addEach(s.prototype,o.prototype),s.prototype.isSorted=!0,s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},s.prototype.has=function(e,i){if(i)throw Error("SortedSet#has does not support second argument: equals");return this.root?(this.splay(e),this.contentEquals(e,this.root.value)):!1},s.prototype.get=function(e,i){if(i)throw Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.value:this.getDefault(e)},s.prototype.add=function(e){var i=new this.Node(e);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],0),this.root=i,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],0),!0;if(this.splay(e),!this.contentEquals(e,this.root.value)){var t=this.contentCompare(e,this.root.value);if(0===t)throw Error("SortedSet cannot contain incomparable but inequal values: "+e+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],this.root.index),0>t?(i.right=this.root,i.left=this.root.left,this.root.left=null,this.root.touch()):(i.left=this.root,i.right=this.root.right,this.root.right=null,this.root.touch()),i.touch(),this.root=i,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],this.root.index),!0}return!1},s.prototype["delete"]=function(e,i){if(i)throw Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(e),this.contentEquals(e,this.root.value))){var t=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t),this.root.left){var s=this.root.right;this.root=this.root.left,this.splay(e),this.root.right=s}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t),!0}return!1},s.prototype.indexOf=function(e,i){if(i)throw Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.index:-1},s.prototype.find=function(e,i,t){if(i)throw Error("SortedSet#find does not support second argument: equals");if(t)throw Error("SortedSet#find does not support third argument: index");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root:void 0},s.prototype.findGreatest=function(e){if(this.root){for(e=e||this.root;e.right;)e=e.right;return e}},s.prototype.findLeast=function(e){if(this.root){for(e=e||this.root;e.left;)e=e.left;return e}},s.prototype.findGreatestLessThanOrEqual=function(e){return this.root?(this.splay(e),this.root):void 0},s.prototype.findGreatestLessThan=function(e){return this.root?(this.splay(e),this.root.getPrevious()):void 0},s.prototype.findLeastGreaterThanOrEqual=function(e){if(this.root){this.splay(e);var i=this.contentCompare(e,this.root.value);return 0===i?this.root:this.root.getNext()}},s.prototype.findLeastGreaterThan=function(e){return this.root?(this.splay(e),this.contentCompare(e,this.root.value),this.root.getNext()):void 0},s.prototype.pop=function(){if(this.root){var e=this.findGreatest();return this["delete"](e.value),e.value}},s.prototype.shift=function(){if(this.root){var e=this.findLeast();return this["delete"](e.value),e.value}},s.prototype.push=function(){this.addEach(arguments)},s.prototype.unshift=function(){this.addEach(arguments)},s.prototype.slice=function(e,i){e=e||0,i=i||this.length,0>e&&(e+=this.length),0>i&&(i+=this.length);var t=[];if(this.root)for(this.splayIndex(e);i>this.root.index&&(t.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return t},s.prototype.splice=function(e,i){return this.swap(e,i,Array.prototype.slice.call(arguments,2))},s.prototype.swap=function(e,i,t){if(void 0===e&&void 0===i)return[];e=e||0,0>e&&(e+=this.length),void 0===i&&(i=1/0);var s=[];if(this.root){this.splayIndex(e);for(var a=0;i>a;a++){s.push(this.root.value);var u=this.root.getNext();if(this["delete"](this.root.value),!u)break;this.splay(u.value)}}return this.addEach(t),s},s.prototype.splay=function(e){var i,t,s,u,n,r;if(this.root){for(i=t=s=new this.Node,r=new this.Node,n=this.root;;){var l=this.contentCompare(e,n.value);if(0>l){if(!n.left)break;if(0>this.contentCompare(e,n.left.value)&&(u=n.left,n.left=u.right,n.touch(),u.right=n,u.touch(),n=u,!n.left))break;u=new a,u.right=n,u.left=r.left,r.left=u,s.left=n,s.touch(),s=n,n=n.left}else{if(!(l>0))break;if(!n.right)break;if(this.contentCompare(e,n.right.value)>0&&(u=n.right,n.right=u.left,n.touch(),u.left=n,u.touch(),n=u,!n.right))break;
u=new a,u.left=n,u.right=r.right,r.right=u,t.right=n,t.touch(),t=n,n=n.right}}for(t.right=n.left,t.touch(),s.left=n.right,s.touch(),n.left=i.right,n.right=i.left;r.left;)r.left.right.touch(),r.left=r.left.left;for(;r.right;)r.right.left.touch(),r.right=r.right.right;n.touch(),this.root=n}},s.prototype.splayIndex=function(e){if(this.root){for(var i=this.root,t=this.root.index;t!==e;)if(t>e&&i.left)i=i.left,t-=1+(i.right?i.right.length:0);else{if(!(e>t&&i.right))break;i=i.right,t+=1+(i.left?i.left.length:0)}return this.splay(i.value),this.root.index===e}return!1},s.prototype.reduce=function(e,i,t){return this.root&&(i=this.root.reduce(e,i,0,t,this)),i},s.prototype.reduceRight=function(e,i,t){return this.root&&(i=this.root.reduceRight(e,i,this.length-1,t,this)),i},s.prototype.min=function(e){var i=this.findLeast(e);return i?i.value:void 0},s.prototype.max=function(e){var i=this.findGreatest(e);return i?i.value:void 0},s.prototype.one=function(){return this.min()},s.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},s.prototype.iterate=function(e,i){return new this.Iterator(this,e,i)},s.prototype.Iterator=u,s.prototype.summary=function(){return this.root?this.root.summary():"()"},s.prototype.log=function(e,i,t,s){e=e||c.unicodeRound,i=i||this.logNode,t||(t=console.log,s=console),t=t.bind(s),this.root&&this.root.log(e,i,t,t)},s.prototype.logNode=function(e,i){i(" "+e.value)},s.logCharsets=c,s.prototype.Node=a,a.prototype.reduce=function(e,i,t,s,a,u){if(u=u||0,this.left){var n=this.left.length;i=this.left.reduce(e,i,t,s,a,u+1),t+=n}return i=e.call(s,i,this.value,t,a,this,u),t+=1,this.right&&(i=this.right.reduce(e,i,t,s,a,u+1)),i},a.prototype.reduceRight=function(e,i,t,s,a,u){return u=u||0,this.right&&(i=this.right.reduce(e,i,t,s,a,u+1),t-=this.right.length),i=e.call(s,i,this.value,this.value,a,this,u),t-=1,this.left&&(i=this.left.reduce(e,i,t,s,a,u+1)),i},a.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},a.prototype.checkIntegrity=function(){var e=1;if(e+=this.left?this.left.checkIntegrity():0,e+=this.right?this.right.checkIntegrity():0,this.length!==e)throw Error("Integrity check failed: "+this.summary());return e},a.prototype.getNext=function(){var e=this;if(e.right){for(e=e.right;e.left;)e=e.left;return e}},a.prototype.getPrevious=function(){var e=this;if(e.left){for(e=e.left;e.right;)e=e.right;return e}},a.prototype.summary=function(){var e=this.value||"-";return e+=" <"+this.length,this.left||this.right?"("+e+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+e+")"},a.prototype.log=function(e,i,t,s){var a,u=this;a=this.left&&this.right?e.intersection:this.left?e.branchUp:this.right?e.branchDown:e.through;var n;this.left&&this.left.log(e,i,function(i){n?s(e.strafe+" "+i):(n=!0,s(e.fromBelow+e.through+i))},function(e){s("  "+e)});var r;i(this,function(i){r?t((u.right?e.strafe:" ")+i):(r=!0,t(a+i))},function(i){s((u.left?e.strafe:" ")+i)});var l;this.right&&this.right.log(e,i,function(i){l?t("  "+i):(l=!0,t(e.fromAbove+e.through+i))},function(i){t(e.strafe+" "+i)})},u.prototype.next=function(){var e;if(e=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast(),!e)throw StopIteration;if(void 0!==this.end&&this.set.contentCompare(e.value,this.end)>=0)throw StopIteration;return this.prev=e,e.value}}}),montageDefine("45fb404","heap",{dependencies:["./listen/array-changes","./shim","./generic-collection","./listen/map-changes","./listen/range-changes","./listen/property-changes","heap"],factory:function(e,i,t){function s(e,i,t){return this instanceof s?(this.contentEquals=i||Object.equals,this.contentCompare=t||Object.compare,this.content=[],this.length=0,this.addEach(e),void 0):new s(e,i,t)}e("./listen/array-changes"),e("./shim");var a=e("./generic-collection"),u=e("./listen/map-changes"),n=e("./listen/range-changes"),r=e("./listen/property-changes");t.exports=s,s.Heap=s,Object.addEach(s.prototype,a.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,u.prototype),s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare)},s.prototype.push=function(e){this.content.push(e),this.float(this.content.length-1),this.length++},s.prototype.pop=function(){var e=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content.set(0,i),this.sink(0)),this.length--,e},s.prototype.add=function(e){this.push(e)},s.prototype.indexOf=function(e){for(var i=0;this.length>i;i++)if(this.contentEquals(this.content[i],e))return i;return-1},s.prototype["delete"]=function(e,i){if(i)throw Error("Heap#delete does not support second argument: equals");var t=this.indexOf(e);if(-1===t)return!1;var s=this.content.pop();if(t===this.content.length)return!0;this.content.set(t,s);var a=this.contentCompare(s,e);return a>0?this.float(t):0>a&&this.sink(t),this.length--,!0},s.prototype.peek=function(){return this.length?this.content[0]:void 0},s.prototype.max=function(){return this.peek()},s.prototype.one=function(){return this.peek()},s.prototype.float=function(e){for(var i=this.content[e];e>0;){var t=Math.floor((e+1)/2)-1,s=this.content[t];if(!(0>this.contentCompare(s,i)))break;this.content.set(t,i),this.content.set(e,s),e=t}},s.prototype.sink=function(e){for(var i,t,s,a,u,n,r=this.content.length,l=this.content[e];;){if(a=2*(e+1),s=a-1,n=!1,r>s){var i=this.content[s],o=this.contentCompare(i,l);o>0&&(u=s,n=!0)}if(r>a){var t=this.content[a],o=this.contentCompare(t,n?i:l);o>0&&(u=a,n=!0)}if(!n)break;this.content.set(e,this.content[u]),this.content.set(u,l),e=u}},s.prototype.clear=function(){this.content.clear(),this.length=0},s.prototype.reduce=function(e,i){var t=arguments[2];return this.content.reduce(function(i,s,a){return e.call(t,i,s,a,this)},i,this)},s.prototype.reduceRight=function(e,i){var t=arguments[2];return this.content.reduceRight(function(i,s,a){return e.call(t,i,s,a,this)},i,this)},s.prototype.makeObservable=function(){this.content.addRangeChangeListener(this,"content"),this.content.addBeforeRangeChangeListener(this,"content"),this.content.addMapChangeListener(this,"content"),this.content.addBeforeMapChangeListener(this,"content")},s.prototype.handleContentRangeChange=function(e,i,t){this.dispatchRangeChange(e,i,t)},s.prototype.handleContentRangeWillChange=function(e,i,t){this.dispatchBeforeRangeChange(e,i,t)},s.prototype.handleContentMapChange=function(e,i){this.dispatchMapChange(i,e)},s.prototype.handleContentMapWillChange=function(e,i){this.dispatchBeforeMapChange(i,e)}}}),montageDefine("45fb404","generic-order",{dependencies:["./shim-object"],factory:function(e,i,t){function s(){throw Error("Can't construct. GenericOrder is a mixin.")}var a=e("./shim-object");t.exports=s,s.prototype.equals=function(e,i){return i=i||this.contentEquals||a.equals,this===e?!0:e?this.length===e.length&&this.zip(e).every(function(e){return i(e[0],e[1])}):!1},s.prototype.compare=function(e,i){if(i=i||this.contentCompare||a.compare,this===e)return 0;if(!e)return 1;var t=Math.min(this.length,e.length),s=this.zip(e).reduce(function(e,s,a){return 0===e?a>=t?e:i(s[0],s[1]):e},0);return 0===s?this.length-e.length:s}}}),montageDefine("45fb404","list",{dependencies:["./shim","./generic-collection","./generic-order","./listen/property-changes","./listen/range-changes","list"],factory:function(e,i,t){"use strict";function s(e,i,t){if(!(this instanceof s))return new s(e,i,t);var a=this.head=new this.Node;a.next=a,a.prev=a,this.contentEquals=i||Object.equals,this.getDefault=t||Function.noop,this.length=0,this.addEach(e)}function a(e){this.head=e,this.at=e.next}function u(e){this.value=e,this.prev=null,this.next=null}t.exports=s,e("./shim");var n=e("./generic-collection"),r=e("./generic-order"),l=e("./listen/property-changes"),o=e("./listen/range-changes");s.List=s,Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,l.prototype),Object.addEach(s.prototype,o.prototype),s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},s.prototype.find=function(e,i,t){i=i||this.contentEquals;for(var s=this.head,a=this.scan(t,s.next);a!==s;){if(i(a.value,e))return a;a=a.next}},s.prototype.findLast=function(e,i,t){i=i||this.contentEquals;for(var s=this.head,a=this.scan(t,s.prev);a!==s;){if(i(a.value,e))return a;a=a.prev}},s.prototype.has=function(e,i){return!!this.find(e,i)},s.prototype.get=function(e,i){var t=this.find(e,i);return t?t.value:this.getDefault(e)},s.prototype["delete"]=function(e,i){var t=this.findLast(e,i);if(t){if(this.dispatchesRangeChanges){var s=[],a=[e];this.dispatchBeforeRangeChange(s,a,t.index)}return t["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(t.next,t.index),this.dispatchRangeChange(s,a,t.index)),!0}return!1},s.prototype.clear=function(){var e,i;this.dispatchesRangeChanges&&(i=this.toArray(),e=[],this.dispatchBeforeRangeChange(e,i,0)),this.head.next=this.head.prev=this.head,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange(e,i,0)},s.prototype.add=function(e){var i=new this.Node(e);return this.dispatchesRangeChanges&&(i.index=this.length,this.dispatchBeforeRangeChange([e],[],i.index)),this.head.addBefore(i),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],i.index),!0},s.prototype.push=function(){var e=this.head;if(this.dispatchesRangeChanges){var i=Array.prototype.slice.call(arguments),t=[],s=this.length;this.dispatchBeforeRangeChange(i,t,s);var a=this.head.prev}for(var u=0;arguments.length>u;u++){var n=arguments[u],r=new this.Node(n);e.addBefore(r)}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(a.next,void 0===a.index?0:a.index+1),this.dispatchRangeChange(i,t,s))},s.prototype.unshift=function(){if(this.dispatchesRangeChanges){var e=Array.prototype.slice.call(arguments),i=[];this.dispatchBeforeRangeChange(e,i,0)}for(var t=this.head,s=0;arguments.length>s;s++){var a=arguments[s],u=new this.Node(a);t.addAfter(u),t=u}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(e,i,0))},s.prototype.pop=function(){var e,i=this.head;if(i.prev!==i){if(e=i.prev.value,this.dispatchesRangeChanges){var t=[],s=[e],a=this.length-1;this.dispatchBeforeRangeChange(t,s,a)}i.prev["delete"](),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange(t,s,a)}return e},s.prototype.shift=function(){var e,i=this.head;if(i.prev!==i){if(e=i.next.value,this.dispatchesRangeChanges){var t=[],s=[e];this.dispatchBeforeRangeChange(t,s,0)}i.next["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(t,s,0))}return e},s.prototype.peek=function(){return this.head!==this.head.next?this.head.next.value:void 0},s.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},s.prototype.one=function(){return this.peek()},s.prototype.scan=function(e,i){var t=this.head;if("number"==typeof e){var s=e;if(s>=0)for(e=t.next;s&&(s--,e=e.next,e!=t););else for(e=t;0>s&&(s++,e=e.prev,e!=t););return e}return e||i},s.prototype.slice=function(e,i){var t=[],s=this.head;for(e=this.scan(e,s.next),i=this.scan(i,s);e!==i&&e!==s;)t.push(e.value),e=e.next;return t},s.prototype.splice=function(e,i){return this.swap(e,i,Array.prototype.slice.call(arguments,2))},s.prototype.swap=function(e,i,t){var s=e;e=this.scan(e,this.head),null==i&&(i=1/0),t=Array.from(t);for(var a=[],u=e;i--&&i>=0&&u!==this.head;)a.push(u.value),u=u.next;var n,r;this.dispatchesRangeChanges&&(n=e===this.head?this.length:e.prev===this.head?0:e.index,r=e.prev,this.dispatchBeforeRangeChange(t,a,n));for(var u=e,l=0,u=e;a.length>l;l++,u=u.next)u["delete"]();null==s&&u===this.head&&(u=this.head.next);for(var l=0;t.length>l;l++){var o=new this.Node(t[l]);u.addBefore(o)}return this.length+=t.length-a.length,this.dispatchesRangeChanges&&(e===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(r.next,r.index+1),this.dispatchRangeChange(t,a,n)),a},s.prototype.reverse=function(){if(this.dispatchesRangeChanges){var e=this.toArray(),i=e.reversed();this.dispatchBeforeRangeChange(i,e,0)}var t=this.head;do{var s=t.next;t.next=t.prev,t.prev=s,t=t.next}while(t!==this.head);return this.dispatchesRangeChanges&&this.dispatchRangeChange(i,e,0),this},s.prototype.sort=function(){this.swap(0,this.length,this.sorted())},s.prototype.reduce=function(e,i){for(var t=arguments[2],s=this.head,a=s.next;a!==s;)i=e.call(t,i,a.value,a,this),a=a.next;return i},s.prototype.reduceRight=function(e,i){for(var t=arguments[2],s=this.head,a=s.prev;a!==s;)i=e.call(t,i,a.value,a,this),a=a.prev;return i},s.prototype.updateIndexes=function(e,i){for(;e!==this.head;)e.index=i++,e=e.next},s.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},s.prototype.iterate=function(){return new a(this.head)},a.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},s.prototype.Node=u,u.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},u.prototype.addBefore=function(e){var i=this.prev;this.prev=e,e.prev=i,i.next=e,e.next=this},u.prototype.addAfter=function(e){var i=this.next;this.next=e,e.next=i,i.prev=e,e.prev=this}}}),montageDefine("45fb404","fast-set",{dependencies:["./shim","./dict","./list","./generic-collection","./generic-set","./tree-log","./listen/property-changes","fast-set"],factory:function(e,i,t){"use strict";function s(e,i,t,a){return this instanceof s?(i=i||Object.equals,t=t||Object.hash,a=a||Function.noop,this.contentEquals=i,this.contentHash=t,this.getDefault=a,this.buckets=new this.Buckets(null,this.Bucket),this.length=0,this.addEach(e),void 0):new s(e,i,t,a)}e("./shim");var a=e("./dict"),u=e("./list"),n=e("./generic-collection"),r=e("./generic-set"),l=e("./tree-log"),o=e("./listen/property-changes");Object.prototype.hasOwnProperty,t.exports=s,s.FastSet=s,Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,o.prototype),s.prototype.Buckets=a,s.prototype.Bucket=u,s.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},s.prototype.has=function(e){var i=this.contentHash(e);return this.buckets.get(i).has(e)},s.prototype.get=function(e,i){if(i)throw Error("FastSet#get does not support second argument: equals");var t=this.contentHash(e),s=this.buckets;return s.has(t)?s.get(t).get(e):this.getDefault(e)},s.prototype["delete"]=function(e,i){if(i)throw Error("FastSet#delete does not support second argument: equals");var t=this.contentHash(e),s=this.buckets;if(s.has(t)){var a=s.get(t);if(a["delete"](e))return this.length--,0===a.length&&s["delete"](t),!0}return!1},s.prototype.clear=function(){this.buckets.clear(),this.length=0},s.prototype.add=function(e){var i=this.contentHash(e),t=this.buckets;return t.has(i)||t.set(i,new this.Bucket(null,this.contentEquals)),t.get(i).has(e)?!1:(t.get(i).add(e),this.length++,!0)},s.prototype.reduce=function(e,i){var t=arguments[2],s=this.buckets,a=0;return s.reduce(function(i,s){return s.reduce(function(i,s){return e.call(t,i,s,a++,this)},i,this)},i,this)},s.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},s.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},s.prototype.log=function(e,i,t,s){e=e||l.unicodeSharp,i=i||this.logNode,t||(t=console.log,s=console),t=t.bind(s);var a=this.buckets,u=a.keys();u.forEach(function(n,r){var l,o;r===u.length-1?(l=e.fromAbove,o=" "):0===r?(l=e.branchDown,o=e.strafe):(l=e.fromBoth,o=e.strafe);var c=a.get(n);t.call(s,l+e.through+e.branchDown+" "+n),c.forEach(function(a,u){var n,r;u===c.head.prev?(n=e.fromAbove,r=" "):(n=e.fromBoth,r=e.strafe);var l;i(u,function(i){l?t.call(s,o+" "+r+"  "+i):(t.call(s,o+" "+n+e.through+e.through+i),l=!0)},function(i){t.call(s,o+" "+e.strafe+"  "+i)})})})},s.prototype.logNode=function(e,i){var t=e.value;Object(t)===t?JSON.stringify(t,null,4).split("\n").forEach(function(e){i(" "+e)}):i(" "+t)}}}),montageDefine("45fb404","generic-set",{dependencies:[],factory:function(e,i,t){function s(){throw Error("Can't construct. GenericSet is a mixin.")}t.exports=s,s.prototype.isSet=!0,s.prototype.union=function(e){var i=this.constructClone(this);return i.addEach(e),i},s.prototype.intersection=function(e){return this.constructClone(this.filter(function(i){return e.has(i)}))},s.prototype.difference=function(e){var i=this.constructClone(this);return i.deleteEach(e),i},s.prototype.symmetricDifference=function(e){var i=this.union(e),t=this.intersection(e);return i.difference(t)},s.prototype.equals=function(e,i){var t=this;return e&&"function"==typeof e.reduce&&this.length===e.length&&e.reduce(function(e,s){return e&&t.has(s,i)},!0)},s.prototype.contains=function(e){return this.has(e)},s.prototype.remove=function(e){return this["delete"](e)},s.prototype.toggle=function(e){this.has(e)?this["delete"](e):this.add(e)}}}),montageDefine("45fb404","listen/range-changes",{dependencies:["weak-map","../dict"],factory:function(e,i,t){"use strict";function s(){throw Error("Can't construct. RangeChanges is a mixin.")}var a=e("weak-map"),u=e("../dict"),n=new a;t.exports=s,s.prototype.getAllRangeChangeDescriptors=function(){return n.has(this)||n.set(this,u()),n.get(this)},s.prototype.getRangeChangeDescriptor=function(e){var i=this.getAllRangeChangeDescriptors();return e=e||"",i.has(e)||i.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),i.get(e)},s.prototype.addRangeChangeListener=function(e,i,t){!this.isObservable&&this.makeObservable&&this.makeObservable();var s,a=this.getRangeChangeDescriptor(i);s=t?a.willChangeListeners:a.changeListeners,s.push(e),Object.defineProperty(this,"dispatchesRangeChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var u=this;return function(){u&&(u.removeRangeChangeListener(e,i,t),u=null)}},s.prototype.removeRangeChangeListener=function(e,i,t){var s,a=this.getRangeChangeDescriptor(i);s=t?a.willChangeListeners:a.changeListeners;var u=s.lastIndexOf(e);if(-1===u)throw Error("Can't remove range change listener: does not exist: token "+JSON.stringify(i));s.splice(u,1)},s.prototype.dispatchRangeChange=function(e,i,t,s){var a=this.getAllRangeChangeDescriptors(),u="Range"+(s?"WillChange":"Change");a.forEach(function(a,n){if(!a.isActive){a.isActive=!0;var r;r=s?a.willChangeListeners:a.changeListeners;var l="handle"+(n.slice(0,1).toUpperCase()+n.slice(1))+u;try{r.slice().forEach(function(a){if(!(0>r.indexOf(a)))if(a[l])a[l](e,i,t,this,s);else{if(!a.call)throw Error("Handler "+a+" has no method "+l+" and is not callable");a.call(this,e,i,t,this,s)}},this)}finally{a.isActive=!1}}},this)},s.prototype.addBeforeRangeChangeListener=function(e,i){return this.addRangeChangeListener(e,i,!0)},s.prototype.removeBeforeRangeChangeListener=function(e,i){return this.removeRangeChangeListener(e,i,!0)},s.prototype.dispatchBeforeRangeChange=function(e,i,t){return this.dispatchRangeChange(e,i,t,!0)}}}),montageDefine("45fb404","listen/map-changes",{dependencies:["weak-map","../list","../dict"],factory:function(e,i,t){"use strict";function s(){throw Error("Can't construct. MapChanges is a mixin.")}var a=e("weak-map"),u=e("../list");t.exports=s,Object.prototype.hasOwnProperty;var n=new a;s.prototype.getAllMapChangeDescriptors=function(){var i=e("../dict");return n.has(this)||n.set(this,i()),n.get(this)},s.prototype.getMapChangeDescriptor=function(e){var i=this.getAllMapChangeDescriptors();return e=e||"",i.has(e)||i.set(e,{willChangeListeners:new u,changeListeners:new u}),i.get(e)},s.prototype.addMapChangeListener=function(e,i,t){!this.isObservable&&this.makeObservable&&this.makeObservable();var s,a=this.getMapChangeDescriptor(i);s=t?a.willChangeListeners:a.changeListeners,s.push(e),Object.defineProperty(this,"dispatchesMapChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var u=this;return function(){u&&(u.removeMapChangeListener(e,i,t),u=null)}},s.prototype.removeMapChangeListener=function(e,i,t){var s,a=this.getMapChangeDescriptor(i);s=t?a.willChangeListeners:a.changeListeners;var u=s.findLast(e);if(!u)throw Error("Can't remove map change listener: does not exist: token "+JSON.stringify(i));u["delete"]()},s.prototype.dispatchMapChange=function(e,i,t){var s=this.getAllMapChangeDescriptors(),a="Map"+(t?"WillChange":"Change");s.forEach(function(s,u){if(!s.isActive){s.isActive=!0;var n;n=t?s.willChangeListeners:s.changeListeners;var r="handle"+(u.slice(0,1).toUpperCase()+u.slice(1))+a;try{n.forEach(function(t){if(t[r])t[r](i,e,this);else{if(!t.call)throw Error("Handler "+t+" has no method "+r+" and is not callable");t.call(t,i,e,this)}},this)}finally{s.isActive=!1}}},this)},s.prototype.addBeforeMapChangeListener=function(e,i){return this.addMapChangeListener(e,i,!0)},s.prototype.removeBeforeMapChangeListener=function(e,i){return this.removeMapChangeListener(e,i,!0)},s.prototype.dispatchBeforeMapChange=function(e,i){return this.dispatchMapChange(e,i,!0)}}}),montageDefine("45fb404","tree-log",{dependencies:[],factory:function(e,i,t){"use strict";function s(){}t.exports=s,s.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},s.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},s.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}}}),montageDefine("45fb404","dict",{dependencies:["./shim","./generic-collection","./generic-map","./listen/property-changes","dict"],factory:function(e,i,t){"use strict";function s(e,i){return this instanceof s?(i=i||Function.noop,this.getDefault=i,this.store={},this.length=0,this.addEach(e),void 0):new s(e,i)}function a(e){return"~"+e}function u(e){return e.slice(1)}e("./shim");var n=e("./generic-collection"),r=e("./generic-map"),l=e("./listen/property-changes");t.exports=s,s.Dict=s,Object.addEach(s.prototype,n.prototype),Object.addEach(s.prototype,r.prototype),Object.addEach(s.prototype,l.prototype),s.prototype.constructClone=function(e){return new this.constructor(e,this.mangle,this.getDefault)},s.prototype.assertString=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e)},s.prototype.get=function(e,i){this.assertString(e);var t=a(e);return t in this.store?this.store[t]:arguments.length>1?i:this.getDefault(e)},s.prototype.set=function(e,i){this.assertString(e);var t=a(e);return t in this.store?(this.dispatchesBeforeMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),this.store[t]=i,this.dispatchesMapChanges&&this.dispatchMapChange(e,i),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.length++,this.store[t]=i,this.dispatchesMapChanges&&this.dispatchMapChange(e,i),!0)},s.prototype.has=function(e){this.assertString(e);var i=a(e);return i in this.store},s.prototype["delete"]=function(e){this.assertString(e);var i=a(e);return i in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[i]),delete this.store[a(e)],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1},s.prototype.clear=function(){var e,i;for(i in this.store)e=u(i),this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[i]),delete this.store[i],this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0);this.length=0},s.prototype.reduce=function(e,i,t){for(var s in this.store)i=e.call(t,i,this.store[s],u(s),this);return i},s.prototype.reduceRight=function(e,i,t){var s=this,a=this.store;return Object.keys(this.store).reduceRight(function(i,n){return e.call(t,i,a[n],u(n),s)},i)},s.prototype.one=function(){var e;for(e in this.store)return this.store[e]}}}),montageDefine("70e9633","parse",{dependencies:["collections/shim","./grammar"],factory:function(e,i,t){function s(e,i){if(Array.isArray(e))return{type:"tuple",args:e.map(function(e){return s(e,i)})};if(!i&&Object.prototype.hasOwnProperty.call(u,e))return u[e];try{var t=a.parse(e,i||Object.empty);return i||(u[e]=t),t}catch(n){throw n.message=n.message.replace(/[\s\.]+$/,"")+" "+" on line "+n.line+" column "+n.column,n}}e("collections/shim");var a=e("./grammar"),u={};t.exports=s}}),montageDefine("70e9633","evaluate",{dependencies:["./parse","./compile-evaluator","./scope"],factory:function(e,i,t){function s(e,i,t,s,r){var l;l="string"==typeof e?a(e):e;var o=u(l),c=new n(i);return c.parameters=t,c.document=s,c.components=r,o(c)}var a=e("./parse"),u=e("./compile-evaluator"),n=e("./scope");t.exports=s}}),montageDefine("70e9633","assign",{dependencies:["./parse","./compile-assigner","./scope"],factory:function(e,i,t){function s(e,i,t,s,r,l){var o;o="string"==typeof i?a(i):i;var c=u(o),m=new n(e);return m.parameters=s,m.document=r,m.components=l,c(t,m)}var a=e("./parse"),u=e("./compile-assigner"),n=e("./scope");t.exports=s}}),montageDefine("70e9633","observe",{dependencies:["./parse","./compile-observer","./observers","./scope"],factory:function(e,i,t){function s(e,i,t){var s;s="function"==typeof t?{change:t}:t,s=s||o,s.source=e,s.sourcePath=i;var c=s.parameters=s.parameters||e,m=s.document,d=s.components,p=s.beforeChange,v=s.contentChange,h=new l(e);h.parameters=c,h.document=m,h.components=d,h.beforeChange=p;var g=a(i),f=u(g);return v===!0&&(f=n.makeRangeContentObserver(f)),f(r(function(i){if(i){if("function"!=typeof v)return s.change.apply(e,arguments);if("function"==typeof v)return i.addRangeChangeListener(v),function(){i.removeRangeChangeListener(v)}}}),h)}var a=e("./parse"),u=e("./compile-observer"),n=e("./observers"),r=n.autoCancelPrevious,l=e("./scope");t.exports=s;var o={}}}),montageDefine("70e9633","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,i,t){function s(e,i,t){t.target=e,t.targetPath=i;var s=t.source=t.source||e,o=t["<-"]||t["<->"]||"",c=t.twoWay="<->"in t;t.sourcePath=o,t.value;var m=t.parameters=t.parameters||s,d=t.document,p=t.components,h=t.trace,g=t.sourceScope=new v(s);g.parameters=m,g.document=d,g.components=p;var f=t.targetScope=new v(e);if(f.parameters=m,f.document=d,f.components=p,t.converter){var b=t.converter;b.convert&&(t.convert=b.convert.bind(b)),b.revert&&(t.revert=b.revert.bind(b))}else if(t.reverter){var q=t.reverter;q.convert&&(t.revert=q.convert.bind(q)),q.revert&&(t.convert=q.revert.bind(q))}var y=t.convert,S=t.revert,_=t.sourceSyntax=n(o),P=t.targetSyntax=n(i),C=r(P,_);if(P=C[0],_=C[1],c&&"rangeContent"===P.type)return u(f,P.args[0],g,_,y,S,t,h?{sourcePath:l(_),targetPath:l(P.args[0])}:null);h&&console.log("DEFINE BINDING",i,"<-",o,e);var N=a(f,P,g,_,y,t,h),C=r(_,P);_=C[0],P=C[1];var D=Function.noop;return c&&(h&&console.log("DEFINE BINDING",i,"->",o,s),D=a(g,_,f,P,S,t,h)),function(){N(),D()}}function a(e,i,t,s,a,u,n){var r=o(s);a&&(r=d.makeConverterObserver(r,a,t));var m=c(i);return m(r,t,e,u,n?{sourcePath:l(s),targetPath:l(i)}:null)}function u(e,i,t,s,a,u,n,r){function l(e,i,t){g||(g=!0,r&&console.log("RANGE CONTENT PROPAGATED",r.targetPath,"<-",r.sourcePath,"PLUS",e,"MINUS",i,"AT",t),v.swap(t,i.length,e),g=!1)}function c(e,i,t){g||(g=!0,r&&console.log("RANGE CONTENT PROPAGATED",r.targetPath,"->",r.sourcePath,"PLUS",e,"MINUS",i,"AT",t),h.swap(t,i.length,e),g=!1)}function d(){if(h!==v){r&&console.log("RANGE CONTENT BOUND",r.targetPath,"<->",r.sourcePath),g=!0;var i=p(h,l,t),s=p(v,c,e);return g=!1,function(){r&&console.log("RANGE CONTENT UNBOUND",r.targetPath,"<->",r.sourcePath),i(),s()}}}var v,h,g,f=o(s),b=o(i),q=m(s),y=m(i),S=Function.noop;g=!0;var _=b(function(e){S(),S=Function.noop,r&&console.log("RANGE CONTENT TARGET",r.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(v=e,h&&v?(r&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",r.targetPath,"->",r.sourcePath,"WITH",v),g=!0,h.swap(0,h.length,v),g=!1,S=d()):h||g||(r&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",r.targetPath,"<-",tarce.sourcePath,"WITH",h),q(v.clone(),t)))},e);g=!1;var P=f(function(i){S(),S=Function.noop,r&&console.log("RANGE CONTENT SOURCE",r.sourcePath,"SET TO",i),i&&i.addRangeChangeListener&&(h=i,v&&h?(r&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",r.targetPath,"<-",r.sourcePath,"WITH",h),g=!0,v.swap(0,v.length,h),g=!1,S=d()):v||y(h.clone(),e))},t);return v||h||q([],t),function(){S(),_(),P()}}var n=e("./parse"),r=e("./algebra"),l=e("./stringify"),o=e("./compile-observer"),c=e("./compile-binder"),m=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var v=e("./scope");t.exports=s}}),montageDefine("70e9633","compile-observer",{dependencies:["./observers","./operators"],factory:function(e,i,t){function s(e){return n.compile(e)}var a=e("./observers"),u=e("./operators");t.exports=s;var n=s.semantics={compilers:{property:a.makePropertyObserver,get:a.makeGetObserver,path:a.makePathObserver,"with":a.makeWithObserver,"if":a.makeConditionalObserver,parent:a.makeParentObserver,not:a.makeNotObserver,and:a.makeAndObserver,or:a.makeOrObserver,"default":a.makeDefaultObserver,defined:a.makeDefinedObserver,rangeContent:Function.identity,mapContent:Function.identity,keys:a.makeKeysObserver,values:a.makeValuesObserver,items:a.makeEntriesObserver,entries:a.makeEntriesObserver,toMap:a.makeToMapObserver,mapBlock:a.makeMapBlockObserver,filterBlock:a.makeFilterBlockObserver,everyBlock:a.makeEveryBlockObserver,someBlock:a.makeSomeBlockObserver,sortedBlock:a.makeSortedBlockObserver,sortedSetBlock:a.makeSortedSetBlockObserver,groupBlock:a.makeGroupBlockObserver,groupMapBlock:a.makeGroupMapBlockObserver,minBlock:a.makeMinBlockObserver,maxBlock:a.makeMaxBlockObserver,min:a.makeMinObserver,max:a.makeMaxObserver,enumerate:a.makeEnumerationObserver,reversed:a.makeReversedObserver,flatten:a.makeFlattenObserver,concat:a.makeConcatObserver,view:a.makeViewObserver,sum:a.makeSumObserver,average:a.makeAverageObserver,last:a.makeLastObserver,only:a.makeOnlyObserver,one:a.makeOneObserver,has:a.makeHasObserver,tuple:a.makeArrayObserver,range:a.makeRangeObserver,startsWith:a.makeStartsWithObserver,endsWith:a.makeEndsWithObserver,contains:a.makeContainsObserver,join:a.makeJoinObserver,toArray:a.makeToArrayObserver,asArray:a.makeToArrayObserver},compile:function(e){var i=this.compilers;if("literal"===e.type)return a.makeLiteralObserver(e.value);if("value"===e.type)return a.observeValue;if("parameters"===e.type)return a.observeParameters;if("element"===e.type)return a.makeElementObserver(e.id);if("component"===e.type)return a.makeComponentObserver(e.label,e);if("record"===e.type){var t={},s=e.args;for(var u in s)t[u]=this.compile(s[u]);return a.makeObjectObserver(t)}i.hasOwnProperty(e.type)||(i[e.type]=a.makeMethodObserverMaker(e.type));var n=e.args.map(this.compile,this);return i[e.type].apply(null,n)}},r=n.compilers;Object.keys(u).forEach(function(e){r[e]||(r[e]=a.makeOperatorObserverMaker(u[e]))}),r.toString=a.makeOperatorObserverMaker(u.toString)}}),montageDefine("70e9633","scope",{dependencies:[],factory:function(e,i,t){function s(e){this.parent=null,this.value=e}t.exports=s,s.prototype.nest=function(e){var i=Object.create(this);return i.value=e,i.parent=this,i}}}),montageDefine("70e9633","observers",{dependencies:["collections/shim","collections/listen/property-changes","collections/listen/array-changes","collections/sorted-array","collections/sorted-set","collections/map","collections/set","collections/heap","./scope","./operators","./parse","./compile-observer","./merge"],factory:function(e,i){function t(e){return function(i){return i(e)
}}function s(e,i){return e(i.value)}function a(e,i){return e(i.parameters)}function u(e){return function(i,t){return i(t.document.getElementById(e))}}function n(e){return function(i,t){var s=t.components,a=s.getObjectByLabel||s.getComponentByLabel,u=a.call(s,e);return i(u)}}function r(e,i,t,s){function a(e,i,s){u&&u(),u=t(e,i,s)}if(null==e)return t();var u;return Ci.addOwnPropertyChangeListener(e,i,a,s.beforeChange),a(e[i],i,e),function(){u&&u(),Ci.removeOwnPropertyChangeListener(e,i,a,s.beforeChange)}}function l(e,i){return function(t,s){return i(function(i){return"string"!=typeof i&&"number"!=typeof i?t():e(function(e){return null==e?t():e.observeProperty?e.observeProperty(i,t,s):wi(e,i,t,s)},s)},s)}}function o(e,i,t,s){function a(e,s,a){n(i,s)&&(u&&u(),u=t(e,i,a))}var u,n=e.contentEquals||Object.equals;return a(e.get(i),i,e),e.addMapChangeListener(a,s.beforeChange),function(){u&&u(),e.removeMapChangeListener(a)}}function c(e,i){return function(t,s){return e(function(e){return e?i(function(i){return null==i?t():e.observeGet?e.observeGet(i,t,s):Ii(e,i,t,s)},s):t()},s)}}function m(e,i){return function(t,s){return t=yi(t),i(function(i){return e(function(e){return e?e.addRangeChangeListener?J(e,function(){return t((e.has||e.contains).call(e,i))},s):e.addMapChangeListener?ni(e,function(){return t(e.has(i))},s):t():t()},s)},s)}}function d(e){return function(i,t){for(var s=[],a=[],u=0;e.length>u;u++)s[u]=void 0,a[u]=function(e,i){return e(function(e){s.set(i,e)},t)}(e[u],u);var n=i(s);return function(){n&&n();for(var e=0;a.length>e;e++)n=a[e],n&&n()}}}function p(e){return function(i,t){var s={},a={};for(var u in e)(function(e,i){a[e]=void 0,s[e]=i(function(i){a[e]=i},t)})(u,e[u]);var n=i(a);return function(){n&&n();for(var e in s)n=s[e],n&&n()}}}function v(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];return d(e)}function h(e){return function(){for(var i=[],t=arguments.length;t--;)i[t]=arguments[t];var s=d(i),a=ai(s);return function(i,t){return a(function(t){return t.every(Ei.defined)?i(e.apply(void 0,t)):i()},t)}}}function g(e){var i=e.slice(0,1).toUpperCase()+e.slice(1),t="make"+i+"Observer",s="observe"+i;return function(){var i=arguments[0],a=Array.prototype.slice.call(arguments,1),u=d(a),n=ai(u);return function(u,r){return i(function(i){return i?i[t]?i[t].apply(i,a)(u,r):i[s]?i[s](u,r):n(function(t){return t.every(Ei.defined)?"function"==typeof i[e]?u(i[e].apply(i,t)):u():u()},r):u()},r)}}}function f(e){return function(i,t){return e(function(e){return i(!e)},t)}}function b(e,i){return function(t,s){return e(function(e){return e?i(t,s):t(e)},s)}}function q(e,i){return function(t,s){return e(function(e){return e?t(e):i(t,s)},s)}}function y(e,i,t){return function(s,a){return e(function(e){return null==e?s():e?i(s,a):t(s,a)},a)}}function S(e){return function(i,t){return e(function(e){return i(null!=e)},t)}}function _(e,i){return function(t,s){return e(function(e){return null==e?i(t,s):t(e)},s)}}function P(e,i){return function(t,s){return e(function(e){function a(i){for(;e.length>i;i++)r[i].index=i}function u(e,t,u){Pi(r,u,t.length,e.map(function(e,i){return{index:u+i}})),a(u+e.length);var o,c,m=[],d=u,p=u+t.length;for(d=u,p=u+t.length;p>d;d++)c=l[d],c&&c();Pi(l,u,t.length,e.map(function(e,t){var a=r[u+t];return i(function(e){o?n.set(a.index,e):m[t]=e},s.nest(e))})),o=!0,n.swap(u,t.length,m)}if(!e)return t();var n=[],r=[],l=[],o=J(e,u,s),c=t(n,e);return function(){c&&c();for(var e=0,i=l.length;i>e;e++)c=l[e],c&&c();o()}},s)}}function C(e,i){var t=P(e,i);return function(e,i){return t(function(t,s){function a(e){for(;t.length>e;e++)l[e+1]=l[e]+!!t[e]}function u(e,i,t){var u=s.slice(t,t+e.length),r=i.map(Boolean).sum(),o=u.filter(function(i,t){return e[t]}),c=l[t],m=n.slice(c,c+r);(m.length!==o.length||m.some(function(e,i){return e!==o[i]}))&&n.swap(c,r,o),a(c)}if(!s)return e();var n=[],r=[],l=[0],o=J(t,u,i),c=e(n);return function(){c&&c();for(var e=0,i=r.length;i>e;e++)c=r[e],c&&c();o()}},i)}}function N(e,i){var t=A(i),s=P(e,t),a=function(e,i){return s(function(t){function s(e,i){u.deleteEach(i),u.addEach(e)}if(!t)return e();var a=[],u=Ni(a,D,M),n=J(t,s,i),r=e(a);return function(){r&&r(),n()}},i)};return xi(a,ci)}function D(e,i){return Object.equals(e[1],i[1])}function M(e,i){return Object.compare(e[1],i[1])}function A(e){return function(i,t){return e(function(e){return i([t.value,e])},t)}}function E(e,i){var t=A(i),s=P(e,t),a=V(s,di),u=P(a,$(di));return function(e,i){function t(e,i){return e=r.get(e),i=r.get(i),Object.compare(e,i)}function s(e,i){return e=r.get(e),i=r.get(i),Object.equals(e,i)}function a(e,i){i.forEach(function(e){l["delete"](e[0]),r["delete"](e[0])}),e.forEach(function(e){r.set(e[0],e[1]),l.add(e[0])})}function n(e){return l.clear(),J(e,a,i)}var r=new Mi,l=new Di(null,s,t),o=e(l),c=u(n,i);return function(){o&&o(),c()}}}function w(e){return function(i,t){return e(function(e){function s(e,i,t){var s=a.length-t-i.length;a.swap(s,i.length,e.reversed())}if(!e)return i();var a=[],u=J(e,s,t),n=i(a);return function(){n&&n(),u()}},t)}}function I(e){return function(i,t){return e(function(e){function s(i){for(var t=i;e.length>t;t++)l[t].index=t,r[t+1]=e[t]?r[t]+e[t].length:r[t]}function a(e,i,a){var o=r[a],c=r[a+i.length],m=c-o;u.swap(o,m,[]),Pi(l,a,i.length,e.map(function(){return{index:null}})),s(a);for(var d,p=a,c=a+i.length;c>p;p++)d=n[p],d&&d();Pi(n,a,i.length,e.map(function(e,i){function n(e,i,t){s(o.index);var a=r[o.index]+t,n=r[o.index]+t+i.length,l=n-a;u.swap(a,l,e)}var o=l[a+i];return J(e,n,t)}))}if(!e)return i();var u=[],n=[],r=[0],l=[],o=J(e,a,t),c=i(u);return function(){c&&c();for(var e=0,i=n.length;i>e;e++)c=n[e],c&&c();o()}},t)}}function x(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];return Ti(d(e))}function L(e,i){var t=Li(e,i),s=l(t,Vi);return hi(s,Boolean)}function T(e,i){var t=hi(i,Ei.not),s=Li(e,t),a=l(s,Vi);return hi(a,Ei.not)}function V(e,i){var t=j(e,i);return Ri(t)}function j(e,i){var t=A(i),s=P(e,t);return function(e,i){return s(function(t,s){function a(e,i){i.forEach(function(e){var i=u.get(e[1]);1===i.length?u["delete"](e[1]):i["delete"](e[0])}),e.forEach(function(e){var i,t=!u.has(e[1]);i=t?s.constructClone():u.get(e[1]),i.add(e[0]),t&&u.set(e[1],i)})}if(!t)return e();var u=Mi(),n=J(t,a,i),r=e(u);return function(){n(),r&&r()}},i)}}function O(e,i,t){function s(e,i){return Object.compare(e[1],i[1])*t}var a=A(i),u=P(e,a);return function(e,i){return u(function(t){function a(e,i){n.addEach(e),n.deleteEach(i)}function u(i,t){return 0===t?i?e(i[0]):e():void 0}if(!t)return e();var n=new Ai(null,D,s),r=J(t,a,i),l=ni(n,u,i);return function(){r(),l()}},i)}}function F(e,i){return O(e,i,1)}function R(e,i){return O(e,i,-1)}function k(e){return O(e,s,1)}function U(e){return O(e,s,-1)}function z(e){return function(i){return function(t,s){return t=yi(t),i(function(i){if(!i)return t();var a=e(i,t);return J(i,function(e,i,s){return t(a(e,i,s))},s)},s)}}}function B(e){return"number"==typeof e&&!isNaN(e)}function Q(e,i,t){return t||(t=i,i=ji),function(s,a){return e(function(e){function u(i,t,s){if(m){var a=i.length-t.length;r>=s?a>0?(c.swap(0,0,e.slice(r,r+a)),c.splice(n,c.length-n)):(c.splice(0,-a),c.swap(c.length,0,e.slice(r+c.length,r+n))):r+n>s&&(c.swap(s-r,t.length,i),a>0?c.splice(n,c.length-n):c.swap(c.length,0,e.slice(r+c.length,r+n)))}}if(!e)return s();var n,r,l,o,c=[],m=!1,d=J(e,u,a),p=t(function(i){i=+i,isNaN(i)&&(i=void 0);var t="number"==typeof i&&"number"==typeof r,s=Math.max(0,i);"number"==typeof o&&(s=Math.min(s,e.length-o)),m!==t?(t?c.swap(0,0,e.slice(o,o+s)):c.clear(),m=t):m&&l!==s&&(l>s?c.splice(i,l-s):c.swap(l,0,e.slice(o+l,o+s))),n=i,l=s},a),v=i(function(i){i=+i,isNaN(i)&&(i=void 0);var t="number"==typeof n&&"number"==typeof i,s=Math.max(0,i);"number"==typeof n&&(s=Math.min(s,e.length));var a=Math.max(0,n);if("number"==typeof s&&(a=Math.min(a,e.length-s)),m!==t)t?c.swap(0,c.length,e.slice(s,s+a)):c.clear(),m=t;else if(m&&o!==s){var u=Math.abs(s-o);l>u&&o>s?(c.swap(0,0,e.slice(s,o)),c.splice(a,c.length-a)):l>u&&s>o?(c.swap(c.length,0,e.slice(o+l,s+a)),c.splice(0,c.length-a)):c.swap(0,c.length,e.slice(s,s+a))}r=i,o=s,l=a},a),h=s(c);return function(){h&&h(),p(),v(),d()}},a)}}function G(e){return function(i,t){return e(function(e){function s(e){for(;u.length>e;e++)u[e].set(0,e)}function a(e,i,t){u.swap(t,i.length,e.map(function(e,i){return[t+i,e]})),s(t+e.length)}if(!e)return i();var u=[],n=J(e,a,t),r=i(u);return function(){r&&r(),n()}},t)}}function W(e){return function(i,t){var s=[],a=i(s),u=e(function(e){if(e>>>=0,null==e)s.clear();else if(e>s.length){for(var i=[],t=s.length;e>t;t++)i.push(t);s.swap(s.length,0,i)}else s.length>e&&s.splice(e,s.length)},t);return function(){a&&a(),u&&u()}}}function H(e,i){return function(t,s){return i(function(i){if("string"!=typeof i)return t();var a=RegExp("^"+RegExp.escape(i));return e(function(e){return"string"!=typeof e?t():t(a.test(e))},s)},s)}}function X(e,i){return function(t,s){return i(function(i){if("string"!=typeof i)return t();var a=RegExp(RegExp.escape(i)+"$");return e(function(e){return"string"!=typeof e?t():t(a.test(e))},s)},s)}}function Y(e,i){return function(t,s){return i(function(i){if("string"!=typeof i)return t();var a=RegExp(RegExp.escape(i));return e(function(e){return"string"!=typeof e?t():t(a.test(e))},s)},s)}}function K(e,i){return i=i||Oi,function(t,s){return e(function(e){return e?i(function(i){function a(){u&&u(),u=t(e.join(i))}if("string"!=typeof i)return t();var u,n=J(e,a,s);return function(){n(),u&&u()}},s):t()},s)}}function J(e,i,t){function s(e,t,s){a&&a(),a=i(e,t,s)}if(!e)return Function.noop;var a;if(!e.toArray)return Function.noop;if(!e.addRangeChangeListener)return Function.noop;s(e.toArray(),[],0);var u=e.addRangeChangeListener(s,null,t.beforeChange);return function(){a&&a(),u()}}function $(e){return function(i,t){return e(function(e){return Fi(e,i,t)},t)}}function Z(e,i,t){function s(t,s,r){if(u+=t.length-s.length,!(u>r+s.length&&u>r+t.length)){var l=0>u?null:e.get(u);a&&a(),a=i(l),n=l}}var a,u=-1,n=null,r=J(e,s,t);return function(){a&&a(),r&&r()}}function ei(e){return function(i,t){return e(yi(function(e){return ii(e,i,t)}),t)}}function ii(e,i,t){function s(t,s){return a+=t.length-s.length,1!==a?i():i(e.only())}var a=0;return J(e,s,t)}function ti(e){return function(i,t){return e(yi(function(e){return si(e,i,t)}),t)}}function si(e,i,t){function s(t,s){return a+=t.length-s.length,0===a?i():i(e.one())}var a=0;return J(e,s,t)}function ai(e){return function(i,t){return e(function(e){return e&&e.addRangeChangeListener?J(e,function(){return i(e)},t):i(e)},t)}}function ui(e){return function(i,t){return e(function(e){return e&&e.addMapChangeListener?ni(e,function(){return i(e)},t):i(e)},t)}}function ni(e,i,t){function s(e,t,s){var u=a.get(t);a["delete"](t),u&&u(),u=i(e,t,s),void 0===e?u&&u():a.set(t,u)}if(e.addMapChangeListener){var a=new Mi;e.forEach(s);var u=e.addMapChangeListener(s,t.beforeChange);return function(){a.forEach(function(e){e&&e()}),u()}}}function ri(e){return function(i,t){return e(function(e){return e?li(e,i,t):i()},t)}}function li(e,i,t){function s(e,i){var t,s;u.has(i)?null==e?(t=u.get(i),u["delete"](i),s=a.indexOf(t),a.splice(s,1)):(t=u.get(i),t.set(1,e)):(t=[i,e],u.set(i,t),a.push(t))}var a=[],u=Mi(),n=i(a),r=ni(e,s,t);return function(){n&&n(),r&&r()}}function oi(e){var i=Ri(e);return xi(i,ci)}function ci(e,i){return i.value?e(i.value[0]):e()}function mi(e){var i=Ri(e);return xi(i,di)}function di(e,i){return i.value?e(i.value[1]):e()}function pi(e){return function(i,t){var s=new Mi,a=i(s),u=e(function(e){if(s.clear(),e&&"object"==typeof e){if(e.addRangeChangeListener)return ki(function(e){function i(e,i){i.forEach(function(e){s["delete"](e[0])}),e.forEach(function(e){s.set(e[0],e[1])})}return J(e,i,t)},t.nest(e));if(e.addMapChangeListener)return ni(e,function(e,i){void 0===e?s["delete"](i):s.set(i,e)},t);var i=[],a=0;for(var u in e)i[a++]=wi(e,u,function(e){void 0===e?s["delete"](u):s.set(u,e)},t);return function(){for(var e=0,t=i.length;t>e;e++)i[e]()}}},t)||Function.noop;return function(){a&&a(),u()}}}function vi(e){return function(i,t){return t.parent?e(i,t.parent):i()}}function hi(e,i,t){return function(s,a){return s=yi(s),e(function(e){return s(i.call(t,e))},a)}}function gi(e,i,t){return function(s,a){return s=yi(s),e(function(e){return e&&e.every(Ei.defined)?s(i.apply(t,e)):void 0},a)}}function fi(i,t){var s=e("./parse"),a=e("./compile-observer");return function(e,u){return e=yi(e),t(function(t){if(null==t)return e();var n,r;try{n=s(t),r=a(n)}catch(l){return e()}return i(function(i){return r(e,u.nest(i))},u)},u)}}function bi(e,i){return function(t,s){return e(function(e){return null==e?t():i(function(e){return null==e?t():t(e)},s.nest(e))},s)}}function qi(e){return function(){var i=e.apply(this,arguments);return function(e,t){var s=[],a=i(function(e){function i(e,i,t){s.swap(t,i.length,e)}return e&&e.addRangeChangeListener?(Ui(s,e),e.addRangeChangeListener(i,null,t.beforeChange),function(){e.removeRangeChangeListener(i,null,t.beforeChange)}):(s.clear(),void 0)},t),u=e(s);return function(){a(),u&&u()}}}}function yi(e){var i;return function(t){if(t!==i){var s=e.apply(this,arguments);return i=t,s}}}function Si(e){e.forEach(function(e){e&&e()})}function _i(e){var i;return function(){return i&&i(),i=e.apply(this,arguments),function(){i&&i(),i=void 0}}}function Pi(e,i,t,s){0>i?i=e.length+i:i>e.length&&(e.length=i),i+t>e.length?t=e.length-i:0>t&&(t=0);var a=s.length-t,u=e.length,n=e.length+a;if(a>0)for(var r=u-1;r>=i+t;r--){var l=r+a;r in e?e[l]=e[r]:(e[l]=void 0,delete e[l])}for(var r=0;s.length>r;r++)r in s?e[i+r]=s[r]:(e[i+r]=void 0,delete e[i+r]);if(0>a)for(var r=i+s.length;u-a>r;r++){var l=r-a;l in e?e[r]=e[l]:(e[r]=void 0,delete e[r])}e.length=n}e("collections/shim");var Ci=e("collections/listen/property-changes");e("collections/listen/array-changes");var Ni=e("collections/sorted-array"),Di=e("collections/sorted-set"),Mi=e("collections/map");e("collections/set");var Ai=e("collections/heap");e("./scope");var Ei=e("./operators");i.makeLiteralObserver=t,i.observeValue=s,i.observeParameters=a,i.makeElementObserver=u,i.makeComponentObserver=n,i.observeProperty=r;var wi=r;i.makePropertyObserver=l,i.observeKey=o,i.observeGet=o;var Ii=o;i.makeGetObserver=c,i.makeHasObserver=m,i.makeObserversObserver=d,i.makeRecordObserver=p,i.makeObjectObserver=p,i.makeTupleObserver=v,i.makeArrayObserver=v,i.makeOperatorObserverMaker=h,i.makeMethodObserverMaker=g,i.makeNotObserver=f,i.makeAndObserver=b,i.makeOrObserver=q,i.makeConditionalObserver=y,i.makeDefinedObserver=S,i.makeDefaultObserver=_;var xi=i.makeMapBlockObserver=qi(P),Li=i.makeFilterBlockObserver=qi(C);i.makeSortedBlockObserver=N,i.makeSortedSetBlockObserver=E,i.makeReversedObserver=qi(w);var Ti=i.makeFlattenObserver=qi(I);i.makeConcatObserver=x,i.makeSomeBlockObserver=L,i.makeEveryBlockObserver=T,i.makeGroupBlockObserver=V,i.makeGroupMapBlockObserver=j,i.makeMaxBlockObserver=F,i.makeMinBlockObserver=R,i.makeMaxObserver=k,i.makeMinObserver=U;var Vi=t("length");i.makeSumObserver=z(function(){var e=0;return function(i,t){return i=i.filter(B),t=t.filter(B),e+=i.sum()-t.sum()}}),i.makeAverageObserver=z(function(){var e=0,i=0;return function(t,s){return t=t.filter(B),s=s.filter(B),e+=t.sum()-s.sum(),i+=t.length-s.length,e/i}}),i.makeViewObserver=qi(Q);var ji=t(0);i.makeEnumerateObserver=qi(G),i.makeEnumerationObserver=i.makeEnumerateObserver,i.makeRangeObserver=W,i.makeStartsWithObserver=H,i.makeEndsWithObserver=X,i.makeContainsObserver=Y,i.makeJoinObserver=K;var Oi=t("");i.observeRangeChange=J,i.makeLastObserver=$,i.observeLast=Z;var Fi=Z;i.makeOnlyObserver=ei,i.observeOnly=ii,i.makeOneObserver=ti,i.observeOne=si,i.makeRangeContentObserver=ai,i.makeMapContentObserver=ui,i.observeMapChange=ni;var Ri=i.makeEntriesObserver=qi(ri);i.observeEntries=li,i.makeKeysObserver=oi,i.observeEntryKey=ci,i.makeValuesObserver=mi,i.observeEntryValue=di,i.makeToMapObserver=pi;var ki=xi(V(s,ci),$(di));i.makeParentObserver=vi,i.makeConverterObserver=hi,i.makeComputerObserver=gi,i.makePathObserver=fi,i.makeExpressionObserver=fi,i.makeWithObserver=bi,i.makeToArrayObserver=qi(Function.identity),i.makeAsArrayObserver=i.makeToArrayObserver;var Ui=e("./merge").merge;i.makeUniq=yi,i.cancelEach=Si,i.autoCancelPrevious=_i}}),montageDefine("70e9633","stringify",{dependencies:["./parse","./language"],factory:function(e,i,t){"use strict";function s(e,i){return s.semantics.stringify(e,i)}function a(e){return function(i,t,s){var a=e+"{"+s(i.args[1],t)+"}";return"value"===i.args[0].type?a:s(i.args[0],t)+"."+a}}e("./parse");var u=e("./language").precedence,n=e("./language").operatorTypes;e("./language").operatorTokens,t.exports=s,s.semantics={makeBlockStringifier:a,stringify:function(e,i,t){function s(e){var t=n(e,i);return t?t:"this"}var a,n=this.stringify.bind(this),r=this.stringifiers;if(r[e.type])a=r[e.type](e,i,n);else if(e.inline)a="&"+e.type+"("+e.args.map(s).join(", ")+")";else{var l;1===e.args.length&&"mapBlock"===e.args[0].type?(l=e.type+"{"+n(e.args[0].args[1],i)+"}",e=e.args[0]):l=e.type+"("+e.args.slice(1).map(s).join(", ")+")",a="value"===e.args[0].type?l:n(e.args[0],i)+"."+l}return!t||t.type===e.type&&"if"!==t.type||u.get(t.type).has(e.type)?a:"("+a+")"},stringifiers:{value:function(){return""},literal:function(e){return"string"==typeof e.value?"'"+e.value.replace("'","\\'")+"'":""+e.value},parameters:function(){return"$"},record:function(e,i,t){return"{"+Object.map(e.args,function(e,s){var a;return a="value"===e.type?"this":t(e,i),s+": "+a}).join(", ")+"}"},tuple:function(e,i,t){return"["+Object.map(e.args,function(e){return"value"===e.type?"this":t(e)}).join(", ")+"]"},component:function(e,i){var t;return i&&i.components&&e.component?i.components.getObjectLabel?t=i.components.getObjectLabel(e.component):i.components.getLabelForObject&&(t=i.components.getLabelForObject(e.component)):t=e.label,"@"+t},element:function(e){return"#"+e.id},mapBlock:a("map"),filterBlock:a("filter"),someBlock:a("some"),everyBlock:a("every"),sortedBlock:a("sorted"),sortedSetBlock:a("sortedSet"),groupBlock:a("group"),groupMapBlock:a("groupMap"),minBlock:a("min"),maxBlock:a("max"),property:function(e,i,t){return"value"===e.args[0].type?"string"==typeof e.args[1].value?e.args[1].value:"literal"===e.args[1].type?"."+e.args[1].value:"this["+t(e.args[1],i)+"]":"parameters"===e.args[0].type?"$"+e.args[1].value:"literal"===e.args[1].type&&/^[\w\d_]+$/.test(e.args[1].value)?t(e.args[0],i,{type:"scope"})+"."+e.args[1].value:t(e.args[0],{type:"scope"},i)+"["+t(e.args[1],i)+"]"},"with":function(e,i,t){var s=t(e.args[1],i,e);return t(e.args[0],i)+"."+s},not:function(e,i,t){return"equals"===e.args[0].type?t(e.args[0].args[0],i,{type:"equals"})+" != "+t(e.args[0].args[1],i,{type:"equals"}):"!"+t(e.args[0],i,e)},neg:function(e,i,t){return"-"+t(e.args[0],i,e)},toNumber:function(e,i,t){return"+"+t(e.args[0],i,e)},parent:function(e,i,t){return"^"+t(e.args[0],i,e)},"if":function(e,i,t){return t(e.args[0],i,e)+" ? "+t(e.args[1],i)+" : "+t(e.args[2],i)},event:function(e,i,t){return e.when+" "+e.event+" -> "+t(e.listener,i)},binding:function(e,i,t,s){var a=s(i.args[0],t)+" "+e+" "+s(i.args[1],t),u="",n=i.descriptor;if(n)for(var r in n)u+=", "+r+": "+s(n[r],t);return a+u},bind:function(e,i,t){return this.binding("<-",e,i,t)},bind2:function(e,i,t){return this.binding("<->",e,i,t)},assign:function(e,i,t){return t(e.args[0],i)+": "+t(e.args[1],i)},block:function(e,i,t){var s="@"+e.label;return e.connection&&("prototype"===e.connection?s+=" < ":"object"===e.connection&&(s+=" : "),s+=t({type:"literal",value:e.module}),e.exports&&"value"!==e.exports.type&&(s+=" "+t(e.exports,i))),s+" {\n"+e.statements.map(function(e){return"    "+t(e,i)+";\n"}).join("")+"}\n"},sheet:function(e,i,t){return"\n"+e.blocks.map(function(e){return t(e,i)}).join("\n")+"\n"}}},n.forEach(function(e,i){s.semantics.stringifiers[i]=function(i,t,s){return i.args.map(function(e){return s(e,t,i)}).join(" "+e+" ").trim()}})}}),montageDefine("70e9633","expand",{dependencies:["collections/set","collections/map","./operators"],factory:function(e,i,t){function s(e,i){var t=s.semantics.expand.bind(s.semantics);return t(e,i,t)}var a=e("collections/set"),u=e("collections/map");e("./operators"),t.exports=s,s.semantics={reflexive:a(["literal","element","rangeContent","mapContent"]),traverseLeft:a(["with","mapBlock","filterBlock","someBlock","everyBlock","sortedBlock","groupBlock","groupMapBlock"]),expanders:u({value:function(e,i){return i.value||{type:"value"}},parameters:function(e,i){return i.parameters||{type:"parameters"}},record:function(e,i,t){var s={type:"record",args:[]};for(var a in e.args)s.args[a]=t(e.args[a],i,t);return s},component:function(e,i){return i.components&&e.component?{type:"component",label:i.components.getObjectLabel(e.component)}:e}}),expand:function(e,i,t){return this.expanders.has(e.type)?this.expanders.get(e.type)(e,i,t):this.traverseLeft.has(e.type)?{type:e.type,args:[t(e.args[0],i,t)].concat(e.args.slice(1))}:this.reflexive.has(e.type)?e:{type:e.type,args:e.args.map(function(e){return t(e,i,t)})}}}}}),montageDefine("70e9633","bindings",{dependencies:["collections/map","./bind","./compute","./observe","./stringify"],factory:function(e,i){function t(e,i,t){if(i)for(var a in i)s(e,a,i[a],t);return e}function s(e,t,s,u){u=u||Object.empty;var n=a(e);if(d.call(n,t))throw Error("Can't bind to already bound target, "+JSON.stringify(t));return"<-"in s||"<->"in s||"compute"in s?(s.target=e,s.parameters=s.parameters||u.parameters,s.document=s.document||u.document,s.components=s.components||u.components,s.cancel="compute"in s?c(e,t,s):o(e,t,s),n[t]=s,i.count++):("get"in s||"set"in s||"writable"in s||(s.writable=!0),"configurable"in s||(s.configurable=!0),"enumerable"in s||(s.enumerable=!0),Object.defineProperty(e,t,s)),e}function a(e){return m.has(e)||m.set(e,{}),m.get(e)}function u(e,i){var t=a(e);return t[i]}function n(e){var i=a(e);for(var t in i)r(e,t)}function r(e,t){var s=a(e);if(!s[t])throw Error("Can't cancel non-existent binding to "+JSON.stringify(t));var u=s[t];if(u&&u.cancel){u.cancel(),delete s[t],i.count--;for(var t in s)return;m["delete"](e)}}var l=e("collections/map"),o=e("./bind"),c=e("./compute");e("./observe"),e("./stringify");var m=new l,d=Object.prototype.hasOwnProperty;i.count=0,i.bindings=m,i.defineBindings=t,i.defineBinding=s,i.getBindings=a,i.getBinding=u,i.cancelBindings=n,i.cancelBinding=r}}),montageDefine("70e9633","grammar",{dependencies:[],factory:function(e,i,t){t.exports=function(){function e(e,i){function t(){this.constructor=e}t.prototype=i.prototype,e.prototype=new t}function i(e,i,t,s,a){function u(e,i){function t(e){function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+i(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+i(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+i(e)})}var s,a;switch(e.length){case 0:s="end of input";break;case 1:s=e[0];break;default:s=e.slice(0,-1).join(", ")+" or "+e[e.length-1]}return a=i?'"'+t(i)+'"':"end of input","Expected "+s+" but "+a+" found."}this.expected=e,this.found=i,this.offset=t,this.line=s,this.column=a,this.name="SyntaxError",this.message=u(e,i)}function t(e){function t(i){function t(i,t,s){var a,u;for(a=t;s>a;a++)u=e.charAt(a),"\n"===u?(i.seenCR||i.line++,i.column=1,i.seenCR=!1):"\r"===u||"\u2028"===u||"\u2029"===u?(i.line++,i.column=1,i.seenCR=!0):(i.column++,i.seenCR=!1)}return Qa!==i&&(Qa>i&&(Qa=0,Ga={line:1,column:1,seenCR:!1}),t(Ga,Qa,i),Qa=i),Ga}function s(e){Wa>za||(za>Wa&&(Wa=za,Ha=[]),Ha.push(e))}function a(e){var i=0;for(e.sort();e.length>i;)e[i-1]===e[i]?e.splice(i,1):i++}function u(){var e,i;return Xa++,e=l(),Xa--,null===e&&(i=null,0===Xa&&s(Z)),e}function n(){var i,t,a,n,r,l,o;if(i=za,t=u(),null!==t){for(a=[],n=za,44===e.charCodeAt(za)?(r=ii,za++):(r=null,0===Xa&&s(ti)),null!==r?(l=k(),null!==l?(o=u(),null!==o?(r=[r,l,o],n=r):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei);null!==n;)a.push(n),n=za,44===e.charCodeAt(za)?(r=ii,za++):(r=null,0===Xa&&s(ti)),null!==r?(l=k(),null!==l?(o=u(),null!==o?(r=[r,l,o],n=r):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei);null!==a?(n=k(),null!==n?(Ba=i,t=si(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)}else za=i,i=ei;return i}function r(){var i,t,a,u;return i=za,40===e.charCodeAt(za)?(t=ai,za++):(t=null,0===Xa&&s(ui)),null!==t?(a=k(),null!==a?(41===e.charCodeAt(za)?(u=ni,za++):(u=null,0===Xa&&s(ri)),null!==u?(Ba=i,t=li(),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,40===e.charCodeAt(za)?(t=ai,za++):(t=null,0===Xa&&s(ui)),null!==t?(a=n(),null!==a?(41===e.charCodeAt(za)?(u=ni,za++):(u=null,0===Xa&&s(ri)),null!==u?(Ba=i,t=oi(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)),i}function l(){var i,t,a,n,r,l,c,m,d,p,v;return i=za,t=o(),null!==t?(a=k(),null!==a?(n=za,63===e.charCodeAt(za)?(r=mi,za++):(r=null,0===Xa&&s(di)),null!==r?(l=k(),null!==l?(c=u(),null!==c?(m=k(),null!==m?(58===e.charCodeAt(za)?(d=pi,za++):(d=null,0===Xa&&s(vi)),null!==d?(p=k(),null!==p?(v=u(),null!==v?(r=[r,l,c,m,d,p,v],n=r):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei),null===n&&(n=ci),null!==n?(Ba=i,t=hi(t,n),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),i}function o(){var i,t,a,u,n,r,l,o;if(i=za,t=c(),null!==t){for(a=[],u=za,n=k(),null!==n?(e.substr(za,2)===gi?(r=gi,za+=2):(r=null,0===Xa&&s(fi)),null!==r?(l=k(),null!==l?(o=c(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(e.substr(za,2)===gi?(r=gi,za+=2):(r=null,0===Xa&&s(fi)),null!==r?(l=k(),null!==l?(o=c(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function c(){var i,t,a,u,n,r,l,o;if(i=za,t=m(),null!==t){for(a=[],u=za,n=k(),null!==n?(e.substr(za,2)===qi?(r=qi,za+=2):(r=null,0===Xa&&s(yi)),null!==r?(l=k(),null!==l?(o=m(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(e.substr(za,2)===qi?(r=qi,za+=2):(r=null,0===Xa&&s(yi)),null!==r?(l=k(),null!==l?(o=m(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function m(){var i,t,a,u,n,r,l,o,c;return i=za,t=d(),null!==t?(a=za,u=k(),null!==u?(n=za,e.substr(za,3)===Si?(r=Si,za+=3):(r=null,0===Xa&&s(_i)),null===r&&(e.substr(za,2)===Pi?(r=Pi,za+=2):(r=null,0===Xa&&s(Ci)),null===r&&(e.substr(za,2)===Ni?(r=Ni,za+=2):(r=null,0===Xa&&s(Di)),null===r&&(r=za,60===e.charCodeAt(za)?(l=Mi,za++):(l=null,0===Xa&&s(Ai)),null!==l?(o=za,Xa++,45===e.charCodeAt(za)?(c=Ei,za++):(c=null,0===Xa&&s(wi)),Xa--,null===c?o=ci:(za=o,o=ei),null!==o?(l=[l,o],r=l):(za=r,r=ei)):(za=r,r=ei),null===r&&(62===e.charCodeAt(za)?(r=Ii,za++):(r=null,0===Xa&&s(xi)),null===r&&(e.substr(za,2)===Li?(r=Li,za+=2):(r=null,0===Xa&&s(Ti)),null===r&&(e.substr(za,2)===Vi?(r=Vi,za+=2):(r=null,0===Xa&&s(ji)))))))),null!==r&&(r=e.substring(n,za)),n=r,null!==n?(r=k(),null!==r?(l=d(),null!==l?(u=[u,n,r,l],a=u):(za=a,a=ei)):(za=a,a=ei)):(za=a,a=ei)):(za=a,a=ei),null===a&&(a=ci),null!==a?(Ba=i,t=Oi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),i}function d(){var i,t,a,u,n,r,l,o;if(i=za,t=p(),null!==t){for(a=[],u=za,n=k(),null!==n?(r=za,43===e.charCodeAt(za)?(l=Fi,za++):(l=null,0===Xa&&s(Ri)),null===l&&(45===e.charCodeAt(za)?(l=Ei,za++):(l=null,0===Xa&&s(wi))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=p(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(r=za,43===e.charCodeAt(za)?(l=Fi,za++):(l=null,0===Xa&&s(Ri)),null===l&&(45===e.charCodeAt(za)?(l=Ei,za++):(l=null,0===Xa&&s(wi))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=p(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function p(){var i,t,a,u,n,r,l,o;if(i=za,t=v(),null!==t){for(a=[],u=za,n=k(),null!==n?(r=za,42===e.charCodeAt(za)?(l=ki,za++):(l=null,0===Xa&&s(Ui)),null===l&&(47===e.charCodeAt(za)?(l=zi,za++):(l=null,0===Xa&&s(Bi)),null===l&&(37===e.charCodeAt(za)?(l=Qi,za++):(l=null,0===Xa&&s(Gi)),null===l&&(e.substr(za,3)===Wi?(l=Wi,za+=3):(l=null,0===Xa&&s(Hi))))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=v(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(r=za,42===e.charCodeAt(za)?(l=ki,za++):(l=null,0===Xa&&s(Ui)),null===l&&(47===e.charCodeAt(za)?(l=zi,za++):(l=null,0===Xa&&s(Bi)),null===l&&(37===e.charCodeAt(za)?(l=Qi,za++):(l=null,0===Xa&&s(Gi)),null===l&&(e.substr(za,3)===Wi?(l=Wi,za+=3):(l=null,0===Xa&&s(Hi))))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=v(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function v(){var i,t,a,u,n,r,l,o;if(i=za,t=h(),null!==t){for(a=[],u=za,n=k(),null!==n?(r=za,e.substr(za,2)===Xi?(l=Xi,za+=2):(l=null,0===Xa&&s(Yi)),null===l&&(e.substr(za,2)===Ki?(l=Ki,za+=2):(l=null,0===Xa&&s(Ji)),null===l&&(e.substr(za,2)===$i?(l=$i,za+=2):(l=null,0===Xa&&s(Zi)))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=h(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(r=za,e.substr(za,2)===Xi?(l=Xi,za+=2):(l=null,0===Xa&&s(Yi)),null===l&&(e.substr(za,2)===Ki?(l=Ki,za+=2):(l=null,0===Xa&&s(Ji)),null===l&&(e.substr(za,2)===$i?(l=$i,za+=2):(l=null,0===Xa&&s(Zi)))),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(o=h(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function h(){var i,t,a,u,n,r,l,o;if(i=za,t=g(),null!==t){for(a=[],u=za,n=k(),null!==n?(e.substr(za,2)===et?(r=et,za+=2):(r=null,0===Xa&&s(it)),null!==r?(l=k(),null!==l?(o=g(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,n=k(),null!==n?(e.substr(za,2)===et?(r=et,za+=2):(r=null,0===Xa&&s(it)),null!==r?(l=k(),null!==l?(o=g(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=bi(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function g(){var i,t,a;return i=za,t=za,33===e.charCodeAt(za)?(a=tt,za++):(a=null,0===Xa&&s(st)),null===a&&(43===e.charCodeAt(za)?(a=Fi,za++):(a=null,0===Xa&&s(Ri)),null===a&&(45===e.charCodeAt(za)?(a=Ei,za++):(a=null,0===Xa&&s(wi)))),null!==a&&(a=e.substring(t,za)),t=a,null!==t?(a=g(),null!==a?(Ba=i,t=at(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=f()),i}function f(){var e,i,t,s;if(e=za,i=y(),null!==i){for(t=[],s=b();null!==s;)t.push(s),s=b();null!==t?(Ba=e,i=ut(i,t),null===i?(za=e,e=i):e=i):(za=e,e=ei)}else za=e,e=ei;return e}function b(){var i,t,a,n;return i=za,46===e.charCodeAt(za)?(t=nt,za++):(t=null,0===Xa&&s(rt)),null!==t?(a=q(),null!==a?(Ba=i,t=lt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,91===e.charCodeAt(za)?(t=ot,za++):(t=null,0===Xa&&s(ct)),null!==t?(a=u(),null!==a?(93===e.charCodeAt(za)?(n=mt,za++):(n=null,0===Xa&&s(dt)),null!==n?(Ba=i,t=pt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)),i}function q(){var i,t,a,n,l,o,c;return i=za,t=za,a=S(),null!==a&&(a=e.substring(t,za)),t=a,null!==t?(123===e.charCodeAt(za)?(a=vt,za++):(a=null,0===Xa&&s(ht)),null!==a?(n=k(),null!==n?(l=u(),null!==l?(o=k(),null!==o?(125===e.charCodeAt(za)?(c=gt,za++):(c=null,0===Xa&&s(ft)),null!==c?(Ba=i,t=bt(t,l),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,t=za,a=S(),null!==a&&(a=e.substring(t,za)),t=a,null!==t?(a=r(),null!==a?(Ba=i,t=qt(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,t=j(),null!==t&&(Ba=i,t=yt(t)),null===t?(za=i,i=t):i=t,null===i&&(i=za,t=za,a=S(),null!==a&&(a=e.substring(t,za)),t=a,null!==t&&(Ba=i,t=St(t)),null===t?(za=i,i=t):i=t,null===i&&(i=za,t=M(),null!==t&&(Ba=i,t=_t(t)),null===t?(za=i,i=t):i=t,null===i&&(i=za,t=A(),null!==t&&(Ba=i,t=_t(t)),null===t?(za=i,i=t):i=t,null===i&&(i=za,40===e.charCodeAt(za)?(t=ai,za++):(t=null,0===Xa&&s(ui)),null!==t?(a=u(),null!==a?(41===e.charCodeAt(za)?(n=ni,za++):(n=null,0===Xa&&s(ri)),null!==n?(Ba=i,t=_t(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei))))))),i
}function y(){var i,t,a,n;return i=M(),null===i&&(i=A(),null===i&&(i=_(),null===i&&(i=I(),null===i&&(i=za,e.substr(za,4)===Pt?(t=Pt,za+=4):(t=null,0===Xa&&s(Ct)),null!==t&&(Ba=i,t=Nt()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,4)===Dt?(t=Dt,za+=4):(t=null,0===Xa&&s(Mt)),null!==t&&(Ba=i,t=At()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,5)===Et?(t=Et,za+=5):(t=null,0===Xa&&s(wt)),null!==t&&(Ba=i,t=It()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,4)===xt?(t=xt,za+=4):(t=null,0===Xa&&s(Lt)),null!==t&&(Ba=i,t=Tt()),null===t?(za=i,i=t):i=t,null===i&&(i=za,64===e.charCodeAt(za)?(t=Vt,za++):(t=null,0===Xa&&s(jt)),null!==t?(a=za,n=W(),null!==n&&(n=e.substring(a,za)),a=n,null!==a?(Ba=i,t=Ot(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,36===e.charCodeAt(za)?(t=Ft,za++):(t=null,0===Xa&&s(Rt)),null!==t?(a=za,n=S(),null!==n&&(n=e.substring(a,za)),a=n,null!==a?(Ba=i,t=kt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,36===e.charCodeAt(za)?(t=Ft,za++):(t=null,0===Xa&&s(Rt)),null!==t&&(Ba=i,t=Ut()),null===t?(za=i,i=t):i=t,null===i&&(i=za,35===e.charCodeAt(za)?(t=zt,za++):(t=null,0===Xa&&s(Bt)),null!==t?(a=za,n=S(),null!==n&&(n=e.substring(a,za)),a=n,null!==a?(Ba=i,t=Qt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,38===e.charCodeAt(za)?(t=Gt,za++):(t=null,0===Xa&&s(Wt)),null!==t?(a=za,n=S(),null!==n&&(n=e.substring(a,za)),a=n,null!==a?(n=r(),null!==n?(Ba=i,t=Ht(a,n),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,94===e.charCodeAt(za)?(t=Xt,za++):(t=null,0===Xa&&s(Yt)),null!==t?(a=y(),null!==a?(Ba=i,t=Kt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,40===e.charCodeAt(za)?(t=ai,za++):(t=null,0===Xa&&s(ui)),null!==t?(a=u(),null!==a?(41===e.charCodeAt(za)?(n=ni,za++):(n=null,0===Xa&&s(ri)),null!==n?(Ba=i,t=Jt(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,t=q(),null!==t&&(Ba=i,t=$t(t)),null===t?(za=i,i=t):i=t,null===i&&(i=za,t=[],null!==t&&(Ba=i,t=Zt()),null===t?(za=i,i=t):i=t)))))))))))))))),i}function S(){var i,t;if(Xa++,i=[],is.test(e.charAt(za))?(t=e.charAt(za),za++):(t=null,0===Xa&&s(ts)),null!==t)for(;null!==t;)i.push(t),is.test(e.charAt(za))?(t=e.charAt(za),za++):(t=null,0===Xa&&s(ts));else i=ei;return Xa--,null===i&&(t=null,0===Xa&&s(es)),i}function _(){var i,t,a,u;if(Xa++,i=za,39===e.charCodeAt(za)?(t=as,za++):(t=null,0===Xa&&s(us)),null!==t){for(a=[],u=P();null!==u;)a.push(u),u=P();null!==a?(39===e.charCodeAt(za)?(u=as,za++):(u=null,0===Xa&&s(us)),null!==u?(Ba=i,t=ns(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)}else za=i,i=ei;if(null===i)if(i=za,34===e.charCodeAt(za)?(t=rs,za++):(t=null,0===Xa&&s(ls)),null!==t){for(a=[],u=C();null!==u;)a.push(u),u=C();null!==a?(34===e.charCodeAt(za)?(u=rs,za++):(u=null,0===Xa&&s(ls)),null!==u?(Ba=i,t=ns(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)}else za=i,i=ei;return Xa--,null===i&&(t=null,0===Xa&&s(ss)),i}function P(){var i,t;return os.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(cs)),null===i&&(i=za,e.substr(za,2)===ms?(t=ms,za+=2):(t=null,0===Xa&&s(ds)),null!==t&&(Ba=i,t=ps()),null===t?(za=i,i=t):i=t,null===i&&(i=N())),i}function C(){var i,t;return vs.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(hs)),null===i&&(i=za,e.substr(za,2)===gs?(t=gs,za+=2):(t=null,0===Xa&&s(fs)),null!==t&&(Ba=i,t=bs()),null===t?(za=i,i=t):i=t,null===i&&(i=N())),i}function N(){var i,t,a,u,n,r,l,o;return i=za,e.substr(za,2)===qs?(t=qs,za+=2):(t=null,0===Xa&&s(ys)),null!==t&&(Ba=i,t=Ss()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===_s?(t=_s,za+=2):(t=null,0===Xa&&s(Ps)),null!==t&&(Ba=i,t=Cs()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===Ns?(t=Ns,za+=2):(t=null,0===Xa&&s(Ds)),null!==t&&(Ba=i,t=Ms()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===As?(t=As,za+=2):(t=null,0===Xa&&s(Es)),null!==t&&(Ba=i,t=ws()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===Is?(t=Is,za+=2):(t=null,0===Xa&&s(xs)),null!==t&&(Ba=i,t=Ls()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===Ts?(t=Ts,za+=2):(t=null,0===Xa&&s(Vs)),null!==t&&(Ba=i,t=js()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===Os?(t=Os,za+=2):(t=null,0===Xa&&s(Fs)),null!==t&&(Ba=i,t=Rs()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===ks?(t=ks,za+=2):(t=null,0===Xa&&s(Us)),null!==t&&(Ba=i,t=zs()),null===t?(za=i,i=t):i=t,null===i&&(i=za,e.substr(za,2)===Bs?(t=Bs,za+=2):(t=null,0===Xa&&s(Qs)),null!==t?(a=za,u=za,n=D(),null!==n?(r=D(),null!==r?(l=D(),null!==l?(o=D(),null!==o?(n=[n,r,l,o],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei),null!==u&&(u=e.substring(a,za)),a=u,null!==a?(Ba=i,t=Gs(a),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei))))))))),i}function D(){var i;return Ws.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(Hs)),i}function M(){var i,t,a,u,r,l;return i=za,91===e.charCodeAt(za)?(t=ot,za++):(t=null,0===Xa&&s(ct)),null!==t?(a=k(),null!==a?(93===e.charCodeAt(za)?(u=mt,za++):(u=null,0===Xa&&s(dt)),null!==u?(Ba=i,t=Xs(),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,91===e.charCodeAt(za)?(t=ot,za++):(t=null,0===Xa&&s(ct)),null!==t?(a=k(),null!==a?(u=n(),null!==u?(r=k(),null!==r?(93===e.charCodeAt(za)?(l=mt,za++):(l=null,0===Xa&&s(dt)),null!==l?(Ba=i,t=Ys(u),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)),i}function A(){var i,t,a,u,n,r;return i=za,123===e.charCodeAt(za)?(t=vt,za++):(t=null,0===Xa&&s(ht)),null!==t?(a=k(),null!==a?(125===e.charCodeAt(za)?(u=gt,za++):(u=null,0===Xa&&s(ft)),null!==u?(n=k(),null!==n?(Ba=i,t=Ks(),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,123===e.charCodeAt(za)?(t=vt,za++):(t=null,0===Xa&&s(ht)),null!==t?(a=k(),null!==a?(u=E(),null!==u?(125===e.charCodeAt(za)?(n=gt,za++):(n=null,0===Xa&&s(ft)),null!==n?(r=k(),null!==r?(Ba=i,t=Js(u),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)),i}function E(){var i,t,a,u,n,r,l;if(i=za,t=w(),null!==t){for(a=[],u=za,44===e.charCodeAt(za)?(n=ii,za++):(n=null,0===Xa&&s(ti)),null!==n?(r=k(),null!==r?(l=w(),null!==l?(n=[n,r,l],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==u;)a.push(u),u=za,44===e.charCodeAt(za)?(n=ii,za++):(n=null,0===Xa&&s(ti)),null!==n?(r=k(),null!==r?(l=w(),null!==l?(n=[n,r,l],u=n):(za=u,u=ei)):(za=u,u=ei)):(za=u,u=ei);null!==a?(Ba=i,t=$s(t,a),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;return i}function w(){var i,t,a,n,r;return i=za,t=za,a=S(),null!==a&&(a=e.substring(t,za)),t=a,null!==t?(58===e.charCodeAt(za)?(a=pi,za++):(a=null,0===Xa&&s(vi)),null!==a?(n=k(),null!==n?(r=u(),null!==r?(Ba=i,t=Zs(t,r),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),i}function I(){var i,t,a;return Xa++,i=za,t=za,a=x(),null!==a&&(a=e.substring(t,za)),t=a,null!==t&&(Ba=i,t=ia(t)),null===t?(za=i,i=t):i=t,Xa--,null===i&&(t=null,0===Xa&&s(ea)),i}function x(){var e,i,t,s;return e=za,i=L(),null!==i?(t=T(),null!==t?(s=V(),null!==s?(i=[i,t,s],e=i):(za=e,e=ei)):(za=e,e=ei)):(za=e,e=ei),null===e&&(e=za,i=L(),null!==i?(t=T(),null!==t?(i=[i,t],e=i):(za=e,e=ei)):(za=e,e=ei),null===e&&(e=za,i=L(),null!==i?(t=V(),null!==t?(i=[i,t],e=i):(za=e,e=ei)):(za=e,e=ei),null===e&&(e=L()))),e}function L(){var i,t,a,u;return i=za,t=R(),null!==t?(a=j(),null!==a?(t=[t,a],i=t):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=F(),null===i&&(i=za,45===e.charCodeAt(za)?(t=Ei,za++):(t=null,0===Xa&&s(wi)),null!==t?(a=R(),null!==a?(u=j(),null!==u?(t=[t,a,u],i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,45===e.charCodeAt(za)?(t=Ei,za++):(t=null,0===Xa&&s(wi)),null!==t?(a=F(),null!==a?(t=[t,a],i=t):(za=i,i=ei)):(za=i,i=ei)))),i}function T(){var i,t,a;return i=za,46===e.charCodeAt(za)?(t=nt,za++):(t=null,0===Xa&&s(rt)),null!==t?(a=j(),null!==a?(t=[t,a],i=t):(za=i,i=ei)):(za=i,i=ei),i}function V(){var e,i,t;return e=za,i=O(),null!==i?(t=j(),null!==t?(i=[i,t],e=i):(za=e,e=ei)):(za=e,e=ei),e}function j(){var e,i;if(e=[],i=F(),null!==i)for(;null!==i;)e.push(i),i=F();else e=ei;return e}function O(){var i,t,a;return i=za,ta.test(e.charAt(za))?(t=e.charAt(za),za++):(t=null,0===Xa&&s(sa)),null!==t?(aa.test(e.charAt(za))?(a=e.charAt(za),za++):(a=null,0===Xa&&s(ua)),null===a&&(a=ci),null!==a?(t=[t,a],i=t):(za=i,i=ei)):(za=i,i=ei),i}function F(){var i;return na.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(ra)),i}function R(){var i;return la.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(oa)),i}function k(){var e,i;for(e=[],i=U(),null===i&&(i=z());null!==i;)e.push(i),i=U(),null===i&&(i=z());return e}function U(){var i,t;return Xa++,ma.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(da)),null===i&&(pa.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(va))),Xa--,null===i&&(t=null,0===Xa&&s(ca)),i}function z(){var i,t;return Xa++,ga.test(e.charAt(za))?(i=e.charAt(za),za++):(i=null,0===Xa&&s(fa)),Xa--,null===i&&(t=null,0===Xa&&s(ha)),i}function B(){var e,i,t,s;if(e=za,i=k(),null!==i){for(t=[],s=Q();null!==s;)t.push(s),s=Q();null!==t?(s=k(),null!==s?(Ba=e,i=ba(t),null===i?(za=e,e=i):e=i):(za=e,e=ei)):(za=e,e=ei)}else za=e,e=ei;return e}function Q(){var i,t,a,u,n,r,l,o,c,m;return i=za,64===e.charCodeAt(za)?(t=Vt,za++):(t=null,0===Xa&&s(jt)),null!==t?(a=za,u=W(),null!==u&&(u=e.substring(a,za)),a=u,null!==a?(u=k(),null!==u?(n=G(),null===n&&(n=ci),null!==n?(123===e.charCodeAt(za)?(r=vt,za++):(r=null,0===Xa&&s(ht)),null!==r?(l=k(),null!==l?(o=H(),null!==o?(125===e.charCodeAt(za)?(c=gt,za++):(c=null,0===Xa&&s(ft)),null!==c?(m=k(),null!==m?(Ba=i,t=qa(a,n,o),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),i}function G(){var i,t,a,n,r,l,o,c;return i=za,60===e.charCodeAt(za)?(t=Mi,za++):(t=null,0===Xa&&s(Ai)),null===t&&(58===e.charCodeAt(za)?(t=pi,za++):(t=null,0===Xa&&s(vi))),null!==t?(a=k(),null!==a?(n=_(),null===n&&(n=ci),null!==n?(r=k(),null!==r?(l=za,o=za,Xa++,123===e.charCodeAt(za)?(c=vt,za++):(c=null,0===Xa&&s(ht)),Xa--,null===c?o=ci:(za=o,o=ei),null!==o?(c=u(),null!==c?(o=[o,c],l=o):(za=l,l=ei)):(za=l,l=ei),null===l&&(l=ci),null!==l?(o=k(),null!==o?(Ba=i,t=ya(t,n,l),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,t=k(),null!==t&&(Ba=i,t=Sa()),null===t?(za=i,i=t):i=t),i}function W(){var i,t,a,u,n,r,l;if(i=za,t=[],_a.test(e.charAt(za))?(a=e.charAt(za),za++):(a=null,0===Xa&&s(Pa)),null!==a)for(;null!==a;)t.push(a),_a.test(e.charAt(za))?(a=e.charAt(za),za++):(a=null,0===Xa&&s(Pa));else t=ei;if(null!==t){if(a=[],u=za,58===e.charCodeAt(za)?(n=pi,za++):(n=null,0===Xa&&s(vi)),null!==n){if(r=[],_a.test(e.charAt(za))?(l=e.charAt(za),za++):(l=null,0===Xa&&s(Pa)),null!==l)for(;null!==l;)r.push(l),_a.test(e.charAt(za))?(l=e.charAt(za),za++):(l=null,0===Xa&&s(Pa));else r=ei;null!==r?(n=[n,r],u=n):(za=u,u=ei)}else za=u,u=ei;for(;null!==u;)if(a.push(u),u=za,58===e.charCodeAt(za)?(n=pi,za++):(n=null,0===Xa&&s(vi)),null!==n){if(r=[],_a.test(e.charAt(za))?(l=e.charAt(za),za++):(l=null,0===Xa&&s(Pa)),null!==l)for(;null!==l;)r.push(l),_a.test(e.charAt(za))?(l=e.charAt(za),za++):(l=null,0===Xa&&s(Pa));else r=ei;null!==r?(n=[n,r],u=n):(za=u,u=ei)}else za=u,u=ei;null!==a?(t=[t,a],i=t):(za=i,i=ei)}else za=i,i=ei;return i}function H(){var i,t,a,u,n,r,l,o,c;if(i=za,t=X(),null!==t)if(a=k(),null!==a){for(u=[],n=za,59===e.charCodeAt(za)?(r=Ca,za++):(r=null,0===Xa&&s(Na)),null!==r?(l=k(),null!==l?(o=X(),null!==o?(c=k(),null!==c?(r=[r,l,o,c],n=r):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei);null!==n;)u.push(n),n=za,59===e.charCodeAt(za)?(r=Ca,za++):(r=null,0===Xa&&s(Na)),null!==r?(l=k(),null!==l?(o=X(),null!==o?(c=k(),null!==c?(r=[r,l,o,c],n=r):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei)):(za=n,n=ei);null!==u?(59===e.charCodeAt(za)?(n=Ca,za++):(n=null,0===Xa&&s(Na)),null===n&&(n=ci),null!==n?(r=k(),null!==r?(Ba=i,t=si(t,u),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)}else za=i,i=ei;else za=i,i=ei;return null===i&&(i=za,t=X(),null!==t?(a=k(),null!==a?(59===e.charCodeAt(za)?(u=Ca,za++):(u=null,0===Xa&&s(Na)),null===u&&(u=ci),null!==u?(n=k(),null!==n?(Ba=i,t=Da(t),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i&&(i=za,t=k(),null!==t&&(Ba=i,t=li()),null===t?(za=i,i=t):i=t)),i}function X(){var i,t,a,n,r,l,o,c,m,d,p,v,h,g,f,b,q;if(i=za,e.substr(za,2)===Ma?(t=Ma,za+=2):(t=null,0===Xa&&s(Aa)),null===t&&(e.substr(za,6)===Ea?(t=Ea,za+=6):(t=null,0===Xa&&s(wa))),null!==t?(32===e.charCodeAt(za)?(a=Ia,za++):(a=null,0===Xa&&s(xa)),null!==a?(n=k(),null!==n?(r=za,l=S(),null!==l&&(l=e.substring(r,za)),r=l,null!==r?(l=k(),null!==l?(e.substr(za,2)===La?(o=La,za+=2):(o=null,0===Xa&&s(Ta)),null!==o?(c=k(),null!==c?(m=u(),null!==m?(d=k(),null!==d?(Ba=i,t=Va(t,r,m),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei),null===i){if(i=za,t=u(),null!==t)if(a=k(),null!==a)if(58===e.charCodeAt(za)?(n=pi,za++):(n=null,0===Xa&&s(vi)),null===n&&(e.substr(za,3)===ja?(n=ja,za+=3):(n=null,0===Xa&&s(Oa)),null===n&&(e.substr(za,2)===Fa?(n=Fa,za+=2):(n=null,0===Xa&&s(Ra)))),null!==n)if(r=k(),null!==r)if(l=u(),null!==l)if(o=k(),null!==o){for(c=[],m=za,44===e.charCodeAt(za)?(d=ii,za++):(d=null,0===Xa&&s(ti)),null!==d?(p=k(),null!==p?(v=za,h=S(),null!==h&&(h=e.substring(v,za)),v=h,null!==v?(h=k(),null!==h?(58===e.charCodeAt(za)?(g=pi,za++):(g=null,0===Xa&&s(vi)),null!==g?(f=k(),null!==f?(b=u(),null!==b?(q=k(),null!==q?(d=[d,p,v,h,g,f,b,q],m=d):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei);null!==m;)c.push(m),m=za,44===e.charCodeAt(za)?(d=ii,za++):(d=null,0===Xa&&s(ti)),null!==d?(p=k(),null!==p?(v=za,h=S(),null!==h&&(h=e.substring(v,za)),v=h,null!==v?(h=k(),null!==h?(58===e.charCodeAt(za)?(g=pi,za++):(g=null,0===Xa&&s(vi)),null!==g?(f=k(),null!==f?(b=u(),null!==b?(q=k(),null!==q?(d=[d,p,v,h,g,f,b,q],m=d):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei)):(za=m,m=ei);null!==c?(Ba=i,t=ka(t,n,l,c),null===t?(za=i,i=t):i=t):(za=i,i=ei)}else za=i,i=ei;else za=i,i=ei;else za=i,i=ei;else za=i,i=ei;else za=i,i=ei;else za=i,i=ei;null===i&&(i=za,t=za,a=S(),null!==a&&(a=e.substring(t,za)),t=a,null!==t?(a=k(),null!==a?(n=u(),null!==n?(r=k(),null!==r?(Ba=i,t=Ua(t,n),null===t?(za=i,i=t):i=t):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei)):(za=i,i=ei))}return i}var Y,K=arguments.length>1?arguments[1]:{},J={expression:u,sheet:B},$=u,Z="expression",ei=null,ii=",",ti='","',si=function(e,i){for(var t=[e],s=0;i.length>s;s++)t.push(i[s][2]);return t},ai="(",ui='"("',ni=")",ri='")"',li=function(){return[]},oi=function(e){return e},ci="",mi="?",di='"?"',pi=":",vi='":"',hi=function(e,i){if(i){var t=i[2],s=i[6];return{type:"if",args:[e,t,s]}}return e},gi="||",fi='"||"',bi=function(e,i){for(var t=0;i.length>t;t++)e={type:Ya[i[t][1]],args:[e,i[t][3]]};return e},qi="&&",yi='"&&"',Si="<=>",_i='"<=>"',Pi="<=",Ci='"<="',Ni=">=",Di='">="',Mi="<",Ai='"<"',Ei="-",wi='"-"',Ii=">",xi='">"',Li="==",Ti='"=="',Vi="!=",ji='"!="',Oi=function(e,i){if(i){var t=i[1],s=i[3];return"!="===t?{type:"not",args:[{type:"equals",args:[e,s]}]}:{type:Ya[t],args:[e,s]}}return e},Fi="+",Ri='"+"',ki="*",Ui='"*"',zi="/",Bi='"/"',Qi="%",Gi='"%"',Wi="rem",Hi='"rem"',Xi="**",Yi='"**"',Ki="//",Ji='"//"',$i="%%",Zi='"%%"',et="??",it='"??"',tt="!",st='"!"',at=function(e,i){return{type:Ka[e],args:[i]}},ut=function(e,i){for(var t=0;i.length>t;t++)e=i[t](e);return e},nt=".",rt='"."',lt=function(e){return e},ot="[",ct='"["',mt="]",dt='"]"',pt=function(e){return function(i){return{type:"property",args:[i,e]}}},vt="{",ht='"{"',gt="}",ft='"}"',bt=function(e,i){return Ja[e]?function(t){return{type:Ja[e],args:[t,i]}}:"value"===i.type?function(i){return{type:e,args:[i]}}:function(t){return{type:e,args:[{type:"mapBlock",args:[t,i]}]}}},qt=function(e,i){return function(t){return{type:e,args:[t].concat(i)}}},yt=function(e){return function(i){return{type:"property",args:[i,{type:"literal",value:+e.join("")}]}}},St=function(e){return function(i){return{type:"property",args:[i,{type:"literal",value:e}]}}},_t=function(e){return function(i){return{type:"with",args:[i,e]}}},Pt="this",Ct='"this"',Nt=function(){return{type:"value"}},Dt="true",Mt='"true"',At=function(){return{type:"literal",value:!0}},Et="false",wt='"false"',It=function(){return{type:"literal",value:!1}},xt="null",Lt='"null"',Tt=function(){return{type:"literal",value:null}},Vt="@",jt='"@"',Ot=function(e){return{type:"component",label:e}},Ft="$",Rt='"$"',kt=function(e){return{type:"property",args:[{type:"parameters"},{type:"literal",value:e}]}},Ut=function(){return{type:"parameters"}},zt="#",Bt='"#"',Qt=function(e){return{type:"element",id:e}},Gt="&",Wt='"&"',Ht=function(e,i){return{type:e,args:i,inline:!0}},Xt="^",Yt='"^"',Kt=function(e){return{type:"parent",args:[e]}},Jt=function(e){return e},$t=function(e){return e({type:"value"})},Zt=function(){return{type:"value"}},es="word",is=/^[a-zA-Z_0-9\-]/,ts="[a-zA-Z_0-9\\-]",ss="string",as="'",us='"\'"',ns=function(e){return{type:"literal",value:e.join("")}},rs='"',ls='"\\""',os=/^[^'\\\0-\x1F]/,cs="[^'\\\\\\0-\\x1F]",ms="\\'",ds='"\\\\\'"',ps=function(){return"'"},vs=/^[^"\\\0-\x1F]/,hs='[^"\\\\\\0-\\x1F]',gs='\\"',fs='"\\\\\\""',bs=function(){return'"'},qs="\\\\",ys='"\\\\\\\\"',Ss=function(){return"\\"},_s="\\/",Ps='"\\\\/"',Cs=function(){return"/"},Ns="\\b",Ds='"\\\\b"',Ms=function(){return"\b"},As="\\f",Es='"\\\\f"',ws=function(){return"\f"},Is="\\n",xs='"\\\\n"',Ls=function(){return"\n"},Ts="\\r",Vs='"\\\\r"',js=function(){return"\r"},Os="\\t",Fs='"\\\\t"',Rs=function(){return"	"},ks="\\0",Us='"\\\\0"',zs=function(){return"\0"},Bs="\\u",Qs='"\\\\u"',Gs=function(e){return String.fromCharCode(parseInt(e,16))},Ws=/^[0-9a-fA-F]/,Hs="[0-9a-fA-F]",Xs=function(){return{type:"tuple",args:[]}},Ys=function(e){return{type:"tuple",args:e}},Ks=function(){return{type:"record",args:[]}},Js=function(e){return{type:"record",args:e}},$s=function(e,i){var t={};t[e[0]]=e[1];for(var s=0;i.length>s;s++)t[i[s][2][0]]=i[s][2][1];return t},Zs=function(e,i){return[e,i]},ea="number",ia=function(e){return{type:"literal",value:+e}},ta=/^[eE]/,sa="[eE]",aa=/^[+\-]/,ua="[+\\-]",na=/^[0-9]/,ra="[0-9]",la=/^[1-9]/,oa="[1-9]",ca="whitespace",ma=/^[\t\x0B\f \xA0\uFEFF]/,da="[\\t\\x0B\\f \\xA0\\uFEFF]",pa=/^[ \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000]/,va="[ \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000]",ha="line terminator",ga=/^[\n\r\u2028\u2029]/,fa="[\\n\\r\\u2028\\u2029]",ba=function(e){return{type:"sheet",blocks:e}},qa=function(e,i,t){return{type:"block",connection:i.connection,module:i.module,exports:i.exports,label:e,statements:t}},ya=function(e,i,t){return{connection:{"<":"prototype",":":"object"}[e],module:i&&i.value,exports:""!==t?t[1]:void 0}},Sa=function(){return{}},_a=/^[a-zA-Z_0-9]/,Pa="[a-zA-Z_0-9]",Ca=";",Na='";"',Da=function(e){return[e]},Ma="on",Aa='"on"',Ea="before",wa='"before"',Ia=" ",xa='" "',La="->",Ta='"->"',Va=function(e,i,t){return{type:"event",when:e,event:i,listener:t}},ja="<->",Oa='"<->"',Fa="<-",Ra='"<-"',ka=function(e,i,t,s){var a={type:$a[i],args:[e,t]};if(s.length){for(var u={},n=0;s.length>n;n++)u[s[n][2]]=s[n][6];a.descriptor=u}return a},Ua=function(e,i){return{type:"unit",name:e,value:i}},za=0,Ba=0,Qa=0,Ga={line:1,column:1,seenCR:!1},Wa=0,Ha=[],Xa=0;if("startRule"in K){if(!(K.startRule in J))throw Error("Can't start parsing from rule \""+K.startRule+'".');$=J[K.startRule]}var Ya={"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","??":"default","&&":"and","||":"or","<-":"bind","<->":"bind2",":":"assign"},Ka={"+":"toNumber","-":"neg","!":"not","^":"parent"},Ja={map:"mapBlock",filter:"filterBlock",some:"someBlock",every:"everyBlock",sorted:"sortedBlock",sortedSet:"sortedSetBlock",group:"groupBlock",groupMap:"groupMapBlock",min:"minBlock",max:"maxBlock"},$a={":":"assign","<-":"bind","<->":"bind2"};if(Y=$(),null!==Y&&za===e.length)return Y;throw a(Ha),Ba=Math.max(za,Wa),new i(Ha,e.length>Ba?e.charAt(Ba):null,Ba,t(Ba).line,t(Ba).column)}return e(i,Error),{SyntaxError:i,parse:t}}()}}),montageDefine("70e9633","compile-evaluator",{dependencies:["collections/shim-object","collections/map","collections/sorted-set","./operators","./scope","./parse"],factory:function(e,i,t){function s(e){return s.semantics.compile(e)}var a=e("collections/shim-object"),u=e("collections/map"),n=e("collections/sorted-set"),r=e("./operators");e("./scope"),t.exports=s;var l={literal:function(e){return function(){return e.value}},value:function(){return function(e){return e.value}},parameters:function(){return function(e){return e.parameters}},element:function(e){return function(i){return i.document.getElementById(e.id)}},component:function(e){return function(i){return i.components.getObjectByLabel(e.label)}},tuple:function(e){var i=e.args.map(this.compile,this);return function(e){return i.map(function(i){return i(e)})}},record:function(e){var i=e.args,t={};for(var s in i)t[s]=this.compile(i[s]);return function(e){var i={};for(var s in t)i[s]=t[s](e);return i}}},o={mapBlock:function(e,i){return function(t){return e(t).map(function(e){return i(t.nest(e))})}},filterBlock:function(e,i){return function(t){return e(t).filter(function(e){return i(t.nest(e))})}},someBlock:function(e,i){return function(t){return e(t).some(function(e){return i(t.nest(e))})}},everyBlock:function(e,i){return function(t){return e(t).every(function(e){return i(t.nest(e))})}},sortedBlock:function(e,i){return function(t){return e(t).sorted(Function.by(function(e){return i(t.nest(e))}))}},sortedSetBlock:function(e,i){return function(t){function s(e){return i(t.nest(e))}function u(e,i){return a.compare(s(e),s(i))}function r(e,i){return a.equals(s(e),s(i))}return new n(e(t),r,u)}},groupBlock:function(e,i){return function(t){return e(t).group(function(e){return i(t.nest(e))})}},groupMapBlock:function(e,i){return function(t){return new u(e(t).group(function(e){return i(t.nest(e))}))}},minBlock:function(e,i){return function(t){return e(t).min(Function.by(function(e){return i(t.nest(e))}))}},maxBlock:function(e,i){return function(t){return e(t).max(Function.by(function(e){return i(t.nest(e))}))}},parent:function(e){return function(i){return e(i.parent)}},"with":function(e,i){return function(t){return i(t.nest(e(t)))}},"if":function(e,i,t){return function(s){var a=e(s);return null!=a?a?i(s):t(s):void 0}},not:function(e){return function(i){return!e(i)}},and:function(e,i){return function(t){return e(t)&&i(t)}},or:function(e,i){return function(t){return e(t)||i(t)}},"default":function(e,i){return function(t){var s=e(t);return null==s&&(s=i(t)),s}},defined:function(e){return function(i){var t=e(i);return null!=t}},path:function(i,t){return function(a){var u=i(a),n=t(a),r=e("./parse");try{var l=r(n),o=s(l);return o(a.nest(u))}catch(c){}}}},c=a.clone(r,1);a.addEach(c,{property:function(e,i){return e[i]},get:function(e,i){return e.get(i)},mapContent:Function.identity,rangeContent:Function.identity,view:function(e,i,t){return e.slice(i,i+t)}}),s.semantics={compilers:l,argCompilers:o,operators:c,compile:function(e){var i=this.compilers,t=this.argCompilers,s=this.operators;if(i.hasOwnProperty(e.type))return i[e.type].call(this,e);if(t.hasOwnProperty(e.type)){var a=e.args.map(this.compile,this);return t[e.type].apply(null,a)}s.hasOwnProperty(e.type)||(s[e.type]=function(i){var t=Array.prototype.slice.call(arguments,1);if(!i[e.type])throw new TypeError("Can't call "+JSON.stringify(e.type)+" of "+i);return i[e.type].apply(i,t)});var u=s[e.type],a=e.args.map(this.compile,this);return function(e){var i=a.map(function(i){return i(e)});return i.every(r.defined)?u.apply(null,i):void 0}}}}}),montageDefine("70e9633","compile-assigner",{dependencies:["./compile-evaluator","./algebra","./scope"],factory:function(e,i,t){function s(e){return s.semantics.compile(e)}var a=e("./compile-evaluator"),u=e("./algebra");e("./scope");var n={type:"value"},r={type:"literal",value:!0},l={type:"literal",value:!1};t.exports=s,s.semantics={compile:function(e){var i=this.compilers;if("equals"===e.type){var t=this.compile(e.args[0]),s=this.compileEvaluator(e.args[1]);return i.equals(t,s)}if("if"===e.type){var a=this.compileEvaluator(e.args[0]),r=this.compile(e.args[1]),l=this.compile(e.args[2]);return i["if"](a,r,l)}if("and"===e.type||"or"===e.type){var o=u(e.args[0],n),c=u(e.args[1],n),m=this.compileEvaluator(e.args[0]),s=this.compileEvaluator(e.args[1]),d=this.compileEvaluator(o[1]),p=this.compileEvaluator(c[1]),t=this.compile(o[0]),v=this.compile(c[0]);return i[e.type](t,v,m,s,d,p)}if("everyBlock"===e.type){var h=this.compileEvaluator(e.args[0]),g=u(e.args[1],{type:"literal",value:!0}),f=this.compile(g[0]),b=this.compileEvaluator(g[1]);return i.everyBlock(h,f,b)}if("parent"===e.type){var q=this.compile(e.args[0]);return function(e,i){return q(e,i.parent)}}if(i.hasOwnProperty(e.type)){var y=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return i[e.type].apply(null,y)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:a,compilers:{property:function(e,i){return function(t,s){var a=e(s);if(a){var u=i(s);null!=u&&(Array.isArray(a)?a.set(u,t):a[u]=t)}}},get:function(e,i){return function(t,s){var a=e(s);if(a){var u=i(s);null!=u&&a.set(u,t)}}},has:function(e,i){return function(t,s){var a=e(s);if(a){var u=i(s);null!=t&&(t?(a.has||a.contains).call(a,u)||a.add(u):(a.has||a.contains).call(a,u)&&(a.remove||a["delete"]).call(a,u))}}},equals:function(e,i){return function(t,s){return t?e(i(s),s):void 0}},"if":function(e,i,t){return function(s,a){var u=e(a);return null!=u?u?i(s,a):t(s,a):void 0}},and:function(e,i,t,s,a,u){return function(n,l){null!=n&&(n?(e(a(r),l),i(u(r),l)):e(t(l)&&!s(l),l))}},or:function(e,i,t,s,a,u){return function(n,r){null!=n&&(n?e(t(r)||!s(r),r):(e(a(l),r),i(u(l),r)))}},rangeContent:function(e){return function(i,t){var s=e(t);s&&(i?s.swap(0,s.length,i):s.clear())}},mapContent:function(e){return function(i,t){var s=e(t);s&&(s.clear(),t.value&&s.addEach(i))}},reversed:function(e){return function(i,t){var s=e(t);s&&s.swap(0,s.length,i.reversed())}},everyBlock:function(e,i,t){return function(s,a){if(s){var u=e(a),n=t(a);u.forEach(function(e){i(n,a.nest(e))})}}}}}}}),montageDefine("70e9633","algebra",{dependencies:[],factory:function(e,i,t){function s(e,i){return s.semantics.solve(e,i)}t.exports=s,s.semantics={solve:function(e,i){for(;;){for(;this.simplifiers.hasOwnProperty(e.type);){var t=this.simplifiers[e.type](e);if(!t)break;e=t}var s=this.rotateTargetToSource.hasOwnProperty(e.type),a=this.rotateSourceToTarget.hasOwnProperty(i.type);if(!s&&!a)break;s?(i=this.rotateTargetToSource[e.type](e,i),e=e.args[0]):a&&(e=this.rotateSourceToTarget[i.type](e,i),i=i.args[0])}return[e,i]},simplifiers:{not:function(e){var i=e.args[0];return"not"===i.type?i.args[0]:void 0},add:function(e){var i=e.args[0];return"literal"===i.type&&""===i.value?{type:"toString",args:[e.args[1]]}:void 0},someBlock:function(e){return{type:"not",args:[{type:"everyBlock",args:[e.args[0],{type:"not",args:[e.args[1]]}]}]}}},rotateTargetToSource:{reflect:function(e,i){return{type:e.type,args:[i]}},invert:function(e,i,t){return{type:t,args:[i,e.args[1]]}},toNumber:function(e,i){return this.reflect(e,i)},toString:function(e,i){return this.reflect(e,i)},not:function(e,i){return this.reflect(e,i)},neg:function(e,i){return this.reflect(e,i)},add:function(e,i){return this.invert(e,i,"sub")},sub:function(e,i){return this.invert(e,i,"add")},mul:function(e,i){return this.invert(e,i,"div")},div:function(e,i){return this.invert(e,i,"mul")},pow:function(e,i){return this.invert(e,i,"root")},root:function(e,i){return this.invert(e,i,"pow")},join:function(e,i){return this.invert(e,i,"split")},split:function(e,i){return this.invert(e,i,"join")}},rotateSourceToTarget:{rangeContent:function(e,i){return"rangeContent"===e.type?e:{type:i.type,args:[e]}}}}}}),montageDefine("70e9633","compile-binder",{dependencies:["./compile-observer","./observers","./binders","./algebra"],factory:function(e,i,t){function s(e){return s.semantics.compile(e)}var a=e("./compile-observer");e("./observers");var u=e("./binders"),n=e("./algebra"),r={type:"value"},l={type:"literal",value:!0};t.exports=s,s.semantics={compilers:{property:u.makePropertyBinder,get:u.makeGetBinder,has:u.makeHasBinder,only:u.makeOnlyBinder,one:u.makeOneBinder,rangeContent:u.makeRangeContentBinder,mapContent:u.makeMapContentBinder,reversed:u.makeReversedBinder,and:u.makeAndBinder,or:u.makeOrBinder},compile:function(e){var i=this.compilers;if("default"===e.type)return this.compile(e.args[0]);if("literal"===e.type){if(null==e.value)return Function.noop;throw Error("Can't bind to literal: "+e.value)}if("equals"===e.type){var t=this.compile(e.args[0]),s=a(e.args[1]);return u.makeEqualityBinder(t,s)}if("if"===e.type){var o=a(e.args[0]),c=this.compile(e.args[1]),m=this.compile(e.args[2]);return u.makeConditionalBinder(o,c,m)}if("and"===e.type||"or"===e.type){var d=n(e.args[0],r),p=n(e.args[1],r),t=this.compile(d[0]),v=this.compile(p[0]),h=a(d[1]),g=a(p[1]),f=a(e.args[0]),s=a(e.args[1]);return this.compilers[e.type](t,v,f,s,h,g)}if("everyBlock"===e.type){var b=a(e.args[0]),q=n(e.args[1],l),y=this.compile(q[0]),S=a(q[1]);return u.makeEveryBlockBinder(b,y,S)}if("rangeContent"===e.type){var _,P=a(e.args[0]);try{_=this.compile(e.args[0])}catch(C){_=Function.noop}return u.makeRangeContentBinder(P,_)}if("defined"===e.type){var _=this.compile(e.args[0]);return u.makeDefinedBinder(_)}if("parent"===e.type){var _=this.compile(e.args[0]);return u.makeParentBinder(_)}if("with"===e.type){var P=a(e.args[0]),_=this.compile(e.args[1]);return u.makeWithBinder(P,_)}if(i.hasOwnProperty(e.type)){var N=e.args.map(a,a.semantics);return i[e.type].apply(null,N)}throw Error("Can't compile binder for "+JSON.stringify(e.type))}}}}),montageDefine("70e9633","binders",{dependencies:["./scope","./observers"],factory:function(e,i){function t(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function s(e,i,s,a,u,n){return s(C(function(s){if(!u.isActive)try{u.isActive=!0,n&&console.log("SET",n.targetPath,"TO",s,"ON",e,"BECAUSE",n.sourcePath,t()),Array.isArray(e)&&i>>>0===i?e.set(i,s):e[i]=s}finally{u.isActive=!1}}),a)}function a(e,i){return function(t,s,a,u,n){return i(C(function(i){return null!=i?e(C(function(e){return null!=e?e.bindProperty?e.bindProperty(i,t,s,u,n):L(e,i,t,s,u,n):void 0}),a):void 0}),a)}}function u(e,i,s,a,u,n){return s(C(function(s){if(!u.isActive)try{u.isActive=!0,n&&console.log("SET FOR KEY",i,"TO",s,"ON",e,"BECAUSE",n.sourcePath,t()),e.set(i,s)}finally{u.isActive=!1}}),a)}function n(e,i){return function(t,s,a,u,n){return e(C(function(e){return e?i(C(function(i){return null!=i?T(e,i,t,s,u,n):void 0}),a):void 0}),a)}}function r(e,i){return function(s,a,u,n,r){return e(C(function(e){return e?i(C(function(i){return null!=i?s(C(function(s){if(s)(e.has||e.contains).call(e,i)||(r&&console.log("ADD",i,"TO",r.targetPath,"BECAUSE",r.sourcePath,t()),e.add(i));else for(;(e.has||e.contains).call(e,i);)r&&console.log("REMOVE",i,"FROM",r.targetPath,"BECAUSE",r.sourcePath,t()),(e.remove||e["delete"]).call(e,i)}),a):void 0}),u):void 0}),u)}}function l(e,i){return function(s,a,u,n,r){return s(C(function(s){return s?(r&&console.log("BIND",r.targetPath,"TO",r.sourcePath,t()),e(i,a,a,n,r),function(){r&&console.log("UNBIND",r.targetPath,"FROM",r.sourcePath,t())}):void 0}),u)}}function o(e,i,t){return function(s,a,u,n,r){return s(C(function(s){return s?e(C(function(e){function s(e,s,l){D(a.slice(l,l+s.length)),a.swap(l,s.length,e.map(function(e){var s=u.nest(e);return i(t,s,s,n,r)
}))}if(e){var a=[],l=N(e,s,u);return function(){D(a),l()}}}),u):void 0}),a)}}function c(e,i,t,s,a,u){var n=M(s),r=E(t,n);return function(t,s,n,l,o){return t(C(function(t){if(null!=t){if(t){var s=e(a,I,n,l,o),c=i(u,I,n,l,o);return function(){s(),c()}}return e(r,n,n,l,o)}}),s)}}function m(e,i,t,s,a,u){var n=M(s),r=A(t,n);return function(t,s,n,l,o){return t(C(function(t){if(null!=t){if(t)return e(r,n,n,l,o);var s=e(a,x,n,l,o),c=i(u,x,n,l,o);return function(){s(),c()}}}),s)}}function d(e,i,t){return function(s,a,u,n,r){return e(C(function(e){return null!=e?e?i(s,a,u,n,r):t(s,a,u,n,r):void 0}),a)}}function p(e){return function(i,t,s){return e(C(function(e){return e?i(C(function(i){null!=i&&(e.splice?e.splice(0,e.length,i):e.clear&&e.add&&(e.clear(),e.add(i)))}),t):void 0}),s)}}function v(e){return function(i,t,s){return e(C(function(e){return e?i(C(function(i){null!=i&&i!==e.one()&&(e.splice?e.splice(0,e.length,i):e.clear&&e.add&&(e.clear(),e.add(i)))}),t):void 0}),s)}}function h(e,i){return function(s,a,u,n,r){return e(C(function(e){return e?s(C(function(i){function s(i,s,a){S(e)||(r&&console.log("SWAPPING",s,"FOR",i,"AT",a,"ON",r.targetPath,t()),e.swap?e.swap(a,s.length,i):e.add&&(e.remove||e["delete"])&&(i.forEach(e.add,e),s.forEach(e.remove||e["delete"],e)))}if(i!==e){if(!i)return e.clear(),void 0;if(i.addRangeChangeListener)return i.addRangeChangeListener(s),s(Array.from(i),Array.from(e),0),function(){i.removeRangeChangeListener(s)}}}),a):i(P.makeLiteralObserver([]),a,u,n,r)}),u)}}function g(e){return function(i,s,a,u,n){return e(C(function(e){return e?i(C(function(i){function s(i,s){if(!u.isActive)try{u.isActive=!0,void 0===i?(n&&n&&console.log("DELETED",n.targetPath,"FOR KEY",s,"ON",e,"BECAUSE",n.sourcePath,t()),Array.isArray(e)?e.splice(s,1):e["delete"](s)):(n&&n&&console.log("SET",n.targetPath,"FOR KEY",s,"TO",i,"ON",e,"BECAUSE",n.sourcePath,t()),e.set(s,i))}finally{u.isActive=!1}}return i?(e.clear(),i.forEach(s),i.addMapChangeListener(s)):(e.clear(),void 0)}),s):void 0}),a)}}function f(e){return function(i,t,s){return e(C(function(e){return e?i(C(function(i){function t(i,t,s){if(!S(e)){var a=e.length-s-t.length;e.swap(a,t.length,i.reversed())}}return i?(i.addRangeChangeListener(t),t(i,e,0),function(){i.removeRangeChangeListener(t)}):(e.clear(),void 0)}),t):void 0}),s)}}function b(e){return function(i,t,s,a,u){return i(C(function(i){return i?Function.noop:e(w,t,s,a,u)}),s)}}function q(e){return function(i,t,s,a,u){return s.parent?e(i,t,s.parent,a,u):void 0}}function y(e,i){return function(t,s,a,u,n){return e(C(function(e){return null!=e?i(t,s,a.nest(e),u,n):void 0}),a)}}function S(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var _=e("./scope"),P=e("./observers"),C=P.autoCancelPrevious,N=P.observeRangeChange,D=P.cancelEach,M=P.makeNotObserver,A=P.makeOrObserver,E=P.makeAndObserver;P.observeValue;var w=P.makeLiteralObserver(),I=new _(!0),x=new _(!1);i.bindProperty=s;var L=s;i.makePropertyBinder=a,i.bindGet=u;var T=u;i.makeGetBinder=n,i.makeHasBinder=r,i.makeEqualityBinder=l,i.makeEveryBlockBinder=o,i.makeAndBinder=c,i.makeOrBinder=m,i.makeConditionalBinder=d,i.makeOnlyBinder=p,i.makeOneBinder=v,i.makeRangeContentBinder=h,i.makeMapContentBinder=g,i.makeReversedBinder=f,i.makeDefinedBinder=b,i.makeParentBinder=q,i.makeWithBinder=y}}),montageDefine("70e9633","operators",{dependencies:["collections/shim-object","collections/shim-regexp","collections/map","collections/set"],factory:function(e,i){e("collections/shim-object"),e("collections/shim-regexp");var t=e("collections/map"),s=e("collections/set");i.toNumber=function(e){return+e},i.toString=function(e){return null==e?e:"string"==typeof e||"number"==typeof e?""+e:null},i.toArray=Array.from,i.toMap=t,i.toSet=s,i.not=function(e){return!e},i.neg=function(e){return-e},i.pow=function(e,i){return Math.pow(e,i)},i.root=function(e,i){return Math.pow(e,1/i)},i.log=function(e,i){return Math.log(e)/Math.log(i)},i.mul=function(e,i){return e*i},i.div=function(e,i){return e/i},i.mod=function(e,i){return(e%i+i)%i},i.rem=function(e,i){return e%i},i.add=function(e,i){return e+i},i.sub=function(e,i){return e-i},i.ceil=function(e){return Math.ceil(e)},i.floor=function(e){return Math.floor(e)},i.round=function(e){return Math.round(e)},i.lt=function(e,i){return 0>Object.compare(e,i)},i.gt=function(e,i){return Object.compare(e,i)>0},i.le=function(e,i){return 0>=Object.compare(e,i)},i.ge=function(e,i){return Object.compare(e,i)>=0},i.equals=Object.equals,i.compare=Object.compare,i.and=function(e,i){return e&&i},i.or=function(e,i){return e||i},i.defined=function(e){return null!=e},i.startsWith=function(e,i){var t=RegExp("^"+RegExp.escape(i));return t.test(e)},i.endsWith=function(e,i){var t=RegExp(RegExp.escape(i)+"$");return t.test(e)},i.contains=function(e,i){var t=RegExp(RegExp.escape(i));return t.test(e)},i.join=function(e,i){return e.join(i||"")},i.split=function(e,i){return e.split(i||"")},i.range=function(e){for(var i=[],t=0;e>t;t++)i.push(t);return i},i.last=function(e){return e.get(e.length-1)}}}),montageDefine("70e9633","merge",{dependencies:["collections/shim"],factory:function(e,i){"use strict";function t(e,i){for(var t,s=(i.length+1)*(e.length+1),a=Array(s),u=Array(i.length+1),n=Array(i.length+1),r=0;e.length+1>r;r++){for(var l=0;i.length+1>l;l++){var o,c;if(0===r&&0===l)o=" ",c=0;else if(0===r)o="insert",c=l;else if(0===l)o="delete",c=r;else if(e[r-1]===i[l-1])o="retain",c=n[l-1];else{var m=u[l-1],d=n[l];m>d?(o="delete",c=d+1):(o="insert",c=m+1)}a[r+l*(e.length+1)]=o,u[l]=c}t=u,u=n,n=t}return{edges:a,cost:n[i.length],source:i,target:e}}function s(e){for(var i,t,s=[],a=e.edges,u=i=e.target.length,n=e.source.length;i||n;){var r=a[i+n*(u+1)];if("delete"===r){if(t&&"delete"===t[0])t[1]++;else{var l=["delete",1];t=l,s.push(l)}i--}else if("insert"===r){if(t&&"insert"===t[0])t[1]++;else{var l=["insert",1];t=l,s.push(l)}n--}else if("retain"===r){var l=["retain",1];t&&"retain"===t[0]?t[1]++:(t=l,s.push(l)),i--,n--}}return s.reverse(),s}function a(e,i){return s(t(e,i))}function u(e,i){for(var t=a(e,i),s=[],u=0,n=0,r=0;t.length>r;){var l=t[r++];if("insert"===l[0])s.push([n,0,i.slice(n,n+l[1])]),n+=l[1];else if("delete"===l[0])if(t.length>r&&"insert"===t[r][0]){var o=t[r++];s.push([n,l[1],i.slice(n,n+o[1])]),u+=l[1],n+=o[1]}else s.push([n,l[1]]),u+=l[1];else"retain"==l[0]&&(u+=l[1],n+=l[1])}return s}function n(e,i){for(var t=0;i.length>t;t++)e.swap.apply(e,i[t])}function r(e,i){n(e,u(e,i))}e("collections/shim"),i.graphOt=t,i.traceOt=s,i.ot=a,i.diff=u,i.apply=n,i.merge=r}}),montageDefine("70e9633","language",{dependencies:["collections/set","collections/dict"],factory:function(e,i){var t=e("collections/set"),s=e("collections/dict"),a=i.precedence=s(),u=i.precedenceLevels=[["tuple","record"],["literal","value","parameters","property","element","component","mapBlock","filterBlock","sortedBlock","groupBlock","groupMapBlock","with"],["not","neg","number","parent"],["scope"],["default"],["pow","root","log"],["mul","div","mod","rem"],["add","sub"],["equals","lt","gt","le","ge","compare"],["and"],["or"],["if"]];u.forEach(function(e){var i=t(a.keys());e.forEach(function(e){a.set(e,i)})});var n=i.operatorTokens=s({"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","!=":"notEquals","??":"default","&&":"and","||":"or","?":"then",":":"else"});i.operatorTypes=s(n.map(function(e,i){return[e,i]}))}}),montageDefine("70e9633","compute",{dependencies:["./parse","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,i,t){function s(e,i,t){t.target=e,t.targetPath=i;var s=t.source=t.source||e,o=t.args,c=t.compute,m=t.parameters=t.parameters||s,d=t.document,p=t.components,v=t.trace,h=t.sourceScope=new l(s);h.parameters=m,h.document=d,h.components=p;var g=t.targetScope=new l(e);g.parameters=m,g.document=d,g.components=p;var f=o.map(function(e){return a(e)}).map(function(e){if("rangeContent"===e.type){var i=u(e.args[0]);return r.makeRangeContentObserver(i)}if("mapContent"===e.type){var i=u(e.args[0]);return r.makeMapContentObserver(i)}return u(e)}),b=r.makeRangeContentObserver(r.makeObserversObserver(f)),q=r.makeComputerObserver(b,c,e),y=a(i),S=n(y);return S(q,h,g,t,v?{sourcePath:o.join(", "),targetPath:i}:void 0)}var a=e("./parse"),u=e("./compile-observer"),n=e("./compile-binder"),r=e("./observers"),l=e("./scope");t.exports=s}}),montageDefine("80d73cb","weak-map",{dependencies:[],factory:function(e,i,t){(function(){"use strict";function e(i){i.permitHostObjects___&&i.permitHostObjects___(e)}function i(e){return!(e.substr(0,o.length)==o&&"___"===e.substr(e.length-3))}function s(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var i=e[c];if(i&&i.key===e)return i;if(!l(e))return void 0;var t=[],s=[];return i={key:e,gets:t,vals:s},r(e,c,{value:i,writable:!1,enumerable:!1,configurable:!1}),i}function a(e){return e.prototype=null,Object.freeze(e)}if("undefined"==typeof ses||!ses.ok||ses.ok()){if("undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=e),"function"==typeof WeakMap){var u=WeakMap;if("undefined"==typeof navigator||!/Firefox/.test(navigator.userAgent))return t.exports=WeakMap,void 0}Object.prototype.hasOwnProperty;var n=Object.getOwnPropertyNames,r=Object.defineProperty,l=Object.isExtensible,o="weakmap:",c=o+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var m=new ArrayBuffer(25),d=new Uint8Array(m);crypto.getRandomValues(d),c=o+"rand:"+Array.prototype.map.call(d,function(e){return(e%36).toString(36)}).join("")+"___"}if(r(Object,"getOwnPropertyNames",{value:function(e){return n(e).filter(i)}}),"getPropertyNames"in Object){var p=Object.getPropertyNames;r(Object,"getPropertyNames",{value:function(e){return p(e).filter(i)}})}(function(){var e=Object.freeze;r(Object,"freeze",{value:function(i){return s(i),e(i)}});var i=Object.seal;r(Object,"seal",{value:function(e){return s(e),i(e)}});var t=Object.preventExtensions;r(Object,"preventExtensions",{value:function(e){return s(e),t(e)}})})();var v=function(){function e(i,t){var a,u,l=s(i);return l?(a=l.gets.indexOf(e),u=l.vals):(a=n.indexOf(i),u=r),a>=0?u[a]:t}function i(i){var t,a=s(i);return t=a?a.gets.indexOf(e):n.indexOf(i),t>=0}function t(i,t){var a,u=s(i);u?(a=u.gets.indexOf(e),a>=0?u.vals[a]=t:(u.gets.push(e),u.vals.push(t))):(a=n.indexOf(i),a>=0?r[a]=t:(n.push(i),r.push(t)))}function u(i){var t,a=s(i);return a?(t=a.gets.indexOf(e),t>=0&&(a.gets.splice(t,1),a.vals.splice(t,1))):(t=n.indexOf(i),t>=0&&(n.splice(t,1),r.splice(t,1))),!0}var n=[],r=[];return Object.create(v.prototype,{get___:{value:a(e)},has___:{value:a(i)},set___:{value:a(t)},delete___:{value:a(u)}})};v.prototype=Object.create(Object.prototype,{get:{value:function(e,i){return this.get___(e,i)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,i){this.set___(e,i)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof u?function(){function i(){function i(e,i){return l?r.has(e)?r.get(e):l.get___(e,i):r.get(e,i)}function t(e){return r.has(e)||(l?l.has___(e):!1)}function s(e,i){if(o)try{r.set(e,i)}catch(t){l||(l=new v),l.set___(e,i)}else r.set(e,i)}function n(e){r["delete"](e),l&&l.delete___(e)}var r=new u,l=void 0,o=!1;return Object.create(v.prototype,{get___:{value:a(i)},has___:{value:a(t)},set___:{value:a(s)},delete___:{value:a(n)},permitHostObjects___:{value:a(function(i){if(i!==e)throw Error("bogus call to permitHostObjects___");o=!0})}})}i.prototype=v.prototype,t.exports=i,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),t.exports=v)}})()}});